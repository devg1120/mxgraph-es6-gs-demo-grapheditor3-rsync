(function(k,U){typeof exports=="object"&&typeof module<"u"?U(exports):typeof define=="function"&&define.amd?define(["exports"],U):(k=typeof globalThis<"u"?globalThis:k||self,U(k.mxgraph={}))})(this,function(exports){"use strict";var kt=Object.defineProperty;var Bt=(k,U,$)=>U in k?kt(k,U,{enumerable:!0,configurable:!0,writable:!0,value:$}):k[U]=$;var u=(k,U,$)=>Bt(k,typeof U!="symbol"?U+"":U,$);class mxPoint{constructor(i,t){this.x=i??0,this.y=t??0}equals(i){return i!=null&&i.x==this.x&&i.y==this.y}clone(){return cloneObj(this)}}function cloneObj(v,i,t){t=t??!1;var e=null;if(v!=null&&typeof v.constructor=="function"){e=new v.constructor;for(var s in v)s!="mxObjectId"&&i==null&&(!t&&typeof v[s]=="object"?e[s]=cloneObj(v[s]):e[s]=v[s])}return e}class mxRectangle extends mxPoint{constructor(i,t,e,s){super(i,t),this.width=e??0,this.height=s??0}setRect(i,t,e,s){this.x=i,this.y=t,this.width=e,this.height=s}getCenterX(){return this.x+this.width/2}getCenterY(){return this.y+this.height/2}add(i){if(i!=null){var t=Math.min(this.x,i.x),e=Math.min(this.y,i.y),s=Math.max(this.x+this.width,i.x+i.width),n=Math.max(this.y+this.height,i.y+i.height);this.x=t,this.y=e,this.width=s-t,this.height=n-e}}intersect(i){if(i!=null){var t=this.x+this.width,e=i.x+i.width,s=this.y+this.height,n=i.y+i.height;this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this.width=Math.min(t,e)-this.x,this.height=Math.min(s,n)-this.y}}grow(i){return this.x-=i,this.y-=i,this.width+=2*i,this.height+=2*i,this}getPoint(){return new mxPoint(this.x,this.y)}rotate90(){var i=(this.width-this.height)/2;this.x+=i,this.y-=i;var t=this.width;this.width=this.height,this.height=t}equals(i){return i!=null&&i.x==this.x&&i.y==this.y&&i.width==this.width&&i.height==this.height}static fromRectangle(i){return new mxRectangle(i.x,i.y,i.width,i.height)}}class mxConstants{}u(mxConstants,"DEFAULT_HOTSPOT",.3),u(mxConstants,"MIN_HOTSPOT_SIZE",8),u(mxConstants,"MAX_HOTSPOT_SIZE",0),u(mxConstants,"RENDERING_HINT_EXACT","exact"),u(mxConstants,"RENDERING_HINT_FASTER","faster"),u(mxConstants,"RENDERING_HINT_FASTEST","fastest"),u(mxConstants,"DIALECT_SVG","svg"),u(mxConstants,"DIALECT_VML","vml"),u(mxConstants,"DIALECT_MIXEDHTML","mixedHtml"),u(mxConstants,"DIALECT_PREFERHTML","preferHtml"),u(mxConstants,"DIALECT_STRICTHTML","strictHtml"),u(mxConstants,"NS_SVG","http://www.w3.org/2000/svg"),u(mxConstants,"NS_XHTML","http://www.w3.org/1999/xhtml"),u(mxConstants,"NS_XLINK","http://www.w3.org/1999/xlink"),u(mxConstants,"SHADOWCOLOR","gray"),u(mxConstants,"VML_SHADOWCOLOR","gray"),u(mxConstants,"SHADOW_OFFSET_X",2),u(mxConstants,"SHADOW_OFFSET_Y",3),u(mxConstants,"SHADOW_OPACITY",1),u(mxConstants,"NODETYPE_ELEMENT",1),u(mxConstants,"NODETYPE_ATTRIBUTE",2),u(mxConstants,"NODETYPE_TEXT",3),u(mxConstants,"NODETYPE_CDATA",4),u(mxConstants,"NODETYPE_ENTITY_REFERENCE",5),u(mxConstants,"NODETYPE_ENTITY",6),u(mxConstants,"NODETYPE_PROCESSING_INSTRUCTION",7),u(mxConstants,"NODETYPE_COMMENT",8),u(mxConstants,"NODETYPE_DOCUMENT",9),u(mxConstants,"NODETYPE_DOCUMENTTYPE",10),u(mxConstants,"NODETYPE_DOCUMENT_FRAGMENT",11),u(mxConstants,"NODETYPE_NOTATION",12),u(mxConstants,"TOOLTIP_VERTICAL_OFFSET",16),u(mxConstants,"DEFAULT_VALID_COLOR","#00FF00"),u(mxConstants,"DEFAULT_INVALID_COLOR","#FF0000"),u(mxConstants,"OUTLINE_HIGHLIGHT_COLOR","#00FF00"),u(mxConstants,"OUTLINE_HIGHLIGHT_STROKEWIDTH",5),u(mxConstants,"HIGHLIGHT_STROKEWIDTH",3),u(mxConstants,"HIGHLIGHT_SIZE",2),u(mxConstants,"HIGHLIGHT_OPACITY",100),u(mxConstants,"CURSOR_MOVABLE_VERTEX","move"),u(mxConstants,"CURSOR_MOVABLE_EDGE","move"),u(mxConstants,"CURSOR_LABEL_HANDLE","default"),u(mxConstants,"CURSOR_TERMINAL_HANDLE","pointer"),u(mxConstants,"CURSOR_BEND_HANDLE","crosshair"),u(mxConstants,"CURSOR_VIRTUAL_BEND_HANDLE","crosshair"),u(mxConstants,"CURSOR_CONNECT","pointer"),u(mxConstants,"HIGHLIGHT_COLOR","#00FF00"),u(mxConstants,"CONNECT_TARGET_COLOR","#0000FF"),u(mxConstants,"INVALID_CONNECT_TARGET_COLOR","#FF0000"),u(mxConstants,"DROP_TARGET_COLOR","#0000FF"),u(mxConstants,"VALID_COLOR","#00FF00"),u(mxConstants,"INVALID_COLOR","#FF0000"),u(mxConstants,"EDGE_SELECTION_COLOR","#00FF00"),u(mxConstants,"VERTEX_SELECTION_COLOR","#00FF00"),u(mxConstants,"VERTEX_SELECTION_STROKEWIDTH",1),u(mxConstants,"EDGE_SELECTION_STROKEWIDTH",1),u(mxConstants,"VERTEX_SELECTION_DASHED",!0),u(mxConstants,"EDGE_SELECTION_DASHED",!0),u(mxConstants,"GUIDE_COLOR","#FF0000"),u(mxConstants,"GUIDE_STROKEWIDTH",1),u(mxConstants,"OUTLINE_COLOR","#0099FF"),u(mxConstants,"OUTLINE_STROKEWIDTH",3),u(mxConstants,"HANDLE_SIZE",6),u(mxConstants,"LABEL_HANDLE_SIZE",4),u(mxConstants,"HANDLE_FILLCOLOR","#00FF00"),u(mxConstants,"HANDLE_STROKECOLOR","black"),u(mxConstants,"LABEL_HANDLE_FILLCOLOR","yellow"),u(mxConstants,"CONNECT_HANDLE_FILLCOLOR","#0000FF"),u(mxConstants,"LOCKED_HANDLE_FILLCOLOR","#FF0000"),u(mxConstants,"OUTLINE_HANDLE_FILLCOLOR","#00FFFF"),u(mxConstants,"OUTLINE_HANDLE_STROKECOLOR","#0033FF"),u(mxConstants,"DEFAULT_FONTFAMILY","Arial,Helvetica"),u(mxConstants,"DEFAULT_FONTSIZE",11),u(mxConstants,"DEFAULT_TEXT_DIRECTION",""),u(mxConstants,"LINE_HEIGHT",1.2),u(mxConstants,"WORD_WRAP","normal"),u(mxConstants,"ABSOLUTE_LINE_HEIGHT",!1),u(mxConstants,"DEFAULT_FONTSTYLE",0),u(mxConstants,"DEFAULT_STARTSIZE",40),u(mxConstants,"DEFAULT_MARKERSIZE",6),u(mxConstants,"DEFAULT_IMAGESIZE",24),u(mxConstants,"ENTITY_SEGMENT",30),u(mxConstants,"RECTANGLE_ROUNDING_FACTOR",.15),u(mxConstants,"LINE_ARCSIZE",20),u(mxConstants,"ARROW_SPACING",0),u(mxConstants,"ARROW_WIDTH",30),u(mxConstants,"ARROW_SIZE",30),u(mxConstants,"PAGE_FORMAT_A4_PORTRAIT",new mxRectangle(0,0,827,1169)),u(mxConstants,"PAGE_FORMAT_A4_LANDSCAPE",new mxRectangle(0,0,1169,827)),u(mxConstants,"PAGE_FORMAT_LETTER_PORTRAIT",new mxRectangle(0,0,850,1100)),u(mxConstants,"PAGE_FORMAT_LETTER_LANDSCAPE",new mxRectangle(0,0,1100,850)),u(mxConstants,"NONE","none"),u(mxConstants,"STYLE_PERIMETER","perimeter"),u(mxConstants,"STYLE_SOURCE_PORT","sourcePort"),u(mxConstants,"STYLE_TARGET_PORT","targetPort"),u(mxConstants,"STYLE_PORT_CONSTRAINT","portConstraint"),u(mxConstants,"STYLE_PORT_CONSTRAINT_ROTATION","portConstraintRotation"),u(mxConstants,"STYLE_SOURCE_PORT_CONSTRAINT","sourcePortConstraint"),u(mxConstants,"STYLE_TARGET_PORT_CONSTRAINT","targetPortConstraint"),u(mxConstants,"STYLE_OPACITY","opacity"),u(mxConstants,"STYLE_FILL_OPACITY","fillOpacity"),u(mxConstants,"STYLE_STROKE_OPACITY","strokeOpacity"),u(mxConstants,"STYLE_TEXT_OPACITY","textOpacity"),u(mxConstants,"STYLE_TEXT_DIRECTION","textDirection"),u(mxConstants,"STYLE_OVERFLOW","overflow"),u(mxConstants,"STYLE_ORTHOGONAL","orthogonal"),u(mxConstants,"STYLE_EXIT_X","exitX"),u(mxConstants,"STYLE_EXIT_Y","exitY"),u(mxConstants,"STYLE_EXIT_DX","exitDx"),u(mxConstants,"STYLE_EXIT_DY","exitDy"),u(mxConstants,"STYLE_EXIT_PERIMETER","exitPerimeter"),u(mxConstants,"STYLE_ENTRY_X","entryX"),u(mxConstants,"STYLE_ENTRY_Y","entryY"),u(mxConstants,"STYLE_ENTRY_DX","entryDx"),u(mxConstants,"STYLE_ENTRY_DY","entryDy"),u(mxConstants,"STYLE_ENTRY_PERIMETER","entryPerimeter"),u(mxConstants,"STYLE_WHITE_SPACE","whiteSpace"),u(mxConstants,"STYLE_ROTATION","rotation"),u(mxConstants,"STYLE_FILLCOLOR","fillColor"),u(mxConstants,"STYLE_POINTER_EVENTS","pointerEvents"),u(mxConstants,"STYLE_SWIMLANE_FILLCOLOR","swimlaneFillColor"),u(mxConstants,"STYLE_MARGIN","margin"),u(mxConstants,"STYLE_GRADIENTCOLOR","gradientColor"),u(mxConstants,"STYLE_GRADIENT_DIRECTION","gradientDirection"),u(mxConstants,"STYLE_STROKECOLOR","strokeColor"),u(mxConstants,"STYLE_SEPARATORCOLOR","separatorColor"),u(mxConstants,"STYLE_STROKEWIDTH","strokeWidth"),u(mxConstants,"STYLE_ALIGN","align"),u(mxConstants,"STYLE_VERTICAL_ALIGN","verticalAlign"),u(mxConstants,"STYLE_LABEL_WIDTH","labelWidth"),u(mxConstants,"STYLE_LABEL_POSITION","labelPosition"),u(mxConstants,"STYLE_VERTICAL_LABEL_POSITION","verticalLabelPosition"),u(mxConstants,"STYLE_IMAGE_ASPECT","imageAspect"),u(mxConstants,"STYLE_IMAGE_ALIGN","imageAlign"),u(mxConstants,"STYLE_IMAGE_VERTICAL_ALIGN","imageVerticalAlign"),u(mxConstants,"STYLE_GLASS","glass"),u(mxConstants,"STYLE_IMAGE","image"),u(mxConstants,"STYLE_IMAGE_WIDTH","imageWidth"),u(mxConstants,"STYLE_IMAGE_HEIGHT","imageHeight"),u(mxConstants,"STYLE_IMAGE_BACKGROUND","imageBackground"),u(mxConstants,"STYLE_IMAGE_BORDER","imageBorder"),u(mxConstants,"STYLE_FLIPH","flipH"),u(mxConstants,"STYLE_FLIPV","flipV"),u(mxConstants,"STYLE_NOLABEL","noLabel"),u(mxConstants,"STYLE_NOEDGESTYLE","noEdgeStyle"),u(mxConstants,"STYLE_LABEL_BACKGROUNDCOLOR","labelBackgroundColor"),u(mxConstants,"STYLE_LABEL_BORDERCOLOR","labelBorderColor"),u(mxConstants,"STYLE_LABEL_PADDING","labelPadding"),u(mxConstants,"STYLE_INDICATOR_SHAPE","indicatorShape"),u(mxConstants,"STYLE_INDICATOR_IMAGE","indicatorImage"),u(mxConstants,"STYLE_INDICATOR_COLOR","indicatorColor"),u(mxConstants,"STYLE_INDICATOR_STROKECOLOR","indicatorStrokeColor"),u(mxConstants,"STYLE_INDICATOR_GRADIENTCOLOR","indicatorGradientColor"),u(mxConstants,"STYLE_INDICATOR_SPACING","indicatorSpacing"),u(mxConstants,"STYLE_INDICATOR_WIDTH","indicatorWidth"),u(mxConstants,"STYLE_INDICATOR_HEIGHT","indicatorHeight"),u(mxConstants,"STYLE_INDICATOR_DIRECTION","indicatorDirection"),u(mxConstants,"STYLE_SHADOW","shadow"),u(mxConstants,"STYLE_SEGMENT","segment"),u(mxConstants,"STYLE_ENDARROW","endArrow"),u(mxConstants,"STYLE_STARTARROW","startArrow"),u(mxConstants,"STYLE_ENDSIZE","endSize"),u(mxConstants,"STYLE_STARTSIZE","startSize"),u(mxConstants,"STYLE_SWIMLANE_LINE","swimlaneLine"),u(mxConstants,"STYLE_ENDFILL","endFill"),u(mxConstants,"STYLE_STARTFILL","startFill"),u(mxConstants,"STYLE_DASHED","dashed"),u(mxConstants,"STYLE_DASH_PATTERN","dashPattern"),u(mxConstants,"STYLE_FIX_DASH","fixDash"),u(mxConstants,"STYLE_ROUNDED","rounded"),u(mxConstants,"STYLE_CURVED","curved"),u(mxConstants,"STYLE_ARCSIZE","arcSize"),u(mxConstants,"STYLE_ABSOLUTE_ARCSIZE","absoluteArcSize"),u(mxConstants,"STYLE_SOURCE_PERIMETER_SPACING","sourcePerimeterSpacing"),u(mxConstants,"STYLE_TARGET_PERIMETER_SPACING","targetPerimeterSpacing"),u(mxConstants,"STYLE_PERIMETER_SPACING","perimeterSpacing"),u(mxConstants,"STYLE_SPACING","spacing"),u(mxConstants,"STYLE_SPACING_TOP","spacingTop"),u(mxConstants,"STYLE_SPACING_LEFT","spacingLeft"),u(mxConstants,"STYLE_SPACING_BOTTOM","spacingBottom"),u(mxConstants,"STYLE_SPACING_RIGHT","spacingRight"),u(mxConstants,"STYLE_HORIZONTAL","horizontal"),u(mxConstants,"STYLE_DIRECTION","direction"),u(mxConstants,"STYLE_ANCHOR_POINT_DIRECTION","anchorPointDirection"),u(mxConstants,"STYLE_ELBOW","elbow"),u(mxConstants,"STYLE_FONTCOLOR","fontColor"),u(mxConstants,"STYLE_FONTFAMILY","fontFamily"),u(mxConstants,"STYLE_FONTSIZE","fontSize"),u(mxConstants,"STYLE_FONTSTYLE","fontStyle"),u(mxConstants,"STYLE_ASPECT","aspect"),u(mxConstants,"STYLE_AUTOSIZE","autosize"),u(mxConstants,"STYLE_FOLDABLE","foldable"),u(mxConstants,"STYLE_EDITABLE","editable"),u(mxConstants,"STYLE_BACKGROUND_OUTLINE","backgroundOutline"),u(mxConstants,"STYLE_BENDABLE","bendable"),u(mxConstants,"STYLE_MOVABLE","movable"),u(mxConstants,"STYLE_RESIZABLE","resizable"),u(mxConstants,"STYLE_RESIZE_WIDTH","resizeWidth"),u(mxConstants,"STYLE_RESIZE_HEIGHT","resizeHeight"),u(mxConstants,"STYLE_ROTATABLE","rotatable"),u(mxConstants,"STYLE_CLONEABLE","cloneable"),u(mxConstants,"STYLE_DELETABLE","deletable"),u(mxConstants,"STYLE_SHAPE","shape"),u(mxConstants,"STYLE_EDGE","edgeStyle"),u(mxConstants,"STYLE_JETTY_SIZE","jettySize"),u(mxConstants,"STYLE_SOURCE_JETTY_SIZE","sourceJettySize"),u(mxConstants,"STYLE_TARGET_JETTY_SIZE","targetJettySize"),u(mxConstants,"STYLE_LOOP","loopStyle"),u(mxConstants,"STYLE_ORTHOGONAL_LOOP","orthogonalLoop"),u(mxConstants,"STYLE_ROUTING_CENTER_X","routingCenterX"),u(mxConstants,"STYLE_ROUTING_CENTER_Y","routingCenterY"),u(mxConstants,"FONT_BOLD",1),u(mxConstants,"FONT_ITALIC",2),u(mxConstants,"FONT_UNDERLINE",4),u(mxConstants,"FONT_STRIKETHROUGH",8),u(mxConstants,"SHAPE_RECTANGLE","rectangle"),u(mxConstants,"SHAPE_ELLIPSE","ellipse"),u(mxConstants,"SHAPE_DOUBLE_ELLIPSE","doubleEllipse"),u(mxConstants,"SHAPE_RHOMBUS","rhombus"),u(mxConstants,"SHAPE_LINE","line"),u(mxConstants,"SHAPE_IMAGE","image"),u(mxConstants,"SHAPE_ARROW","arrow"),u(mxConstants,"SHAPE_ARROW_CONNECTOR","arrowConnector"),u(mxConstants,"SHAPE_LABEL","label"),u(mxConstants,"SHAPE_CYLINDER","cylinder"),u(mxConstants,"SHAPE_SWIMLANE","swimlane"),u(mxConstants,"SHAPE_CONNECTOR","connector"),u(mxConstants,"SHAPE_ACTOR","actor"),u(mxConstants,"SHAPE_CLOUD","cloud"),u(mxConstants,"SHAPE_TRIANGLE","triangle"),u(mxConstants,"SHAPE_HEXAGON","hexagon"),u(mxConstants,"ARROW_CLASSIC","classic"),u(mxConstants,"ARROW_CLASSIC_THIN","classicThin"),u(mxConstants,"ARROW_BLOCK","block"),u(mxConstants,"ARROW_BLOCK_THIN","blockThin"),u(mxConstants,"ARROW_OPEN","open"),u(mxConstants,"ARROW_OPEN_THIN","openThin"),u(mxConstants,"ARROW_OVAL","oval"),u(mxConstants,"ARROW_DIAMOND","diamond"),u(mxConstants,"ARROW_DIAMOND_THIN","diamondThin"),u(mxConstants,"ALIGN_LEFT","left"),u(mxConstants,"ALIGN_CENTER","center"),u(mxConstants,"ALIGN_RIGHT","right"),u(mxConstants,"ALIGN_TOP","top"),u(mxConstants,"ALIGN_MIDDLE","middle"),u(mxConstants,"ALIGN_BOTTOM","bottom"),u(mxConstants,"DIRECTION_NORTH","north"),u(mxConstants,"DIRECTION_SOUTH","south"),u(mxConstants,"DIRECTION_EAST","east"),u(mxConstants,"DIRECTION_WEST","west"),u(mxConstants,"TEXT_DIRECTION_DEFAULT",""),u(mxConstants,"TEXT_DIRECTION_AUTO","auto"),u(mxConstants,"TEXT_DIRECTION_LTR","ltr"),u(mxConstants,"TEXT_DIRECTION_RTL","rtl"),u(mxConstants,"DIRECTION_MASK_NONE",0),u(mxConstants,"DIRECTION_MASK_WEST",1),u(mxConstants,"DIRECTION_MASK_NORTH",2),u(mxConstants,"DIRECTION_MASK_SOUTH",4),u(mxConstants,"DIRECTION_MASK_EAST",8),u(mxConstants,"DIRECTION_MASK_ALL",15),u(mxConstants,"ELBOW_VERTICAL","vertical"),u(mxConstants,"ELBOW_HORIZONTAL","horizontal"),u(mxConstants,"EDGESTYLE_ELBOW","elbowEdgeStyle"),u(mxConstants,"EDGESTYLE_ENTITY_RELATION","entityRelationEdgeStyle"),u(mxConstants,"EDGESTYLE_LOOP","loopEdgeStyle"),u(mxConstants,"EDGESTYLE_SIDETOSIDE","sideToSideEdgeStyle"),u(mxConstants,"EDGESTYLE_TOPTOBOTTOM","topToBottomEdgeStyle"),u(mxConstants,"EDGESTYLE_ORTHOGONAL","orthogonalEdgeStyle"),u(mxConstants,"EDGESTYLE_SEGMENT","segmentEdgeStyle"),u(mxConstants,"PERIMETER_ELLIPSE","ellipsePerimeter"),u(mxConstants,"PERIMETER_RECTANGLE","rectanglePerimeter"),u(mxConstants,"PERIMETER_RHOMBUS","rhombusPerimeter"),u(mxConstants,"PERIMETER_HEXAGON","hexagonPerimeter"),u(mxConstants,"PERIMETER_TRIANGLE","trianglePerimeter");class mxXmlRequest{constructor(i,t,e,s,n,l){u(this,"binary",!1);u(this,"withCredentials",!1);u(this,"request",null);u(this,"decodeSimulateValues",!1);this.url=i,this.params=t,this.method=e||"POST",this.async=s??!0,this.username=n,this.password=l}static get(i,t,e,s,n,l,r){var a=new mxXmlRequest(i,null,"GET"),o=a.setRequestHeaders;return r&&(a.setRequestHeaders=function(h,d){o.apply(this,arguments);for(var g in r)h.setRequestHeader(g,r[g])}),s!=null&&a.setBinary(s),a.send(t,e,n,l),a}static load(i){var t=new mxXmlRequest(i,null,"GET",!1);return t.send(),t}create(){var i=new XMLHttpRequest;return this.isBinary()&&i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined"),i}isBinary(){return this.binary}setBinary(i){this.binary=i}getText(){return this.request.responseText}isReady(){return this.request.readyState==4}getDocumentElement(){var i=this.getXml();return i!=null?i.documentElement:null}getXml(){var i=this.request.responseXML;if(document.documentMode>=9||i==null||i.documentElement==null){var t=new DOMParser;i=t.parseFromString(this.request.responseText,"text/xml")}return i}getStatus(){return this.request!=null?this.request.status:null}send(i,t,e,s){this.request=this.create(),this.request!=null&&(i!=null&&(this.request.onreadystatechange=()=>{this.isReady()&&(i(this),this.request.onreadystatechange=null)}),this.request.open(this.method,this.url,this.async,this.username,this.password),this.setRequestHeaders(this.request,this.params),window.XMLHttpRequest&&this.withCredentials&&(this.request.withCredentials="true"),!mxClient.IS_QUIRKS&&(document.documentMode==null||document.documentMode>9)&&window.XMLHttpRequest&&e!=null&&s!=null&&(this.request.timeout=e,this.request.ontimeout=s),this.request.send(this.params))}setRequestHeaders(i,t){t!=null&&i.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}simulate(i,t){i=i||document;var e=null;i==document&&(e=window.onbeforeunload,window.onbeforeunload=null);var s=i.createElement("form");s.setAttribute("method",this.method),s.setAttribute("action",this.url),t!=null&&s.setAttribute("target",t),s.style.display="none",s.style.visibility="hidden";for(var n=this.params.indexOf("&")>0?this.params.split("&"):this.params.split(),l=0;l<n.length;l++){var r=n[l].indexOf("=");if(r>0){var a=n[l].substring(0,r),o=n[l].substring(r+1);this.decodeSimulateValues&&(o=decodeURIComponent(o));var h=i.createElement("textarea");h.setAttribute("wrap","off"),h.setAttribute("name",a);var i=h.ownerDocument,d=i.createTextNode(o);h!=null&&h.appendChild(d),s.appendChild(h)}}i.body.appendChild(s),s.submit(),s.parentNode!=null&&s.parentNode.removeChild(s),e!=null&&(window.onbeforeunload=e)}}const k=class k{static isLanguageSupported(i){return mxClient.languages!=null?mxClient.languages.indexOf(i)>=0:!0}static getDefaultBundle(i,t){return k.loadDefaultBundle||!k.isLanguageSupported(t)?i+k.extension:null}static getSpecialBundle(i,t){if(mxClient.languages==null||!this.isLanguageSupported(t)){var e=t.indexOf("-");e>0&&(t=t.substring(0,e))}return k.loadSpecialBundle&&k.isLanguageSupported(t)&&t!=mxClient.defaultLanguage?i+"_"+t+k.extension:null}static add(i,t,e){if(t=t??(mxClient.language!=null?mxClient.language.toLowerCase():mxConstants.NONE),t!=mxConstants.NONE){var s=k.getDefaultBundle(i,t),n=k.getSpecialBundle(i,t),l=function(){if(n!=null)if(e)mxXmlRequest.get(n,function(o){k.parse(o.getText()),e()},function(){e()});else try{var a=mxXmlRequest.load(n);a.isReady()&&k.parse(a.getText())}catch{}else e!=null&&e()};if(s!=null)if(e)mxXmlRequest.get(s,function(a){k.parse(a.getText()),l()},function(){l()});else try{var r=mxXmlRequest.load(s);r.isReady()&&k.parse(r.getText()),l()}catch{}else l()}}static parse(i){if(i!=null){for(var t=i.split(`
`),e=0;e<t.length;e++)if(t[e].charAt(0)!="#"){var s=t[e].indexOf("=");if(s>0){var n=t[e].substring(0,s),l=t[e].length;t[e].charCodeAt(l-1)==13&&l--;var r=t[e].substring(s+1,l);this.resourcesEncoded?(r=r.replace(/\\(?=u[a-fA-F\d]{4})/g,"%"),k.resources[n]=unescape(r)):k.resources[n]=r}}}}static get(i,t,e){var s=k.resources[i];return s==null&&(s=e),s!=null&&t!=null&&(s=k.replacePlaceholders(s,t)),s}static replacePlaceholders(i,t){for(var e=[],s=null,n=0;n<i.length;n++){var l=i.charAt(n);l=="{"?s="":s!=null&&l=="}"?(s=parseInt(s)-1,s>=0&&s<t.length&&e.push(t[s]),s=null):s!=null?s+=l:e.push(l)}return e.join("")}static loadResources(i){k.add(mxClient.basePath+"/resources/editor",null,function(){k.add(mxClient.basePath+"/resources/graph",null,i)})}};u(k,"resources",{}),u(k,"extension",".txt"),u(k,"resourcesEncoded",!1),u(k,"loadDefaultBundle",!0),u(k,"loadSpecialBundle",!0);let mxResources=k;const U=class U{static isBrowserSupported(){return U.IS_SVG}static link(i,t,e,s){e=e||document;var n=e.createElement("link");n.setAttribute("rel",i),n.setAttribute("href",t),n.setAttribute("charset","UTF-8"),n.setAttribute("type","text/css"),s&&n.setAttribute("id",s);var l=e.getElementsByTagName("head")[0];l.appendChild(n)}static loadResources(i,t){var e=U.defaultBundles.length;function s(){--e==0&&i()}for(var n=0;n<U.defaultBundles.length;n++)mxResources.add(U.defaultBundles[n],t,s)}static include(i){document.write('<script src="'+i+'"><\/script>')}};u(U,"VERSION","@MXGRAPH-VERSION@"),u(U,"IS_IE",navigator.userAgent!=null&&navigator.userAgent.indexOf("MSIE")>=0),u(U,"IS_IE6",navigator.userAgent!=null&&navigator.userAgent.indexOf("MSIE 6")>=0),u(U,"IS_IE11",navigator.userAgent!=null&&!!navigator.userAgent.match(/Trident\/7\./)),u(U,"IS_EDGE",navigator.userAgent!=null&&!!navigator.userAgent.match(/Edge\//)),u(U,"IS_QUIRKS",navigator.userAgent!=null&&navigator.userAgent.indexOf("MSIE")>=0&&(document.documentMode==null||document.documentMode==5)),u(U,"IS_EM","spellcheck"in document.createElement("textarea")&&document.documentMode==8),u(U,"VML_PREFIX","v"),u(U,"OFFICE_PREFIX","o"),u(U,"IS_NS",navigator.userAgent!=null&&navigator.userAgent.indexOf("Mozilla/")>=0&&navigator.userAgent.indexOf("MSIE")<0&&navigator.userAgent.indexOf("Edge/")<0),u(U,"IS_OP",navigator.userAgent!=null&&(navigator.userAgent.indexOf("Opera/")>=0||navigator.userAgent.indexOf("OPR/")>=0)),u(U,"IS_OT",navigator.userAgent!=null&&navigator.userAgent.indexOf("Presto/")>=0&&navigator.userAgent.indexOf("Presto/2.4.")<0&&navigator.userAgent.indexOf("Presto/2.3.")<0&&navigator.userAgent.indexOf("Presto/2.2.")<0&&navigator.userAgent.indexOf("Presto/2.1.")<0&&navigator.userAgent.indexOf("Presto/2.0.")<0&&navigator.userAgent.indexOf("Presto/1.")<0),u(U,"IS_SF",/Apple Computer, Inc/.test(navigator.vendor)),u(U,"IS_ANDROID",navigator.appVersion.indexOf("Android")>=0),u(U,"IS_IOS",/iP(hone|od|ad)/.test(navigator.platform)),u(U,"IS_GC",/Google Inc/.test(navigator.vendor)),u(U,"IS_CHROMEAPP",window.chrome!=null&&chrome.app!=null&&chrome.app.runtime!=null),u(U,"IS_FF",typeof InstallTrigger<"u"),u(U,"IS_MT",navigator.userAgent.indexOf("Firefox/")>=0&&navigator.userAgent.indexOf("Firefox/1.")<0&&navigator.userAgent.indexOf("Firefox/2.")<0||navigator.userAgent.indexOf("Iceweasel/")>=0&&navigator.userAgent.indexOf("Iceweasel/1.")<0&&navigator.userAgent.indexOf("Iceweasel/2.")<0||navigator.userAgent.indexOf("SeaMonkey/")>=0&&navigator.userAgent.indexOf("SeaMonkey/1.")<0||navigator.userAgent.indexOf("Iceape/")>=0&&navigator.userAgent.indexOf("Iceape/1.")<0),u(U,"IS_VML",navigator.appName.toUpperCase()=="MICROSOFT INTERNET EXPLORER"),u(U,"IS_SVG",navigator.appName.toUpperCase()!="MICROSOFT INTERNET EXPLORER"),u(U,"NO_FO",!document.createElementNS||document.createElementNS("http://www.w3.org/2000/svg","foreignObject")!="[object SVGForeignObjectElement]"||navigator.userAgent.indexOf("Opera/")>=0),u(U,"IS_WIN",navigator.appVersion.indexOf("Win")>0),u(U,"IS_MAC",navigator.appVersion.indexOf("Mac")>0),u(U,"IS_CHROMEOS",/\bCrOS\b/.test(navigator.appVersion)),u(U,"IS_TOUCH","ontouchstart"in document.documentElement),u(U,"IS_POINTER",window.PointerEvent!=null&&!(navigator.appVersion.indexOf("Mac")>0)),u(U,"IS_LOCAL",document.location.href.indexOf("http://")<0&&document.location.href.indexOf("https://")<0),u(U,"defaultBundles",[]);let mxClient=U;class mxEventObject{constructor(i){u(this,"consumed",!1);this.name=i,this.properties=[];for(var t=1;t<arguments.length;t+=2)arguments[t+1]!=null&&(this.properties[arguments[t]]=arguments[t+1])}getName(){return this.name}getProperties(){return this.properties}getProperty(i){return this.properties[i]}isConsumed(){return this.consumed}consume(){this.consumed=!0}}const $=class ${static get(i){if(i!=null){if(i[$.FIELD_NAME]==null)if(typeof i=="object"){var t=getFunctionName(i.constructor);i[$.FIELD_NAME]=t+"#"+$.counter++}else typeof i=="function"&&(i[$.FIELD_NAME]="Function#"+$.counter++);return i[$.FIELD_NAME]}return null}static clear(i){(typeof i=="object"||typeof i=="function")&&delete i[$.FIELD_NAME]}};u($,"FIELD_NAME","mxObjectId"),u($,"counter",0);let mxObjectIdentity=$;function getFunctionName(v){var i=null;if(v!=null){if(v.name!=null)i=v.name;else if(i=v.toString().trim(),/^function\s/.test(i)){i=ltrim(i.substring(9));var t=i.indexOf("(");t>0&&(i=i.substring(0,t))}}return i}function ltrim(v,i){return i=i||"\\s",v!=null?v.replace(new RegExp("^["+i+"]+","g"),""):null}class mxDictionary{constructor(){u(this,"map",null);this.clear()}clear(){this.map={}}get(i){var t=mxObjectIdentity.get(i);return this.map[t]}put(i,t){var e=mxObjectIdentity.get(i),s=this.map[e];return this.map[e]=t,s}remove(i){var t=mxObjectIdentity.get(i),e=this.map[t];return delete this.map[t],e}getKeys(){var i=[];for(var t in this.map)i.push(t);return i}getValues(){var i=[];for(var t in this.map)i.push(this.map[t]);return i}visit(i){for(var t in this.map)i(t,this.map[t])}}const L=class L{static removeAllListeners(i){var t=i.mxListenerList;if(t!=null)for(;t.length>0;){var e=t[0];L.removeListener(i,e.name,e.f)}}static addGestureListeners(i,t,e,s){t!=null&&L.addListener(i,mxClient.IS_POINTER?"pointerdown":"mousedown",t),e!=null&&L.addListener(i,mxClient.IS_POINTER?"pointermove":"mousemove",e),s!=null&&L.addListener(i,mxClient.IS_POINTER?"pointerup":"mouseup",s),!mxClient.IS_POINTER&&mxClient.IS_TOUCH&&(t!=null&&L.addListener(i,"touchstart",t),e!=null&&L.addListener(i,"touchmove",e),s!=null&&L.addListener(i,"touchend",s))}static removeGestureListeners(i,t,e,s){t!=null&&L.removeListener(i,mxClient.IS_POINTER?"pointerdown":"mousedown",t),e!=null&&L.removeListener(i,mxClient.IS_POINTER?"pointermove":"mousemove",e),s!=null&&L.removeListener(i,mxClient.IS_POINTER?"pointerup":"mouseup",s),!mxClient.IS_POINTER&&mxClient.IS_TOUCH&&(t!=null&&L.removeListener(i,"touchstart",t),e!=null&&L.removeListener(i,"touchmove",e),s!=null&&L.removeListener(i,"touchend",s))}static redirectMouseEvents(i,t,e,s,n,l,r){var a=function(o){return typeof e=="function"?e(o):e};L.addGestureListeners(i,function(o){s!=null?s(o):L.isConsumed(o)||t.fireMouseEvent(L.MOUSE_DOWN,new mxMouseEvent(o,a(o)))},function(o){n!=null?n(o):L.isConsumed(o)||t.fireMouseEvent(L.MOUSE_MOVE,new mxMouseEvent(o,a(o)))},function(o){l!=null?l(o):L.isConsumed(o)||t.fireMouseEvent(L.MOUSE_UP,new mxMouseEvent(o,a(o)))}),L.addListener(i,"dblclick",function(o){if(r!=null)r(o);else if(!L.isConsumed(o)){var h=a(o);t.dblClick(o,h!=null?h.cell:null)}})}static release(i){try{if(i!=null){L.removeAllListeners(i);var t=i.childNodes;if(t!=null)for(var e=t.length,s=0;s<e;s+=1)L.release(t[s])}}catch{}}static addMouseWheelListener(i,t){if(i!=null){var e=function(n){n==null&&(n=window.event),n.ctrlKey&&n.preventDefault(),-n.deltaY,(Math.abs(n.deltaX)>.5||Math.abs(n.deltaY)>.5)&&i(n,n.deltaY==0?-n.deltaX>0:-n.deltaY>0)};if(t=t??window,mxClient.IS_SF&&!mxClient.IS_TOUCH){var s=1;L.addListener(t,"gesturestart",function(n){L.consume(n),s=1}),L.addListener(t,"gesturechange",function(n){L.consume(n);var l=s-n.scale;Math.abs(l)>.2&&(i(n,l<0,!0),s=n.scale)}),L.addListener(t,"gestureend",function(n){L.consume(n)})}L.addListener(t,"wheel",e)}}static disableContextMenu(i){L.addListener(i,"contextmenu",function(t){return t.preventDefault&&t.preventDefault(),!1})}static getSource(i){return i.srcElement!=null?i.srcElement:i.target}static isConsumed(i){return i.isConsumed!=null&&i.isConsumed}static isTouchEvent(i){return i.pointerType!=null?i.pointerType=="touch"||i.pointerType===i.MSPOINTER_TYPE_TOUCH:i.mozInputSource!=null?i.mozInputSource==5:i.type.indexOf("touch")==0}static isPenEvent(i){return i.pointerType!=null?i.pointerType=="pen"||i.pointerType===i.MSPOINTER_TYPE_PEN:i.mozInputSource!=null?i.mozInputSource==2:i.type.indexOf("pen")==0}static isMultiTouchEvent(i){return i.type!=null&&i.type.indexOf("touch")==0&&i.touches!=null&&i.touches.length>1}static isMouseEvent(i){return i.pointerType!=null?i.pointerType=="mouse"||i.pointerType===i.MSPOINTER_TYPE_MOUSE:i.mozInputSource!=null?i.mozInputSource==1:i.type.indexOf("mouse")==0}static isLeftMouseButton(i){return"buttons"in i&&(i.type=="mousedown"||i.type=="mousemove")?i.buttons==1:"which"in i?i.which===1:i.button===1}static isMiddleMouseButton(i){return"which"in i?i.which===2:i.button===4}static isRightMouseButton(i){return"which"in i?i.which===3:i.button===2}static isPopupTrigger(i){return L.isRightMouseButton(i)||mxClient.IS_MAC&&L.isControlDown(i)&&!L.isShiftDown(i)&&!L.isMetaDown(i)&&!L.isAltDown(i)}static isShiftDown(i){return i!=null?i.shiftKey:!1}static isAltDown(i){return i!=null?i.altKey:!1}static isControlDown(i){return i!=null?i.ctrlKey:!1}static isMetaDown(i){return i!=null?i.metaKey:!1}static getMainEvent(i){return(i.type=="touchstart"||i.type=="touchmove")&&i.touches!=null&&i.touches[0]!=null?i=i.touches[0]:i.type=="touchend"&&i.changedTouches!=null&&i.changedTouches[0]!=null&&(i=i.changedTouches[0]),i}static getClientX(i){return L.getMainEvent(i).clientX}static getClientY(i){return L.getMainEvent(i).clientY}static org_consume(i,t,e){t=t??!0,e=e??!0,t&&(i.preventDefault?(e&&i.stopPropagation(),i.preventDefault()):e&&(i.cancelBubble=!0)),i.isConsumed=!0,i.preventDefault||(i.returnValue=!1)}static consume(i,t,e){t=t??!0,e=e??!0,t&&(i.preventDefault?(e&&i.stopPropagation(),i.type!="wheel"&&i.preventDefault()):e&&(i.cancelBubble=!0)),i.isConsumed=!0,i.preventDefault||(i.returnValue=!1)}};u(L,"addListener",function(){var i=function(t,e,s){t.mxListenerList==null&&(t.mxListenerList=[]);var n={name:e,f:s};t.mxListenerList.push(n)};return window.addEventListener?function(t,e,s){t.addEventListener(e,s,!1),i(t,e,s)}:function(t,e,s){t.attachEvent("on"+e,s),i(t,e,s)}}()),u(L,"removeListener",function(){var i=function(t,e,s){if(t.mxListenerList!=null){for(var n=t.mxListenerList.length,l=0;l<n;l++){var r=t.mxListenerList[l];if(r.f==s){t.mxListenerList.splice(l,1);break}}t.mxListenerList.length==0&&(t.mxListenerList=null)}};return window.removeEventListener?function(t,e,s){t.removeEventListener(e,s,!1),i(t,e,s)}:function(t,e,s){t.detachEvent("on"+e,s),i(t,e,s)}}()),u(L,"LABEL_HANDLE",-1),u(L,"ROTATION_HANDLE",-2),u(L,"CUSTOM_HANDLE",-100),u(L,"VIRTUAL_HANDLE",-1e5),u(L,"MOUSE_DOWN","mouseDown"),u(L,"MOUSE_MOVE","mouseMove"),u(L,"MOUSE_UP","mouseUp"),u(L,"ACTIVATE","activate"),u(L,"RESIZE_START","resizeStart"),u(L,"RESIZE","resize"),u(L,"RESIZE_END","resizeEnd"),u(L,"MOVE_START","moveStart"),u(L,"MOVE","move"),u(L,"MOVE_END","moveEnd"),u(L,"PAN_START","panStart"),u(L,"PAN","pan"),u(L,"PAN_END","panEnd"),u(L,"MINIMIZE","minimize"),u(L,"NORMALIZE","normalize"),u(L,"MAXIMIZE","maximize"),u(L,"HIDE","hide"),u(L,"SHOW","show"),u(L,"CLOSE","close"),u(L,"DESTROY","destroy"),u(L,"REFRESH","refresh"),u(L,"SIZE","size"),u(L,"SELECT","select"),u(L,"FIRED","fired"),u(L,"FIRE_MOUSE_EVENT","fireMouseEvent"),u(L,"GESTURE","gesture"),u(L,"TAP_AND_HOLD","tapAndHold"),u(L,"GET","get"),u(L,"RECEIVE","receive"),u(L,"CONNECT","connect"),u(L,"DISCONNECT","disconnect"),u(L,"SUSPEND","suspend"),u(L,"RESUME","resume"),u(L,"MARK","mark"),u(L,"ROOT","root"),u(L,"POST","post"),u(L,"OPEN","open"),u(L,"SAVE","save"),u(L,"BEFORE_ADD_VERTEX","beforeAddVertex"),u(L,"ADD_VERTEX","addVertex"),u(L,"AFTER_ADD_VERTEX","afterAddVertex"),u(L,"DONE","done"),u(L,"EXECUTE","execute"),u(L,"EXECUTED","executed"),u(L,"BEGIN_UPDATE","beginUpdate"),u(L,"START_EDIT","startEdit"),u(L,"END_UPDATE","endUpdate"),u(L,"END_EDIT","endEdit"),u(L,"BEFORE_UNDO","beforeUndo"),u(L,"UNDO","undo"),u(L,"REDO","redo"),u(L,"CHANGE","change"),u(L,"NOTIFY","notify"),u(L,"LAYOUT_CELLS","layoutCells"),u(L,"CLICK","click"),u(L,"SCALE","scale"),u(L,"TRANSLATE","translate"),u(L,"SCALE_AND_TRANSLATE","scaleAndTranslate"),u(L,"UP","up"),u(L,"DOWN","down"),u(L,"ADD","add"),u(L,"REMOVE","remove"),u(L,"CLEAR","clear"),u(L,"ADD_CELLS","addCells"),u(L,"CELLS_ADDED","cellsAdded"),u(L,"MOVE_CELLS","moveCells"),u(L,"CELLS_MOVED","cellsMoved"),u(L,"RESIZE_CELLS","resizeCells"),u(L,"CELLS_RESIZED","cellsResized"),u(L,"TOGGLE_CELLS","toggleCells"),u(L,"CELLS_TOGGLED","cellsToggled"),u(L,"ORDER_CELLS","orderCells"),u(L,"CELLS_ORDERED","cellsOrdered"),u(L,"REMOVE_CELLS","removeCells"),u(L,"CELLS_REMOVED","cellsRemoved"),u(L,"GROUP_CELLS","groupCells"),u(L,"UNGROUP_CELLS","ungroupCells"),u(L,"REMOVE_CELLS_FROM_PARENT","removeCellsFromParent"),u(L,"FOLD_CELLS","foldCells"),u(L,"CELLS_FOLDED","cellsFolded"),u(L,"ALIGN_CELLS","alignCells"),u(L,"LABEL_CHANGED","labelChanged"),u(L,"CONNECT_CELL","connectCell"),u(L,"CELL_CONNECTED","cellConnected"),u(L,"SPLIT_EDGE","splitEdge"),u(L,"FLIP_EDGE","flipEdge"),u(L,"START_EDITING","startEditing"),u(L,"EDITING_STARTED","editingStarted"),u(L,"EDITING_STOPPED","editingStopped"),u(L,"ADD_OVERLAY","addOverlay"),u(L,"REMOVE_OVERLAY","removeOverlay"),u(L,"UPDATE_CELL_SIZE","updateCellSize"),u(L,"ESCAPE","escape"),u(L,"DOUBLE_CLICK","doubleClick"),u(L,"START","start"),u(L,"RESET","reset");let mxEvent=L;class mxCellHighlight{constructor(i,t,e,s){u(this,"keepOnTop",!1);u(this,"graph",null);u(this,"state",null);u(this,"spacing",2);u(this,"resetHandler",null);i!=null&&(this.graph=i,this.highlightColor=t??mxConstants.DEFAULT_VALID_COLOR,this.strokeWidth=e??mxConstants.HIGHLIGHT_STROKEWIDTH,this.dashed=s??!1,this.opacity=mxConstants.HIGHLIGHT_OPACITY,this.repaintHandler=()=>{if(this.state!=null){var n=this.graph.view.getState(this.state.cell);n==null?this.hide():(this.state=n,this.repaint())}},this.graph.getView().addListener(mxEvent.SCALE,this.repaintHandler),this.graph.getView().addListener(mxEvent.TRANSLATE,this.repaintHandler),this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.repaintHandler),this.graph.getModel().addListener(mxEvent.CHANGE,this.repaintHandler),this.resetHandler=()=>{this.hide()},this.graph.getView().addListener(mxEvent.DOWN,this.resetHandler),this.graph.getView().addListener(mxEvent.UP,this.resetHandler))}setHighlightColor(i){this.highlightColor=i,this.shape!=null&&(this.shape.stroke=i)}drawHighlight(){this.shape=this.createShape(),this.repaint(),!this.keepOnTop&&this.shape.node.parentNode.firstChild!=this.shape.node&&this.shape.node.parentNode.insertBefore(this.shape.node,this.shape.node.parentNode.firstChild)}createShape(){var i=this.graph.cellRenderer.createShape(this.state);return i.svgStrokeTolerance=this.graph.tolerance,i.points=this.state.absolutePoints,i.apply(this.state),i.stroke=this.highlightColor,i.opacity=this.opacity,i.isDashed=this.dashed,i.isShadow=!1,i.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,i.init(this.graph.getView().getOverlayPane()),mxEvent.redirectMouseEvents(i.node,this.graph,this.state),this.graph.dialect!=mxConstants.DIALECT_SVG?i.pointerEvents=!1:i.svgPointerEvents="stroke",i}getStrokeWidth(i){return this.strokeWidth}repaint(){this.state!=null&&this.shape!=null&&(this.shape.scale=this.state.view.scale,this.graph.model.isEdge(this.state.cell)?(this.shape.strokewidth=this.getStrokeWidth(),this.shape.points=this.state.absolutePoints,this.shape.outline=!1):(this.shape.bounds=new mxRectangle(this.state.x-this.spacing,this.state.y-this.spacing,this.state.width+2*this.spacing,this.state.height+2*this.spacing),this.shape.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"),this.shape.strokewidth=this.getStrokeWidth()/this.state.view.scale,this.shape.outline=!0),this.state.shape!=null&&this.shape.setCursor(this.state.shape.getCursor()),(mxClient.IS_QUIRKS||document.documentMode==8)&&(this.shape.stroke=="transparent"?(this.shape.stroke="white",this.shape.opacity=1):this.shape.opacity=this.opacity),this.shape.redraw())}hide(){this.highlight(null)}highlight(i){this.state!=i&&(this.shape!=null&&(this.shape.destroy(),this.shape=null),this.state=i,this.state!=null&&this.drawHighlight())}isHighlightAt(i,t){var e=!1;if(this.shape!=null&&document.elementFromPoint!=null&&!mxClient.IS_QUIRKS)for(var s=document.elementFromPoint(i,t);s!=null;){if(s==this.shape.node){e=!0;break}s=s.parentNode}return e}destroy(){this.graph.getView().removeListener(this.resetHandler),this.graph.getView().removeListener(this.repaintHandler),this.graph.getModel().removeListener(this.repaintHandler),this.shape!=null&&(this.shape.destroy(),this.shape=null)}}class mxUrlConverter{constructor(){u(this,"enabled",!0);u(this,"baseUrl",null);u(this,"baseDomain",null)}updateBaseUrl(){this.baseDomain=location.protocol+"//"+location.host,this.baseUrl=this.baseDomain+location.pathname;var i=this.baseUrl.lastIndexOf("/");i>0&&(this.baseUrl=this.baseUrl.substring(0,i+1))}isEnabled(){return this.enabled}setEnabled(i){this.enabled=i}getBaseUrl(){return this.baseUrl}setBaseUrl(i){this.baseUrl=i}getBaseDomain(){return this.baseDomain}setBaseDomain(i){this.baseDomain=i}isRelativeUrl(i){return i!=null&&i.substring(0,2)!="//"&&i.substring(0,7)!="http://"&&i.substring(0,8)!="https://"&&i.substring(0,10)!="data:image"&&i.substring(0,7)!="file://"}convert(i){return this.isEnabled()&&this.isRelativeUrl(i)&&(this.getBaseUrl()==null&&this.updateBaseUrl(),i.charAt(0)=="/"?i=this.getBaseDomain()+i:i=this.getBaseUrl()+i),i}}class mxAbstractCanvas2D{constructor(){u(this,"state",null);u(this,"states",null);u(this,"path",null);u(this,"rotateHtml",!0);u(this,"lastX",0);u(this,"lastY",0);u(this,"moveOp","M");u(this,"lineOp","L");u(this,"quadOp","Q");u(this,"curveOp","C");u(this,"closeOp","Z");u(this,"pointerEvents",!1);this.converter=this.createUrlConverter(),this.reset()}createUrlConverter(){return new mxUrlConverter}reset(){this.state=this.createState(),this.states=[]}createState(){return{dx:0,dy:0,scale:1,alpha:1,fillAlpha:1,strokeAlpha:1,fillColor:null,gradientFillAlpha:1,gradientColor:null,gradientAlpha:1,gradientDirection:null,strokeColor:null,strokeWidth:1,dashed:!1,dashPattern:"3 3",fixDash:!1,lineCap:"flat",lineJoin:"miter",miterLimit:10,fontColor:"#000000",fontBackgroundColor:null,fontBorderColor:null,fontSize:mxConstants.DEFAULT_FONTSIZE,fontFamily:mxConstants.DEFAULT_FONTFAMILY,fontStyle:0,shadow:!1,shadowColor:mxConstants.SHADOWCOLOR,shadowAlpha:mxConstants.SHADOW_OPACITY,shadowDx:mxConstants.SHADOW_OFFSET_X,shadowDy:mxConstants.SHADOW_OFFSET_Y,rotation:0,rotationCx:0,rotationCy:0}}format(i){return Math.round(parseFloat(i))}addOp(){if(this.path!=null&&(this.path.push(arguments[0]),arguments.length>2))for(var i=this.state,t=2;t<arguments.length;t+=2)this.lastX=arguments[t-1],this.lastY=arguments[t],this.path.push(this.format((this.lastX+i.dx)*i.scale)),this.path.push(this.format((this.lastY+i.dy)*i.scale))}rotatePoint(i,t,e,s,n){var l=e*(Math.PI/180);return mxUtils.getRotatedPoint(new mxPoint(i,t),Math.cos(l),Math.sin(l),new mxPoint(s,n))}save(){this.states.push(this.state),this.state=mxUtils.clone(this.state)}restore(){this.states.length>0&&(this.state=this.states.pop())}setLink(i){}scale(i){this.state.scale*=i,this.state.strokeWidth*=i}translate(i,t){this.state.dx+=i,this.state.dy+=t}rotate(i,t,e,s,n){}setAlpha(i){this.state.alpha=i}setFillAlpha(i){this.state.fillAlpha=i}setStrokeAlpha(i){this.state.strokeAlpha=i}setFillColor(i){i==mxConstants.NONE&&(i=null),this.state.fillColor=i,this.state.gradientColor=null}setGradient(i,t,e,s,n,l,r,a,o){var h=this.state;h.fillColor=i,h.gradientFillAlpha=a??1,h.gradientColor=t,h.gradientAlpha=o??1,h.gradientDirection=r}setStrokeColor(i){i==mxConstants.NONE&&(i=null),this.state.strokeColor=i}setStrokeWidth(i){this.state.strokeWidth=i}setDashed(i,t){this.state.dashed=i,this.state.fixDash=t}setDashPattern(i){this.state.dashPattern=i}setLineCap(i){this.state.lineCap=i}setLineJoin(i){this.state.lineJoin=i}setMiterLimit(i){this.state.miterLimit=i}setFontColor(i){i==mxConstants.NONE&&(i=null),this.state.fontColor=i}setFontBackgroundColor(i){i==mxConstants.NONE&&(i=null),this.state.fontBackgroundColor=i}setFontBorderColor(i){i==mxConstants.NONE&&(i=null),this.state.fontBorderColor=i}setFontSize(i){this.state.fontSize=parseFloat(i)}setFontFamily(i){this.state.fontFamily=i}setFontStyle(i){i==null&&(i=0),this.state.fontStyle=i}setShadow(i){this.state.shadow=i}setShadowColor(i){i==mxConstants.NONE&&(i=null),this.state.shadowColor=i}setShadowAlpha(i){this.state.shadowAlpha=i}setShadowOffset(i,t){this.state.shadowDx=i,this.state.shadowDy=t}begin(){this.lastX=0,this.lastY=0,this.path=[]}moveTo(i,t){this.addOp(this.moveOp,i,t)}lineTo(i,t){this.addOp(this.lineOp,i,t)}quadTo(i,t,e,s){this.addOp(this.quadOp,i,t,e,s)}curveTo(i,t,e,s,n,l){this.addOp(this.curveOp,i,t,e,s,n,l)}arcTo(i,t,e,s,n,l,r){var a=mxUtils.arcToCurves(this.lastX,this.lastY,i,t,e,s,n,l,r);if(a!=null)for(var o=0;o<a.length;o+=6)this.curveTo(a[o],a[o+1],a[o+2],a[o+3],a[o+4],a[o+5])}close(i,t,e,s,n,l){this.addOp(this.closeOp)}end(){}}class mxVmlCanvas2D extends mxAbstractCanvas2D{constructor(t){super();u(this,"node",null);u(this,"textEnabled",!0);u(this,"moveOp","m");u(this,"lineOp","l");u(this,"curveOp","c");u(this,"closeOp","x");u(this,"rotatedHtmlBackground","");u(this,"vmlScale",1);this.root=t}createElement(t){return document.createElement(t)}createVmlElement(t){return this.createElement(mxClient.VML_PREFIX+":"+t)}addNode(t,e){var s=this.node,n=this.state;if(s!=null){if(s.nodeName=="shape")if(this.path!=null&&this.path.length>0)s.path=this.path.join(" ")+" e",s.style.width=this.root.style.width,s.style.height=this.root.style.height,s.coordsize=parseInt(s.style.width)+" "+parseInt(s.style.height);else return;s.strokeweight=this.format(Math.max(1,n.strokeWidth*n.scale/this.vmlScale))+"px",n.shadow&&this.root.appendChild(this.createShadow(s,t&&n.fillColor!=null,e&&n.strokeColor!=null)),e&&n.strokeColor!=null?(s.stroked="true",s.strokecolor=n.strokeColor):s.stroked="false",s.appendChild(this.createStroke()),t&&n.fillColor!=null?s.appendChild(this.createFill()):this.pointerEvents&&(s.nodeName!="shape"||this.path[this.path.length-1]==this.closeOp)?s.appendChild(this.createTransparentFill()):s.filled="false",this.root.appendChild(s)}}createTransparentFill(){var t=this.createVmlElement("fill");return t.src=mxClient.imageBasePath+"/transparent.gif",t.type="tile",t}createFill(){var t=this.state,e=this.createVmlElement("fill");if(e.color=t.fillColor,t.gradientColor!=null){e.type="gradient",e.method="none",e.color2=t.gradientColor;var s=180-t.rotation;t.gradientDirection==mxConstants.DIRECTION_WEST?s-=90+(this.root.style.flip=="x"?180:0):t.gradientDirection==mxConstants.DIRECTION_EAST?s+=90+(this.root.style.flip=="x"?180:0):t.gradientDirection==mxConstants.DIRECTION_NORTH?s-=180+(this.root.style.flip=="y"?-180:0):s+=this.root.style.flip=="y"?-180:0,(this.root.style.flip=="x"||this.root.style.flip=="y")&&(s*=-1),e.angle=mxUtils.mod(s,360),e.opacity=t.alpha*t.gradientFillAlpha*100+"%",e.setAttribute(mxClient.OFFICE_PREFIX+":opacity2",t.alpha*t.gradientAlpha*100+"%")}else(t.alpha<1||t.fillAlpha<1)&&(e.opacity=t.alpha*t.fillAlpha*100+"%");return e}createStroke(){var t=this.state,e=this.createVmlElement("stroke");return e.endcap=t.lineCap||"flat",e.joinstyle=t.lineJoin||"miter",e.miterlimit=t.miterLimit||"10",(t.alpha<1||t.strokeAlpha<1)&&(e.opacity=t.alpha*t.strokeAlpha*100+"%"),t.dashed&&(e.dashstyle=this.getVmlDashStyle()),e}getVmlDashStyle(){var t="dash";if(typeof this.state.dashPattern=="string"){var e=this.state.dashPattern.split(" ");e.length>0&&e[0]==1&&(t="0 2")}return t}createShadow(t,e,s){var n=this.state,l=-n.rotation*(Math.PI/180),r=Math.cos(l),a=Math.sin(l),o=n.shadowDx*n.scale,h=n.shadowDy*n.scale;this.root.style.flip=="x"?o*=-1:this.root.style.flip=="y"&&(h*=-1);var d=t.cloneNode(!0);return d.style.marginLeft=Math.round(o*r-h*a)+"px",d.style.marginTop=Math.round(o*a+h*r)+"px",document.documentMode==8&&(d.strokeweight=t.strokeweight,t.nodeName=="shape"&&(d.path=this.path.join(" ")+" e",d.style.width=this.root.style.width,d.style.height=this.root.style.height,d.coordsize=parseInt(t.style.width)+" "+parseInt(t.style.height))),s?(d.strokecolor=n.shadowColor,d.appendChild(this.createShadowStroke())):d.stroked="false",e?d.appendChild(this.createShadowFill()):d.filled="false",d}createShadowFill(){var t=this.createVmlElement("fill");return t.color=this.state.shadowColor,t.opacity=this.state.alpha*this.state.shadowAlpha*100+"%",t}createShadowStroke(){var t=this.createStroke();return t.opacity=this.state.alpha*this.state.shadowAlpha*100+"%",t}rotate(t,e,s,n,l){e&&s?t+=180:e?this.root.style.flip="x":s&&(this.root.style.flip="y"),(e?!s:s)&&(t*=-1),this.root.style.rotation=t,this.state.rotation=this.state.rotation+t,this.state.rotationCx=n,this.state.rotationCy=l}begin(){super.begin(),this.node=this.createVmlElement("shape"),this.node.style.position="absolute"}quadTo(t,e,s,n){var l=this.state,r=(this.lastX+l.dx)*l.scale,a=(this.lastY+l.dy)*l.scale,o=(t+l.dx)*l.scale,h=(e+l.dy)*l.scale,d=(s+l.dx)*l.scale,g=(n+l.dy)*l.scale,m=r+2/3*(o-r),f=a+2/3*(h-a),c=d+2/3*(o-d),x=g+2/3*(h-g);this.path.push("c "+this.format(m)+" "+this.format(f)+" "+this.format(c)+" "+this.format(x)+" "+this.format(d)+" "+this.format(g)),this.lastX=d/l.scale-l.dx,this.lastY=g/l.scale-l.dy}createRect(t,e,s,n,l){var r=this.state,a=this.createVmlElement(t);return a.style.position="absolute",a.style.left=this.format((e+r.dx)*r.scale)+"px",a.style.top=this.format((s+r.dy)*r.scale)+"px",a.style.width=this.format(n*r.scale)+"px",a.style.height=this.format(l*r.scale)+"px",a}rect(t,e,s,n){this.node=this.createRect("rect",t,e,s,n)}roundrect(t,e,s,n,l,r){this.node=this.createRect("roundrect",t,e,s,n),this.node.setAttribute("arcsize",Math.max(l*100/s,r*100/n)+"%")}ellipse(t,e,s,n){this.node=this.createRect("oval",t,e,s,n)}image(t,e,s,n,l,r,a,o){var h=null;if(!r)h=this.createRect("image",t,e,s,n),h.src=l;else{h=this.createRect("rect",t,e,s,n),h.stroked="false";var d=this.createVmlElement("fill");d.aspect=r?"atmost":"ignore",d.rotate="true",d.type="frame",d.src=l,h.appendChild(d)}a&&o?h.style.rotation="180":a?h.style.flip="x":o&&(h.style.flip="y"),(this.state.alpha<1||this.state.fillAlpha<1)&&(h.style.filter+="alpha(opacity="+this.state.alpha*this.state.fillAlpha*100+")"),this.root.appendChild(h)}createDiv(t,e,s,n){var l=this.createElement("div"),r=this.state,a="";if(r.fontBackgroundColor!=null&&(a+="background-color:"+mxUtils.htmlEntities(r.fontBackgroundColor)+";"),r.fontBorderColor!=null&&(a+="border:1px solid "+mxUtils.htmlEntities(r.fontBorderColor)+";"),mxUtils.isNode(t))l.appendChild(t);else if(n!="fill"&&n!="width"){var o=this.createElement("div");o.style.cssText=a,o.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",o.style.zoom="1",o.style.textDecoration="inherit",o.innerHTML=t,l.appendChild(o)}else l.style.cssText=a,l.innerHTML=t;var h=l.style;return h.fontSize=r.fontSize/this.vmlScale+"px",h.fontFamily=r.fontFamily,h.color=r.fontColor,h.verticalAlign="top",h.textAlign=e||"left",h.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?r.fontSize*mxConstants.LINE_HEIGHT/this.vmlScale+"px":mxConstants.LINE_HEIGHT,(r.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(h.fontWeight="bold"),(r.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(h.fontStyle="italic"),(r.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(h.textDecoration="underline"),l}text(t,e,s,n,l,r,a,o,h,d,g,m,f){if(this.textEnabled&&l!=null){var c=this.state;if(h=="html"){if(c.rotation!=null){var x=this.rotatePoint(t,e,c.rotation,c.rotationCx,c.rotationCy);t=x.x,e=x.y}document.documentMode==8&&!mxClient.IS_EM?(t+=c.dx,e+=c.dy,d!="fill"&&a==mxConstants.ALIGN_TOP&&(e-=1)):(t*=c.scale,e*=c.scale);var p=document.documentMode==8&&!mxClient.IS_EM?this.createVmlElement("group"):this.createElement("div");p.style.position="absolute",p.style.display="inline",p.style.left=this.format(t)+"px",p.style.top=this.format(e)+"px",p.style.zoom=c.scale;var C=this.createElement("div");C.style.position="relative",C.style.display="inline";var E=mxUtils.getAlignmentAsPoint(r,a),T=E.x,S=E.y,y=this.createDiv(l,r,a,d),b=this.createElement("div");if(f!=null&&y.setAttribute("dir",f),o&&s>0){if(g||(y.style.width=Math.round(s)+"px"),y.style.wordWrap=mxConstants.WORD_WRAP,y.style.whiteSpace="normal",y.style.wordWrap=="break-word"){var w=y;w.firstChild!=null&&w.firstChild.nodeName=="DIV"&&(w.firstChild.style.width="100%")}}else y.style.whiteSpace="nowrap";var I=c.rotation+(m||0);if(this.rotateHtml&&I!=0?(b.style.display="inline",b.style.zoom="1",b.appendChild(y),document.documentMode==8&&!mxClient.IS_EM&&this.root.nodeName!="DIV"?(C.appendChild(b),p.appendChild(C)):p.appendChild(b)):document.documentMode==8&&!mxClient.IS_EM?(C.appendChild(y),p.appendChild(C)):(y.style.display="inline",p.appendChild(y)),this.root.nodeName!="DIV"){var O=this.createVmlElement("rect");O.stroked="false",O.filled="false",O.appendChild(p),this.root.appendChild(O)}else this.root.appendChild(p);if(g?(y.style.overflow="hidden",y.style.width=Math.round(s)+"px",mxClient.IS_QUIRKS||(y.style.maxHeight=Math.round(n)+"px")):d=="fill"?(y.style.overflow="hidden",y.style.width=Math.max(0,s)+1+"px",y.style.height=Math.max(0,n)+1+"px"):d=="width"&&(y.style.overflow="hidden",y.style.width=Math.max(0,s)+1+"px",y.style.maxHeight=Math.max(0,n)+1+"px"),this.rotateHtml&&I!=0){var P=I*(Math.PI/180),M=parseFloat(parseFloat(Math.cos(P)).toFixed(8)),H=parseFloat(parseFloat(Math.sin(-P)).toFixed(8));P%=2*Math.PI,P<0&&(P+=2*Math.PI),P%=Math.PI,P>Math.PI/2&&(P=Math.PI-P);var R=Math.cos(P),D=Math.sin(P);document.documentMode==8&&!mxClient.IS_EM&&(y.style.display="inline-block",b.style.display="inline-block",C.style.display="inline-block"),y.style.visibility="hidden",y.style.position="absolute",document.body.appendChild(y);var A=y;A.firstChild!=null&&A.firstChild.nodeName=="DIV"&&(A=A.firstChild);var w=A.offsetWidth+3,G=A.offsetHeight;g?(s=Math.min(s,w),G=Math.min(G,n)):s=w,o&&(y.style.width=s+"px"),mxClient.IS_QUIRKS&&(g||d=="width")&&G>n&&(G=n,y.style.height=G+"px"),n=G;var B=(n-n*R+s*-D)/2-H*s*(T+.5)+M*n*(S+.5),tt=(s-s*R+n*-D)/2+M*s*(T+.5)+H*n*(S+.5);if(p.nodeName=="group"&&this.root.nodeName=="DIV"){var q=this.createElement("div");q.style.display="inline-block",q.style.position="absolute",q.style.left=this.format(t+(tt-s/2)*c.scale)+"px",q.style.top=this.format(e+(B-n/2)*c.scale)+"px",p.parentNode.appendChild(q),q.appendChild(p)}else{var j=document.documentMode==8&&!mxClient.IS_EM?1:c.scale;p.style.left=this.format(t+(tt-s/2)*j)+"px",p.style.top=this.format(e+(B-n/2)*j)+"px"}b.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+M+", M12="+H+", M21="+-H+", M22="+M+", sizingMethod='auto expand')",b.style.backgroundColor=this.rotatedHtmlBackground,this.state.alpha<1&&(b.style.filter+="alpha(opacity="+this.state.alpha*100+")"),b.appendChild(y),y.style.position="",y.style.visibility=""}else if(document.documentMode!=8||mxClient.IS_EM){y.style.verticalAlign="top",this.state.alpha<1&&(p.style.filter="alpha(opacity="+this.state.alpha*100+")");var V=y.parentNode;y.style.visibility="hidden",document.body.appendChild(y),s=y.offsetWidth;var G=y.offsetHeight;mxClient.IS_QUIRKS&&g&&G>n&&(G=n,y.style.height=G+"px"),n=G,y.style.visibility="",V.appendChild(y),p.style.left=this.format(t+s*T*this.state.scale)+"px",p.style.top=this.format(e+n*S*this.state.scale)+"px"}else this.state.alpha<1&&(y.style.filter="alpha(opacity="+this.state.alpha*100+")"),C.style.left=T*100+"%",C.style.top=S*100+"%"}else this.plainText(t,e,s,n,mxUtils.htmlEntities(l,!1),r,a,o,h,d,g,m,f)}}plainText(t,e,s,n,l,r,a,o,h,d,g,m,f){var c=this.state;t=(t+c.dx)*c.scale,e=(e+c.dy)*c.scale;var x=this.createVmlElement("shape");x.style.width="1px",x.style.height="1px",x.stroked="false";var p=this.createVmlElement("fill");p.color=c.fontColor,p.opacity=c.alpha*100+"%",x.appendChild(p);var C=this.createVmlElement("path");C.textpathok="true",C.v="m "+this.format(0)+" "+this.format(0)+" l "+this.format(1)+" "+this.format(0),x.appendChild(C);var E=this.createVmlElement("textpath");E.style.cssText="v-text-align:"+r,E.style.align=r,E.style.fontFamily=c.fontFamily,E.string=l,E.on="true";var T=c.fontSize*c.scale/this.vmlScale;E.style.fontSize=T+"px",(c.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(E.style.fontWeight="bold"),(c.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(E.style.fontStyle="italic"),(c.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(E.style.textDecoration="underline");var S=l.split(`
`),y=T+(S.length-1)*T*mxConstants.LINE_HEIGHT,b=0,w=0;if(a==mxConstants.ALIGN_BOTTOM?w=-y/2:a!=mxConstants.ALIGN_MIDDLE&&(w=y/2),m!=null){x.style.rotation=m;var I=m*(Math.PI/180);b=Math.sin(I)*w,w=Math.cos(I)*w}x.appendChild(E),x.style.left=this.format(t-b)+"px",x.style.top=this.format(e+w)+"px",this.root.appendChild(x)}stroke(){this.addNode(!1,!0)}fill(){this.addNode(!0,!1)}fillAndStroke(){this.addNode(!0,!0)}}class mxSvgCanvas2D extends mxAbstractCanvas2D{constructor(t,e){super();u(this,"useDomParser",typeof DOMParser=="function"&&typeof XMLSerializer=="function");u(this,"node",null);u(this,"matchHtmlAlignment",!0);u(this,"textEnabled",!0);u(this,"foEnabled",!0);u(this,"foAltText","[Object]");u(this,"foOffset",0);u(this,"textOffset",0);u(this,"imageOffset",0);u(this,"strokeTolerance",0);u(this,"minStrokeWidth",1);u(this,"refCount",0);u(this,"lineHeightCorrection",1);u(this,"pointerEventsValue","all");u(this,"fontMetricsPadding",10);u(this,"cacheOffsetSize",!0);this.root=t,this.gradients=[],this.defs=null,this.styleEnabled=e??!1;var s=null;if(t.ownerDocument!=document){for(var n=t;n!=null&&n.nodeName!="svg";)n=n.parentNode;s=n}if(s!=null){var l=s.getElementsByTagName("defs");l.length>0&&(this.defs=s.getElementsByTagName("defs")[0]),this.defs==null&&(this.defs=this.createElement("defs"),s.firstChild!=null?s.insertBefore(this.defs,s.firstChild):s.appendChild(this.defs)),this.styleEnabled&&this.defs.appendChild(this.createStyle())}}format(t){return parseFloat(parseFloat(t).toFixed(2))}getBaseUrl(){var t=window.location.href,e=t.lastIndexOf("#");return e>0&&(t=t.substring(0,e)),t}reset(){super.reset(),this.gradients=[]}createStyle(t){var e=this.createElement("style");return e.setAttribute("type","text/css"),mxUtils.write(e,"svg{font-family:"+mxConstants.DEFAULT_FONTFAMILY+";font-size:"+mxConstants.DEFAULT_FONTSIZE+";fill:none;stroke-miterlimit:10}"),e}createElement(t,e){if(this.root.ownerDocument.createElementNS!=null)return this.root.ownerDocument.createElementNS(e||mxConstants.NS_SVG,t);var s=this.root.ownerDocument.createElement(t);return e!=null&&s.setAttribute("xmlns",e),s}getAlternateText(t,e,s,n,l,r,a,o,h,d,g,m,f){return r!=null?this.foAltText:null}createAlternateContent(t,e,s,n,l,r,a,o,h,d,g,m,f){var c=this.getAlternateText(t,e,s,n,l,r,a,o,h,d,g,m,f),x=this.state;if(c!=null&&x.fontSize>0){var p=o==mxConstants.ALIGN_TOP?1:o==mxConstants.ALIGN_BOTTOM?0:.3,C=a==mxConstants.ALIGN_RIGHT?"end":a==mxConstants.ALIGN_LEFT?"start":"middle",E=this.createElement("text");E.setAttribute("x",Math.round(e+x.dx)),E.setAttribute("y",Math.round(s+x.dy+p*x.fontSize)),E.setAttribute("fill",x.fontColor||"black"),E.setAttribute("font-family",x.fontFamily),E.setAttribute("font-size",Math.round(x.fontSize)+"px"),C!="start"&&E.setAttribute("text-anchor",C),(x.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&E.setAttribute("font-weight","bold"),(x.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&E.setAttribute("font-style","italic");var T=[];return(x.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&T.push("underline"),(x.fontStyle&mxConstants.FONT_STRIKETHROUGH)==mxConstants.FONT_STRIKETHROUGH&&T.push("line-through"),T.length>0&&E.setAttribute("text-decoration",T.join(" ")),mxUtils.write(E,c),E}else return null}createGradientId(t,e,s,n,l){t.charAt(0)=="#"&&(t=t.substring(1)),e.charAt(0)=="#"&&(e=e.substring(1)),t=t.toLowerCase()+"-"+s,e=e.toLowerCase()+"-"+n;var r=null;if(l==null||l==mxConstants.DIRECTION_SOUTH)r="s";else if(l==mxConstants.DIRECTION_EAST)r="e";else{var a=t;t=e,e=a,l==mxConstants.DIRECTION_NORTH?r="s":l==mxConstants.DIRECTION_WEST&&(r="e")}return"mx-gradient-"+t+"-"+e+"-"+r}getSvgGradient(t,e,s,n,l){var r=this.createGradientId(t,e,s,n,l),a=this.gradients[r];if(a==null){var o=this.root.ownerSVGElement,h=0,d=r+"-"+h;if(o!=null)for(a=o.ownerDocument.getElementById(d);a!=null&&a.ownerSVGElement!=o;)d=r+"-"+h++,a=o.ownerDocument.getElementById(d);else d="id"+ ++this.refCount;a==null&&(a=this.createSvgGradient(t,e,s,n,l),a.setAttribute("id",d),this.defs!=null?this.defs.appendChild(a):o.appendChild(a)),this.gradients[r]=a}return a.getAttribute("id")}createSvgGradient(t,e,s,n,l){var r=this.createElement("linearGradient");r.setAttribute("x1","0%"),r.setAttribute("y1","0%"),r.setAttribute("x2","0%"),r.setAttribute("y2","0%"),l==null||l==mxConstants.DIRECTION_SOUTH?r.setAttribute("y2","100%"):l==mxConstants.DIRECTION_EAST?r.setAttribute("x2","100%"):l==mxConstants.DIRECTION_NORTH?r.setAttribute("y1","100%"):l==mxConstants.DIRECTION_WEST&&r.setAttribute("x1","100%");var a=s<1?";stop-opacity:"+s:"",o=this.createElement("stop");return o.setAttribute("offset","0%"),o.setAttribute("style","stop-color:"+t+a),r.appendChild(o),a=n<1?";stop-opacity:"+n:"",o=this.createElement("stop"),o.setAttribute("offset","100%"),o.setAttribute("style","stop-color:"+e+a),r.appendChild(o),r}addNode(t,e){var s=this.node,n=this.state;if(s!=null){if(s.nodeName=="path")if(this.path!=null&&this.path.length>0)s.setAttribute("d",this.path.join(" "));else return;t&&n.fillColor!=null?this.updateFill():this.styleEnabled||(s.nodeName=="ellipse"&&mxClient.IS_FF?s.setAttribute("fill","transparent"):s.setAttribute("fill","none"),t=!1),e&&n.strokeColor!=null?this.updateStroke():this.styleEnabled||s.setAttribute("stroke","none"),n.transform!=null&&n.transform.length>0&&s.setAttribute("transform",n.transform),n.shadow&&this.root.appendChild(this.createShadow(s)),this.strokeTolerance>0&&!t&&this.root.appendChild(this.createTolerance(s)),this.pointerEvents?s.setAttribute("pointer-events",this.pointerEventsValue):!this.pointerEvents&&this.originalRoot==null&&s.setAttribute("pointer-events","none"),(s.nodeName!="rect"&&s.nodeName!="path"&&s.nodeName!="ellipse"||s.getAttribute("fill")!="none"&&s.getAttribute("fill")!="transparent"||s.getAttribute("stroke")!="none"||s.getAttribute("pointer-events")!="none")&&this.root.appendChild(s),this.node=null}}updateFill(){var t=this.state;if((t.alpha<1||t.fillAlpha<1)&&this.node.setAttribute("fill-opacity",t.alpha*t.fillAlpha),t.fillColor!=null)if(t.gradientColor!=null){var e=this.getSvgGradient(String(t.fillColor),String(t.gradientColor),t.gradientFillAlpha,t.gradientAlpha,t.gradientDirection);if(!mxClient.IS_CHROMEAPP&&!mxClient.IS_IE11&&!mxClient.IS_EDGE&&this.root.ownerDocument==document){var s=this.getBaseUrl().replace(/([\(\)])/g,"\\$1");this.node.setAttribute("fill","url("+s+"#"+e+")")}else this.node.setAttribute("fill","url(#"+e+")")}else this.node.setAttribute("fill",String(t.fillColor).toLowerCase())}getCurrentStrokeWidth(){return Math.max(this.minStrokeWidth,Math.max(.01,this.format(this.state.strokeWidth*this.state.scale)))}updateStroke(){var t=this.state;this.node.setAttribute("stroke",String(t.strokeColor).toLowerCase()),(t.alpha<1||t.strokeAlpha<1)&&this.node.setAttribute("stroke-opacity",t.alpha*t.strokeAlpha);var e=this.getCurrentStrokeWidth();e!=1&&this.node.setAttribute("stroke-width",e),this.node.nodeName=="path"&&this.updateStrokeAttributes(),t.dashed&&this.node.setAttribute("stroke-dasharray",this.createDashPattern((t.fixDash?1:t.strokeWidth)*t.scale))}updateStrokeAttributes(){var t=this.state;if(t.lineJoin!=null&&t.lineJoin!="miter"&&this.node.setAttribute("stroke-linejoin",t.lineJoin),t.lineCap!=null){var e=t.lineCap;e=="flat"&&(e="butt"),e!="butt"&&this.node.setAttribute("stroke-linecap",e)}t.miterLimit!=null&&(!this.styleEnabled||t.miterLimit!=10)&&this.node.setAttribute("stroke-miterlimit",t.miterLimit)}createDashPattern(t){var e=[];if(typeof this.state.dashPattern=="string"){var s=this.state.dashPattern.split(" ");if(s.length>0)for(var n=0;n<s.length;n++)e[n]=Number(s[n])*t}return e.join(" ")}createTolerance(t){var e=t.cloneNode(!0),s=parseFloat(e.getAttribute("stroke-width")||1)+this.strokeTolerance;return e.setAttribute("pointer-events","stroke"),e.setAttribute("visibility","hidden"),e.removeAttribute("stroke-dasharray"),e.setAttribute("stroke-width",s),e.setAttribute("fill","none"),e.setAttribute("stroke",mxClient.IS_OT?"none":"white"),e}createShadow(t){var e=t.cloneNode(!0),s=this.state;return e.getAttribute("fill")!="none"&&(!mxClient.IS_FF||e.getAttribute("fill")!="transparent")&&e.setAttribute("fill",s.shadowColor),e.getAttribute("stroke")!="none"&&e.setAttribute("stroke",s.shadowColor),e.setAttribute("transform","translate("+this.format(s.shadowDx*s.scale)+","+this.format(s.shadowDy*s.scale)+")"+(s.transform||"")),e.setAttribute("opacity",s.shadowAlpha),e}setLink(t){if(t==null)this.root=this.originalRoot;else{this.originalRoot=this.root;var e=this.createElement("a");e.setAttributeNS==null||this.root.ownerDocument!=document&&document.documentMode==null?e.setAttribute("xlink:href",t):e.setAttributeNS(mxConstants.NS_XLINK,"xlink:href",t),this.root.appendChild(e),this.root=e}}rotate(t,e,s,n,l){if(t!=0||e||s){var r=this.state;if(n+=r.dx,l+=r.dy,n*=r.scale,l*=r.scale,r.transform=r.transform||"",e&&s)t+=180;else if(e!=s){var a=e?n:0,o=e?-1:1,h=s?l:0,d=s?-1:1;r.transform+="translate("+this.format(a)+","+this.format(h)+")scale("+this.format(o)+","+this.format(d)+")translate("+this.format(-a)+","+this.format(-h)+")"}(e?!s:s)&&(t*=-1),t!=0&&(r.transform+="rotate("+this.format(t)+","+this.format(n)+","+this.format(l)+")"),r.rotation=r.rotation+t,r.rotationCx=n,r.rotationCy=l}}begin(){super.begin(),this.node=this.createElement("path")}rect(t,e,s,n){var l=this.state,r=this.createElement("rect");r.setAttribute("x",this.format((t+l.dx)*l.scale)),r.setAttribute("y",this.format((e+l.dy)*l.scale)),r.setAttribute("width",this.format(s*l.scale)),r.setAttribute("height",this.format(n*l.scale)),this.node=r}roundrect(t,e,s,n,l,r){this.rect(t,e,s,n),l>0&&this.node.setAttribute("rx",this.format(l*this.state.scale)),r>0&&this.node.setAttribute("ry",this.format(r*this.state.scale))}ellipse(t,e,s,n){var l=this.state,r=this.createElement("ellipse");r.setAttribute("cx",this.format((t+s/2+l.dx)*l.scale)),r.setAttribute("cy",this.format((e+n/2+l.dy)*l.scale)),r.setAttribute("rx",s/2*l.scale),r.setAttribute("ry",n/2*l.scale),this.node=r}image(t,e,s,n,l,r,a,o){l=this.converter.convert(l),r=r??!0,a=a??!1,o=o??!1;var h=this.state;t+=h.dx,e+=h.dy;var d=this.createElement("image");d.setAttribute("x",this.format(t*h.scale)+this.imageOffset),d.setAttribute("y",this.format(e*h.scale)+this.imageOffset),d.setAttribute("width",this.format(s*h.scale)),d.setAttribute("height",this.format(n*h.scale)),d.setAttributeNS==null?d.setAttribute("xlink:href",l):d.setAttributeNS(mxConstants.NS_XLINK,"xlink:href",l),r||d.setAttribute("preserveAspectRatio","none"),(h.alpha<1||h.fillAlpha<1)&&d.setAttribute("opacity",h.alpha*h.fillAlpha);var g=this.state.transform||"";if(a||o){var m=1,f=1,c=0,x=0;a&&(m=-1,c=-s-2*t),o&&(f=-1,x=-n-2*e),g+="scale("+m+","+f+")translate("+c*h.scale+","+x*h.scale+")"}g.length>0&&d.setAttribute("transform",g),this.pointerEvents||d.setAttribute("pointer-events","none"),this.root.appendChild(d)}convertHtml(t){if(this.useDomParser){var e=new DOMParser().parseFromString(t,"text/html");e!=null&&(t=new XMLSerializer().serializeToString(e.body),t.substring(0,5)=="<body"&&(t=t.substring(t.indexOf(">",5)+1)),t.substring(t.length-7,t.length)=="</body>"&&(t=t.substring(0,t.length-7)))}else if(document.implementation!=null&&document.implementation.createDocument!=null){var s=document.implementation.createDocument("http://www.w3.org/1999/xhtml","html",null),n=s.createElement("body");s.documentElement.appendChild(n);var l=document.createElement("div");l.innerHTML=t;for(var r=l.firstChild;r!=null;){var a=r.nextSibling;n.appendChild(s.adoptNode(r)),r=a}return n.innerHTML}else{var o=document.createElement("textarea");o.innerHTML=t.replace(/&amp;/g,"&amp;amp;").replace(/&#60;/g,"&amp;lt;").replace(/&#62;/g,"&amp;gt;").replace(/&lt;/g,"&amp;lt;").replace(/&gt;/g,"&amp;gt;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=o.value.replace(/&/g,"&amp;").replace(/&amp;lt;/g,"&lt;").replace(/&amp;gt;/g,"&gt;").replace(/&amp;amp;/g,"&amp;").replace(/<br>/g,"<br />").replace(/<hr>/g,"<hr />").replace(/(<img[^>]+)>/gm,"$1 />")}return t}createDiv(t){var e=t;if(mxUtils.isNode(e)||(e="<div><div>"+this.convertHtml(e)+"</div></div>"),!mxClient.IS_IE11&&document.createElementNS){var s=document.createElementNS("http://www.w3.org/1999/xhtml","div");if(mxUtils.isNode(e)){var n=document.createElement("div"),l=n.cloneNode(!1);this.root.ownerDocument!=document?n.appendChild(e.cloneNode(!0)):n.appendChild(e),l.appendChild(n),s.appendChild(l)}else s.innerHTML=e;return s}else return mxUtils.isNode(e)&&(e="<div><div>"+mxUtils.getXml(e)+"</div></div>"),e='<div xmlns="http://www.w3.org/1999/xhtml">'+e+"</div>",mxUtils.parseXml(e).documentElement}updateText(t,e,s,n,l,r,a,o,h,d,g){g!=null&&g.firstChild!=null&&g.firstChild.firstChild!=null&&this.updateTextNodes(t,e,s,n,l,r,a,o,h,d,g.firstChild)}addForeignObject(t,e,s,n,l,r,a,o,h,d,g,m,f,c,x){var p=this.createElement("g"),C=this.createElement("foreignObject");if(C.setAttribute("style","overflow: visible; text-align: left;"),C.setAttribute("pointer-events","none"),c.ownerDocument!=document&&(c=mxUtils.importNodeImplementation(C.ownerDocument,c,!0)),C.appendChild(c),p.appendChild(C),this.updateTextNodes(t,e,s,n,r,a,o,d,g,m,p),this.root.ownerDocument!=document){var E=this.createAlternateContent(C,t,e,s,n,l,r,a,o,h,d,g,m);if(E!=null){C.setAttribute("requiredFeatures","http://www.w3.org/TR/SVG11/feature#Extensibility");var T=this.createElement("switch");T.appendChild(C),T.appendChild(E),p.appendChild(T)}}x.appendChild(p)}updateTextNodes(t,e,s,n,l,r,a,o,h,d,g){var m=this.state.scale;mxSvgCanvas2D.createCss(s+2,n,l,r,a,o,h,this.state.fontBackgroundColor!=null?this.state.fontBackgroundColor:null,this.state.fontBorderColor!=null?this.state.fontBorderColor:null,"display: flex; align-items: unsafe "+(r==mxConstants.ALIGN_TOP?"flex-start":r==mxConstants.ALIGN_BOTTOM?"flex-end":"center")+"; justify-content: unsafe "+(l==mxConstants.ALIGN_LEFT?"flex-start":l==mxConstants.ALIGN_RIGHT?"flex-end":"center")+"; ",this.getTextCss(),m,(f,c,x,p,C)=>{t+=this.state.dx,e+=this.state.dy;var E=g.firstChild,T=E.firstChild,S=T.firstChild,y=S.firstChild,b=(this.rotateHtml?this.state.rotation:0)+(d??0),w=(this.foOffset!=0?"translate("+this.foOffset+" "+this.foOffset+")":"")+(m!=1?"scale("+m+")":"");y.setAttribute("style",C),S.setAttribute("style",p),E.setAttribute("width",Math.ceil(1/Math.min(1,m)*100)+"%"),E.setAttribute("height",Math.ceil(1/Math.min(1,m)*100)+"%");var I=Math.round(e+c);I<0?E.setAttribute("y",I):(E.removeAttribute("y"),x+="padding-top: "+I+"px; "),T.setAttribute("style",x+"margin-left: "+Math.round(t+f)+"px;"),w+=b!=0?"rotate("+b+" "+t+" "+e+")":"",w!=""?g.setAttribute("transform",w):g.removeAttribute("transform"),this.state.alpha!=1?g.setAttribute("opacity",this.state.alpha):g.removeAttribute("opacity")})}static createCss(t,e,s,n,l,r,a,o,h,d,g,m,f){var c="box-sizing: border-box; font-size: 0; text-align: "+(s==mxConstants.ALIGN_LEFT?"left":s==mxConstants.ALIGN_RIGHT?"right":"center")+"; ",x=mxUtils.getAlignmentAsPoint(s,n),p="overflow: hidden; ",C="width: 1px; ",E="height: 1px; ",T=x.x*t,S=x.y*e;a?(C="width: "+Math.round(t)+"px; ",c+="max-height: "+Math.round(e)+"px; ",S=0):r=="fill"?(C="width: "+Math.round(t)+"px; ",E="height: "+Math.round(e)+"px; ",g+="width: 100%; height: 100%; ",c+=C+E):r=="width"?(C="width: "+Math.round(t)+"px; ",g+="width: 100%; ",c+=C,S=0,e>0&&(c+="max-height: "+Math.round(e)+"px; ")):(p="",S=0);var y="";o!=null&&(y+="background-color: "+o+"; "),h!=null&&(y+="border: 1px solid "+h+"; "),p==""||a?g+=y:c+=y,l&&t>0?(g+="white-space: normal; word-wrap: "+mxConstants.WORD_WRAP+"; ",C="width: "+Math.round(t)+"px; ",p!=""&&r!="fill"&&(S=0)):(g+="white-space: nowrap; ",p==""&&(T=0)),f(T,S,d+C+E,c+p,g,p)}getTextCss(){var t=this.state,e=mxConstants.ABSOLUTE_LINE_HEIGHT?t.fontSize*mxConstants.LINE_HEIGHT+"px":mxConstants.LINE_HEIGHT*this.lineHeightCorrection,s="display: inline-block; font-size: "+t.fontSize+"px; font-family: "+t.fontFamily+"; color: "+t.fontColor+"; line-height: "+e+"; pointer-events: "+(this.pointerEvents?this.pointerEventsValue:"none")+"; ";(t.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(s+="font-weight: bold; "),(t.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(s+="font-style: italic; ");var n=[];return(t.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&n.push("underline"),(t.fontStyle&mxConstants.FONT_STRIKETHROUGH)==mxConstants.FONT_STRIKETHROUGH&&n.push("line-through"),n.length>0&&(s+="text-decoration: "+n.join(" ")+"; "),s}text(t,e,s,n,l,r,a,o,h,d,g,m,f){if(this.textEnabled&&l!=null)if(m=m??0,this.foEnabled&&h=="html"){var c=this.createDiv(l);c!=null&&(f!=null&&c.setAttribute("dir",f),this.addForeignObject(t,e,s,n,l,r,a,o,h,d,g,m,f,c,this.root))}else this.plainText(t+this.state.dx,e+this.state.dy,s,n,l,r,a,o,d,g,m,f)}createClip(t,e,s,n){t=Math.round(t),e=Math.round(e),s=Math.round(s),n=Math.round(n);for(var l="mx-clip-"+t+"-"+e+"-"+s+"-"+n,r=0,a=l+"-"+r;document.getElementById(a)!=null;)a=l+"-"+ ++r;var o=this.createElement("clipPath");o.setAttribute("id",a);var h=this.createElement("rect");return h.setAttribute("x",t),h.setAttribute("y",e),h.setAttribute("width",s),h.setAttribute("height",n),o.appendChild(h),o}plainText(t,e,s,n,l,r,a,o,h,d,g,m){g=g??0;var f=this.state,c=f.fontSize,x=this.createElement("g"),p=f.transform||"";if(this.updateFont(x),g!=0&&(p+="rotate("+g+","+this.format(t*f.scale)+","+this.format(e*f.scale)+")"),m!=null&&x.setAttribute("direction",m),d&&s>0&&n>0){var C=t,I=e;r==mxConstants.ALIGN_CENTER?C-=s/2:r==mxConstants.ALIGN_RIGHT&&(C-=s),h!="fill"&&(a==mxConstants.ALIGN_MIDDLE?I-=n/2:a==mxConstants.ALIGN_BOTTOM&&(I-=n));var E=this.createClip(C*f.scale-2,I*f.scale-2,s*f.scale+4,n*f.scale+4);if(this.defs!=null?this.defs.appendChild(E):this.root.appendChild(E),!mxClient.IS_CHROMEAPP&&!mxClient.IS_IE11&&!mxClient.IS_EDGE&&this.root.ownerDocument==document){var T=this.getBaseUrl().replace(/([\(\)])/g,"\\$1");x.setAttribute("clip-path","url("+T+"#"+E.getAttribute("id")+")")}else x.setAttribute("clip-path","url(#"+E.getAttribute("id")+")")}var S=r==mxConstants.ALIGN_RIGHT?"end":r==mxConstants.ALIGN_CENTER?"middle":"start";S!="start"&&x.setAttribute("text-anchor",S),(!this.styleEnabled||c!=mxConstants.DEFAULT_FONTSIZE)&&x.setAttribute("font-size",c*f.scale+"px"),p.length>0&&x.setAttribute("transform",p),f.alpha<1&&x.setAttribute("opacity",f.alpha);var y=l.split(`
`),b=Math.round(c*mxConstants.LINE_HEIGHT),w=c+(y.length-1)*b,I=e+c-1;if(a==mxConstants.ALIGN_MIDDLE)if(h=="fill")I-=n/2;else{var O=(this.matchHtmlAlignment&&d&&n>0?Math.min(w,n):w)/2;I-=O}else if(a==mxConstants.ALIGN_BOTTOM)if(h=="fill")I-=n;else{var O=this.matchHtmlAlignment&&d&&n>0?Math.min(w,n):w;I-=O+1}for(var P=0;P<y.length;P++){if(y[P].length>0&&mxUtils.trim(y[P]).length>0){var M=this.createElement("text");M.setAttribute("x",this.format(t*f.scale)+this.textOffset),M.setAttribute("y",this.format(I*f.scale)+this.textOffset),mxUtils.write(M,y[P]),x.appendChild(M)}I+=b}this.root.appendChild(x),this.addTextBackground(x,l,t,e,s,h=="fill"?n:w,r,a,h)}updateFont(t){var e=this.state;t.setAttribute("fill",e.fontColor),(!this.styleEnabled||e.fontFamily!=mxConstants.DEFAULT_FONTFAMILY)&&t.setAttribute("font-family",e.fontFamily),(e.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&t.setAttribute("font-weight","bold"),(e.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&t.setAttribute("font-style","italic");var s=[];(e.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&s.push("underline"),(e.fontStyle&mxConstants.FONT_STRIKETHROUGH)==mxConstants.FONT_STRIKETHROUGH&&s.push("line-through"),s.length>0&&t.setAttribute("text-decoration",s.join(" "))}addTextBackground(t,e,s,n,l,r,a,o,h){var d=this.state;if(d.fontBackgroundColor!=null||d.fontBorderColor!=null){var g=null;if(h=="fill"||h=="width")a==mxConstants.ALIGN_CENTER?s-=l/2:a==mxConstants.ALIGN_RIGHT&&(s-=l),o==mxConstants.ALIGN_MIDDLE?n-=r/2:o==mxConstants.ALIGN_BOTTOM&&(n-=r),g=new mxRectangle((s+1)*d.scale,n*d.scale,(l-2)*d.scale,(r+2)*d.scale);else if(t.getBBox!=null&&this.root.ownerDocument==document)try{g=t.getBBox(),g=new mxRectangle(g.x,g.y+1,g.width,g.height)}catch{}else{var m=document.createElement("div");m.style.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?d.fontSize*mxConstants.LINE_HEIGHT+"px":mxConstants.LINE_HEIGHT,m.style.fontSize=d.fontSize+"px",m.style.fontFamily=d.fontFamily,m.style.whiteSpace="nowrap",m.style.position="absolute",m.style.visibility="hidden",m.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",m.style.zoom="1",(d.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(m.style.fontWeight="bold"),(d.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(m.style.fontStyle="italic"),e=mxUtils.htmlEntities(e,!1),m.innerHTML=e.replace(/\n/g,"<br/>"),document.body.appendChild(m);var l=m.offsetWidth,r=m.offsetHeight;m.parentNode.removeChild(m),a==mxConstants.ALIGN_CENTER?s-=l/2:a==mxConstants.ALIGN_RIGHT&&(s-=l),o==mxConstants.ALIGN_MIDDLE?n-=r/2:o==mxConstants.ALIGN_BOTTOM&&(n-=r),g=new mxRectangle((s+1)*d.scale,(n+2)*d.scale,l*d.scale,(r+1)*d.scale)}if(g!=null){var f=this.createElement("rect");f.setAttribute("fill",d.fontBackgroundColor||"none"),f.setAttribute("stroke",d.fontBorderColor||"none"),f.setAttribute("x",Math.floor(g.x-1)),f.setAttribute("y",Math.floor(g.y-1)),f.setAttribute("width",Math.ceil(g.width+2)),f.setAttribute("height",Math.ceil(g.height));var c=d.fontBorderColor!=null?Math.max(1,this.format(d.scale)):0;f.setAttribute("stroke-width",c),this.root.ownerDocument==document&&mxUtils.mod(c,2)==1&&f.setAttribute("transform","translate(0.5, 0.5)"),t.insertBefore(f,t.firstChild)}}}stroke(){this.addNode(!1,!0)}fill(){this.addNode(!0,!1)}fillAndStroke(){this.addNode(!0,!0)}}class mxShape{constructor(i){u(this,"dialect",null);u(this,"scale",1);u(this,"antiAlias",!0);u(this,"minSvgStrokeWidth",1);u(this,"bounds",null);u(this,"points",null);u(this,"node",null);u(this,"state",null);u(this,"style",null);u(this,"boundingBox",null);u(this,"svgStrokeTolerance",8);u(this,"pointerEvents",!0);u(this,"svgPointerEvents","all");u(this,"shapePointerEvents",!1);u(this,"stencilPointerEvents",!1);u(this,"vmlScale",1);u(this,"outline",!1);u(this,"visible",!0);u(this,"useSvgBoundingBox",!1);u(this,"verticalTextRotation",-90);this.stencil=i,this.initStyles()}init(i){this.node==null&&(this.node=this.create(i),i!=null&&i.appendChild(this.node))}initStyles(i){this.strokewidth=1,this.rotation=0,this.opacity=100,this.fillOpacity=100,this.strokeOpacity=100,this.flipH=!1,this.flipV=!1}isParseVml(){return!0}isHtmlAllowed(){return!1}getSvgScreenOffset(){var i=this.stencil&&this.stencil.strokewidth!="inherit"?Number(this.stencil.strokewidth):this.strokewidth;return mxUtils.mod(Math.max(1,Math.round(i*this.scale)),2)==1?.5:0}create(i){var t=null;return i!=null&&i.ownerSVGElement!=null?t=this.createSvg(i):this.dialect!=mxConstants.DIALECT_VML&&this.isHtmlAllowed()?t=this.createHtml(i):t=this.createVml(i),t}createSvg(){return document.createElementNS(mxConstants.NS_SVG,"g")}createVml(){var i=document.createElement(mxClient.VML_PREFIX+":group");return i.style.position="absolute",i}createHtml(){var i=document.createElement("div");return i.style.position="absolute",i}reconfigure(){this.redraw()}redraw(){this.updateBoundsFromPoints(),this.visible&&this.checkBounds()?(this.node.style.visibility="visible",this.clear(),this.node.nodeName=="DIV"&&this.isHtmlAllowed()?this.redrawHtmlShape():this.redrawShape(),this.updateBoundingBox()):(this.node.style.visibility="hidden",this.boundingBox=null)}clear(){if(this.node.ownerSVGElement!=null)for(;this.node.lastChild!=null;)this.node.removeChild(this.node.lastChild);else this.node.style.cssText="position:absolute;"+(this.cursor!=null?"cursor:"+this.cursor+";":""),this.node.innerHTML=""}updateBoundsFromPoints(){var i=this.points;if(i!=null&&i.length>0&&i[0]!=null){this.bounds=new mxRectangle(Number(i[0].x),Number(i[0].y),1,1);for(var t=1;t<this.points.length;t++)i[t]!=null&&this.bounds.add(new mxRectangle(Number(i[t].x),Number(i[t].y),1,1))}}getLabelBounds(i){var t=mxUtils.getValue(this.style,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_EAST),e=i;if(t!=mxConstants.DIRECTION_SOUTH&&t!=mxConstants.DIRECTION_NORTH&&this.state!=null&&this.state.text!=null&&this.state.text.isPaintBoundsInverted()){e=e.clone();var s=e.width;e.width=e.height,e.height=s}var n=this.getLabelMargins(e);if(n!=null){var l=mxUtils.getValue(this.style,mxConstants.STYLE_FLIPH,!1)=="1",r=mxUtils.getValue(this.style,mxConstants.STYLE_FLIPV,!1)=="1";if(this.state!=null&&this.state.text!=null&&this.state.text.isPaintBoundsInverted()){var s=n.x;n.x=n.height,n.height=n.width,n.width=n.y,n.y=s,s=l,l=r,r=s}return mxUtils.getDirectedBounds(i,n,this.style,l,r)}return i}getLabelMargins(i){return null}checkBounds(){return!isNaN(this.scale)&&isFinite(this.scale)&&this.scale>0&&this.bounds!=null&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)&&this.bounds.width>0&&this.bounds.height>0}createVmlGroup(){var i=document.createElement(mxClient.VML_PREFIX+":group");return i.style.position="absolute",i.style.width=this.node.style.width,i.style.height=this.node.style.height,i}redrawShape(){var i=this.createCanvas();i!=null&&(i.pointerEvents=this.pointerEvents,this.paint(i),this.node!=i.root&&this.node.insertAdjacentHTML("beforeend",i.root.outerHTML),this.node.nodeName=="DIV"&&document.documentMode==8&&(this.node.style.filter="",mxUtils.addTransparentBackgroundFilter(this.node)),this.destroyCanvas(i))}createCanvas(){var i=null;return this.node.ownerSVGElement!=null&&(i=this.createSvgCanvas()),i!=null&&this.outline&&(i.setStrokeWidth(this.strokewidth),i.setStrokeColor(this.stroke),this.isDashed!=null&&i.setDashed(this.isDashed),i.setStrokeWidth=function(){},i.setStrokeColor=function(){},i.setFillColor=function(){},i.setGradient=function(){},i.setDashed=function(){},i.text=function(){}),i}createSvgCanvas(){var i=new mxSvgCanvas2D(this.node,!1);i.strokeTolerance=this.pointerEvents?this.svgStrokeTolerance:0,i.pointerEventsValue=this.svgPointerEvents;var t=this.getSvgScreenOffset();return t!=0?this.node.setAttribute("transform","translate("+t+","+t+")"):this.node.removeAttribute("transform"),i.minStrokeWidth=this.minSvgStrokeWidth,this.antiAlias||(i.format=function(e){return Math.round(parseFloat(e))}),i}createVmlCanvas(){var i=document.documentMode==8&&this.isParseVml()?this.createVmlGroup():this.node,t=new mxVmlCanvas2D(i,!1);if(i.tagUrn!=""){var e=Math.max(1,Math.round(this.bounds.width)),s=Math.max(1,Math.round(this.bounds.height));i.coordsize=e*this.vmlScale+","+s*this.vmlScale,t.scale(this.vmlScale),t.vmlScale=this.vmlScale}var n=this.scale;return t.translate(-Math.round(this.bounds.x/n),-Math.round(this.bounds.y/n)),t}updateVmlContainer(){this.node.style.left=Math.round(this.bounds.x)+"px",this.node.style.top=Math.round(this.bounds.y)+"px";var i=Math.max(1,Math.round(this.bounds.width)),t=Math.max(1,Math.round(this.bounds.height));this.node.style.width=i+"px",this.node.style.height=t+"px",this.node.style.overflow="visible"}redrawHtmlShape(){this.updateHtmlBounds(this.node),this.updateHtmlFilters(this.node),this.updateHtmlColors(this.node)}updateHtmlFilters(i){var t="";if(this.opacity<100&&(t+="alpha(opacity="+this.opacity+")"),this.isShadow&&(t+="progid:DXImageTransform.Microsoft.dropShadow (OffX='"+Math.round(mxConstants.SHADOW_OFFSET_X*this.scale)+"', OffY='"+Math.round(mxConstants.SHADOW_OFFSET_Y*this.scale)+"', Color='"+mxConstants.VML_SHADOWCOLOR+"')"),this.fill!=null&&this.fill!=mxConstants.NONE&&this.gradient&&this.gradient!=mxConstants.NONE){var e=this.fill,s=this.gradient,n="0",l={east:0,south:1,west:2,north:3},r=this.direction!=null?l[this.direction]:0;if(this.gradientDirection!=null&&(r=mxUtils.mod(r+l[this.gradientDirection]-1,4)),r==1){n="1";var a=e;e=s,s=a}else if(r==2){var a=e;e=s,s=a}else r==3&&(n="1");t+="progid:DXImageTransform.Microsoft.gradient(startColorStr='"+e+"', endColorStr='"+s+"', gradientType='"+n+"')"}i.style.filter=t}updateHtmlColors(i){var t=this.stroke;t!=null&&t!=mxConstants.NONE?(i.style.borderColor=t,this.isDashed?i.style.borderStyle="dashed":this.strokewidth>0&&(i.style.borderStyle="solid"),i.style.borderWidth=Math.max(1,Math.ceil(this.strokewidth*this.scale))+"px"):i.style.borderWidth="0px",t=this.outline?null:this.fill,t!=null&&t!=mxConstants.NONE?(i.style.backgroundColor=t,i.style.backgroundImage="none"):this.pointerEvents?i.style.backgroundColor="transparent":document.documentMode==8?mxUtils.addTransparentBackgroundFilter(i):this.setTransparentBackgroundImage(i)}updateHtmlBounds(i){var t=document.documentMode>=9?0:Math.ceil(this.strokewidth*this.scale);i.style.borderWidth=Math.max(1,t)+"px",i.style.overflow="hidden",i.style.left=Math.round(this.bounds.x-t/2)+"px",i.style.top=Math.round(this.bounds.y-t/2)+"px",document.compatMode=="CSS1Compat"&&(t=-t),i.style.width=Math.round(Math.max(0,this.bounds.width+t))+"px",i.style.height=Math.round(Math.max(0,this.bounds.height+t))+"px"}destroyCanvas(i){if(i instanceof mxSvgCanvas2D){for(var t in i.gradients){var e=i.gradients[t];e!=null&&(e.mxRefCount=(e.mxRefCount||0)+1)}this.releaseSvgGradients(this.oldGradients),this.oldGradients=i.gradients}}paint(i){var t=!1;if(i!=null&&this.outline){var e=i.stroke;i.stroke=function(){t=!0,e.apply(this,arguments)};var s=i.fillAndStroke;i.fillAndStroke=function(){t=!0,s.apply(this,arguments)}}var n=this.scale,l=this.bounds.x/n,r=this.bounds.y/n,a=this.bounds.width/n,o=this.bounds.height/n;if(this.isPaintBoundsInverted()){var h=(a-o)/2;l+=h,r-=h;var d=a;a=o,o=d}this.updateTransform(i,l,r,a,o),this.configureCanvas(i,l,r,a,o);var g=null;if(this.stencil==null&&this.points==null&&this.shapePointerEvents||this.stencil!=null&&this.stencilPointerEvents){var m=this.createBoundingBox();if(this.dialect==mxConstants.DIALECT_SVG)g=this.createTransparentSvgRectangle(m.x,m.y,m.width,m.height),this.node.appendChild(g);else{var f=i.createRect("rect",m.x/n,m.y/n,m.width/n,m.height/n);f.appendChild(i.createTransparentFill()),f.stroked="false",i.root.appendChild(f)}}if(this.stencil!=null)this.stencil.drawShape(i,this,l,r,a,o);else if(i.setStrokeWidth(this.strokewidth),this.points!=null){for(var c=[],x=0;x<this.points.length;x++)this.points[x]!=null&&c.push(new mxPoint(this.points[x].x/n,this.points[x].y/n));this.paintEdgeShape(i,c)}else this.paintVertexShape(i,l,r,a,o);g!=null&&i.state!=null&&i.state.transform!=null&&g.setAttribute("transform",i.state.transform),i!=null&&this.outline&&!t&&(i.rect(l,r,a,o),i.stroke())}configureCanvas(i,t,e,s,n){var l=null;if(this.style!=null&&(l=this.style.dashPattern),i.setAlpha(this.opacity/100),i.setFillAlpha(this.fillOpacity/100),i.setStrokeAlpha(this.strokeOpacity/100),this.isShadow!=null&&i.setShadow(this.isShadow),this.isDashed!=null&&i.setDashed(this.isDashed,this.style!=null?mxUtils.getValue(this.style,mxConstants.STYLE_FIX_DASH,!1)==1:!1),l!=null&&i.setDashPattern(l),this.fill!=null&&this.fill!=mxConstants.NONE&&this.gradient&&this.gradient!=mxConstants.NONE){var r=this.getGradientBounds(i,t,e,s,n);i.setGradient(this.fill,this.gradient,r.x,r.y,r.width,r.height,this.gradientDirection)}else i.setFillColor(this.fill);i.setStrokeColor(this.stroke)}getGradientBounds(i,t,e,s,n){return new mxRectangle(Number(t),Number(e),s,n)}updateTransform(i,t,e,s,n){i.scale(this.scale),i.rotate(this.getShapeRotation(),this.flipH,this.flipV,t+s/2,e+n/2)}paintVertexShape(i,t,e,s,n){this.paintBackground(i,t,e,s,n),(!this.outline||this.style==null||mxUtils.getValue(this.style,mxConstants.STYLE_BACKGROUND_OUTLINE,0)==0)&&(i.setShadow(!1),this.paintForeground(i,t,e,s,n))}paintBackground(i,t,e,s,n){}paintForeground(i,t,e,s,n){}paintEdgeShape(i,t){}getArcSize(i,t){var e=0;if(mxUtils.getValue(this.style,mxConstants.STYLE_ABSOLUTE_ARCSIZE,0)=="1")e=Math.min(i/2,Math.min(t/2,mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2));else{var s=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.RECTANGLE_ROUNDING_FACTOR*100)/100;e=Math.min(i*s,t*s)}return e}paintGlassEffect(i,t,e,s,n,l){var r=Math.ceil(this.strokewidth/2),a=.4;i.setGradient("#ffffff","#ffffff",t,e,s,n*.6,"south",.9,.1),i.begin(),l+=2*r,this.isRounded?(i.moveTo(t-r+l,e-r),i.quadTo(t-r,e-r,t-r,e-r+l),i.lineTo(t-r,e+n*a),i.quadTo(t+s*.5,e+n*.7,t+s+r,e+n*a),i.lineTo(t+s+r,e-r+l),i.quadTo(t+s+r,e-r,t+s+r-l,e-r)):(i.moveTo(t-r,e-r),i.lineTo(t-r,e+n*a),i.quadTo(t+s*.5,e+n*.7,t+s+r,e+n*a),i.lineTo(t+s+r,e-r)),i.close(),i.fill()}addPoints(i,t,e,s,n,l,r){if(t!=null&&t.length>0){r=r??!0;var a=t[t.length-1];if(n&&e){t=t.slice();var o=t[0],h=new mxPoint(a.x+(o.x-a.x)/2,a.y+(o.y-a.y)/2);t.splice(0,0,h)}var d=t[0],g=1;for(r?i.moveTo(d.x,d.y):i.lineTo(d.x,d.y);g<(n?t.length:t.length-1);){var m=t[mxUtils.mod(g,t.length)],f=d.x-m.x,c=d.y-m.y;if(e&&(f!=0||c!=0)&&(l==null||mxUtils.indexOf(l,g-1)<0)){var x=Math.sqrt(f*f+c*c),p=f*Math.min(s,x/2)/x,C=c*Math.min(s,x/2)/x,E=m.x+p,T=m.y+C;i.lineTo(E,T);for(var S=t[mxUtils.mod(g+1,t.length)];g<t.length-2&&Math.round(S.x-m.x)==0&&Math.round(S.y-m.y)==0;)S=t[mxUtils.mod(g+2,t.length)],g++;f=S.x-m.x,c=S.y-m.y,x=Math.max(1,Math.sqrt(f*f+c*c));var y=f*Math.min(s,x/2)/x,b=c*Math.min(s,x/2)/x,w=m.x+y,I=m.y+b;i.quadTo(m.x,m.y,w,I),m=new mxPoint(w,I)}else i.lineTo(m.x,m.y);d=m,g++}n?i.close():i.lineTo(a.x,a.y)}}resetStyles(){this.initStyles(),this.spacing=0,delete this.fill,delete this.gradient,delete this.gradientDirection,delete this.stroke,delete this.startSize,delete this.endSize,delete this.startArrow,delete this.endArrow,delete this.direction,delete this.isShadow,delete this.isDashed,delete this.isRounded,delete this.glass}apply(i){if(this.state=i,this.style=i.style,this.style!=null){if(this.fill=mxUtils.getValue(this.style,mxConstants.STYLE_FILLCOLOR,this.fill),this.gradient=mxUtils.getValue(this.style,mxConstants.STYLE_GRADIENTCOLOR,this.gradient),this.gradientDirection=mxUtils.getValue(this.style,mxConstants.STYLE_GRADIENT_DIRECTION,this.gradientDirection),this.opacity=mxUtils.getValue(this.style,mxConstants.STYLE_OPACITY,this.opacity),this.fillOpacity=mxUtils.getValue(this.style,mxConstants.STYLE_FILL_OPACITY,this.fillOpacity),this.strokeOpacity=mxUtils.getValue(this.style,mxConstants.STYLE_STROKE_OPACITY,this.strokeOpacity),this.stroke=mxUtils.getValue(this.style,mxConstants.STYLE_STROKECOLOR,this.stroke),this.strokewidth=mxUtils.getNumber(this.style,mxConstants.STYLE_STROKEWIDTH,this.strokewidth),this.spacing=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING,this.spacing),this.startSize=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,this.startSize),this.endSize=mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,this.endSize),this.startArrow=mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,this.startArrow),this.endArrow=mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,this.endArrow),this.rotation=mxUtils.getValue(this.style,mxConstants.STYLE_ROTATION,this.rotation),this.direction=mxUtils.getValue(this.style,mxConstants.STYLE_DIRECTION,this.direction),this.flipH=mxUtils.getValue(this.style,mxConstants.STYLE_FLIPH,0)==1,this.flipV=mxUtils.getValue(this.style,mxConstants.STYLE_FLIPV,0)==1,this.stencil!=null&&(this.flipH=mxUtils.getValue(this.style,"stencilFlipH",0)==1||this.flipH,this.flipV=mxUtils.getValue(this.style,"stencilFlipV",0)==1||this.flipV),this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH){var t=this.flipH;this.flipH=this.flipV,this.flipV=t}this.isShadow=mxUtils.getValue(this.style,mxConstants.STYLE_SHADOW,this.isShadow)==1,this.isDashed=mxUtils.getValue(this.style,mxConstants.STYLE_DASHED,this.isDashed)==1,this.isRounded=mxUtils.getValue(this.style,mxConstants.STYLE_ROUNDED,this.isRounded)==1,this.glass=mxUtils.getValue(this.style,mxConstants.STYLE_GLASS,this.glass)==1,this.fill==mxConstants.NONE&&(this.fill=null),this.gradient==mxConstants.NONE&&(this.gradient=null),this.stroke==mxConstants.NONE&&(this.stroke=null)}}setCursor(i){i==null&&(i=""),this.cursor=i,this.node!=null&&(this.node.style.cursor=i)}getCursor(){return this.cursor}isRoundable(){return!1}updateBoundingBox(){if(this.useSvgBoundingBox&&this.node!=null&&this.node.ownerSVGElement!=null)try{var i=this.node.getBBox();if(i.width>0&&i.height>0){this.boundingBox=new mxRectangle(i.x,i.y,i.width,i.height),this.boundingBox.grow(this.strokewidth*this.scale/2);return}}catch{console.log("updateBoundingBox   Err")}if(this.bounds!=null){var t=this.createBoundingBox();if(t!=null){this.augmentBoundingBox(t);var e=this.getShapeRotation();e!=0&&(t=mxUtils.getBoundingBox(t,e))}this.boundingBox=t}}createBoundingBox(){var i=this.bounds.clone();return(this.stencil!=null&&(this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH)||this.isPaintBoundsInverted())&&i.rotate90(),i}augmentBoundingBox(i){this.isShadow&&(i.width+=Math.ceil(mxConstants.SHADOW_OFFSET_X*this.scale),i.height+=Math.ceil(mxConstants.SHADOW_OFFSET_Y*this.scale)),i.grow(this.strokewidth*this.scale/2)}isPaintBoundsInverted(){return this.stencil==null&&(this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH)}getRotation(){return this.rotation!=null?this.rotation:0}getTextRotation(){var i=this.getRotation();return mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,1)!=1&&(i+=this.verticalTextRotation),i}getShapeRotation(){var i=this.getRotation();return this.direction!=null&&(this.direction==mxConstants.DIRECTION_NORTH?i+=270:this.direction==mxConstants.DIRECTION_WEST?i+=180:this.direction==mxConstants.DIRECTION_SOUTH&&(i+=90)),i}createTransparentSvgRectangle(i,t,e,s){var n=document.createElementNS(mxConstants.NS_SVG,"rect");return n.setAttribute("x",i),n.setAttribute("y",t),n.setAttribute("width",e),n.setAttribute("height",s),n.setAttribute("fill","none"),n.setAttribute("stroke","none"),n.setAttribute("pointer-events","all"),n}setTransparentBackgroundImage(i){i.style.backgroundImage="url('"+mxClient.imageBasePath+"/transparent.gif')"}releaseSvgGradients(i){if(i!=null)for(var t in i){var e=i[t];e!=null&&(e.mxRefCount=(e.mxRefCount||0)-1,e.mxRefCount==0&&e.parentNode!=null&&e.parentNode.removeChild(e))}}destroy(){this.node!=null&&(mxEvent.release(this.node),this.node.parentNode!=null&&this.node.parentNode.removeChild(this.node),this.node=null),this.releaseSvgGradients(this.oldGradients),this.oldGradients=null}}class mxPolyline extends mxShape{constructor(i,t,e){super(),this.points=i,this.stroke=t,this.strokewidth=e??1}getRotation(){return 0}getShapeRotation(){return 0}isPaintBoundsInverted(){return!1}paintEdgeShape(i,t){var e=i.pointerEventsValue;i.pointerEventsValue="stroke",this.style==null||this.style[mxConstants.STYLE_CURVED]!=1?this.paintLine(i,t,this.isRounded):this.paintCurvedLine(i,t),i.pointerEventsValue=e}paintLine(i,t,e){var s=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;i.begin(),this.addPoints(i,t,e,s,!1),i.stroke()}paintCurvedLine(i,t){i.begin();var e=t[0],s=t.length;i.moveTo(e.x,e.y);for(var n=1;n<s-2;n++){var a=t[n],o=t[n+1],l=(a.x+o.x)/2,r=(a.y+o.y)/2;i.quadTo(a.x,a.y,l,r)}var a=t[s-2],o=t[s-1];i.quadTo(a.x,a.y,o.x,o.y),i.stroke()}}class mxGuide{constructor(i,t){u(this,"states",null);u(this,"horizontal",!0);u(this,"vertical",!0);u(this,"guideX",null);u(this,"guideY",null);u(this,"rounded",!1);u(this,"tolerance",2);this.graph=i,this.setStates(t)}setStates(i){this.states=i}isEnabledForEvent(i){return!0}getGuideTolerance(i){return i&&this.graph.gridEnabled?this.graph.gridSize/2:this.tolerance}createGuideShape(i){var t=new mxPolyline([],mxConstants.GUIDE_COLOR,mxConstants.GUIDE_STROKEWIDTH);return t.isDashed=!0,t}isStateIgnored(i){return!1}move(i,t,e,s){if(this.states!=null&&(this.horizontal||this.vertical)&&i!=null&&t!=null){let H=function(D,A,G){var B=!1;G&&Math.abs(D-C)<f?(t.x=D-i.getCenterX(),f=Math.abs(D-C),B=!0):G||(Math.abs(D-x)<f?(t.x=D-i.x,f=Math.abs(D-x),B=!0):Math.abs(D-p)<f&&(t.x=D-i.x-i.width,f=Math.abs(D-p),B=!0)),B&&(o=A,h=D,this.guideX==null&&(this.guideX=this.createGuideShape(!0),this.guideX.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.guideX.pointerEvents=!1,this.guideX.init(this.graph.getView().getOverlayPane()))),a=a||B},R=function(D,A,G){var B=!1;G&&Math.abs(D-S)<c?(t.y=D-i.getCenterY(),c=Math.abs(D-S),B=!0):G||(Math.abs(D-E)<c?(t.y=D-i.y,c=Math.abs(D-E),B=!0):Math.abs(D-T)<c&&(t.y=D-i.y-i.height,c=Math.abs(D-T),B=!0)),B&&(g=A,m=D,this.guideY==null&&(this.guideY=this.createGuideShape(!1),this.guideY.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.guideY.pointerEvents=!1,this.guideY.init(this.graph.getView().getOverlayPane()))),d=d||B};var n=this.graph.getView().scale,l=this.getGuideTolerance(e)*n,r=i.clone();r.x+=t.x,r.y+=t.y;for(var a=!1,o=null,h=null,d=!1,g=null,m=null,f=l,c=l,x=r.x,p=r.x+r.width,C=r.getCenterX(),E=r.y,T=r.y+r.height,S=r.getCenterY(),y=0;y<this.states.length;y++){var b=this.states[y];b!=null&&!this.isStateIgnored(b)&&(this.horizontal&&(H.call(this,b.getCenterX(),b,!0),H.call(this,b.x,b,!1),H.call(this,b.x+b.width,b,!1),b.cell==null&&H.call(this,b.getCenterX(),b,!1)),this.vertical&&(R.call(this,b.getCenterY(),b,!0),R.call(this,b.y,b,!1),R.call(this,b.y+b.height,b,!1),b.cell==null&&R.call(this,b.getCenterY(),b,!1)))}this.graph.snapDelta(t,i,!e,a,d),t=this.getDelta(i,o,t.x,g,t.y);var w=this.graph.container;if(!a&&this.guideX!=null)this.guideX.node.style.visibility="hidden";else if(this.guideX!=null){var I=null,O=null;o!=null&&i!=null&&(I=Math.min(i.y+t.y-this.graph.panDy,o.y),O=Math.max(i.y+i.height+t.y-this.graph.panDy,o.y+o.height)),I!=null&&O!=null?this.guideX.points=[new mxPoint(h,I),new mxPoint(h,O)]:this.guideX.points=[new mxPoint(h,-this.graph.panDy),new mxPoint(h,w.scrollHeight-3-this.graph.panDy)],this.guideX.stroke=this.getGuideColor(o,!0),this.guideX.node.style.visibility="visible",this.guideX.redraw()}if(!d&&this.guideY!=null)this.guideY.node.style.visibility="hidden";else if(this.guideY!=null){var P=null,M=null;g!=null&&i!=null&&(P=Math.min(i.x+t.x-this.graph.panDx,g.x),M=Math.max(i.x+i.width+t.x-this.graph.panDx,g.x+g.width)),P!=null&&M!=null?this.guideY.points=[new mxPoint(P,m),new mxPoint(M,m)]:this.guideY.points=[new mxPoint(-this.graph.panDx,m),new mxPoint(w.scrollWidth-3-this.graph.panDx,m)],this.guideY.stroke=this.getGuideColor(g,!1),this.guideY.node.style.visibility="visible",this.guideY.redraw()}}return t}getDelta(i,t,e,s,n){var l=this.graph.view.scale;return(this.rounded||t!=null&&t.cell==null)&&(e=Math.round((i.x+e)/l)*l-i.x),(this.rounded||s!=null&&s.cell==null)&&(n=Math.round((i.y+n)/l)*l-i.y),new mxPoint(e,n)}getGuideColor(i,t){return mxConstants.GUIDE_COLOR}hide(){this.setVisible(!1)}setVisible(i){this.guideX!=null&&(this.guideX.node.style.visibility=i?"visible":"hidden"),this.guideY!=null&&(this.guideY.node.style.visibility=i?"visible":"hidden")}destroy(){this.guideX!=null&&(this.guideX.destroy(),this.guideX=null),this.guideY!=null&&(this.guideY.destroy(),this.guideY=null)}}class mxDragSource{constructor(i,t){u(this,"dragOffset",null);u(this,"dragElement",null);u(this,"previewElement",null);u(this,"enabled",!0);u(this,"currentGraph",null);u(this,"currentDropTarget",null);u(this,"currentPoint",null);u(this,"currentGuide",null);u(this,"currentHighlight",null);u(this,"autoscroll",!0);u(this,"guidesEnabled",!0);u(this,"gridEnabled",!0);u(this,"highlightDropTargets",!0);u(this,"dragElementZIndex",100);u(this,"dragElementOpacity",70);u(this,"checkEventSource",!0);this.element=i,this.dropHandler=t,mxEvent.addGestureListeners(i,e=>{this.mouseDown(e)}),mxEvent.addListener(i,"dragstart",function(e){mxEvent.consume(e)}),this.eventConsumer=function(e,s){var n=s.getProperty("eventName"),l=s.getProperty("event");n!=mxEvent.MOUSE_DOWN&&l.consume()}}isEnabled(){return this.enabled}setEnabled(i){this.enabled=i}isGuidesEnabled(){return this.guidesEnabled}setGuidesEnabled(i){this.guidesEnabled=i}isGridEnabled(){return this.gridEnabled}setGridEnabled(i){this.gridEnabled=i}getGraphForEvent(i){return null}getDropTarget(i,t,e,s){return i.getCellAt(t,e)}createDragElement(i){return this.element.cloneNode(!0)}createPreviewElement(i){return null}isActive(){return this.mouseMoveHandler!=null}reset(){this.currentGraph!=null&&(this.dragExit(this.currentGraph),this.currentGraph=null),this.removeDragElement(),this.removeListeners(),this.stopDrag()}mouseDown(i){this.enabled&&!mxEvent.isConsumed(i)&&this.mouseMoveHandler==null&&(this.startDrag(i),this.mouseMoveHandler=mxUtils.bind(this,this.mouseMove),this.mouseUpHandler=mxUtils.bind(this,this.mouseUp),mxEvent.addGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler),mxClient.IS_TOUCH&&!mxEvent.isMouseEvent(i)&&(this.eventSource=mxEvent.getSource(i),mxEvent.addGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler)))}startDrag(i){this.dragElement=this.createDragElement(i),this.dragElement.style.position="absolute",this.dragElement.style.zIndex=this.dragElementZIndex,mxUtils.setOpacity(this.dragElement,this.dragElementOpacity),this.checkEventSource&&mxClient.IS_SVG&&(this.dragElement.style.pointerEvents="none")}stopDrag(){this.removeDragElement()}removeDragElement(){this.dragElement!=null&&(this.dragElement.parentNode!=null&&this.dragElement.parentNode.removeChild(this.dragElement),this.dragElement=null)}getElementForEvent(i){return mxEvent.isTouchEvent(i)||mxEvent.isPenEvent(i)?document.elementFromPoint(mxEvent.getClientX(i),mxEvent.getClientY(i)):mxEvent.getSource(i)}graphContainsEvent(i,t){var e=mxEvent.getClientX(t),s=mxEvent.getClientY(t),n=mxUtils.getOffset(i.container),l=mxUtils.getScrollOrigin(),r=this.getElementForEvent(t);if(this.checkEventSource)for(;r!=null&&r!=i.container;)r=r.parentNode;return r!=null&&e>=n.x-l.x&&s>=n.y-l.y&&e<=n.x-l.x+i.container.offsetWidth&&s<=n.y-l.y+i.container.offsetHeight}mouseMove(i){var t=this.getGraphForEvent(i);if(t!=null&&!this.graphContainsEvent(t,i)&&(t=null),t!=this.currentGraph&&(this.currentGraph!=null&&this.dragExit(this.currentGraph,i),this.currentGraph=t,this.currentGraph!=null&&this.dragEnter(this.currentGraph,i)),this.currentGraph!=null&&this.dragOver(this.currentGraph,i),this.dragElement!=null&&(this.previewElement==null||this.previewElement.style.visibility!="visible")){var e=mxEvent.getClientX(i),s=mxEvent.getClientY(i);this.dragElement.parentNode==null&&document.body.appendChild(this.dragElement),this.dragElement.style.visibility="visible",this.dragOffset!=null&&(e+=this.dragOffset.x,s+=this.dragOffset.y);var n=mxUtils.getDocumentScrollOrigin(document);this.dragElement.style.left=e+n.x+"px",this.dragElement.style.top=s+n.y+"px"}else this.dragElement!=null&&(this.dragElement.style.visibility="hidden");mxEvent.consume(i)}mouseUp(i){if(this.currentGraph!=null){if(this.currentPoint!=null&&(this.previewElement==null||this.previewElement.style.visibility!="hidden")){var t=this.currentGraph.view.scale,e=this.currentGraph.view.translate,s=this.currentPoint.x/t-e.x,n=this.currentPoint.y/t-e.y;this.drop(this.currentGraph,i,this.currentDropTarget,s,n)}this.dragExit(this.currentGraph),this.currentGraph=null}this.stopDrag(),this.removeListeners(),mxEvent.consume(i)}removeListeners(){this.eventSource!=null&&(mxEvent.removeGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler),this.eventSource=null),mxEvent.removeGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler),this.mouseMoveHandler=null,this.mouseUpHandler=null}dragEnter(i,t){i.isMouseDown=!0,i.isMouseTrigger=mxEvent.isMouseEvent(t),this.previewElement=this.createPreviewElement(i),this.previewElement!=null&&this.checkEventSource&&mxClient.IS_SVG&&(this.previewElement.style.pointerEvents="none"),this.isGuidesEnabled()&&this.previewElement!=null&&(this.currentGuide=new mxGuide(i,i.graphHandler.getGuideStates())),this.highlightDropTargets&&(this.currentHighlight=new mxCellHighlight(i,mxConstants.DROP_TARGET_COLOR)),i.addListener(mxEvent.FIRE_MOUSE_EVENT,this.eventConsumer)}dragExit(i,t){this.currentDropTarget=null,this.currentPoint=null,i.isMouseDown=!1,i.removeListener(this.eventConsumer),this.previewElement!=null&&(this.previewElement.parentNode!=null&&this.previewElement.parentNode.removeChild(this.previewElement),this.previewElement=null),this.currentGuide!=null&&(this.currentGuide.destroy(),this.currentGuide=null),this.currentHighlight!=null&&(this.currentHighlight.destroy(),this.currentHighlight=null)}dragOver(i,t){var e=mxUtils.getOffset(i.container),s=mxUtils.getScrollOrigin(i.container),n=mxEvent.getClientX(t)-e.x+s.x-i.panDx,l=mxEvent.getClientY(t)-e.y+s.y-i.panDy;if(i.autoScroll&&(this.autoscroll==null||this.autoscroll)&&i.scrollPointToVisible(n,l,i.autoExtend),this.currentHighlight!=null&&i.isDropEnabled()){this.currentDropTarget=this.getDropTarget(i,n,l,t);var r=i.getView().getState(this.currentDropTarget);this.currentHighlight.highlight(r)}if(this.previewElement!=null){this.previewElement.parentNode==null&&(i.container.appendChild(this.previewElement),this.previewElement.style.zIndex="3",this.previewElement.style.position="absolute");var a=this.isGridEnabled()&&i.isGridEnabledEvent(t),o=!0;if(this.currentGuide!=null&&this.currentGuide.isEnabledForEvent(t)){var h=parseInt(this.previewElement.style.width),d=parseInt(this.previewElement.style.height),g=new mxRectangle(0,0,h,d),m=new mxPoint(n,l);m=this.currentGuide.move(g,m,a,!0),o=!1,n=m.x,l=m.y}else if(a){var f=i.view.scale,c=i.view.translate,x=i.gridSize/2;n=(i.snap(n/f-c.x-x)+c.x)*f,l=(i.snap(l/f-c.y-x)+c.y)*f}this.currentGuide!=null&&o&&this.currentGuide.hide(),this.previewOffset!=null&&(n+=this.previewOffset.x,l+=this.previewOffset.y),this.previewElement.style.left=Math.round(n)+"px",this.previewElement.style.top=Math.round(l)+"px",this.previewElement.style.visibility="visible"}this.currentPoint=new mxPoint(n,l)}drop(i,t,e,s,n){this.dropHandler.apply(this,arguments),i.container.style.visibility!="hidden"&&i.container.focus()}}class mxEventSource{constructor(i){u(this,"eventListeners",null);u(this,"eventsEnabled",!0);u(this,"eventSource",null);this.setEventSource(i)}isEventsEnabled(){return this.eventsEnabled}setEventsEnabled(i){this.eventsEnabled=i}getEventSource(){return this.eventSource}setEventSource(i){this.eventSource=i}addListener(i,t){this.eventListeners==null&&(this.eventListeners=[]),this.eventListeners.push(i),this.eventListeners.push(t)}removeListener(i){if(this.eventListeners!=null)for(var t=0;t<this.eventListeners.length;)this.eventListeners[t+1]==i?this.eventListeners.splice(t,2):t+=2}fireEvent(i,t){if(this.eventListeners!=null&&this.isEventsEnabled()){i==null&&(i=new mxEventObject),t==null&&(t=this.getEventSource()),t==null&&(t=this);for(var e=[t,i],s=0;s<this.eventListeners.length;s+=2){var n=this.eventListeners[s];(n==null||n==i.getName())&&this.eventListeners[s+1].apply(this,e)}}}}class mxWindow extends mxEventSource{constructor(t,e,s,n,l,r,a,o,h,d){super();u(this,"closeImage",mxClient.imageBasePath+"/close.gif");u(this,"minimizeImage",mxClient.imageBasePath+"/minimize.gif");u(this,"normalizeImage",mxClient.imageBasePath+"/normalize.gif");u(this,"maximizeImage",mxClient.imageBasePath+"/maximize.gif");u(this,"resizeImage",mxClient.imageBasePath+"/resize.gif");u(this,"visible",!1);u(this,"minimumSize",new mxRectangle(0,0,50,40));u(this,"destroyOnClose",!0);u(this,"contentHeightCorrection",document.documentMode==8||document.documentMode==7?6:2);u(this,"title",null);u(this,"content",null);e!=null&&(a=a??!0,this.content=e,this.init(s,n,l,r,d),this.installMaximizeHandler(),this.installMinimizeHandler(),this.installCloseHandler(),this.setMinimizable(a),this.setTitle(t),(o==null||o)&&this.installMoveHandler(),h!=null&&h.parentNode!=null?h.parentNode.replaceChild(this.div,h):document.body.appendChild(this.div))}init(t,e,s,n,l){l=l??"mxWindow",this.div=document.createElement("div"),this.div.className=l,this.div.style.left=t+"px",this.div.style.top=e+"px",this.table=document.createElement("table"),this.table.className=l,mxClient.IS_POINTER&&(this.div.style.touchAction="none"),s!=null&&(mxClient.IS_QUIRKS||(this.div.style.width=s+"px"),this.table.style.width=s+"px"),n!=null&&(mxClient.IS_QUIRKS||(this.div.style.height=n+"px"),this.table.style.height=n+"px");var r=document.createElement("tbody"),a=document.createElement("tr");this.title=document.createElement("td"),this.title.className=l+"Title",this.buttons=document.createElement("div"),this.buttons.style.position="absolute",this.buttons.style.display="inline-block",this.buttons.style.right="4px",this.buttons.style.top="5px",this.title.appendChild(this.buttons),a.appendChild(this.title),r.appendChild(a),a=document.createElement("tr"),this.td=document.createElement("td"),this.td.className=l+"Pane",document.documentMode==7&&(this.td.style.height="100%"),this.contentWrapper=document.createElement("div"),this.contentWrapper.className=l+"Pane",this.contentWrapper.style.width="100%",this.contentWrapper.appendChild(this.content),(mxClient.IS_QUIRKS||this.content.nodeName.toUpperCase()!="DIV")&&(this.contentWrapper.style.height="100%"),this.td.appendChild(this.contentWrapper),a.appendChild(this.td),r.appendChild(a),this.table.appendChild(r),this.div.appendChild(this.table);var o=h=>{this.activate()};mxEvent.addGestureListeners(this.title,o),mxEvent.addGestureListeners(this.table,o),this.hide()}setTitle(t){for(var e=this.title.firstChild;e!=null;){var s=e.nextSibling;e.nodeType==mxConstants.NODETYPE_TEXT&&e.parentNode.removeChild(e),e=s}mxUtils.write(this.title,t||""),this.title.appendChild(this.buttons)}setScrollable(t){(navigator.userAgent==null||navigator.userAgent.indexOf("Presto/2.5")<0)&&(t?this.contentWrapper.style.overflow="auto":this.contentWrapper.style.overflow="hidden")}activate(){if(mxWindow.activeWindow!=this){var t=mxUtils.getCurrentStyle(this.getElement()),e=t!=null?t.zIndex:3;if(mxWindow.activeWindow){var s=mxWindow.activeWindow.getElement();s!=null&&s.style!=null&&(s.style.zIndex=e)}var n=mxWindow.activeWindow;this.getElement().style.zIndex=parseInt(e)+1,this.fireEvent(new mxEventObject(mxEvent.ACTIVATE,"previousWindow",n))}}getElement(){return this.div}fit(){mxUtils.fit(this.div)}isResizable(){return this.resize!=null?this.resize.style.display!="none":!1}setResizable(t){if(t)if(this.resize==null){this.resize=document.createElement("img"),this.resize.style.position="absolute",this.resize.style.bottom="2px",this.resize.style.right="2px",this.resize.setAttribute("src",this.resizeImage),this.resize.style.cursor="nw-resize";var e=null,s=null,n=null,l=null,r=h=>{this.activate(),e=mxEvent.getClientX(h),s=mxEvent.getClientY(h),n=this.div.offsetWidth,l=this.div.offsetHeight,mxEvent.addGestureListeners(document,null,a,o),this.fireEvent(new mxEventObject(mxEvent.RESIZE_START,"event",h)),mxEvent.consume(h)},a=h=>{if(e!=null&&s!=null){var d=mxEvent.getClientX(h)-e,g=mxEvent.getClientY(h)-s;this.setSize(n+d,l+g),this.fireEvent(new mxEventObject(mxEvent.RESIZE,"event",h)),mxEvent.consume(h)}},o=h=>{e!=null&&s!=null&&(e=null,s=null,mxEvent.removeGestureListeners(document,null,a,o),this.fireEvent(new mxEventObject(mxEvent.RESIZE_END,"event",h)),mxEvent.consume(h))};mxEvent.addGestureListeners(this.resize,r,a,o),this.div.appendChild(this.resize)}else this.resize.style.display="inline";else this.resize!=null&&(this.resize.style.display="none")}setSize(t,e){t=Math.max(this.minimumSize.width,t),e=Math.max(this.minimumSize.height,e),mxClient.IS_QUIRKS||(this.div.style.width=t+"px",this.div.style.height=e+"px"),this.table.style.width=t+"px",this.table.style.height=e+"px",mxClient.IS_QUIRKS||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px")}setMinimizable(t){this.minimize.style.display=t?"":"none"}getMinimumSize(){return new mxRectangle(0,0,0,this.title.offsetHeight)}installMinimizeHandler(){this.minimize=document.createElement("img"),this.minimize.setAttribute("src",this.minimizeImage),this.minimize.setAttribute("title","Minimize"),this.minimize.style.cursor="pointer",this.minimize.style.marginLeft="2px",this.minimize.style.display="none",this.buttons.appendChild(this.minimize);var t=!1,e=null,s=null,n=l=>{if(this.activate(),t)t=!1,this.minimize.setAttribute("src",this.minimizeImage),this.minimize.setAttribute("title","Minimize"),this.contentWrapper.style.display="",this.maximize.style.display=e,mxClient.IS_QUIRKS||(this.div.style.height=s),this.table.style.height=s,this.resize!=null&&(this.resize.style.visibility=""),this.fireEvent(new mxEventObject(mxEvent.NORMALIZE,"event",l));else{t=!0,this.minimize.setAttribute("src",this.normalizeImage),this.minimize.setAttribute("title","Normalize"),this.contentWrapper.style.display="none",e=this.maximize.style.display,this.maximize.style.display="none",s=this.table.style.height;var r=this.getMinimumSize();r.height>0&&(mxClient.IS_QUIRKS||(this.div.style.height=r.height+"px"),this.table.style.height=r.height+"px"),r.width>0&&(mxClient.IS_QUIRKS||(this.div.style.width=r.width+"px"),this.table.style.width=r.width+"px"),this.resize!=null&&(this.resize.style.visibility="hidden"),this.fireEvent(new mxEventObject(mxEvent.MINIMIZE,"event",l))}mxEvent.consume(l)};mxEvent.addGestureListeners(this.minimize,n)}setMaximizable(t){this.maximize.style.display=t?"":"none"}installMaximizeHandler(){this.maximize=document.createElement("img"),this.maximize.setAttribute("src",this.maximizeImage),this.maximize.setAttribute("title","Maximize"),this.maximize.style.cursor="default",this.maximize.style.marginLeft="2px",this.maximize.style.cursor="pointer",this.maximize.style.display="none",this.buttons.appendChild(this.maximize);var t=!1,e=null,s=null,n=null,l=null,r=null,a=o=>{if(this.activate(),this.maximize.style.display!="none"){if(t){if(t=!1,this.maximize.setAttribute("src",this.maximizeImage),this.maximize.setAttribute("title","Maximize"),this.contentWrapper.style.display="",this.minimize.style.display=r,this.div.style.left=e+"px",this.div.style.top=s+"px",!mxClient.IS_QUIRKS){this.div.style.height=n,this.div.style.width=l;var d=mxUtils.getCurrentStyle(this.contentWrapper);(d.overflow=="auto"||this.resize!=null)&&(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px")}this.table.style.height=n,this.table.style.width=l,this.resize!=null&&(this.resize.style.visibility=""),this.fireEvent(new mxEventObject(mxEvent.NORMALIZE,"event",o))}else{t=!0,this.maximize.setAttribute("src",this.normalizeImage),this.maximize.setAttribute("title","Normalize"),this.contentWrapper.style.display="",r=this.minimize.style.display,this.minimize.style.display="none",e=parseInt(this.div.style.left),s=parseInt(this.div.style.top),n=this.table.style.height,l=this.table.style.width,this.div.style.left="0px",this.div.style.top="0px";var h=Math.max(document.body.clientHeight||0,document.documentElement.clientHeight||0);if(mxClient.IS_QUIRKS||(this.div.style.width=document.body.clientWidth-2+"px",this.div.style.height=h-2+"px"),this.table.style.width=document.body.clientWidth-2+"px",this.table.style.height=h-2+"px",this.resize!=null&&(this.resize.style.visibility="hidden"),!mxClient.IS_QUIRKS){var d=mxUtils.getCurrentStyle(this.contentWrapper);(d.overflow=="auto"||this.resize!=null)&&(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px")}this.fireEvent(new mxEventObject(mxEvent.MAXIMIZE,"event",o))}mxEvent.consume(o)}};mxEvent.addGestureListeners(this.maximize,a),mxEvent.addListener(this.title,"dblclick",a)}installMoveHandler(){this.title.style.cursor="move",mxEvent.addGestureListeners(this.title,t=>{var e=mxEvent.getClientX(t),s=mxEvent.getClientY(t),n=this.getX(),l=this.getY(),r=o=>{var h=mxEvent.getClientX(o)-e,d=mxEvent.getClientY(o)-s;this.setLocation(n+h,l+d),this.fireEvent(new mxEventObject(mxEvent.MOVE,"event",o)),mxEvent.consume(o)},a=o=>{mxEvent.removeGestureListeners(document,null,r,a),this.fireEvent(new mxEventObject(mxEvent.MOVE_END,"event",o)),mxEvent.consume(o)};mxEvent.addGestureListeners(document,null,r,a),this.fireEvent(new mxEventObject(mxEvent.MOVE_START,"event",t)),mxEvent.consume(t)}),mxClient.IS_POINTER&&(this.title.style.touchAction="none")}setLocation(t,e){this.div.style.left=t+"px",this.div.style.top=e+"px"}getX(){return parseInt(this.div.style.left)}getY(){return parseInt(this.div.style.top)}installCloseHandler(){this.closeImg=document.createElement("img"),this.closeImg.setAttribute("src",this.closeImage),this.closeImg.setAttribute("title","Close"),this.closeImg.style.marginLeft="2px",this.closeImg.style.cursor="pointer",this.closeImg.style.display="none",this.buttons.appendChild(this.closeImg),mxEvent.addGestureListeners(this.closeImg,t=>{this.fireEvent(new mxEventObject(mxEvent.CLOSE,"event",t)),this.destroyOnClose?this.destroy():this.setVisible(!1),mxEvent.consume(t)})}setImage(t){this.image=document.createElement("img"),this.image.setAttribute("src",t),this.image.setAttribute("align","left"),this.image.style.marginRight="4px",this.image.style.marginLeft="0px",this.image.style.marginTop="-2px",this.title.insertBefore(this.image,this.title.firstChild)}setClosable(t){this.closeImg.style.display=t?"":"none"}isVisible(){return this.div!=null?this.div.style.display!="none":!1}setVisible(t){this.div!=null&&this.isVisible()!=t&&(t?this.show():this.hide())}show(){this.div.style.display="",this.activate();var t=mxUtils.getCurrentStyle(this.contentWrapper);!mxClient.IS_QUIRKS&&(t.overflow=="auto"||this.resize!=null)&&this.contentWrapper.style.display!="none"&&(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px"),this.fireEvent(new mxEventObject(mxEvent.SHOW))}hide(){this.div.style.display="none",this.fireEvent(new mxEventObject(mxEvent.HIDE))}destroy(){this.fireEvent(new mxEventObject(mxEvent.DESTROY)),this.div!=null&&(mxEvent.release(this.div),this.div.parentNode.removeChild(this.div),this.div=null),this.title=null,this.content=null,this.contentWrapper=null}}const _=class _{static init(){if(_.window==null&&document.body!=null){var i=_.consoleName+" - mxGraph "+mxClient.VERSION,t=document.createElement("table");t.setAttribute("width","100%"),t.setAttribute("height","100%");var e=document.createElement("tbody"),s=document.createElement("tr"),n=document.createElement("td");n.style.verticalAlign="top",_.textarea=document.createElement("textarea"),_.textarea.setAttribute("wrap","off"),_.textarea.setAttribute("readOnly","true"),_.textarea.style.height="100%",_.textarea.style.resize="none",_.textarea.value=_.buffer,mxClient.IS_NS&&document.compatMode!="BackCompat"?_.textarea.style.width="99%":_.textarea.style.width="100%",n.appendChild(_.textarea),s.appendChild(n),e.appendChild(s),s=document.createElement("tr"),_.td=document.createElement("td"),_.td.style.verticalAlign="top",_.td.setAttribute("height","30px"),s.appendChild(_.td),e.appendChild(s),t.appendChild(e),_.addButton("Info",function(h){_.info()}),_.addButton("DOM",function(h){var d=mxUtils.getInnerHtml(document.body);_.debug(d)}),_.addButton("Trace",function(h){_.TRACE=!_.TRACE,_.TRACE?_.debug("Tracing enabled"):_.debug("Tracing disabled")}),_.addButton("Copy",function(h){try{mxUtils.copy(_.textarea.value)}catch(d){mxUtils.alert(d)}}),_.addButton("Show",function(h){try{mxUtils.popup(_.textarea.value)}catch(d){mxUtils.alert(d)}}),_.addButton("Clear",function(h){_.textarea.value=""});var l=0,r=0;if(typeof window.innerWidth=="number"?(l=window.innerHeight,r=window.innerWidth):(l=document.documentElement.clientHeight||document.body.clientHeight,r=document.body.clientWidth),_.window=new mxWindow(i,t,Math.max(0,r-320),Math.max(0,l-210),300,160),_.window.setMaximizable(!0),_.window.setScrollable(!1),_.window.setResizable(!0),_.window.setClosable(!0),_.window.destroyOnClose=!1,mxClient.IS_NS&&!mxClient.IS_GC&&!mxClient.IS_SF&&document.compatMode!="BackCompat"||document.documentMode==11){var a=_.window.getElement(),o=function(h,d){_.textarea.style.height=Math.max(0,a.offsetHeight-70)+"px"};_.window.addListener(mxEvent.RESIZE_END,o),_.window.addListener(mxEvent.MAXIMIZE,o),_.window.addListener(mxEvent.NORMALIZE,o),_.textarea.style.height="92px"}}}static info(){_.writeln(mxUtils.toString(navigator))}static addButton(i,t){var e=document.createElement("button");mxUtils.write(e,i),mxEvent.addListener(e,"click",t),_.td.appendChild(e)}static isVisible(){return _.window!=null?_.window.isVisible():!1}static show(){_.setVisible(!0)}static setVisible(i){_.window==null&&_.init(),_.window!=null&&_.window.setVisible(i)}static enter(i){if(_.TRACE)return _.writeln("Entering "+i),new Date().getTime()}static leave(i,t){if(_.TRACE){var e=t!=0?" ("+(new Date().getTime()-t)+" ms)":"";_.writeln("Leaving "+i+e)}}static debug(){_.DEBUG&&_.writeln.apply(this,arguments)}static warn(){_.WARN&&_.writeln.apply(this,arguments)}static write(){for(var i="",t=0;t<arguments.length;t++)i+=arguments[t],t<arguments.length-1&&(i+=" ");_.textarea!=null?(_.textarea.value=_.textarea.value+i,navigator.userAgent!=null&&navigator.userAgent.indexOf("Presto/2.5")>=0&&(_.textarea.style.visibility="hidden",_.textarea.style.visibility="visible"),_.textarea.scrollTop=_.textarea.scrollHeight):_.buffer+=i}static writeln(){for(var i="",t=0;t<arguments.length;t++)i+=arguments[t],t<arguments.length-1&&(i+=" ");_.write(i+`
`)}};u(_,"consoleName","Console"),u(_,"TRACE",!1),u(_,"DEBUG",!0),u(_,"WARN",!0),u(_,"buffer","");let mxLog=_;class mxGeometry extends mxRectangle{constructor(t,e,s,n){super(t,e,s,n);u(this,"TRANSLATE_CONTROL_POINTS",!0);u(this,"alternateBounds",null);u(this,"sourcePoint",null);u(this,"targetPoint",null);u(this,"points",null);u(this,"offset",null);u(this,"relative",!1)}swap(){if(this.alternateBounds!=null){var t=new mxRectangle(this.x,this.y,this.width,this.height);this.x=this.alternateBounds.x,this.y=this.alternateBounds.y,this.width=this.alternateBounds.width,this.height=this.alternateBounds.height,this.alternateBounds=t}}getTerminalPoint(t){return t?this.sourcePoint:this.targetPoint}setTerminalPoint(t,e){return e?this.sourcePoint=t:this.targetPoint=t,t}rotate(t,e){var s=mxUtils.toRadians(t),n=Math.cos(s),l=Math.sin(s);if(!this.relative){var r=new mxPoint(this.getCenterX(),this.getCenterY()),a=mxUtils.getRotatedPoint(r,n,l,e);this.x=Math.round(a.x-this.width/2),this.y=Math.round(a.y-this.height/2)}if(this.sourcePoint!=null){var a=mxUtils.getRotatedPoint(this.sourcePoint,n,l,e);this.sourcePoint.x=Math.round(a.x),this.sourcePoint.y=Math.round(a.y)}if(this.targetPoint!=null){var a=mxUtils.getRotatedPoint(this.targetPoint,n,l,e);this.targetPoint.x=Math.round(a.x),this.targetPoint.y=Math.round(a.y)}if(this.points!=null){for(var o=0;o<this.points.length;o++)if(this.points[o]!=null){var a=mxUtils.getRotatedPoint(this.points[o],n,l,e);this.points[o].x=Math.round(a.x),this.points[o].y=Math.round(a.y)}}}translate(t,e){if(t=parseFloat(t),e=parseFloat(e),this.relative||(this.x=parseFloat(this.x)+t,this.y=parseFloat(this.y)+e),this.sourcePoint!=null&&(this.sourcePoint.x=parseFloat(this.sourcePoint.x)+t,this.sourcePoint.y=parseFloat(this.sourcePoint.y)+e),this.targetPoint!=null&&(this.targetPoint.x=parseFloat(this.targetPoint.x)+t,this.targetPoint.y=parseFloat(this.targetPoint.y)+e),this.TRANSLATE_CONTROL_POINTS&&this.points!=null)for(var s=0;s<this.points.length;s++)this.points[s]!=null&&(this.points[s].x=parseFloat(this.points[s].x)+t,this.points[s].y=parseFloat(this.points[s].y)+e)}scale(t,e,s){if(t=parseFloat(t),e=parseFloat(e),this.sourcePoint!=null&&(this.sourcePoint.x=parseFloat(this.sourcePoint.x)*t,this.sourcePoint.y=parseFloat(this.sourcePoint.y)*e),this.targetPoint!=null&&(this.targetPoint.x=parseFloat(this.targetPoint.x)*t,this.targetPoint.y=parseFloat(this.targetPoint.y)*e),this.points!=null)for(var n=0;n<this.points.length;n++)this.points[n]!=null&&(this.points[n].x=parseFloat(this.points[n].x)*t,this.points[n].y=parseFloat(this.points[n].y)*e);this.relative||(this.x=parseFloat(this.x)*t,this.y=parseFloat(this.y)*e,s&&(e=t=Math.min(t,e)),this.width=parseFloat(this.width)*t,this.height=parseFloat(this.height)*e)}equals(t){return super.equals(t)&&this.relative==t.relative&&(this.sourcePoint==null&&t.sourcePoint==null||this.sourcePoint!=null&&this.sourcePoint.equals(t.sourcePoint))&&(this.targetPoint==null&&t.targetPoint==null||this.targetPoint!=null&&this.targetPoint.equals(t.targetPoint))&&(this.points==null&&t.points==null||this.points!=null&&mxUtils.equalPoints(this.points,t.points))&&(this.alternateBounds==null&&t.alternateBounds==null||this.alternateBounds!=null&&this.alternateBounds.equals(t.alternateBounds))&&(this.offset==null&&t.offset==null||this.offset!=null&&this.offset.equals(t.offset))}}const Lt=class Lt{constructor(i,t,e,s){this.template=i,this.exclude=t??[],this.idrefs=e??[],this.mapping=s??[],this.reverse=new Object;for(var n in this.mapping)this.reverse[this.mapping[n]]=n}getName(){return mxUtils.getFunctionName(this.template.constructor)}cloneTemplate(){return new this.template.constructor}getFieldName(i){if(i!=null){var t=this.reverse[i];t!=null&&(i=t)}return i}getAttributeName(i){if(i!=null){var t=this.mapping[i];t!=null&&(i=t)}return i}isExcluded(i,t,e,s){return t==mxObjectIdentity.FIELD_NAME||mxUtils.indexOf(this.exclude,t)>=0}isReference(i,t,e,s){return mxUtils.indexOf(this.idrefs,t)>=0}encode(i,t){var e=i.document.createElement(this.getName());return t=this.beforeEncode(i,t,e),this.encodeObject(i,t,e),this.afterEncode(i,t,e)}encodeObject(i,t,e){i.setAttribute(e,"id",i.getId(t));for(var s in t){var n=s,l=t[n];l!=null&&!this.isExcluded(t,n,l,!0)&&(mxUtils.isInteger(n)&&(n=null),this.encodeValue(i,t,n,l,e))}}encodeValue(i,t,e,s,n){if(s!=null){if(this.isReference(t,e,s,!0)){var l=i.getId(s);if(l==null){mxLog.warn("mxObjectCodec.encode: No ID for "+this.getName()+"."+e+"="+s);return}s=l}var r=this.template[e];(e==null||i.encodeDefaults||r!=s)&&(e=this.getAttributeName(e),this.writeAttribute(i,t,e,s,n))}}writeAttribute(i,t,e,s,n){typeof s!="object"?this.writePrimitiveAttribute(i,t,e,s,n):this.writeComplexAttribute(i,t,e,s,n)}writePrimitiveAttribute(i,t,e,s,n){if(s=this.convertAttributeToXml(i,t,e,s,n),e==null){var l=i.document.createElement("add");typeof s=="function"?l.appendChild(i.document.createTextNode(s)):i.setAttribute(l,"value",s),n.appendChild(l)}else typeof s!="function"&&i.setAttribute(n,e,s)}writeComplexAttribute(i,t,e,s,n){var l=i.encode(s);l!=null?(e!=null&&l.setAttribute("as",e),n.appendChild(l)):mxLog.warn("mxObjectCodec.encode: No node for "+this.getName()+"."+e+": "+s)}convertAttributeToXml(i,t,e,s){return this.isBooleanAttribute(i,t,e,s)&&(s=s==!0?"1":"0"),s}isBooleanAttribute(i,t,e,s){return typeof s.length>"u"&&(s==!0||s==!1)}convertAttributeFromXml(i,t,e){var s=t.value;return this.isNumericAttribute(i,t,e)&&(s=parseFloat(s),(isNaN(s)||!isFinite(s))&&(s=0)),s}isNumericAttribute(i,t,e){var s=e.constructor==mxGeometry&&(t.name=="x"||t.name=="y"||t.name=="width"||t.name=="height")||e.constructor==mxPoint&&(t.name=="x"||t.name=="y")||mxUtils.isNumeric(t.value);return s}beforeEncode(i,t,e){return t}afterEncode(i,t,e){return e}decode(i,t,e){var s=t.getAttribute("id"),n=i.objects[s];return n==null&&(n=e||this.cloneTemplate(),s!=null&&i.putObject(s,n)),t=this.beforeDecode(i,t,n),this.decodeNode(i,t,n),this.afterDecode(i,t,n)}decodeNode(i,t,e){t!=null&&(this.decodeAttributes(i,t,e),this.decodeChildren(i,t,e))}decodeAttributes(i,t,e){var s=t.attributes;if(s!=null)for(var n=0;n<s.length;n++)this.decodeAttribute(i,s[n],e)}isIgnoredAttribute(i,t,e){return t.nodeName=="as"||t.nodeName=="id"}decodeAttribute(i,t,e){if(!this.isIgnoredAttribute(i,t,e)){var s=t.nodeName,n=this.convertAttributeFromXml(i,t,e),l=this.getFieldName(s);if(this.isReference(e,l,n,!1)){var r=i.getObject(n);if(r==null){mxLog.warn("mxObjectCodec.decode: No object for "+this.getName()+"."+s+"="+n);return}n=r}this.isExcluded(e,s,n,!1)||(e[s]=n)}}decodeChildren(i,t,e){for(var s=t.firstChild;s!=null;){var n=s.nextSibling;s.nodeType==mxConstants.NODETYPE_ELEMENT&&!this.processInclude(i,s,e)&&this.decodeChild(i,s,e),s=n}}decodeChild(i,t,e){var s=this.getFieldName(t.getAttribute("as"));if(s==null||!this.isExcluded(e,s,t,!1)){var n=this.getFieldTemplate(e,s,t),l=null;t.nodeName=="add"?(l=t.getAttribute("value"),l==null&&Lt.allowEval&&(l=mxUtils.eval(mxUtils.getTextContent(t)))):l=i.decode(t,n);try{this.addObjectValue(e,s,l,n)}catch(r){throw new Error(r.message+" for "+t.nodeName)}}}getFieldTemplate(i,t,e){var s=i[t];return s instanceof Array&&s.length>0&&(s=null),s}addObjectValue(i,t,e,s){e!=null&&e!=s&&(t!=null&&t.length>0?i[t]=e:i.push(e))}processInclude(i,t,e){if(t.nodeName=="include"){var s=t.getAttribute("name");if(s!=null)try{var n=mxUtils.load(s).getDocumentElement();n!=null&&i.decode(n,e)}catch{}return!0}return!1}beforeDecode(i,t,e){return t}afterDecode(i,t,e){return e}};u(Lt,"allowEval",!1);let mxObjectCodec=Lt;const _mxCodecRegistry=class _mxCodecRegistry{static register(v){if(v!=null){var i=v.getName();_mxCodecRegistry.codecs[i]=v;var t=mxUtils.getFunctionName(v.template.constructor);t!=i&&_mxCodecRegistry.addAlias(t,i)}return v}static addAlias(v,i){_mxCodecRegistry.aliases[v]=i}static getCodec_encode(v){var i=null;if(v!=null){var t=mxUtils.getFunctionName(v),e=_mxCodecRegistry.aliases[t];if(e!=null&&(t=e),i=_mxCodecRegistry.codecs[t],i==null)try{i=new mxObjectCodec(new v),_mxCodecRegistry.register(i)}catch{}}return i}static getCodec(name){var codec=null;if(codec=_mxCodecRegistry.codecs[name],codec==null)try{let classname=name,obj=eval("new "+classname+"()");codec=new mxObjectCodec(obj),_mxCodecRegistry.register(codec)}catch(v){}return codec}};u(_mxCodecRegistry,"codecs",[]),u(_mxCodecRegistry,"aliases",[]);let mxCodecRegistry=_mxCodecRegistry;const xt=class xt{static create(i){var t="";if(i!=null)for(var e=i.getParent();e!=null;){var s=e.getIndex(i);t=s+xt.PATH_SEPARATOR+t,i=e,e=i.getParent()}var n=t.length;return n>1&&(t=t.substring(0,n-1)),t}static getParentPath(i){if(i!=null){var t=i.lastIndexOf(xt.PATH_SEPARATOR);if(t>=0)return i.substring(0,t);if(i.length>0)return""}return null}static resolve(i,t){var e=i;if(t!=null)for(var s=t.split(xt.PATH_SEPARATOR),n=0;n<s.length;n++)e=e.getChildAt(parseInt(s[n]));return e}static compare(i,t){for(var e=Math.min(i.length,t.length),s=0,n=0;n<e;n++)if(i[n]!=t[n]){if(i[n].length==0||t[n].length==0)s=i[n]==t[n]?0:i[n]>t[n]?1:-1;else{var l=parseInt(i[n]),r=parseInt(t[n]);s=l==r?0:l>r?1:-1}break}if(s==0){var l=i.length,r=t.length;l!=r&&(s=l>r?1:-1)}return s}clone(){return Object.assign(Object.create(Object.getPrototypeOf(this)),this)}};u(xt,"PATH_SEPARATOR",".");let mxCellPath=xt;class mxCell{constructor(i,t,e){u(this,"id",null);u(this,"geometry",null);u(this,"style",null);u(this,"vertex",!1);u(this,"edge",!1);u(this,"connectable",!0);u(this,"visible",!0);u(this,"collapsed",!1);u(this,"parent",null);u(this,"source",null);u(this,"target",null);u(this,"children",null);u(this,"edges",null);u(this,"mxTransient",["id","value","parent","source","target","children","edges"]);this.value=i,this.setGeometry(t),this.setStyle(e),this.onInit!=null&&this.onInit()}getId(){return this.id}setId(i){this.id=i}getValue(){return this.value}setValue(i){this.value=i}valueChanged(i){var t=this.getValue();return this.setValue(i),t}getGeometry(){return this.geometry}setGeometry(i){this.geometry=i}getStyle(){return this.style}setStyle(i){this.style=i}isVertex(){return this.vertex!=0}setVertex(i){this.vertex=i}isEdge(){return this.edge!=0}setEdge(i){this.edge=i}isConnectable(){return this.connectable!=0}setConnectable(i){this.connectable=i}isVisible(){return this.visible!=0}setVisible(i){this.visible=i}isCollapsed(){return this.collapsed!=0}setCollapsed(i){this.collapsed=i}getParent(){return this.parent}setParent(i){this.parent=i}getTerminal(i){return i?this.source:this.target}setTerminal(i,t){return t?this.source=i:this.target=i,i}getChildCount(){return this.children==null?0:this.children.length}getIndex(i){return mxUtils.indexOf(this.children,i)}getChildAt(i){return this.children==null?null:this.children[i]}insert(i,t){return i!=null&&(t==null&&(t=this.getChildCount(),i.getParent()==this&&t--),i.removeFromParent(),i.setParent(this),this.children==null?(this.children=[],this.children.push(i)):this.children.splice(t,0,i)),i}remove(i){var t=null;return this.children!=null&&i>=0&&(t=this.getChildAt(i),t!=null&&(this.children.splice(i,1),t.setParent(null))),t}removeFromParent(){if(this.parent!=null){var i=this.parent.getIndex(this);this.parent.remove(i)}}getEdgeCount(){return this.edges==null?0:this.edges.length}getEdgeIndex(i){return mxUtils.indexOf(this.edges,i)}getEdgeAt(i){return this.edges==null?null:this.edges[i]}insertEdge(i,t){return i!=null&&(i.removeFromTerminal(t),i.setTerminal(this,t),(this.edges==null||i.getTerminal(!t)!=this||mxUtils.indexOf(this.edges,i)<0)&&(this.edges==null&&(this.edges=[]),this.edges.push(i))),i}removeEdge(i,t){if(i!=null){if(i.getTerminal(!t)!=this&&this.edges!=null){var e=this.getEdgeIndex(i);e>=0&&this.edges.splice(e,1)}i.setTerminal(null,t)}return i}removeFromTerminal(i){var t=this.getTerminal(i);t!=null&&t.removeEdge(this,i)}hasAttribute(i){var t=this.getValue();return t!=null&&t.nodeType==mxConstants.NODETYPE_ELEMENT&&t.hasAttribute?t.hasAttribute(i):t.getAttribute(i)!=null}getAttribute(i,t){var e=this.getValue(),s=e!=null&&e.nodeType==mxConstants.NODETYPE_ELEMENT?e.getAttribute(i):null;return s??t}setAttribute(i,t){var e=this.getValue();e!=null&&e.nodeType==mxConstants.NODETYPE_ELEMENT&&e.setAttribute(i,t)}clone(){var i=mxUtils.clone(this,this.mxTransient);return i.setValue(this.cloneValue()),i}cloneValue(){var i=this.getValue();return i!=null&&(typeof i.clone=="function"?i=i.clone():isNaN(i.nodeType)||(i=i.cloneNode(!0))),i}}class mxCodec{constructor(i){u(this,"elements",null);u(this,"encodeDefaults",!1);this.document=i||mxUtils.createXmlDocument(),this.objects=[]}putObject(i,t){return this.objects[i]=t,t}getObject(i){var t=null;if(i!=null&&(t=this.objects[i],t==null&&(t=this.lookup(i),t==null))){var e=this.getElementById(i);e!=null&&(t=this.decode(e))}return t}lookup(i){return null}getElementById(i){return this.updateElements(),this.elements[i]}updateElements(){this.elements==null&&(this.elements=new Object,this.document.documentElement!=null&&this.addElement(this.document.documentElement))}addElement(i){if(i.nodeType==mxConstants.NODETYPE_ELEMENT){var t=i.getAttribute("id");if(t!=null){if(this.elements[t]==null)this.elements[t]=i;else if(this.elements[t]!=i)throw new Error(t+": Duplicate ID")}}for(i=i.firstChild;i!=null;)this.addElement(i),i=i.nextSibling}getId(i){var t=null;return i!=null&&(t=this.reference(i),t==null&&i instanceof mxCell&&(t=i.getId(),t==null&&(t=mxCellPath.create(i),t.length==0&&(t="root")))),t}reference(i){return null}encode(i){var t=null;if(i!=null&&i.constructor!=null){var e=mxCodecRegistry.getCodec_encode(i.constructor);e!=null?t=e.encode(this,i):mxUtils.isNode(i)?t=mxUtils.importNode(this.document,i,!0):mxLog.warn("mxCodec.encode: No codec for "+mxUtils.getFunctionName(i.constructor))}return t}decode(i,t){this.updateElements();var e=null;if(i!=null&&i.nodeType==mxConstants.NODETYPE_ELEMENT){var s=mxCodecRegistry.getCodec(i.nodeName);s!=null?e=s.decode(this,i,t):(e=i.cloneNode(!0),e.removeAttribute("as"))}return e}decode_tmp(i,t){this.updateElements();var e=null,s=null,s=mxCodecRegistry.getCodec(i.nodeName);if(s!=null)try{e=s.decode(this,i,t)}catch(n){console.log("dec.decode err",n)}else if(i.nodeName=="mxGeometry"){const l=new DOMParser().parseFromString(i.outerHTML,"application/xml");let r=0,a=0,o=0,h=0;for(let d=0;d<l.documentElement.attributes.length;d++){let g=l.documentElement.attributes[d].name;g=="x"?r=parseInt(l.documentElement.attributes[d].value,10):g=="y"?a=parseInt(l.documentElement.attributes[d].value,10):g=="width"?o=parseInt(l.documentElement.attributes[d].value,10):g=="height"&&(h=parseInt(l.documentElement.attributes[d].value,10))}e=new mxGeometry(r,a,o,h)}else console.log("mxCodec decode notreg:",i.nodeName);return e}encodeCell(i,t,e){if(t.appendChild(this.encode(i)),e==null||e)for(var s=i.getChildCount(),n=0;n<s;n++)this.encodeCell(i.getChildAt(n),t)}isCellCodec(i){return i!=null&&typeof i.isCellCodec=="function"?i.isCellCodec():!1}decodeCell(i,t){t=t??!0;var e=null;if(i!=null&&i.nodeType==mxConstants.NODETYPE_ELEMENT){var s=mxCodecRegistry.getCodec(i.nodeName);if(!this.isCellCodec(s))for(var n=i.firstChild;n!=null&&!this.isCellCodec(s);)s=mxCodecRegistry.getCodec(n.nodeName),n=n.nextSibling;this.isCellCodec(s)||(s=mxCodecRegistry.getCodec(mxCell)),e=s.decode(this,i),t&&this.insertIntoGraph(e)}return e}insertIntoGraph(i){var t=i.parent,e=i.getTerminal(!0),s=i.getTerminal(!1);if(i.setTerminal(null,!1),i.setTerminal(null,!0),i.parent=null,t!=null){if(t==i)throw new Error(t.id+": Self Reference");t.insert(i)}e!=null&&e.insertEdge(i,!0),s!=null&&s.insertEdge(i,!1)}setAttribute(i,t,e){t!=null&&e!=null&&i.setAttribute(t,e)}}class mxTemporaryCellStates{constructor(i,t,e,s,n){t=t??1,this.view=i,this.oldValidateCellState=i.validateCellState,this.oldBounds=i.getGraphBounds(),this.oldStates=i.getStates(),this.oldScale=i.getScale(),this.oldDoRedrawShape=i.graph.cellRenderer.doRedrawShape;var l=this;if(n!=null&&(i.graph.cellRenderer.doRedrawShape=function(h){var d=h.shape.paint;h.shape.paint=function(g){var m=n(h);m!=null&&g.setLink(m),d.apply(this,arguments),m!=null&&g.setLink(null)},l.oldDoRedrawShape.apply(i.graph.cellRenderer,arguments),h.shape.paint=d}),i.validateCellState=function(h,d){return h==null||s==null||s(h)?l.oldValidateCellState.apply(i,arguments):null},i.setStates(new mxDictionary),i.setScale(t),e!=null){i.resetValidationState();for(var r=null,a=0;a<e.length;a++){var o=i.getBoundingBox(i.validateCellState(i.validateCell(e[a])));r==null?r=o:r.add(o)}i.setGraphBounds(r||new mxRectangle)}}destroy(){this.view.setScale(this.oldScale),this.view.setStates(this.oldStates),this.view.setGraphBounds(this.oldBounds),this.view.validateCellState=this.oldValidateCellState,this.view.graph.cellRenderer.doRedrawShape=this.oldDoRedrawShape}}class mxStyleChange{constructor(i,t,e){this.model=i,this.cell=t,this.style=e,this.previous=e}execute(){this.cell!=null&&(this.style=this.previous,this.previous=this.model.styleForCellChanged(this.cell,this.previous))}}class mxChildChange{constructor(i,t,e,s){this.model=i,this.parent=t,this.previous=t,this.child=e,this.index=s,this.previousIndex=s}execute(){if(this.child!=null){var i=this.model.getParent(this.child),t=i!=null?i.getIndex(this.child):0;this.previous==null&&this.connect(this.child,!1),i=this.model.parentForCellChanged(this.child,this.previous,this.previousIndex),this.previous!=null&&this.connect(this.child,!0),this.parent=this.previous,this.previous=i,this.index=this.previousIndex,this.previousIndex=t}}connect(i,t){t=t??!0;var e=i.getTerminal(!0),s=i.getTerminal(!1);e!=null&&(t?this.model.terminalForCellChanged(i,e,!0):this.model.terminalForCellChanged(i,null,!0)),s!=null&&(t?this.model.terminalForCellChanged(i,s,!1):this.model.terminalForCellChanged(i,null,!1)),i.setTerminal(e,!0),i.setTerminal(s,!1);for(var n=this.model.getChildCount(i),l=0;l<n;l++)this.connect(this.model.getChildAt(i,l),t)}}class mxValueChange{constructor(i,t,e){this.model=i,this.cell=t,this.value=e,this.previous=e}execute(){this.cell!=null&&(this.value=this.previous,this.previous=this.model.valueForCellChanged(this.cell,this.previous))}}class mxTerminalChange{constructor(i,t,e,s){this.model=i,this.cell=t,this.terminal=e,this.previous=e,this.source=s}execute(){this.cell!=null&&(this.terminal=this.previous,this.previous=this.model.terminalForCellChanged(this.cell,this.previous,this.source))}}class mxGeometryChange{constructor(i,t,e){this.model=i,this.cell=t,this.geometry=e,this.previous=e}execute(){this.cell!=null&&(this.geometry=this.previous,this.previous=this.model.geometryForCellChanged(this.cell,this.previous))}}class mxEffects{static animateChanges(i,t,e){var s=10,n=0,l=function(){for(var a=!1,o=0;o<t.length;o++){var h=t[o];if(h instanceof mxGeometryChange||h instanceof mxTerminalChange||h instanceof mxValueChange||h instanceof mxChildChange||h instanceof mxStyleChange){var d=i.getView().getState(h.cell||h.child,!1);if(d!=null)if(a=!0,h.constructor!=mxGeometryChange||i.model.isEdge(h.cell))mxUtils.setOpacity(d.shape.node,100*n/s);else{var g=i.getView().scale,m=(h.geometry.x-h.previous.x)*g,f=(h.geometry.y-h.previous.y)*g,c=(h.geometry.width-h.previous.width)*g,x=(h.geometry.height-h.previous.height)*g;n==0?(d.x-=m,d.y-=f,d.width-=c,d.height-=x):(d.x+=m/s,d.y+=f/s,d.width+=c/s,d.height+=x/s),i.cellRenderer.redraw(d),mxEffects.cascadeOpacity(i,h.cell,100*n/s)}}}n<s&&a?(n++,window.setTimeout(l,r)):e!=null&&e()},r=30;l()}static cascadeOpacity(i,t,e){for(var s=i.model.getChildCount(t),n=0;n<s;n++){var l=i.model.getChildAt(t,n),r=i.getView().getState(l);r!=null&&(mxUtils.setOpacity(r.shape.node,e),mxEffects.cascadeOpacity(i,l,e))}var a=i.model.getEdges(t);if(a!=null)for(var n=0;n<a.length;n++){var o=i.getView().getState(a[n]);o!=null&&mxUtils.setOpacity(o.shape.node,e)}}static fadeOut(i,t,e,s,n,l){s=s||40,n=n||30;var r=t||100;if(mxUtils.setOpacity(i,r),l||l==null){var a=function(){r=Math.max(r-s,0),mxUtils.setOpacity(i,r),r>0?window.setTimeout(a,n):(i.style.visibility="hidden",e&&i.parentNode&&i.parentNode.removeChild(i))};window.setTimeout(a,n)}else i.style.visibility="hidden",e&&i.parentNode&&i.parentNode.removeChild(i)}}const _mxUtils=class _mxUtils{static removeCursors(v){v.style!=null&&(v.style.cursor="");var i=v.childNodes;if(i!=null)for(var t=i.length,e=0;e<t;e+=1)_mxUtils.removeCursors(i[e])}static getCurrentStyle(v){return v!=null?window.getComputedStyle(v,""):null}static parseCssNumber(v){return v=="thin"?v="2":v=="medium"?v="4":v=="thick"&&(v="6"),v=parseFloat(v),isNaN(v)&&(v=0),v}static hasScrollbars(v){var i=_mxUtils.getCurrentStyle(v);return i!=null&&(i.overflow=="scroll"||i.overflow=="auto")}static bind(v,i){return function(){return i.apply(v,arguments)}}static eval(expr){var result=null;let _mxJavaScriptExpression=null;if(expr.indexOf("function")>=0)try{eval(" _mxJavaScriptExpression= function() { return ("+expr+")}();"),result=_mxJavaScriptExpression,_mxJavaScriptExpression=null}catch(v){mxLog.warn(v.message+" while evaluating "+expr)}else try{result=eval(expr)}catch(v){mxLog.warn(v.message+" while evaluating "+expr)}return result}static findNode(v,i,t){if(v.nodeType==mxConstants.NODETYPE_ELEMENT){var e=v.getAttribute(i);if(e!=null&&e==t)return v}for(v=v.firstChild;v!=null;){var s=_mxUtils.findNode(v,i,t);if(s!=null)return s;v=v.nextSibling}return null}static getFunctionName(v){var i=null;if(v!=null){if(v.name!=null)i=v.name;else if(i=_mxUtils.trim(v.toString()),/^function\s/.test(i)){i=_mxUtils.ltrim(i.substring(9));var t=i.indexOf("(");t>0&&(i=i.substring(0,t))}}return i}static indexOf(v,i){if(v!=null&&i!=null){for(var t=0;t<v.length;t++)if(v[t]==i)return t}return-1}static forEach(v,i){if(v!=null&&i!=null)for(var t=0;t<v.length;t++)i(v[t]);return v}static remove(v,i){var t=null;if(typeof i=="object")for(var e=_mxUtils.indexOf(i,v);e>=0;)i.splice(e,1),t=v,e=_mxUtils.indexOf(i,v);for(var s in i)i[s]==v&&(delete i[s],t=v);return t}static isNode(v,i,t,e){return v!=null&&!isNaN(v.nodeType)&&(i==null||v.nodeName.toLowerCase()==i.toLowerCase())?t==null||v.getAttribute(t)==e:!1}static isAncestorNode(v,i){for(var t=i;t!=null;){if(t==v)return!0;t=t.parentNode}return!1}static getChildNodes(v,i){i=i||mxConstants.NODETYPE_ELEMENT;for(var t=[],e=v.firstChild;e!=null;)e.nodeType==i&&t.push(e),e=e.nextSibling;return t}static importNode(v,i,t){return v.importNode(i,t)}static importNodeImplementation(v,i,t){switch(i.nodeType){case 1:{var e=v.createElement(i.nodeName);if(i.attributes&&i.attributes.length>0)for(var s=0;s<i.attributes.length;s++)e.setAttribute(i.attributes[s].nodeName,i.getAttribute(i.attributes[s].nodeName));if(t&&i.childNodes&&i.childNodes.length>0)for(var s=0;s<i.childNodes.length;s++)e.appendChild(_mxUtils.importNodeImplementation(v,i.childNodes[s],t));return e}case 3:case 4:case 8:return v.createTextNode(i.nodeValue!=null?i.nodeValue:i.value)}}static createXmlDocument(){var v=null;return document.implementation&&document.implementation.createDocument?v=document.implementation.createDocument("","",null):"ActiveXObject"in window&&(v=_mxUtils.createMsXmlDocument()),v}static createMsXmlDocument(){var v=new ActiveXObject("Microsoft.XMLDOM");return v.async=!1,v.validateOnParse=!1,v.resolveExternals=!1,v}static parseXml(v){var i=new DOMParser;return i.parseFromString(v,"text/xml")}static removeWhitespace(v,i){for(var t=i?v.previousSibling:v.nextSibling;t!=null&&t.nodeType==mxConstants.NODETYPE_TEXT;){var e=i?t.previousSibling:t.nextSibling,s=_mxUtils.getTextContent(t);_mxUtils.trim(s).length==0&&t.parentNode.removeChild(t),t=e}}static htmlEntities(v,i){return v=String(v||""),v=v.replace(/&/g,"&amp;"),v=v.replace(/"/g,"&quot;"),v=v.replace(/\'/g,"&#39;"),v=v.replace(/</g,"&lt;"),v=v.replace(/>/g,"&gt;"),(i==null||i)&&(v=v.replace(/\n/g,"&#xa;")),v}static isVml(v){return v!=null&&v.tagUrn=="urn:schemas-microsoft-com:vml"}static getXml(v,i){var t="";if(mxClient.IS_IE11)t=_mxUtils.getPrettyXml(v,"","","");else if(window.XMLSerializer!=null){var e=new XMLSerializer;t=e.serializeToString(v)}else v.xml!=null&&(t=v.xml.replace(/\r\n\t[\t]*/g,"").replace(/>\r\n/g,">").replace(/\r\n/g,`
`));return i=i||"&#xa;",t=t.replace(/\n/g,i),t}static getPrettyXml(v,i,t,e,s){var n=[];if(v!=null)if(i=i??"  ",t=t??"",e=e??`
`,v.namespaceURI!=null&&v.namespaceURI!=s&&(s=v.namespaceURI,v.getAttribute("xmlns")==null&&v.setAttribute("xmlns",v.namespaceURI)),v.nodeType==mxConstants.NODETYPE_DOCUMENT)n.push(_mxUtils.getPrettyXml(v.documentElement,i,t,e,s));else if(v.nodeType==mxConstants.NODETYPE_DOCUMENT_FRAGMENT){var l=v.firstChild;if(l!=null)for(;l!=null;)n.push(_mxUtils.getPrettyXml(l,i,t,e,s)),l=l.nextSibling}else if(v.nodeType==mxConstants.NODETYPE_COMMENT){var r=_mxUtils.getTextContent(v);r.length>0&&n.push(t+"<!--"+r+"-->"+e)}else if(v.nodeType==mxConstants.NODETYPE_TEXT){var r=_mxUtils.getTextContent(v);r.length>0&&n.push(t+_mxUtils.htmlEntities(_mxUtils.trim(r),!1)+e)}else if(v.nodeType==mxConstants.NODETYPE_CDATA){var r=_mxUtils.getTextContent(v);r.length>0&&n.push(t+"<![CDATA["+r+"]]"+e)}else{n.push(t+"<"+v.nodeName);var a=v.attributes;if(a!=null)for(var o=0;o<a.length;o++){var h=_mxUtils.htmlEntities(a[o].value);n.push(" "+a[o].nodeName+'="'+h+'"')}var l=v.firstChild;if(l!=null){for(n.push(">"+e);l!=null;)n.push(_mxUtils.getPrettyXml(l,i,t+i,e,s)),l=l.nextSibling;n.push(t+"</"+v.nodeName+">"+e)}else n.push(" />"+e)}return n.join("")}static extractTextWithWhitespace(v){var i=["BLOCKQUOTE","DIV","H1","H2","H3","H4","H5","H6","OL","P","PRE","TABLE","UL"],t=[];function e(s){if(!(s.length==1&&(s[0].nodeName=="BR"||s[0].innerHTML==`
`)))for(var n=0;n<s.length;n++){var l=s[n];l.nodeName=="BR"||l.innerHTML==`
`||(s.length==1||n==0)&&l.nodeName=="DIV"&&l.innerHTML.toLowerCase()=="<br>"?t.push(`
`):(l.nodeType===3||l.nodeType===4?l.nodeValue.length>0&&t.push(l.nodeValue):l.nodeType!==8&&l.childNodes.length>0&&e(l.childNodes),n<s.length-1&&_mxUtils.indexOf(i,s[n+1].nodeName)>=0&&t.push(`
`))}}return e(v),t.join("")}static replaceTrailingNewlines(v,i){for(var t="";v.length>0&&v.charAt(v.length-1)==`
`;)v=v.substring(0,v.length-1),t+=i;return v+t}static getTextContent(v){return v!=null?v[v.textContent===void 0?"text":"textContent"]:""}static setTextContent(v,i){v.innerText!==void 0?v.innerText=i:v[v.textContent===void 0?"text":"textContent"]=i}static getInnerHtml(v){if(v!=null){var i=new XMLSerializer;return i.serializeToString(v)}return""}static getOuterHtml(v){if(v!=null){var i=new XMLSerializer;return i.serializeToString(v)}return""}static write(v,i){var t=v.ownerDocument,e=t.createTextNode(i);return v!=null&&v.appendChild(e),e}static writeln(v,i){var t=v.ownerDocument,e=t.createTextNode(i);return v!=null&&(v.appendChild(e),v.appendChild(document.createElement("br"))),e}static br(v,i){i=i||1;for(var t=null,e=0;e<i;e++)v!=null&&(t=v.ownerDocument.createElement("br"),v.appendChild(t));return t}static button(v,i,t){t=t??document;var e=t.createElement("button");return _mxUtils.write(e,v),mxEvent.addListener(e,"click",function(s){i(s)}),e}static para(v,i){var t=document.createElement("p");return _mxUtils.write(t,i),v!=null&&v.appendChild(t),t}static addTransparentBackgroundFilter(v){v.style.filter+="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+mxClient.imageBasePath+"/transparent.gif', sizingMethod='scale')"}static linkAction(v,i,t,e,s){return _mxUtils.link(v,i,function(){t.execute(e)},s)}static linkInvoke(v,i,t,e,s,n){return _mxUtils.link(v,i,function(){t[e](s)},n)}static link(v,i,t,e){var s=document.createElement("span");return s.style.color="blue",s.style.textDecoration="underline",s.style.cursor="pointer",e!=null&&(s.style.paddingLeft=e+"px"),mxEvent.addListener(s,"click",t),_mxUtils.write(s,i),v!=null&&v.appendChild(s),s}static getDocumentSize(){var v=document.body,i=document.documentElement;try{return new mxRectangle(0,0,v.clientWidth||i.clientWidth,Math.max(v.clientHeight||0,i.clientHeight))}catch{return new mxRectangle}}static fit(v){var i=_mxUtils.getDocumentSize(),t=parseInt(v.offsetLeft),e=parseInt(v.offsetWidth),s=_mxUtils.getDocumentScrollOrigin(v.ownerDocument),n=s.x,l=s.y,r=n+i.width;t+e>r&&(v.style.left=Math.max(n,r-e)+"px");var a=parseInt(v.offsetTop),o=parseInt(v.offsetHeight),h=l+i.height;a+o>h&&(v.style.top=Math.max(l,h-o)+"px")}static load(v){var i=new mxXmlRequest(v,null,"GET",!1);return i.send(),i}static get(v,i,t,e,s,n,l){var r=new mxXmlRequest(v,null,"GET"),a=r.setRequestHeaders;return l&&(r.setRequestHeaders=function(o,h){a.apply(this,arguments);for(var d in l)o.setRequestHeader(d,l[d])}),e!=null&&r.setBinary(e),r.send(i,t,s,n),r}static getAll(v,i,t){for(var e=v.length,s=[],n=0,l=function(){n==0&&t!=null&&t(),n++},r=0;r<v.length;r++)(function(a,o){_mxUtils.get(a,function(h){var d=h.getStatus();d<200||d>299?l():(s[o]=h,e--,e==0&&i(s))},l)})(v[r],r);e==0&&i(s)}static post(v,i,t,e){return new mxXmlRequest(v,i).send(t,e)}static submit(v,i,t,e){return new mxXmlRequest(v,i).simulate(t,e)}static loadInto(v,i,t){i.addEventListener("load",t,!1),i.load(v)}static getValue(v,i,t){var e=v!=null?v[i]:null;return e==null&&(e=t),e}static getNumber(v,i,t){var e=v!=null?v[i]:null;return e==null&&(e=t||0),Number(e)}static getColor(v,i,t){var e=v!=null?v[i]:null;return e==null?e=t:e==mxConstants.NONE&&(e=null),e}static clone(v,i,t){t=t??!1;var e=null;if(v!=null&&typeof v.constructor=="function"){e=new v.constructor;for(var s in v)s!=mxObjectIdentity.FIELD_NAME&&(i==null||_mxUtils.indexOf(i,s)<0)&&(!t&&typeof v[s]=="object"?e[s]=_mxUtils.clone(v[s]):e[s]=v[s])}return e}static equalPoints(v,i){if(v==null&&i!=null||v!=null&&i==null||v!=null&&i!=null&&v.length!=i.length)return!1;if(v!=null&&i!=null){for(var t=0;t<v.length;t++)if(v[t]!=null&&i[t]==null||v[t]==null&&i[t]!=null||v[t]!=null&&i[t]!=null&&(v[t].x!=i[t].x||v[t].y!=i[t].y))return!1}return!0}static equalEntries(v,i){var t=0;if(v==null&&i!=null||v!=null&&i==null||v!=null&&i!=null&&v.length!=i.length)return!1;if(v!=null&&i!=null){for(var e in i)t++;for(var e in v)if(t--,(!_mxUtils.isNaN(v[e])||!_mxUtils.isNaN(i[e]))&&v[e]!=i[e])return!1}return t==0}static removeDuplicates(v){for(var i=new mxDictionary,t=[],e=0;e<v.length;e++)i.get(v[e])||(t.push(v[e]),i.put(v[e],!0));return t}static isNaN(v){return typeof v=="number"&&isNaN(v)}static extend(v,i){var t=function(){};t.prototype=i.prototype,v.prototype=new t,v.prototype.constructor=v}static toString(v){var i="";for(var t in v)try{if(v[t]==null)i+=t+` = [null]
`;else if(typeof v[t]=="function")i+=t+` => [Function]
`;else if(typeof v[t]=="object"){var e=_mxUtils.getFunctionName(v[t].constructor);i+=t+" => ["+e+`]
`}else i+=t+" = "+v[t]+`
`}catch(s){i+=t+"="+s.message}return i}static toRadians(v){return Math.PI*v/180}static toDegree(v){return v*180/Math.PI}static arcToCurves(v,i,t,e,s,n,l,r,a){if(r-=v,a-=i,t===0||e===0)return Q;var o=l,h=s;t=Math.abs(t),e=Math.abs(e);var d=-r/2,g=-a/2,m=Math.cos(h*Math.PI/180),f=Math.sin(h*Math.PI/180),c=m*d+f*g,x=-1*f*d+m*g,p=c*c,C=x*x,E=t*t,T=e*e,S=p/E+C/T,y;if(S>1)t=Math.sqrt(S)*t,e=Math.sqrt(S)*e,y=0;else{var b=1;n===o&&(b=-1),y=b*Math.sqrt((E*T-E*C-T*p)/(E*C+T*p))}var w=y*t*x/e,I=-1*y*e*c/t,O=m*w-f*I+r/2,P=f*w+m*I+a/2,M=Math.atan2((x-I)/e,(c-w)/t)-Math.atan2(0,1),H=M>=0?M:2*Math.PI+M;M=Math.atan2((-x-I)/e,(-c-w)/t)-Math.atan2((x-I)/e,(c-w)/t);var R=M>=0?M:2*Math.PI+M;o==0&&R>0?R-=2*Math.PI:o!=0&&R<0&&(R+=2*Math.PI);for(var D=R*2/Math.PI,A=Math.ceil(D<0?-1*D:D),G=R/A,B=8/3*Math.sin(G/4)*Math.sin(G/4)/Math.sin(G/2),tt=m*t,q=m*e,j=f*t,V=f*e,X=Math.cos(H),Z=Math.sin(H),et=-B*(tt*Z+V*X),nt=-B*(j*Z-q*X),lt=0,it=0,Q=[],Y=0;Y<A;++Y){H+=G,X=Math.cos(H),Z=Math.sin(H),lt=tt*X-V*Z+O,it=j*X+q*Z+P;var z=-B*(tt*Z+V*X),W=-B*(j*Z-q*X),rt=Y*6;Q[rt]=Number(et+v),Q[rt+1]=Number(nt+i),Q[rt+2]=Number(lt-z+v),Q[rt+3]=Number(it-W+i),Q[rt+4]=Number(lt+v),Q[rt+5]=Number(it+i),et=lt+z,nt=it+W}return Q}static getBoundingBox(v,i,t){var e=null;if(v!=null&&i!=null&&i!=0){var s=_mxUtils.toRadians(i),n=Math.cos(s),l=Math.sin(s);t=t??new mxPoint(v.x+v.width/2,v.y+v.height/2);var r=new mxPoint(v.x,v.y),a=new mxPoint(v.x+v.width,v.y),o=new mxPoint(a.x,v.y+v.height),h=new mxPoint(v.x,o.y);r=_mxUtils.getRotatedPoint(r,n,l,t),a=_mxUtils.getRotatedPoint(a,n,l,t),o=_mxUtils.getRotatedPoint(o,n,l,t),h=_mxUtils.getRotatedPoint(h,n,l,t),e=new mxRectangle(r.x,r.y,0,0),e.add(new mxRectangle(a.x,a.y,0,0)),e.add(new mxRectangle(o.x,o.y,0,0)),e.add(new mxRectangle(h.x,h.y,0,0))}return e}static getRotatedPoint(v,i,t,e){e=e??new mxPoint;var s=v.x-e.x,n=v.y-e.y,l=s*i-n*t,r=n*i+s*t;return new mxPoint(l+e.x,r+e.y)}static getPortConstraints(v,i,t,e){var s=_mxUtils.getValue(v.style,mxConstants.STYLE_PORT_CONSTRAINT,_mxUtils.getValue(i.style,t?mxConstants.STYLE_SOURCE_PORT_CONSTRAINT:mxConstants.STYLE_TARGET_PORT_CONSTRAINT,null));if(s==null)return e;var n=s.toString(),l=mxConstants.DIRECTION_MASK_NONE,r=_mxUtils.getValue(v.style,mxConstants.STYLE_PORT_CONSTRAINT_ROTATION,0),a=0;r==1&&(a=_mxUtils.getValue(v.style,mxConstants.STYLE_ROTATION,0));var o=0;if(a>45?(o=1,a>=135&&(o=2)):a<-45&&(o=3,a<=-135&&(o=2)),n.indexOf(mxConstants.DIRECTION_NORTH)>=0)switch(o){case 0:l|=mxConstants.DIRECTION_MASK_NORTH;break;case 1:l|=mxConstants.DIRECTION_MASK_EAST;break;case 2:l|=mxConstants.DIRECTION_MASK_SOUTH;break;case 3:l|=mxConstants.DIRECTION_MASK_WEST;break}if(n.indexOf(mxConstants.DIRECTION_WEST)>=0)switch(o){case 0:l|=mxConstants.DIRECTION_MASK_WEST;break;case 1:l|=mxConstants.DIRECTION_MASK_NORTH;break;case 2:l|=mxConstants.DIRECTION_MASK_EAST;break;case 3:l|=mxConstants.DIRECTION_MASK_SOUTH;break}if(n.indexOf(mxConstants.DIRECTION_SOUTH)>=0)switch(o){case 0:l|=mxConstants.DIRECTION_MASK_SOUTH;break;case 1:l|=mxConstants.DIRECTION_MASK_WEST;break;case 2:l|=mxConstants.DIRECTION_MASK_NORTH;break;case 3:l|=mxConstants.DIRECTION_MASK_EAST;break}if(n.indexOf(mxConstants.DIRECTION_EAST)>=0)switch(o){case 0:l|=mxConstants.DIRECTION_MASK_EAST;break;case 1:l|=mxConstants.DIRECTION_MASK_SOUTH;break;case 2:l|=mxConstants.DIRECTION_MASK_WEST;break;case 3:l|=mxConstants.DIRECTION_MASK_NORTH;break}return l}static reversePortConstraints(v){var i=0;return i=(v&mxConstants.DIRECTION_MASK_WEST)<<3,i|=(v&mxConstants.DIRECTION_MASK_NORTH)<<1,i|=(v&mxConstants.DIRECTION_MASK_SOUTH)>>1,i|=(v&mxConstants.DIRECTION_MASK_EAST)>>3,i}static findNearestSegment(v,i,t){var e=-1;if(v.absolutePoints.length>0)for(var s=v.absolutePoints[0],n=null,l=1;l<v.absolutePoints.length;l++){var r=v.absolutePoints[l],a=_mxUtils.ptSegDistSq(s.x,s.y,r.x,r.y,i,t);(n==null||a<n)&&(n=a,e=l-1),s=r}return e}static getDirectedBounds(v,i,t,e,s){var n=_mxUtils.getValue(t,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_EAST);if(e=e??_mxUtils.getValue(t,mxConstants.STYLE_FLIPH,!1),s=s??_mxUtils.getValue(t,mxConstants.STYLE_FLIPV,!1),i.x=Math.round(Math.max(0,Math.min(v.width,i.x))),i.y=Math.round(Math.max(0,Math.min(v.height,i.y))),i.width=Math.round(Math.max(0,Math.min(v.width,i.width))),i.height=Math.round(Math.max(0,Math.min(v.height,i.height))),s&&(n==mxConstants.DIRECTION_SOUTH||n==mxConstants.DIRECTION_NORTH)||e&&(n==mxConstants.DIRECTION_EAST||n==mxConstants.DIRECTION_WEST)){var l=i.x;i.x=i.width,i.width=l}if(e&&(n==mxConstants.DIRECTION_SOUTH||n==mxConstants.DIRECTION_NORTH)||s&&(n==mxConstants.DIRECTION_EAST||n==mxConstants.DIRECTION_WEST)){var l=i.y;i.y=i.height,i.height=l}var r=mxRectangle.fromRectangle(i);return n==mxConstants.DIRECTION_SOUTH?(r.y=i.x,r.x=i.height,r.width=i.y,r.height=i.width):n==mxConstants.DIRECTION_WEST?(r.y=i.height,r.x=i.width,r.width=i.x,r.height=i.y):n==mxConstants.DIRECTION_NORTH&&(r.y=i.width,r.x=i.y,r.width=i.height,r.height=i.x),new mxRectangle(v.x+r.x,v.y+r.y,v.width-r.width-r.x,v.height-r.height-r.y)}static getPerimeterPoint(v,i,t){for(var e=null,s=0;s<v.length-1;s++){var n=_mxUtils.intersection(v[s].x,v[s].y,v[s+1].x,v[s+1].y,i.x,i.y,t.x,t.y);if(n!=null){var l=t.x-n.x,r=t.y-n.y,a={p:n,distSq:r*r+l*l};a!=null&&(e==null||e.distSq>a.distSq)&&(e=a)}}return e!=null?e.p:null}static rectangleIntersectsSegment(v,i,t){var e=v.y,s=v.x,n=e+v.height,l=s+v.width,r=i.x,a=t.x;if(i.x>t.x&&(r=t.x,a=i.x),a>l&&(a=l),r<s&&(r=s),r>a)return!1;var o=i.y,h=t.y,d=t.x-i.x;if(Math.abs(d)>1e-7){var g=(t.y-i.y)/d,m=i.y-g*i.x;o=g*r+m,h=g*a+m}if(o>h){var f=h;h=o,o=f}return h>n&&(h=n),o<e&&(o=e),!(o>h)}static contains(v,i,t){return v.x<=i&&v.x+v.width>=i&&v.y<=t&&v.y+v.height>=t}static intersects(v,i){var t=v.width,e=v.height,s=i.width,n=i.height;if(s<=0||n<=0||t<=0||e<=0)return!1;var l=v.x,r=v.y,a=i.x,o=i.y;return s+=a,n+=o,t+=l,e+=r,(s<a||s>l)&&(n<o||n>r)&&(t<l||t>a)&&(e<r||e>o)}static intersectsHotspot(v,i,t,e,s,n){if(e=e??1,s=s??0,n=n??0,e>0){var l=v.getCenterX(),r=v.getCenterY(),a=v.width,o=v.height,h=_mxUtils.getValue(v.style,mxConstants.STYLE_STARTSIZE)*v.view.scale;h>0&&(_mxUtils.getValue(v.style,mxConstants.STYLE_HORIZONTAL,!0)?(r=v.y+h/2,o=h):(l=v.x+h/2,a=h)),a=Math.max(s,a*e),o=Math.max(s,o*e),n>0&&(a=Math.min(a,n),o=Math.min(o,n));var d=new mxRectangle(l-a/2,r-o/2,a,o),g=_mxUtils.toRadians(_mxUtils.getValue(v.style,mxConstants.STYLE_ROTATION)||0);if(g!=0){var m=Math.cos(-g),f=Math.sin(-g),l=new mxPoint(v.getCenterX(),v.getCenterY()),c=_mxUtils.getRotatedPoint(new mxPoint(i,t),m,f,l);i=c.x,t=c.y}return _mxUtils.contains(d,i,t)}return!0}static getOffset(v,i){for(var t=0,e=0,s=!1,n=v,l=document.body,r=document.documentElement;n!=null&&n!=l&&n!=r&&!s;){var a=_mxUtils.getCurrentStyle(n);a!=null&&(s=s||a.position=="fixed"),n=n.parentNode}if(!i&&!s){var o=_mxUtils.getDocumentScrollOrigin(v.ownerDocument);t+=o.x,e+=o.y}var h=v.getBoundingClientRect();return h!=null&&(t+=h.left,e+=h.top),new mxPoint(t,e)}static getDocumentScrollOrigin(v){if(mxClient.IS_QUIRKS)return new mxPoint(v.body.scrollLeft,v.body.scrollTop);var i=v.defaultView||v.parentWindow,t=i!=null&&window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,e=i!=null&&window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return new mxPoint(t,e)}static getScrollOrigin(v,i,t){i=i??!1,t=t??!0;for(var e=v!=null?v.ownerDocument:document,s=e.body,n=e.documentElement,l=new mxPoint,r=!1;v!=null&&v!=s&&v!=n;){!isNaN(v.scrollLeft)&&!isNaN(v.scrollTop)&&(l.x+=v.scrollLeft,l.y+=v.scrollTop);var a=_mxUtils.getCurrentStyle(v);a!=null&&(r=r||a.position=="fixed"),v=i?v.parentNode:null}if(!r&&t){var o=_mxUtils.getDocumentScrollOrigin(e);l.x+=o.x,l.y+=o.y}return l}static convertPoint(v,i,t){var e=_mxUtils.getScrollOrigin(v,!1),s=_mxUtils.getOffset(v);return s.x-=e.x,s.y-=e.y,new mxPoint(i-s.x,t-s.y)}static ltrim(v,i){return i=i||"\\s",v!=null?v.replace(new RegExp("^["+i+"]+","g"),""):null}static rtrim(v,i){return i=i||"\\s",v!=null?v.replace(new RegExp("["+i+"]+$","g"),""):null}static trim(v,i){return _mxUtils.ltrim(_mxUtils.rtrim(v,i),i)}static isNumeric(v){return!isNaN(parseFloat(v))&&isFinite(v)&&(typeof v!="string"||v.toLowerCase().indexOf("0x")<0)}static isInteger(v){return String(parseInt(v))===String(v)}static mod(v,i){return(v%i+i)%i}static intersection(v,i,t,e,s,n,l,r){var a=(r-n)*(t-v)-(l-s)*(e-i),o=(l-s)*(i-n)-(r-n)*(v-s),h=(t-v)*(i-n)-(e-i)*(v-s),d=o/a,g=h/a;if(d>=0&&d<=1&&g>=0&&g<=1){var m=v+d*(t-v),f=i+d*(e-i);return new mxPoint(m,f)}return null}static ptSegDistSq(v,i,t,e,s,n){t-=v,e-=i,s-=v,n-=i;var l=s*t+n*e,r;l<=0?r=0:(s=t-s,n=e-n,l=s*t+n*e,l<=0?r=0:r=l*l/(t*t+e*e));var a=s*s+n*n-r;return a<0&&(a=0),a}static ptLineDist(v,i,t,e,s,n){return Math.abs((e-i)*s-(t-v)*n+t*i-e*v)/Math.sqrt((e-i)*(e-i)+(t-v)*(t-v))}static relativeCcw(v,i,t,e,s,n){t-=v,e-=i,s-=v,n-=i;var l=s*e-n*t;return l==0&&(l=s*t+n*e,l>0&&(s-=t,n-=e,l=s*t+n*e,l<0&&(l=0))),l<0?-1:l>0?1:0}static animateChanges(v,i){mxEffects.animateChanges.apply(this,arguments)}static cascadeOpacity(v,i,t){mxEffects.cascadeOpacity.apply(this,arguments)}static fadeOut(v,i,t,e,s,n){mxEffects.fadeOut.apply(this,arguments)}static setOpacity(v,i){_mxUtils.isVml(v)?i>=100?v.style.filter="":v.style.filter="alpha(opacity="+i/5+")":v.style.opacity=i/100}static createImage(v){var i=null;return i=document.createElement("img"),i.setAttribute("src",v),i.setAttribute("border","0"),i}static sortCells(v,i){i=i??!0;var t=new mxDictionary;return v.sort(function(e,s){var n=t.get(e);n==null&&(n=mxCellPath.create(e).split(mxCellPath.PATH_SEPARATOR),t.put(e,n));var l=t.get(s);l==null&&(l=mxCellPath.create(s).split(mxCellPath.PATH_SEPARATOR),t.put(s,l));var r=mxCellPath.compare(n,l);return r==0?0:r>0==i?1:-1}),v}static getStylename(v){if(v!=null){var i=v.split(";"),t=i[0];if(t.indexOf("=")<0)return t}return""}static getStylenames(v){var i=[];if(v!=null)for(var t=v.split(";"),e=0;e<t.length;e++)t[e].indexOf("=")<0&&i.push(t[e]);return i}static indexOfStylename(v,i){if(v!=null&&i!=null)for(var t=v.split(";"),e=0,s=0;s<t.length;s++){if(t[s]==i)return e;e+=t[s].length+1}return-1}static addStylename(v,i){return _mxUtils.indexOfStylename(v,i)<0&&(v==null?v="":v.length>0&&v.charAt(v.length-1)!=";"&&(v+=";"),v+=i),v}static removeStylename(v,i){var t=[];if(v!=null)for(var e=v.split(";"),s=0;s<e.length;s++)e[s]!=i&&t.push(e[s]);return t.join(";")}static removeAllStylenames(v){var i=[];if(v!=null)for(var t=v.split(";"),e=0;e<t.length;e++)t[e].indexOf("=")>=0&&i.push(t[e]);return i.join(";")}static setCellStyles(v,i,t,e){if(i!=null&&i.length>0){v.beginUpdate();try{for(var s=0;s<i.length;s++)if(i[s]!=null){var n=_mxUtils.setStyle(v.getStyle(i[s]),t,e);v.setStyle(i[s],n)}}finally{v.endUpdate()}}}static setStyle(v,i,t){var e=t!=null&&(typeof t.length>"u"||t.length>0);if(v==null||v.length==0)e&&(v=i+"="+t+";");else if(v.substring(0,i.length+1)==i+"="){var s=v.indexOf(";");e?v=i+"="+t+(s<0?";":v.substring(s)):v=s<0||s==v.length-1?"":v.substring(s+1)}else{var n=v.indexOf(";"+i+"=");if(n<0){if(e){var l=v.charAt(v.length-1)==";"?"":";";v=v+l+i+"="+t+";"}}else{var s=v.indexOf(";",n+1);e?v=v.substring(0,n+1)+i+"="+t+(s<0?";":v.substring(s)):v=v.substring(0,n)+(s<0?";":v.substring(s))}}return v}static setCellStyleFlags(v,i,t,e,s){if(i!=null&&i.length>0){v.beginUpdate();try{for(var n=0;n<i.length;n++)if(i[n]!=null){var l=_mxUtils.setStyleFlag(v.getStyle(i[n]),t,e,s);v.setStyle(i[n],l)}}finally{v.endUpdate()}}}static setStyleFlag(v,i,t,e){if(v==null||v.length==0)e||e==null?v=i+"="+t:v=i+"=0";else{var s=v.indexOf(i+"=");if(s<0){var n=v.charAt(v.length-1)==";"?"":";";e||e==null?v=v+n+i+"="+t:v=v+n+i+"=0"}else{var l=v.indexOf(";",s),r="";l<0?r=v.substring(s+i.length+1):r=v.substring(s+i.length+1,l),e==null?r=parseInt(r)^t:e?r=parseInt(r)|t:r=parseInt(r)&~t,v=v.substring(0,s)+i+"="+r+(l>=0?v.substring(l):"")}}return v}static getAlignmentAsPoint(v,i){var t=-.5,e=-.5;return v==mxConstants.ALIGN_LEFT?t=0:v==mxConstants.ALIGN_RIGHT&&(t=-1),i==mxConstants.ALIGN_TOP?e=0:i==mxConstants.ALIGN_BOTTOM&&(e=-1),new mxPoint(t,e)}static getSizeForString(v,i,t,e,s){i=i??mxConstants.DEFAULT_FONTSIZE,t=t??mxConstants.DEFAULT_FONTFAMILY;var n=document.createElement("div");if(n.style.fontFamily=t,n.style.fontSize=Math.round(i)+"px",n.style.lineHeight=Math.round(i*mxConstants.LINE_HEIGHT)+"px",s!=null){(s&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(n.style.fontWeight="bold"),(s&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(n.style.fontStyle="italic");var l=[];(s&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&l.push("underline"),(s&mxConstants.FONT_STRIKETHROUGH)==mxConstants.FONT_STRIKETHROUGH&&l.push("line-through"),l.length>0&&(n.style.textDecoration=l.join(" "))}n.style.position="absolute",n.style.visibility="hidden",n.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",n.style.zoom="1",e!=null?(n.style.width=e+"px",n.style.whiteSpace="normal"):n.style.whiteSpace="nowrap",n.innerHTML=v,document.body.appendChild(n);var r=new mxRectangle(0,0,n.offsetWidth,n.offsetHeight);return document.body.removeChild(n),r}static getViewXml(v,i,t,e,s){if(e=e??0,s=s??0,i=i??1,t==null){var n=v.getModel();t=[n.getRoot()]}var l=v.getView(),r=null,a=l.isEventsEnabled();l.setEventsEnabled(!1);var o=l.drawPane,h=l.overlayPane;v.dialect==mxConstants.DIALECT_SVG?(l.drawPane=document.createElementNS(mxConstants.NS_SVG,"g"),l.canvas.appendChild(l.drawPane),l.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g"),l.canvas.appendChild(l.overlayPane)):(l.drawPane=l.drawPane.cloneNode(!1),l.canvas.appendChild(l.drawPane),l.overlayPane=l.overlayPane.cloneNode(!1),l.canvas.appendChild(l.overlayPane));var d=l.getTranslate();l.translate=new mxPoint(e,s);var g=new mxTemporaryCellStates(v.getView(),i,t);try{var m=new mxCodec;r=m.encode(v.getView())}finally{g.destroy(),l.translate=d,l.canvas.removeChild(l.drawPane),l.canvas.removeChild(l.overlayPane),l.drawPane=o,l.overlayPane=h,l.setEventsEnabled(a)}return r}static getScaleForPageCount(v,i,t,e){if(v<1)return 1;t=t??mxConstants.PAGE_FORMAT_A4_PORTRAIT,e=e??0;var s=t.width-e*2,n=t.height-e*2,l=i.getGraphBounds().clone(),r=i.getView().getScale();l.width/=r,l.height/=r;var a=l.width,o=l.height,h=1,d=s/n,g=a/o,m=g/d,f=Math.sqrt(v),c=Math.sqrt(m),x=f*c,p=f/c;if(x<1&&p>v){var C=p/v;p=v,x/=C}if(p<1&&x>v){var C=x/v;x=v,p/=C}for(var E=Math.ceil(x)*Math.ceil(p),T=0;E>v;){var S=Math.floor(x)/x,y=Math.floor(p)/p;S==1&&(S=Math.floor(x-1)/x),y==1&&(y=Math.floor(p-1)/p);var C=1;if(S>y?C=S:C=y,x=x*C,p=p*C,E=Math.ceil(x)*Math.ceil(p),T++,T>10)break}var b=s*x;return h=b/a,h*.99999}static show(v,i,t,e,s,n){if(t=t??0,e=e??0,i==null){var l=window.open();i=l.document}else i.open();document.documentMode==9&&i.writeln('<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=9"><![endif]-->');var r=v.getGraphBounds(),a=Math.ceil(t-r.x),o=Math.ceil(e-r.y);if(s==null&&(s=Math.ceil(r.width+t)+Math.ceil(Math.ceil(r.x)-r.x)),n==null&&(n=Math.ceil(r.height+e)+Math.ceil(Math.ceil(r.y)-r.y)),document.documentMode==11){for(var h="<html><head>",d=document.getElementsByTagName("base"),g=0;g<d.length;g++)h+=d[g].outerHTML;h+="<style>";for(var g=0;g<document.styleSheets.length;g++)try{h+=document.styleSheets[g].cssText}catch{}h+='</style></head><body style="margin:0px;">',h+='<div style="position:absolute;overflow:hidden;width:'+s+"px;height:"+n+'px;"><div style="position:relative;left:'+a+"px;top:"+o+'px;">',h+=v.container.innerHTML,h+="</div></div></body><html>",i.writeln(h),i.close()}else{i.writeln("<html><head>");for(var d=document.getElementsByTagName("base"),g=0;g<d.length;g++)i.writeln(_mxUtils.getOuterHtml(d[g]));for(var m=document.getElementsByTagName("link"),g=0;g<m.length;g++)i.writeln(_mxUtils.getOuterHtml(m[g]));for(var f=document.getElementsByTagName("style"),g=0;g<f.length;g++)i.writeln(_mxUtils.getOuterHtml(f[g]));i.writeln('</head><body style="margin:0px;"></body></html>'),i.close();var c=i.createElement("div");c.position="absolute",c.overflow="hidden",c.style.width=s+"px",c.style.height=n+"px";var x=i.createElement("div");x.style.position="absolute",x.style.left=a+"px",x.style.top=o+"px";for(var p=v.container.firstChild,C=null;p!=null;){var E=p.cloneNode(!0);p==v.view.drawPane.ownerSVGElement?(c.appendChild(E),C=E):x.appendChild(E),p=p.nextSibling}i.body.appendChild(c),x.firstChild!=null&&i.body.appendChild(x),C!=null&&(C.style.minWidth="",C.style.minHeight="",C.firstChild.setAttribute("transform","translate("+a+","+o+")"))}return _mxUtils.removeCursors(i.body),i}static printScreen(v){var i=window.open();v.getGraphBounds(),_mxUtils.show(v,i.document);var t=function(){i.focus(),i.print(),i.close()};mxClient.IS_GC?i.setTimeout(t,500):t()}static popup(v,i){if(i){var t=document.createElement("div");t.style.overflow="scroll",t.style.width="636px",t.style.height="460px";var e=document.createElement("pre");e.innerHTML=_mxUtils.htmlEntities(v,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),t.appendChild(e);var s=document.body.clientWidth,n=Math.max(document.body.clientHeight||0,document.documentElement.clientHeight),l=new mxWindow("Popup Window",t,s/2-320,n/2-240,640,480,!1,!0);l.setClosable(!0),l.setVisible(!0)}else if(mxClient.IS_NS){var l=window.open();l.document.writeln("<pre>"+_mxUtils.htmlEntities(v)+"</pre"),l.document.close()}else{var l=window.open(),e=l.document.createElement("pre");e.innerHTML=_mxUtils.htmlEntities(v,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),l.document.body.appendChild(e)}}static alert(v){alert(v)}static prompt(v,i){return prompt(v,i??"")}static confirm(v){return confirm(v)}static error(v,i,t,e){var s=document.createElement("div");s.style.padding="20px";var n=document.createElement("img");n.setAttribute("src",e||_mxUtils.errorImage),n.setAttribute("valign","bottom"),n.style.verticalAlign="middle",s.appendChild(n),s.appendChild(document.createTextNode(" ")),s.appendChild(document.createTextNode(" ")),s.appendChild(document.createTextNode(" ")),_mxUtils.write(s,v);var l=document.body.clientWidth,r=document.body.clientHeight||document.documentElement.clientHeight,a=new mxWindow(mxResources.get(_mxUtils.errorResource)||_mxUtils.errorResource,s,(l-i)/2,r/4,i,null,!1,!0);if(t){_mxUtils.br(s);var o=document.createElement("p"),h=document.createElement("button");h.setAttribute("style","float:right"),mxEvent.addListener(h,"click",function(d){a.destroy()}),_mxUtils.write(h,mxResources.get(_mxUtils.closeResource)||_mxUtils.closeResource),o.appendChild(h),s.appendChild(o),_mxUtils.br(s),a.setClosable(!0)}return a.setVisible(!0),a}static makeDraggable(v,i,t,e,s,n,l,r,a,o){var h=new mxDragSource(v,t);return h.dragOffset=new mxPoint(s??0,n??mxConstants.TOOLTIP_VERTICAL_OFFSET),h.autoscroll=l,h.setGuidesEnabled(!1),a!=null&&(h.highlightDropTargets=a),o!=null&&(h.getDropTarget=o),h.getGraphForEvent=function(d){return typeof i=="function"?i(d):i},e!=null&&(h.createDragElement=function(){return e.cloneNode(!0)},r&&(h.createPreviewElement=function(d){var g=e.cloneNode(!0),m=parseInt(g.style.width),f=parseInt(g.style.height);return g.style.width=Math.round(m*d.view.scale)+"px",g.style.height=Math.round(f*d.view.scale)+"px",g})),h}};u(_mxUtils,"errorResource",mxClient.language!="none"?"error":""),u(_mxUtils,"closeResource",mxClient.language!="none"?"close":""),u(_mxUtils,"errorImage",mxClient.imageBasePath+"/error.gif"),u(_mxUtils,"setPrefixedStyle",function(){var v=null;return mxClient.IS_OT?v="O":mxClient.IS_SF||mxClient.IS_GC?v="Webkit":mxClient.IS_MT&&(v="Moz"),function(i,t,e){i[t]=e,v!=null&&t.length>0&&(t=v+t.substring(0,1).toUpperCase()+t.substring(1),i[t]=e)}}()),u(_mxUtils,"clearSelection",function(){return document.selection?function(){document.selection.empty()}:window.getSelection?function(){window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges()}:function(){}}());let mxUtils=_mxUtils;class mxMouseEvent{constructor(i,t){u(this,"consumed",!1);u(this,"graphX",null);u(this,"graphY",null);this.evt=i,this.state=t,this.sourceState=t}getEvent(){return this.evt}getSource(){return mxEvent.getSource(this.evt)}isSource(i){return i!=null?mxUtils.isAncestorNode(i.node,this.getSource()):!1}getX(){return mxEvent.getClientX(this.getEvent())}getY(){return mxEvent.getClientY(this.getEvent())}getGraphX(){return this.graphX}getGraphY(){return this.graphY}getState(){return this.state}getCell(){var i=this.getState();return i!=null?i.cell:null}isPopupTrigger(){return mxEvent.isPopupTrigger(this.getEvent())}isConsumed(){return this.consumed}consume(i){i=i??(this.evt.touches!=null||mxEvent.isMouseEvent(this.evt)),i&&this.evt.preventDefault&&this.evt.preventDefault(),this.consumed=!0}}const Et=class Et{static addStencil(i,t){Et.stencils[i]=t}static getStencil(i){return Et.stencils[i]}};u(Et,"stencils",{});let mxStencilRegistry=Et;const at=class at extends mxShape{constructor(t,e,s,n,l,r,a,o,h,d,g,m,f,c,x,p,C,E,T,S,y){super();u(this,"replaceLinefeeds",!0);u(this,"verticalTextRotation",-90);u(this,"ignoreClippedStringSize",!0);u(this,"ignoreStringSize",!1);u(this,"textWidthPadding",document.documentMode==8&&!mxClient.IS_EM?4:3);u(this,"lastValue",null);u(this,"cacheEnabled",!0);this.value=t,this.bounds=e,this.color=l??"black",this.align=s??mxConstants.ALIGN_CENTER,this.valign=n??mxConstants.ALIGN_MIDDLE,this.family=r??mxConstants.DEFAULT_FONTFAMILY,this.size=a??mxConstants.DEFAULT_FONTSIZE,this.fontStyle=o??mxConstants.DEFAULT_FONTSTYLE,this.spacing=parseInt(h||2),this.spacingTop=this.spacing+parseInt(d||0),this.spacingRight=this.spacing+parseInt(g||0),this.spacingBottom=this.spacing+parseInt(m||0),this.spacingLeft=this.spacing+parseInt(f||0),this.horizontal=c??!0,this.background=x,this.border=p,this.wrap=C??!1,this.clipped=E??!1,this.overflow=T??"visible",this.labelPadding=S??0,this.textDirection=y,this.rotation=0,this.updateMargin()}isParseVml(){return!1}isHtmlAllowed(){return document.documentMode!=8||mxClient.IS_EM}getSvgScreenOffset(){return 0}checkBounds(){return!isNaN(this.scale)&&isFinite(this.scale)&&this.scale>0&&this.bounds!=null&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)}paint(t,e){var s=this.scale,n=this.bounds.x/s,l=this.bounds.y/s,r=this.bounds.width/s,a=this.bounds.height/s;if(this.updateTransform(t,n,l,r,a),this.configureCanvas(t,n,l,r,a),e)t.updateText(n,l,r,a,this.align,this.valign,this.wrap,this.overflow,this.clipped,this.getTextRotation(),this.node);else{var o=mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML,h=o||t instanceof mxVmlCanvas2D?"html":"";o=!0,h="html";var d=this.value;!o&&h=="html"&&(d=mxUtils.htmlEntities(d,!1)),h=="html"&&!mxUtils.isNode(this.value)&&(d=mxUtils.replaceTrailingNewlines(d,"<div><br></div>")),d=!mxUtils.isNode(this.value)&&this.replaceLinefeeds&&h=="html"?d.replace(/\n/g,"<br/>"):d;var g=this.textDirection;g==mxConstants.TEXT_DIRECTION_AUTO&&!o&&(g=this.getAutoDirection()),g!=mxConstants.TEXT_DIRECTION_LTR&&g!=mxConstants.TEXT_DIRECTION_RTL&&(g=null),t.text(n,l,r,a,d,this.align,this.valign,this.wrap,h,this.overflow,this.clipped,this.getTextRotation(),g)}}redraw(){if(this.visible&&this.checkBounds()&&this.cacheEnabled&&this.lastValue==this.value&&(mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML))if(this.node.nodeName=="DIV"&&this.isHtmlAllowed())mxClient.IS_SVG?this.redrawHtmlShapeWithCss3():(this.updateSize(this.node,this.state==null||this.state.view.textDiv==null),this.updateHtmlTransform()),this.updateBoundingBox();else{var t=this.createCanvas();t!=null&&t.updateText!=null?(t.pointerEvents=this.pointerEvents,this.paint(t,!0),this.destroyCanvas(t),this.updateBoundingBox()):super.redraw()}else super.redraw(),mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML?this.lastValue=this.value:this.lastValue=null}resetStyles(){super.resetStyles(),this.color="black",this.align=mxConstants.ALIGN_CENTER,this.valign=mxConstants.ALIGN_MIDDLE,this.family=mxConstants.DEFAULT_FONTFAMILY,this.size=mxConstants.DEFAULT_FONTSIZE,this.fontStyle=mxConstants.DEFAULT_FONTSTYLE,this.spacing=2,this.spacingTop=2,this.spacingRight=2,this.spacingBottom=2,this.spacingLeft=2,this.horizontal=!0,delete this.background,delete this.border,this.textDirection=mxConstants.DEFAULT_TEXT_DIRECTION,delete this.margin}apply(t){var e=this.spacing;super.apply(t),this.style!=null&&(this.fontStyle=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSTYLE,this.fontStyle),this.family=mxUtils.getValue(this.style,mxConstants.STYLE_FONTFAMILY,this.family),this.size=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSIZE,this.size),this.color=mxUtils.getValue(this.style,mxConstants.STYLE_FONTCOLOR,this.color),this.align=mxUtils.getValue(this.style,mxConstants.STYLE_ALIGN,this.align),this.valign=mxUtils.getValue(this.style,mxConstants.STYLE_VERTICAL_ALIGN,this.valign),this.spacing=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_SPACING,this.spacing)),this.spacingTop=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_TOP,this.spacingTop-e))+this.spacing,this.spacingRight=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_RIGHT,this.spacingRight-e))+this.spacing,this.spacingBottom=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_BOTTOM,this.spacingBottom-e))+this.spacing,this.spacingLeft=parseInt(mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_LEFT,this.spacingLeft-e))+this.spacing,this.horizontal=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,this.horizontal),this.background=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,this.background),this.border=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BORDERCOLOR,this.border),this.textDirection=mxUtils.getValue(this.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION),this.opacity=mxUtils.getValue(this.style,mxConstants.STYLE_TEXT_OPACITY,100),this.updateMargin()),this.flipV=null,this.flipH=null}getAutoDirection(){var t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(this.value);return t!=null&&t.length>0&&t[0]>"z"?mxConstants.TEXT_DIRECTION_RTL:mxConstants.TEXT_DIRECTION_LTR}getContentNode(){var t=this.node;return t!=null&&(t.ownerSVGElement==null?t=this.node.firstChild.firstChild:t=t.firstChild.firstChild.firstChild.firstChild.firstChild),t}updateBoundingBox(){var t=this.node;this.boundingBox=this.bounds.clone();var e=this.getTextRotation(),s=this.style!=null?mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER):null,n=this.style!=null?mxUtils.getValue(this.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE):null;if(!this.ignoreStringSize&&t!=null&&this.overflow!="fill"&&(!this.clipped||!this.ignoreClippedStringSize||s!=mxConstants.ALIGN_CENTER||n!=mxConstants.ALIGN_MIDDLE)){var l=null,r=null;if(t.ownerSVGElement!=null)if(t.firstChild!=null&&t.firstChild.firstChild!=null&&t.firstChild.firstChild.nodeName=="foreignObject")t=t.firstChild.firstChild.firstChild.firstChild,r=t.offsetHeight*this.scale,this.overflow=="width"?l=this.boundingBox.width:l=t.offsetWidth*this.scale;else try{var a=t.getBBox();typeof this.value=="string"&&mxUtils.trim(this.value)==0?this.boundingBox=null:a.width==0&&a.height==0?this.boundingBox=null:this.boundingBox=new mxRectangle(a.x,a.y,a.width,a.height);return}catch{}else{var o=this.state!=null?this.state.view.textDiv:null;if(this.offsetWidth!=null&&this.offsetHeight!=null)l=this.offsetWidth*this.scale,r=this.offsetHeight*this.scale;else{o!=null&&(this.updateFont(o),this.updateSize(o,!1),this.updateInnerHtml(o),t=o);var h=t;if(document.documentMode==8&&!mxClient.IS_EM){var d=Math.round(this.bounds.width/this.scale);if(this.wrap&&d>0){if(t.style.wordWrap=mxConstants.WORD_WRAP,t.style.whiteSpace="normal",t.style.wordWrap!="break-word"){var g=h.getElementsByTagName("div");g.length>0&&(h=g[g.length-1]),l=h.offsetWidth+2,g=this.node.getElementsByTagName("div"),this.clipped&&(l=Math.min(d,l)),g.length>1&&(g[g.length-2].style.width=l+"px")}}else t.style.whiteSpace="nowrap"}else h.firstChild!=null&&h.firstChild.nodeName=="DIV"&&(h=h.firstChild);this.offsetWidth=h.offsetWidth+this.textWidthPadding,this.offsetHeight=h.offsetHeight,l=this.offsetWidth*this.scale,r=this.offsetHeight*this.scale}}l!=null&&r!=null&&(this.boundingBox=new mxRectangle(this.bounds.x,this.bounds.y,l,r))}if(this.boundingBox!=null)if(e!=0){var m=mxUtils.getBoundingBox(new mxRectangle(this.margin.x*this.boundingBox.width,this.margin.y*this.boundingBox.height,this.boundingBox.width,this.boundingBox.height),e,new mxPoint(0,0));this.unrotatedBoundingBox=mxRectangle.fromRectangle(this.boundingBox),this.unrotatedBoundingBox.x+=this.margin.x*this.unrotatedBoundingBox.width,this.unrotatedBoundingBox.y+=this.margin.y*this.unrotatedBoundingBox.height,this.boundingBox.x+=m.x,this.boundingBox.y+=m.y,this.boundingBox.width=m.width,this.boundingBox.height=m.height}else this.boundingBox.x+=this.margin.x*this.boundingBox.width,this.boundingBox.y+=this.margin.y*this.boundingBox.height,this.unrotatedBoundingBox=null}getShapeRotation(){return 0}getTextRotation(){return this.state!=null&&this.state.shape!=null?this.state.shape.getTextRotation():0}isPaintBoundsInverted(){return!this.horizontal&&this.state!=null&&this.state.view.graph.model.isVertex(this.state.cell)}configureCanvas(t,e,s,n,l){super.configureCanvas(t,e,s,n,l),t.setFontColor(this.color),t.setFontBackgroundColor(this.background),t.setFontBorderColor(this.border),t.setFontFamily(this.family),t.setFontSize(this.size),t.setFontStyle(this.fontStyle)}updateVmlContainer(){this.node.style.left=Math.round(this.bounds.x)+"px",this.node.style.top=Math.round(this.bounds.y)+"px",this.node.style.width="1px",this.node.style.height="1px",this.node.style.overflow="visible"}getHtmlValue(){var t=this.value;return this.dialect!=mxConstants.DIALECT_STRICTHTML&&(t=mxUtils.htmlEntities(t,!1)),t=mxUtils.replaceTrailingNewlines(t,"<div><br></div>"),t=this.replaceLinefeeds?t.replace(/\n/g,"<br/>"):t,t}getTextCss(){var t=mxConstants.ABSOLUTE_LINE_HEIGHT?this.size*mxConstants.LINE_HEIGHT+"px":mxConstants.LINE_HEIGHT,e="display: inline-block; font-size: "+this.size+"px; font-family: "+this.family+"; color: "+this.color+"; line-height: "+t+"; pointer-events: "+(this.pointerEvents?"all":"none")+"; ";(this.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(e+="font-weight: bold; "),(this.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(e+="font-style: italic; ");var s=[];return(this.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&s.push("underline"),(this.fontStyle&mxConstants.FONT_STRIKETHROUGH)==mxConstants.FONT_STRIKETHROUGH&&s.push("line-through"),s.length>0&&(e+="text-decoration: "+s.join(" ")+"; "),e}redrawHtmlShape(){if(mxClient.IS_SVG)this.redrawHtmlShapeWithCss3();else{var t=this.node.style;t.whiteSpace="normal",t.overflow="",t.width="",t.height="",this.updateValue(),this.updateFont(this.node),this.updateSize(this.node,this.state==null||this.state.view.textDiv==null),this.offsetWidth=null,this.offsetHeight=null,this.updateHtmlTransform()}}redrawHtmlShapeWithCss3(){var t=Math.max(0,Math.round(this.bounds.width/this.scale)),e=Math.max(0,Math.round(this.bounds.height/this.scale)),s="position: absolute; left: "+Math.round(this.bounds.x)+"px; top: "+Math.round(this.bounds.y)+"px; pointer-events: none; ",n=this.getTextCss();mxSvgCanvas2D.createCss(t+2,e,this.align,this.valign,this.wrap,this.overflow,this.clipped,this.background!=null?mxUtils.htmlEntities(this.background):null,this.border!=null?mxUtils.htmlEntities(this.border):null,s,n,this.scale,(l,r,a,o,h,d)=>{var g=this.getTextRotation(),m=(this.scale!=1?"scale("+this.scale+") ":"")+(g!=0?"rotate("+g+"deg) ":"")+(this.margin.x!=0||this.margin.y!=0?"translate("+this.margin.x*100+"%,"+this.margin.y*100+"%)":"");m!=""&&(m="transform-origin: 0 0; transform: "+m+"; "),d==""?(a+=o,o="display:inline-block; min-width: 100%; "+m):o+=m,this.opacity<100&&(h+="opacity: "+this.opacity/100+"; "),this.node.setAttribute("style",a);var f=mxUtils.isNode(this.value)?this.value.outerHTML:this.getHtmlValue();this.node.firstChild==null&&(this.node.innerHTML="<div><div>"+f+"</div></div>"),this.node.firstChild.firstChild.setAttribute("style",h),this.node.firstChild.setAttribute("style",o)})}updateHtmlTransform(){var t=this.getTextRotation(),e=this.node.style,s=this.margin.x,n=this.margin.y;t!=0?(mxUtils.setPrefixedStyle(e,"transformOrigin",-s*100+"% "+-n*100+"%"),mxUtils.setPrefixedStyle(e,"transform","translate("+s*100+"%,"+n*100+"%) scale("+this.scale+") rotate("+t+"deg)")):(mxUtils.setPrefixedStyle(e,"transformOrigin","0% 0%"),mxUtils.setPrefixedStyle(e,"transform","scale("+this.scale+") translate("+s*100+"%,"+n*100+"%)")),e.left=Math.round(this.bounds.x-Math.ceil(s*(this.overflow!="fill"&&this.overflow!="width"?3:1)))+"px",e.top=Math.round(this.bounds.y-n*(this.overflow!="fill"?3:1))+"px",this.opacity<100?e.opacity=this.opacity/100:e.opacity=""}updateInnerHtml(t){if(mxUtils.isNode(this.value))t.innerHTML=this.value.outerHTML;else{var e=this.value;this.dialect!=mxConstants.DIALECT_STRICTHTML&&(e=mxUtils.htmlEntities(e,!1)),e=mxUtils.replaceTrailingNewlines(e,"<div>&nbsp;</div>"),e=this.replaceLinefeeds?e.replace(/\n/g,"<br/>"):e,e='<div style="display:inline-block;_display:inline;">'+e+"</div>",t.innerHTML=e}}updateHtmlFilter(){var t=this.node.style,e=this.margin.x,S=this.margin.y,s=this.scale;mxUtils.setOpacity(this.node,this.opacity);var n=0,l=0,r=this.state!=null?this.state.view.textDiv:null,a=this.node;if(r!=null){r.style.overflow="",r.style.height="",r.style.width="",this.updateFont(r),this.updateSize(r,!1),this.updateInnerHtml(r);var o=Math.round(this.bounds.width/this.scale);this.wrap&&o>0?(r.style.whiteSpace="normal",r.style.wordWrap=mxConstants.WORD_WRAP,n=o,this.clipped&&(n=Math.min(n,this.bounds.width)),r.style.width=n+"px"):r.style.whiteSpace="nowrap",a=r,a.firstChild!=null&&a.firstChild.nodeName=="DIV"&&(a=a.firstChild,this.wrap&&r.style.wordWrap=="break-word"&&(a.style.width="100%")),!this.clipped&&this.wrap&&o>0&&(n=a.offsetWidth+this.textWidthPadding,r.style.width=n+"px"),l=a.offsetHeight+2,mxClient.IS_QUIRKS&&this.border!=null&&this.border!=mxConstants.NONE&&(l+=3)}else a.firstChild!=null&&a.firstChild.nodeName=="DIV"&&(a=a.firstChild,l=a.offsetHeight);n=a.offsetWidth+this.textWidthPadding,this.clipped&&(l=Math.min(l,this.bounds.height));var o=this.bounds.width/s,h=this.bounds.height/s;this.overflow=="fill"?(l=h,n=o):this.overflow=="width"&&(l=a.scrollHeight,n=o),this.offsetWidth=n,this.offsetHeight=l,mxClient.IS_QUIRKS&&(this.clipped||this.overflow=="width"&&h>0)?(h=Math.min(h,l),t.height=Math.round(h)+"px"):h=l,this.overflow!="fill"&&this.overflow!="width"&&(this.clipped&&(n=Math.min(o,n)),o=n,(mxClient.IS_QUIRKS&&this.clipped||this.wrap)&&(t.width=Math.round(o)+"px")),h*=s,o*=s;var d=this.getTextRotation()*(Math.PI/180),g=parseFloat(parseFloat(Math.cos(d)).toFixed(8)),m=parseFloat(parseFloat(Math.sin(-d)).toFixed(8));d%=2*Math.PI,d<0&&(d+=2*Math.PI),d%=Math.PI,d>Math.PI/2&&(d=Math.PI-d);var f=Math.cos(d),c=Math.sin(-d),x=o*-(e+.5),p=h*-(S+.5),C=(h-h*f+o*c)/2+m*x-g*p,E=(o-o*f+h*c)/2-g*x-m*p;if(d!=0){var T="progid:DXImageTransform.Microsoft.Matrix(M11="+g+", M12="+m+", M21="+-m+", M22="+g+", sizingMethod='auto expand')";t.filter!=null&&t.filter.length>0?t.filter+=" "+T:t.filter=T}var S=0;this.overflow!="fill"&&mxClient.IS_QUIRKS&&(this.valign==mxConstants.ALIGN_TOP?S-=1:this.valign==mxConstants.ALIGN_BOTTOM?S+=2:S+=1),t.zoom=s,t.left=Math.round(this.bounds.x+E-o/2)+"px",t.top=Math.round(this.bounds.y+C-h/2+S)+"px"}updateValue(){if(mxUtils.isNode(this.value))this.node.innerHTML="",this.node.appendChild(this.value);else{var t=this.value;this.dialect!=mxConstants.DIALECT_STRICTHTML&&(t=mxUtils.htmlEntities(t,!1)),t=mxUtils.replaceTrailingNewlines(t,"<div><br></div>"),t=this.replaceLinefeeds?t.replace(/\n/g,"<br/>"):t;var e=this.background!=null&&this.background!=mxConstants.NONE?this.background:null,s=this.border!=null&&this.border!=mxConstants.NONE?this.border:null;if(this.overflow=="fill"||this.overflow=="width")e!=null&&(this.node.style.backgroundColor=e),s!=null&&(this.node.style.border="1px solid "+s);else{var n="";e!=null&&(n+="background-color:"+mxUtils.htmlEntities(e)+";"),s!=null&&(n+="border:1px solid "+mxUtils.htmlEntities(s)+";");var l=mxConstants.ABSOLUTE_LINE_HEIGHT?this.size*mxConstants.LINE_HEIGHT+"px":mxConstants.LINE_HEIGHT;t='<div style="zoom:1;'+n+"display:inline-block;_display:inline;text-decoration:inherit;padding-bottom:1px;padding-right:1px;line-height:"+l+'">'+t+"</div>"}this.node.innerHTML=t;var r=this.node.getElementsByTagName("div");if(r.length>0){var a=this.textDirection;a==mxConstants.TEXT_DIRECTION_AUTO&&this.dialect!=mxConstants.DIALECT_STRICTHTML&&(a=this.getAutoDirection()),a==mxConstants.TEXT_DIRECTION_LTR||a==mxConstants.TEXT_DIRECTION_RTL?r[r.length-1].setAttribute("dir",a):r[r.length-1].removeAttribute("dir")}}}updateFont(t){var e=t.style;e.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?this.size*mxConstants.LINE_HEIGHT+"px":mxConstants.LINE_HEIGHT,e.fontSize=this.size+"px",e.fontFamily=this.family,e.verticalAlign="top",e.color=this.color,(this.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD?e.fontWeight="bold":e.fontWeight="",(this.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC?e.fontStyle="italic":e.fontStyle="";var s=[];(this.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&s.push("underline"),(this.fontStyle&mxConstants.FONT_STRIKETHROUGH)==mxConstants.FONT_STRIKETHROUGH&&s.push("line-through"),e.textDecoration=s.join(" "),this.align==mxConstants.ALIGN_CENTER?e.textAlign="center":this.align==mxConstants.ALIGN_RIGHT?e.textAlign="right":e.textAlign="left"}updateSize(t,e){var s=Math.max(0,Math.round(this.bounds.width/this.scale)),n=Math.max(0,Math.round(this.bounds.height/this.scale)),l=t.style;if(this.clipped?(l.overflow="hidden",mxClient.IS_QUIRKS?l.width=s+"px":(l.maxHeight=n+"px",l.maxWidth=s+"px")):this.overflow=="fill"?(l.width=s+1+"px",l.height=n+1+"px",l.overflow="hidden"):this.overflow=="width"&&(l.width=s+1+"px",l.maxHeight=n+1+"px",l.overflow="hidden"),this.wrap&&s>0){if(l.wordWrap=mxConstants.WORD_WRAP,l.whiteSpace="normal",l.width=s+"px",e&&this.overflow!="fill"&&this.overflow!="width"){var r=t;r.firstChild!=null&&r.firstChild.nodeName=="DIV"&&(r=r.firstChild,t.style.wordWrap=="break-word"&&(r.style.width="100%"));var a=r.offsetWidth;if(a==0){var o=t.parentNode;t.style.visibility="hidden",document.body.appendChild(t),a=r.offsetWidth,t.style.visibility="",o.appendChild(t)}a+=3,this.clipped&&(a=Math.min(a,s)),l.width=a+"px"}}else l.whiteSpace="nowrap"}updateMargin(){this.margin=mxUtils.getAlignmentAsPoint(this.align,this.valign)}getSpacing(){var t=0,e=0;return this.align==mxConstants.ALIGN_CENTER?t=(this.spacingLeft-this.spacingRight)/2:this.align==mxConstants.ALIGN_RIGHT?t=-this.spacingRight-at.baseSpacingRight:t=this.spacingLeft+at.baseSpacingLeft,this.valign==mxConstants.ALIGN_MIDDLE?e=(this.spacingTop-this.spacingBottom)/2:this.valign==mxConstants.ALIGN_BOTTOM?e=-this.spacingBottom-at.baseSpacingBottom:e=this.spacingTop+at.baseSpacingTop,new mxPoint(t,e)}};u(at,"baseSpacingTop",0),u(at,"baseSpacingBottom",0),u(at,"baseSpacingLeft",0),u(at,"baseSpacingRight",0);let mxText=at;class mxRectangleShape extends mxShape{constructor(i,t,e,s){super(),this.bounds=i,this.fill=t,this.stroke=e,this.strokewidth=s??1}isHtmlAllowed(){var i=!0;return this.style!=null&&(i=mxUtils.getValue(this.style,mxConstants.STYLE_POINTER_EVENTS,"1")=="1"),!this.isRounded&&!this.glass&&this.rotation==0&&(i||this.fill!=null&&this.fill!=mxConstants.NONE)}paintBackground(i,t,e,s,n){var l=!0;if(this.style!=null&&(l=mxUtils.getValue(this.style,mxConstants.STYLE_POINTER_EVENTS,"1")=="1"),l||this.fill!=null&&this.fill!=mxConstants.NONE||this.stroke!=null&&this.stroke!=mxConstants.NONE){if(!l&&(this.fill==null||this.fill==mxConstants.NONE)&&(i.pointerEvents=!1),this.isRounded){var r=0;if(mxUtils.getValue(this.style,mxConstants.STYLE_ABSOLUTE_ARCSIZE,0)=="1")r=Math.min(s/2,Math.min(n/2,mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2));else{var a=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.RECTANGLE_ROUNDING_FACTOR*100)/100;r=Math.min(s*a,n*a)}i.roundrect(t,e,s,n,r,r)}else i.rect(t,e,s,n);i.fillAndStroke()}}isRoundable(i,t,e,s,n){return!0}paintForeground(i,t,e,s,n){this.glass&&!this.outline&&this.fill!=null&&this.fill!=mxConstants.NONE&&this.paintGlassEffect(i,t,e,s,n,this.getArcSize(s+this.strokewidth,n+this.strokewidth))}}class mxImageShape extends mxRectangleShape{constructor(t,e,s,n,l){super();u(this,"preserveImageAspect",!0);this.bounds=t,this.image=e,this.fill=s,this.stroke=n,this.strokewidth=l??1,this.shadow=!1}getSvgScreenOffset(){return 0}apply(t){super.apply(t),this.fill=null,this.stroke=null,this.gradient=null,this.style!=null&&(this.preserveImageAspect=mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_ASPECT,1)==1,this.flipH=this.flipH||mxUtils.getValue(this.style,"imageFlipH",0)==1,this.flipV=this.flipV||mxUtils.getValue(this.style,"imageFlipV",0)==1)}isHtmlAllowed(){return!this.preserveImageAspect}createHtml(){var t=document.createElement("div");return t.style.position="absolute",t}isRoundable(t,e,s,n,l){return!1}paintVertexShape(t,e,s,n,l){if(this.image!=null){var r=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BACKGROUND,null),a=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,null);r!=null&&(t.setFillColor(r),t.setStrokeColor(a),t.rect(e,s,n,l),t.fillAndStroke()),t.image(e,s,n,l,this.image,this.preserveImageAspect,!1,!1);var a=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,null);a!=null&&(t.setShadow(!1),t.setStrokeColor(a),t.rect(e,s,n,l),t.stroke())}else super.paintBackground(t,e,s,n,l)}redrawHtmlShape(){if(this.node.style.left=Math.round(this.bounds.x)+"px",this.node.style.top=Math.round(this.bounds.y)+"px",this.node.style.width=Math.max(0,Math.round(this.bounds.width))+"px",this.node.style.height=Math.max(0,Math.round(this.bounds.height))+"px",this.node.innerHTML="",this.image!=null){var t=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BACKGROUND,""),e=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,"");this.node.style.backgroundColor=t,this.node.style.borderColor=e;var s=this.rotation!=0,n=document.createElement(s?mxClient.VML_PREFIX+":image":"img");n.setAttribute("border","0"),n.style.position="absolute",n.src=this.image;var l=this.opacity<100?"alpha(opacity="+this.opacity+")":"";this.node.style.filter=l,this.flipH&&this.flipV?l+="progid:DXImageTransform.Microsoft.BasicImage(rotation=2)":this.flipH?l+="progid:DXImageTransform.Microsoft.BasicImage(mirror=1)":this.flipV&&(l+="progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)"),n.style.filter!=l&&(n.style.filter=l),n.nodeName=="image"?n.style.rotation=this.rotation:this.rotation!=0?mxUtils.setPrefixedStyle(n.style,"transform","rotate("+this.rotation+"deg)"):mxUtils.setPrefixedStyle(n.style,"transform",""),n.style.width=this.node.style.width,n.style.height=this.node.style.height,this.node.style.backgroundImage="",this.node.appendChild(n)}else this.setTransparentBackgroundImage(this.node)}}const St=class St{static addMarker(i,t){St.markers[i]=t}static createMarker(i,t,e,s,n,l,r,a,o,h){var d=St.markers[e];return d!=null?d(i,t,e,s,n,l,r,a,o,h):null}};u(St,"markers",[]);let mxMarker=St;function diamond(v,i,t,e,s,n,l,r,a,o){var h=t==mxConstants.ARROW_DIAMOND?.7071:.9862,d=s*a*h,g=n*a*h;s=s*(l+a),n=n*(l+a);var m=e.clone();m.x-=d,m.y-=g,e.x+=-s-d,e.y+=-n-g;var f=t==mxConstants.ARROW_DIAMOND?2:3.4;return function(){v.begin(),v.moveTo(m.x,m.y),v.lineTo(m.x-s/2-n/f,m.y+s/f-n/2),v.lineTo(m.x-s,m.y-n),v.lineTo(m.x-s/2+n/f,m.y-n/2-s/f),v.close(),o?v.fillAndStroke():v.stroke()}}function createOpenArrow(v){return v=v??2,function(i,t,e,s,n,l,r,a,o,h){var d=n*o*1.118,g=l*o*1.118;n=n*(r+o),l=l*(r+o);var m=s.clone();return m.x-=d,m.y-=g,s.x+=-d*2,s.y+=-g*2,function(){i.begin(),i.moveTo(m.x-n-l/v,m.y-l+n/v),i.lineTo(m.x,m.y),i.lineTo(m.x+l/v-n,m.y-l-n/v),i.stroke()}}}function createArrow(v){return v=v??2,function(i,t,e,s,n,l,r,a,o,h){var d=n*o*1.118,g=l*o*1.118;n=n*(r+o),l=l*(r+o);var m=s.clone();m.x-=d,m.y-=g;var f=e!=mxConstants.ARROW_CLASSIC&&e!=mxConstants.ARROW_CLASSIC_THIN?1:3/4;return s.x+=-n*f-d,s.y+=-l*f-g,function(){i.begin(),i.moveTo(m.x,m.y),i.lineTo(m.x-n-l/v,m.y-l+n/v),(e==mxConstants.ARROW_CLASSIC||e==mxConstants.ARROW_CLASSIC_THIN)&&i.lineTo(m.x-n*3/4,m.y-l*3/4),i.lineTo(m.x+l/v-n,m.y-l-n/v),i.close(),h?i.fillAndStroke():i.stroke()}}}function oval(v,i,t,e,s,n,l,r,a,o){var h=l/2,d=e.clone();return e.x-=s*h,e.y-=n*h,function(){v.ellipse(d.x-h,d.y-h,l,l),o?v.fillAndStroke():v.stroke()}}class mxConnector extends mxPolyline{constructor(i,t,e){super(i,t,e)}updateBoundingBox(){this.useSvgBoundingBox=this.style!=null&&this.style[mxConstants.STYLE_CURVED]==1,super.updateBoundingBox()}paintEdgeShape(i,t){var e=this.createMarker(i,t,!0),s=this.createMarker(i,t,!1);super.paintEdgeShape(i,t),i.setFillColor(this.stroke),i.setShadow(!1),i.setDashed(!1),e!=null&&e(),s!=null&&s()}createMarker(i,t,e){var s=null,n=t.length,l=mxUtils.getValue(this.style,e?mxConstants.STYLE_STARTARROW:mxConstants.STYLE_ENDARROW),r=e?t[1]:t[n-2],a=e?t[0]:t[n-1];if(l!=null&&r!=null&&a!=null){for(var o=1;o<n-1&&Math.round(r.x-a.x)==0&&Math.round(r.y-a.y)==0;)r=e?t[1+o]:t[n-2-o],o++;var h=a.x-r.x,d=a.y-r.y,g=Math.max(1,Math.sqrt(h*h+d*d)),m=h/g,f=d/g,c=mxUtils.getNumber(this.style,e?mxConstants.STYLE_STARTSIZE:mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE),x=this.style[e?mxConstants.STYLE_STARTFILL:mxConstants.STYLE_ENDFILL]!=0;s=mxMarker.createMarker(i,this,l,a,m,f,c,e,this.strokewidth,x)}return s}augmentBoundingBox(i){super.augmentBoundingBox(i);var t=0;mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,mxConstants.NONE)!=mxConstants.NONE&&(t=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_MARKERSIZE)+1),mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,mxConstants.NONE)!=mxConstants.NONE&&(t=Math.max(t,mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE))+1),i.grow(t*this.scale)}}const yt=class yt{constructor(){u(this,"defaultEdgeShape",mxConnector);u(this,"defaultVertexShape",mxRectangleShape);u(this,"defaultTextShape",mxText);u(this,"legacyControlPosition",!0);u(this,"legacySpacing",!0);u(this,"antiAlias",!0);u(this,"minSvgStrokeWidth",1);u(this,"forceControlClickHandler",!1)}static registerShape(i,t){yt.defaultShapes[i]=t}initializeShape(i){i.shape.dialect=i.view.graph.dialect,this.configureShape(i),i.shape.init(i.view.getDrawPane())}createShape(i){var t=null;if(i.style!=null){var e=mxStencilRegistry.getStencil(i.style[mxConstants.STYLE_SHAPE]);if(e!=null)t=new mxShape(e);else{var s=this.getShapeConstructor(i);t=new s}}return t}createIndicatorShape(i){i.shape.indicatorShape=this.getShape(i.view.graph.getIndicatorShape(i))}getShape(i){return i!=null?yt.defaultShapes[i]:null}getShapeConstructor(i){var t=this.getShape(i.style[mxConstants.STYLE_SHAPE]);return t==null&&(t=i.view.graph.getModel().isEdge(i.cell)?this.defaultEdgeShape:this.defaultVertexShape),t}configureShape(i){i.shape.apply(i),i.shape.image=i.view.graph.getImage(i),i.shape.indicatorColor=i.view.graph.getIndicatorColor(i),i.shape.indicatorStrokeColor=i.style[mxConstants.STYLE_INDICATOR_STROKECOLOR],i.shape.indicatorGradientColor=i.view.graph.getIndicatorGradientColor(i),i.shape.indicatorDirection=i.style[mxConstants.STYLE_INDICATOR_DIRECTION],i.shape.indicatorImage=i.view.graph.getIndicatorImage(i),this.postConfigureShape(i)}postConfigureShape(i){i.shape!=null&&(this.resolveColor(i,"indicatorGradientColor",mxConstants.STYLE_GRADIENTCOLOR),this.resolveColor(i,"indicatorColor",mxConstants.STYLE_FILLCOLOR),this.resolveColor(i,"gradient",mxConstants.STYLE_GRADIENTCOLOR),this.resolveColor(i,"stroke",mxConstants.STYLE_STROKECOLOR),this.resolveColor(i,"fill",mxConstants.STYLE_FILLCOLOR))}checkPlaceholderStyles(i){if(i.style!=null){for(var t=["inherit","swimlane","indicated"],e=[mxConstants.STYLE_FILLCOLOR,mxConstants.STYLE_STROKECOLOR,mxConstants.STYLE_GRADIENTCOLOR,mxConstants.STYLE_FONTCOLOR],s=0;s<e.length;s++)if(mxUtils.indexOf(t,i.style[e[s]])>=0)return!0}return!1}resolveColor(i,t,e){var s=e==mxConstants.STYLE_FONTCOLOR?i.text:i.shape;if(s!=null){var n=i.view.graph,l=s[t],r=null;if(l=="inherit"?r=n.model.getParent(i.cell):l=="swimlane"?(s[t]=e==mxConstants.STYLE_STROKECOLOR||e==mxConstants.STYLE_FONTCOLOR?"#000000":"#ffffff",n.model.getTerminal(i.cell,!1)!=null?r=n.model.getTerminal(i.cell,!1):r=i.cell,r=n.getSwimlane(r),e=n.swimlaneIndicatorColorAttribute):l=="indicated"&&i.shape!=null&&(s[t]=i.shape.indicatorColor),r!=null){var a=n.getView().getState(r);if(s[t]=null,a!=null){var o=e==mxConstants.STYLE_FONTCOLOR?a.text:a.shape;o!=null&&t!="indicatorColor"?s[t]=o[t]:s[t]=a.style[e]}}}}getLabelValue(i){return i.view.graph.getLabel(i.cell)}createLabel(i,t){var e=i.view.graph;if(e.getModel().isEdge(i.cell),i.style[mxConstants.STYLE_FONTSIZE]>0||i.style[mxConstants.STYLE_FONTSIZE]==null){var s=e.isHtmlLabel(i.cell)||t!=null&&mxUtils.isNode(t);i.text=new this.defaultTextShape(t,new mxRectangle,i.style[mxConstants.STYLE_ALIGN]||mxConstants.ALIGN_CENTER,e.getVerticalAlign(i),i.style[mxConstants.STYLE_FONTCOLOR],i.style[mxConstants.STYLE_FONTFAMILY],i.style[mxConstants.STYLE_FONTSIZE],i.style[mxConstants.STYLE_FONTSTYLE],i.style[mxConstants.STYLE_SPACING],i.style[mxConstants.STYLE_SPACING_TOP],i.style[mxConstants.STYLE_SPACING_RIGHT],i.style[mxConstants.STYLE_SPACING_BOTTOM],i.style[mxConstants.STYLE_SPACING_LEFT],i.style[mxConstants.STYLE_HORIZONTAL],i.style[mxConstants.STYLE_LABEL_BACKGROUNDCOLOR],i.style[mxConstants.STYLE_LABEL_BORDERCOLOR],e.isWrapping(i.cell)&&e.isHtmlLabel(i.cell),e.isLabelClipped(i.cell),i.style[mxConstants.STYLE_OVERFLOW],i.style[mxConstants.STYLE_LABEL_PADDING],mxUtils.getValue(i.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION)),i.text.opacity=mxUtils.getValue(i.style,mxConstants.STYLE_TEXT_OPACITY,100),i.text.dialect=s?mxConstants.DIALECT_STRICTHTML:i.view.graph.dialect,i.text.style=i.style,i.text.state=i,this.initializeLabel(i,i.text);var n=!1,l=function(r){var a=i;if(mxClient.IS_TOUCH||n){var o=mxEvent.getClientX(r),h=mxEvent.getClientY(r),d=mxUtils.convertPoint(e.container,o,h);a=e.view.getState(e.getCellAt(d.x,d.y))}return a};mxEvent.addGestureListeners(i.text.node,r=>{this.isLabelEvent(i,r)&&(e.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(r,i)),n=e.dialect!=mxConstants.DIALECT_SVG&&mxEvent.getSource(r).nodeName=="IMG")},r=>{this.isLabelEvent(i,r)&&e.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(r,l(r)))},r=>{this.isLabelEvent(i,r)&&(e.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(r,l(r))),n=!1)}),e.nativeDblClickEnabled&&mxEvent.addListener(i.text.node,"dblclick",r=>{this.isLabelEvent(i,r)&&(e.dblClick(r,i.cell),mxEvent.consume(r))})}}initializeLabel(i,t){mxClient.IS_SVG&&mxClient.NO_FO&&t.dialect!=mxConstants.DIALECT_SVG?t.init(i.view.graph.container):t.init(i.view.getDrawPane())}createCellOverlays(i){var t=i.view.graph,e=t.getCellOverlays(i.cell),s=null;if(e!=null){s=new mxDictionary;for(var n=0;n<e.length;n++){var l=i.overlays!=null?i.overlays.remove(e[n]):null;if(l==null){var r=new mxImageShape(new mxRectangle,e[n].image.src);r.dialect=i.view.graph.dialect,r.preserveImageAspect=!1,r.overlay=e[n],this.initializeOverlay(i,r),this.installCellOverlayListeners(i,e[n],r),e[n].cursor!=null&&(r.node.style.cursor=e[n].cursor),s.put(e[n],r)}else s.put(e[n],l)}}i.overlays!=null&&i.overlays.visit(function(a,o){o.destroy()}),i.overlays=s}initializeOverlay(i,t){t.init(i.view.getOverlayPane())}installCellOverlayListeners(i,t,e){var s=i.view.graph;mxEvent.addListener(e.node,"click",function(n){s.isEditing()&&s.stopEditing(!s.isInvokesStopCellEditing()),t.fireEvent(new mxEventObject(mxEvent.CLICK,"event",n,"cell",i.cell))}),mxEvent.addGestureListeners(e.node,function(n){mxEvent.consume(n)},function(n){s.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(n,i))}),mxClient.IS_TOUCH&&mxEvent.addListener(e.node,"touchend",function(n){t.fireEvent(new mxEventObject(mxEvent.CLICK,"event",n,"cell",i.cell))})}createControl(i){var t=i.view.graph,e=t.getFoldingImage(i);if(t.foldingEnabled&&e!=null){if(i.control==null){var s=new mxRectangle(0,0,e.width,e.height);i.control=new mxImageShape(s,e.src),i.control.preserveImageAspect=!1,i.control.dialect=t.dialect,this.initControl(i,i.control,!0,this.createControlClickHandler(i))}}else i.control!=null&&(i.control.destroy(),i.control=null)}createControlClickHandler(i){var t=i.view.graph;return e=>{if(this.forceControlClickHandler||t.isEnabled()){var s=!t.isCellCollapsed(i.cell);t.foldCells(s,!1,[i.cell],null,e),mxEvent.consume(e)}}}initControl(i,t,e,s){var n=i.view.graph,l=n.isHtmlLabel(i.cell)&&mxClient.NO_FO&&n.dialect==mxConstants.DIALECT_SVG;l?(t.dialect=mxConstants.DIALECT_PREFERHTML,t.init(n.container),t.node.style.zIndex=1):t.init(i.view.getOverlayPane());var r=t.innerNode||t.node;if(s!=null&&!mxClient.IS_IOS&&(n.isEnabled()&&(r.style.cursor="pointer"),mxEvent.addListener(r,"click",s)),e){var a=null;mxEvent.addGestureListeners(r,function(o){a=new mxPoint(mxEvent.getClientX(o),mxEvent.getClientY(o)),n.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(o,i)),mxEvent.consume(o)},function(o){n.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(o,i))},function(o){n.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(o,i)),mxEvent.consume(o)}),s!=null&&mxClient.IS_IOS&&r.addEventListener("touchend",function(o){if(a!=null){var h=n.tolerance;Math.abs(a.x-mxEvent.getClientX(o))<h&&Math.abs(a.y-mxEvent.getClientY(o))<h&&(s.call(s,o),mxEvent.consume(o))}},!0)}return r}isShapeEvent(i,t){return!0}isLabelEvent(i,t){return!0}installListeners(i){var t=i.view.graph,e=function(s){var n=i;if(t.dialect!=mxConstants.DIALECT_SVG&&mxEvent.getSource(s).nodeName=="IMG"||mxClient.IS_TOUCH){var l=mxEvent.getClientX(s),r=mxEvent.getClientY(s),a=mxUtils.convertPoint(t.container,l,r);n=t.view.getState(t.getCellAt(a.x,a.y))}return n};mxEvent.addGestureListeners(i.shape.node,s=>{this.isShapeEvent(i,s)&&t.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(s,i))},s=>{this.isShapeEvent(i,s)&&t.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(s,e(s)))},s=>{this.isShapeEvent(i,s)&&t.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(s,e(s)))}),t.nativeDblClickEnabled&&mxEvent.addListener(i.shape.node,"dblclick",s=>{this.isShapeEvent(i,s)&&(t.dblClick(s,i.cell),mxEvent.consume(s))})}redrawLabel(i,t){var e=i.view.graph,s=this.getLabelValue(i),n=e.isWrapping(i.cell),l=e.isLabelClipped(i.cell),r=i.view.graph.isHtmlLabel(i.cell)||s!=null&&mxUtils.isNode(s),a=r?mxConstants.DIALECT_STRICTHTML:i.view.graph.dialect,o=i.style[mxConstants.STYLE_OVERFLOW]||"visible";if(i.text!=null&&(i.text.wrap!=n||i.text.clipped!=l||i.text.overflow!=o||i.text.dialect!=a)&&(i.text.destroy(),i.text=null),i.text==null&&s!=null&&(mxUtils.isNode(s)||s.length>0)?this.createLabel(i,s):i.text!=null&&(s==null||s.length==0)&&(i.text.destroy(),i.text=null),i.text!=null){t&&(i.text.lastValue!=null&&this.isTextShapeInvalid(i,i.text)&&(i.text.lastValue=null),i.text.resetStyles(),i.text.apply(i),i.text.valign=e.getVerticalAlign(i));var h=this.getLabelBounds(i),d=this.getTextScale(i);if(this.resolveColor(i,"color",mxConstants.STYLE_FONTCOLOR),t||i.text.value!=s||i.text.isWrapping!=n||i.text.overflow!=o||i.text.isClipping!=l||i.text.scale!=d||i.text.dialect!=a||i.text.bounds==null||!i.text.bounds.equals(h)){i.text.dialect=a,i.text.value=s,i.text.bounds=h,i.text.scale=d,i.text.wrap=n,i.text.clipped=l,i.text.overflow=o;var g=i.text.node.style.visibility;this.redrawLabelShape(i.text),i.text.node.style.visibility=g}}}isTextShapeInvalid(i,t){function e(s,n,l){var r=!1;return n=="spacingTop"||n=="spacingRight"||n=="spacingBottom"||n=="spacingLeft"?r=parseFloat(t[s])-parseFloat(t.spacing)!=(i.style[n]||l):r=t[s]!=(i.style[n]||l),r}return e("fontStyle",mxConstants.STYLE_FONTSTYLE,mxConstants.DEFAULT_FONTSTYLE)||e("family",mxConstants.STYLE_FONTFAMILY,mxConstants.DEFAULT_FONTFAMILY)||e("size",mxConstants.STYLE_FONTSIZE,mxConstants.DEFAULT_FONTSIZE)||e("color",mxConstants.STYLE_FONTCOLOR,"black")||e("align",mxConstants.STYLE_ALIGN,"")||e("valign",mxConstants.STYLE_VERTICAL_ALIGN,"")||e("spacing",mxConstants.STYLE_SPACING,2)||e("spacingTop",mxConstants.STYLE_SPACING_TOP,0)||e("spacingRight",mxConstants.STYLE_SPACING_RIGHT,0)||e("spacingBottom",mxConstants.STYLE_SPACING_BOTTOM,0)||e("spacingLeft",mxConstants.STYLE_SPACING_LEFT,0)||e("horizontal",mxConstants.STYLE_HORIZONTAL,!0)||e("background",mxConstants.STYLE_LABEL_BACKGROUNDCOLOR)||e("border",mxConstants.STYLE_LABEL_BORDERCOLOR)||e("opacity",mxConstants.STYLE_TEXT_OPACITY,100)||e("textDirection",mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION)}redrawLabelShape(i){i.redraw()}getTextScale(i){return i.view.scale}getLabelBounds(i){var t=i.view.graph,e=i.view.scale,s=t.getModel().isEdge(i.cell),n=new mxRectangle(i.absoluteOffset.x,i.absoluteOffset.y);if(s){var l=i.text.getSpacing();n.x+=l.x*e,n.y+=l.y*e;var r=t.getCellGeometry(i.cell);r!=null&&(n.width=Math.max(0,r.width*e),n.height=Math.max(0,r.height*e))}else{if(i.text.isPaintBoundsInverted()){var a=n.x;n.x=n.y,n.y=a}n.x+=i.x,n.y+=i.y,n.width=Math.max(1,i.width),n.height=Math.max(1,i.height)}if(i.text.isPaintBoundsInverted()){var o=(i.width-i.height)/2;n.x+=o,n.y-=o;var a=n.width;n.width=n.height,n.height=a}if(i.shape!=null){var h=mxUtils.getValue(i.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),d=mxUtils.getValue(i.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);h==mxConstants.ALIGN_CENTER&&d==mxConstants.ALIGN_MIDDLE&&(n=i.shape.getLabelBounds(n))}var g=mxUtils.getValue(i.style,mxConstants.STYLE_LABEL_WIDTH,null);return g!=null&&(n.width=parseFloat(g)*e),s||this.rotateLabelBounds(i,n),n}rotateLabelBounds(i,t){if(t.y-=i.text.margin.y*t.height,t.x-=i.text.margin.x*t.width,!this.legacySpacing||i.style[mxConstants.STYLE_OVERFLOW]!="fill"&&i.style[mxConstants.STYLE_OVERFLOW]!="width"){var e=i.view.scale,s=i.text.getSpacing();t.x+=s.x*e,t.y+=s.y*e;var n=mxUtils.getValue(i.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),l=mxUtils.getValue(i.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),r=mxUtils.getValue(i.style,mxConstants.STYLE_LABEL_WIDTH,null);t.width=Math.max(0,t.width-(n==mxConstants.ALIGN_CENTER&&r==null?i.text.spacingLeft*e+i.text.spacingRight*e:0)),t.height=Math.max(0,t.height-(l==mxConstants.ALIGN_MIDDLE?i.text.spacingTop*e+i.text.spacingBottom*e:0))}var a=i.text.getTextRotation();if(a!=0&&i!=null&&i.view.graph.model.isVertex(i.cell)){var o=i.getCenterX(),h=i.getCenterY();if(t.x!=o||t.y!=h){var d=a*(Math.PI/180),g=mxUtils.getRotatedPoint(new mxPoint(t.x,t.y),Math.cos(d),Math.sin(d),new mxPoint(o,h));t.x=g.x,t.y=g.y}}}redrawCellOverlays(i,t){if(this.createCellOverlays(i),i.overlays!=null){var e=mxUtils.mod(mxUtils.getValue(i.style,mxConstants.STYLE_ROTATION,0),90),s=mxUtils.toRadians(e),n=Math.cos(s),l=Math.sin(s);i.overlays.visit(function(r,a){var o=a.overlay.getBounds(i);if(!i.view.graph.getModel().isEdge(i.cell)&&i.shape!=null&&e!=0){var h=o.getCenterX(),d=o.getCenterY(),g=mxUtils.getRotatedPoint(new mxPoint(h,d),n,l,new mxPoint(i.getCenterX(),i.getCenterY()));h=g.x,d=g.y,o.x=Math.round(h-o.width/2),o.y=Math.round(d-o.height/2)}(t||a.bounds==null||a.scale!=i.view.scale||!a.bounds.equals(o))&&(a.bounds=o,a.scale=i.view.scale,a.redraw())})}}redrawControl(i,t){var e=i.view.graph.getFoldingImage(i);if(i.control!=null&&e!=null){var s=this.getControlBounds(i,e.width,e.height),n=this.legacyControlPosition?mxUtils.getValue(i.style,mxConstants.STYLE_ROTATION,0):i.shape.getTextRotation(),l=i.view.scale;(t||i.control.scale!=l||!i.control.bounds.equals(s)||i.control.rotation!=n)&&(i.control.rotation=n,i.control.bounds=s,i.control.scale=l,i.control.redraw())}}getControlBounds(i,t,e){if(i.control!=null){var s=i.view.scale,n=i.getCenterX(),l=i.getCenterY();if(!i.view.graph.getModel().isEdge(i.cell)&&(n=i.x+t*s,l=i.y+e*s,i.shape!=null)){var r=i.shape.getShapeRotation();if(this.legacyControlPosition)r=mxUtils.getValue(i.style,mxConstants.STYLE_ROTATION,0);else if(i.shape.isPaintBoundsInverted()){var a=(i.width-i.height)/2;n+=a,l-=a}if(r!=0){var o=mxUtils.toRadians(r),h=Math.cos(o),d=Math.sin(o),g=mxUtils.getRotatedPoint(new mxPoint(n,l),h,d,new mxPoint(i.getCenterX(),i.getCenterY()));n=g.x,l=g.y}}return i.view.graph.getModel().isEdge(i.cell)?new mxRectangle(Math.round(n-t/2*s),Math.round(l-e/2*s),Math.round(t*s),Math.round(e*s)):new mxRectangle(Math.round(n-t/2*s),Math.round(l-e/2*s),Math.round(t*s),Math.round(e*s))}return null}insertStateAfter(i,t,e){for(var s=this.getShapesForState(i),n=0;n<s.length;n++)if(s[n]!=null&&s[n].node!=null){var l=s[n].node.parentNode!=i.view.getDrawPane()&&s[n].node.parentNode!=i.view.getOverlayPane(),r=l?e:t;if(r!=null&&r.nextSibling!=s[n].node)r.nextSibling==null?r.parentNode.appendChild(s[n].node):r.parentNode.insertBefore(s[n].node,r.nextSibling);else if(r==null)if(s[n].node.parentNode==i.view.graph.container){for(var a=i.view.canvas;a!=null&&a.parentNode!=i.view.graph.container;)a=a.parentNode;a!=null&&a.nextSibling!=null?a.nextSibling!=s[n].node&&s[n].node.parentNode.insertBefore(s[n].node,a.nextSibling):s[n].node.parentNode.appendChild(s[n].node)}else s[n].node.parentNode!=null&&s[n].node.parentNode.firstChild!=null&&s[n].node.parentNode.firstChild!=s[n].node&&s[n].node.parentNode.insertBefore(s[n].node,s[n].node.parentNode.firstChild);l?e=s[n].node:t=s[n].node}return[t,e]}getShapesForState(i){return[i.shape,i.text,i.control]}redraw(i,t,e){var s=this.redrawShape(i,t,e);i.shape!=null&&(e==null||e)&&(this.redrawLabel(i,s),this.redrawCellOverlays(i,s),this.redrawControl(i,s))}redrawShape(i,t,e){var s=i.view.graph.model,n=!1;return i.shape!=null&&i.shape.style!=null&&i.style!=null&&i.shape.style[mxConstants.STYLE_SHAPE]!=i.style[mxConstants.STYLE_SHAPE]&&(i.shape.destroy(),i.shape=null),i.shape==null&&i.view.graph.container!=null&&i.cell!=i.view.currentRoot&&(s.isVertex(i.cell)||s.isEdge(i.cell))?(i.shape=this.createShape(i),i.shape!=null&&(i.shape.minSvgStrokeWidth=this.minSvgStrokeWidth,i.shape.antiAlias=this.antiAlias,this.createIndicatorShape(i),this.initializeShape(i),this.createCellOverlays(i),this.installListeners(i),i.view.graph.selectionCellsHandler.updateHandler(i))):!t&&i.shape!=null&&(!mxUtils.equalEntries(i.shape.style,i.style)||this.checkPlaceholderStyles(i))&&(i.shape.resetStyles(),this.configureShape(i),i.view.graph.selectionCellsHandler.updateHandler(i),t=!0),i.shape!=null&&i.shape.indicatorShape!=this.getShape(i.view.graph.getIndicatorShape(i))&&(i.shape.indicator!=null&&(i.shape.indicator.destroy(),i.shape.indicator=null),this.createIndicatorShape(i),i.shape.indicatorShape!=null&&(i.shape.indicator=new i.shape.indicatorShape,i.shape.indicator.dialect=i.shape.dialect,i.shape.indicator.init(i.node),t=!0)),i.shape!=null&&(this.createControl(i),(t||this.isShapeInvalid(i,i.shape))&&(i.absolutePoints!=null?(i.shape.points=i.absolutePoints.slice(),i.shape.bounds=null):(i.shape.points=null,i.shape.bounds=new mxRectangle(i.x,i.y,i.width,i.height)),i.shape.scale=i.view.scale,e==null||e?this.doRedrawShape(i):i.shape.updateBoundingBox(),n=!0)),n}doRedrawShape(i){i.shape.redraw()}isShapeInvalid(i,t){return t.bounds==null||t.scale!=i.view.scale||i.absolutePoints==null&&!t.bounds.equals(i)||i.absolutePoints!=null&&!mxUtils.equalPoints(t.points,i.absolutePoints)}destroy(i){i.shape!=null&&(i.text!=null&&(i.text.destroy(),i.text=null),i.overlays!=null&&(i.overlays.visit(function(t,e){e.destroy()}),i.overlays=null),i.control!=null&&(i.control.destroy(),i.control=null),i.shape.destroy(),i.shape=null)}};u(yt,"defaultShapes",new Object);let mxCellRenderer=yt;class mxChildChangeCodec extends mxObjectCodec{constructor(){super(new mxChildChange,["model","child","previousIndex"],["parent","previous"])}isReference(i,t,e,s){return t=="child"&&(!s||i.model.contains(i.previous))?!0:mxUtils.indexOf(this.idrefs,t)>=0}isExcluded(i,t,e,s){return super.isExcluded(i,t,e,s)||s&&e!=null&&(t=="previous"||t=="parent")&&!i.model.contains(e)}afterEncode(i,t,e){return this.isReference(t,"child",t.child,!0)?e.setAttribute("child",i.getId(t.child)):i.encodeCell(t.child,e),e}beforeDecode(i,t,e){if(t.firstChild!=null&&t.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT){t=t.cloneNode(!0);var s=t.firstChild;e.child=i.decodeCell(s,!1);var n=s.nextSibling;for(s.parentNode.removeChild(s),s=n;s!=null;){if(n=s.nextSibling,s.nodeType==mxConstants.NODETYPE_ELEMENT){var l=s.getAttribute("id");i.lookup(l)==null&&i.decodeCell(s)}s.parentNode.removeChild(s),s=n}}else{var r=t.getAttribute("child");e.child=i.getObject(r)}return t}afterDecode(i,t,e){return e.child!=null&&(e.child.parent!=null&&e.previous!=null&&e.child.parent!=e.previous&&(e.previous=e.child.parent),e.child.parent=e.previous,e.previous=e.parent,e.previousIndex=e.index),e}}class mxCellCodec extends mxObjectCodec{constructor(){super(new mxCell,["children","edges","overlays","mxTransient"],["parent","source","target"])}isCellCodec(){return!0}isNumericAttribute(i,t,e){return t.nodeName!=="value"&&super.isNumericAttribute(i,t,e)}isExcluded(i,t,e,s){return super.isExcluded(i,t,e,s)||s&&t=="value"&&e.nodeType==mxConstants.NODETYPE_ELEMENT}afterEncode(i,t,e){if(t.value!=null&&t.value.nodeType==mxConstants.NODETYPE_ELEMENT){var s=e;e=mxUtils.importNode(i.document,t.value,!0),e.appendChild(s);var n=s.getAttribute("id");e.setAttribute("id",n),s.removeAttribute("id")}return e}beforeDecode(i,t,e){var s=t.cloneNode(!0),n=this.getName();if(t.nodeName!=n){var l=t.getElementsByTagName(n)[0];l!=null&&l.parentNode==t?(mxUtils.removeWhitespace(l,!0),mxUtils.removeWhitespace(l,!1),l.parentNode.removeChild(l),s=l):s=null,e.value=t.cloneNode(!0);var r=e.value.getAttribute("id");r!=null&&(e.setId(r),e.value.removeAttribute("id"))}else e.setId(t.getAttribute("id"));if(s!=null)for(var a=0;a<this.idrefs.length;a++){var o=this.idrefs[a],h=s.getAttribute(o);if(h!=null){s.removeAttribute(o);var d=i.objects[h]||i.lookup(h);if(d==null){var g=i.getElementById(h);if(g!=null){var m=mxCodecRegistry.codecs[g.nodeName]||this;d=m.decode(i,g)}}e[o]=d}}return s}}class mxKeyHandler{constructor(i,t){u(this,"graph",null);u(this,"target",null);u(this,"normalKeys",null);u(this,"shiftKeys",null);u(this,"controlKeys",null);u(this,"controlShiftKeys",null);u(this,"enabled",!0);i!=null&&(this.graph=i,this.target=t||document.documentElement,this.normalKeys=[],this.shiftKeys=[],this.controlKeys=[],this.controlShiftKeys=[],this.keydownHandler=e=>{this.keyDown(e)},mxEvent.addListener(this.target,"keydown",this.keydownHandler))}isEnabled(){return this.enabled}setEnabled(i){this.enabled=i}bindKey(i,t){this.normalKeys[i]=t}bindShiftKey(i,t){this.shiftKeys[i]=t}bindControlKey(i,t){this.controlKeys[i]=t}bindControlShiftKey(i,t){this.controlShiftKeys[i]=t}isControlDown(i){return mxEvent.isControlDown(i)}getFunction(i){return i!=null&&!mxEvent.isAltDown(i)?this.isControlDown(i)?mxEvent.isShiftDown(i)?this.controlShiftKeys[i.keyCode]:this.controlKeys[i.keyCode]:mxEvent.isShiftDown(i)?this.shiftKeys[i.keyCode]:this.normalKeys[i.keyCode]:null}isGraphEvent(i){var t=mxEvent.getSource(i);return t==this.target||t.parentNode==this.target||this.graph.cellEditor!=null&&this.graph.cellEditor.isEventSource(i)?!0:mxUtils.isAncestorNode(this.graph.container,t)}keyDown(i){if(this.isEnabledForEvent(i)){if(i.keyCode==27)this.escape(i);else if(!this.isEventIgnored(i)){var t=this.getFunction(i);t!=null&&(t(i),mxEvent.consume(i))}}}isEnabledForEvent(i){return this.graph.isEnabled()&&!mxEvent.isConsumed(i)&&this.isGraphEvent(i)&&this.isEnabled()}isEventIgnored(i){return this.graph.isEditing()}escape(i){this.graph.isEscapeEnabled()&&this.graph.escape(i)}destroy(){this.target!=null&&this.keydownHandler!=null&&(mxEvent.removeListener(this.target,"keydown",this.keydownHandler),this.keydownHandler=null),this.target=null}}class mxDefaultKeyHandler{constructor(i){u(this,"editor",null);u(this,"handler",null);if(i!=null){this.editor=i,this.handler=new mxKeyHandler(i.graph);var t=this.handler.escape;this.handler.escape=function(e){t.apply(this,arguments),i.hideProperties(),i.fireEvent(new mxEventObject(mxEvent.ESCAPE,"event",e))}}}bindAction(i,t,e){var s=()=>{this.editor.execute(t)};e?this.handler.bindControlKey(i,s):this.handler.bindKey(i,s)}destroy(){this.handler.destroy(),this.handler=null}}class mxDefaultKeyHandlerCodec extends mxObjectCodec{constructor(){super(new mxDefaultKeyHandler)}encode(i,t){return null}decode(i,t,e){if(e!=null)for(e.editor,t=t.firstChild;t!=null;){if(!this.processInclude(i,t,e)&&t.nodeName=="add"){var s=t.getAttribute("as"),n=t.getAttribute("action"),l=t.getAttribute("control");e.bindAction(s,n,l)}t=t.nextSibling}return e}}class mxDefaultPopupMenu{constructor(i){u(this,"imageBasePath",null);this.config=i}createMenu(i,t,e,s){if(this.config!=null){var n=this.createConditions(i,e,s),l=this.config.firstChild;this.addItems(i,t,e,s,n,l,null)}}addItems(i,t,e,s,n,l,r){for(var a=!1;l!=null;){if(l.nodeName=="add"){var o=l.getAttribute("if");if(o==null||n[o]){var h=l.getAttribute("as");h=mxResources.get(h)||h;var d=mxUtils.eval(mxUtils.getTextContent(l)),g=l.getAttribute("action"),m=l.getAttribute("icon"),f=l.getAttribute("iconCls"),c=l.getAttribute("enabled-if"),x=c==null||n[c];a&&(t.addSeparator(r),a=!1),m!=null&&this.imageBasePath&&(m=this.imageBasePath+m);var p=this.addAction(t,i,h,m,d,g,e,r,f,x);this.addItems(i,t,e,s,n,l.firstChild,p)}}else l.nodeName=="separator"&&(a=!0);l=l.nextSibling}}addAction(i,t,e,s,n,l,r,a,o,h){var d=function(g){typeof n=="function"&&n.call(t,t,r,g),l!=null&&t.execute(l,r,g)};return i.addItem(e,s,d,a,o,h)}createConditions(i,t,e){var s=i.graph.getModel(),n=s.getChildCount(t),l=[];l.nocell=t==null,l.ncells=i.graph.getSelectionCount()>1,l.notRoot=s.getRoot()!=s.getParent(i.graph.getDefaultParent()),l.cell=t!=null;var r=t!=null&&i.graph.getSelectionCount()==1;l.nonEmpty=r&&n>0,l.expandable=r&&i.graph.isCellFoldable(t,!1),l.collapsable=r&&i.graph.isCellFoldable(t,!0),l.validRoot=r&&i.graph.isValidRoot(t),l.emptyValidRoot=l.validRoot&&n==0,l.swimlane=r&&i.graph.isSwimlane(t);for(var a=this.config.getElementsByTagName("condition"),o=0;o<a.length;o++){var h=mxUtils.eval(mxUtils.getTextContent(a[o])),d=a[o].getAttribute("name");d!=null&&typeof h=="function"&&(l[d]=h(i,t,e))}return l}}class mxDefaultPopupMenuCodec extends mxObjectCodec{constructor(){super(new mxDefaultPopupMenu)}encode(i,t){return null}decode(i,t,e){var s=t.getElementsByTagName("include")[0];return s!=null?this.processInclude(i,s,e):e!=null&&(e.config=t),e}}class mxPopupMenu extends mxEventSource{constructor(t){super();u(this,"submenuImage",mxClient.imageBasePath+"/submenu.gif");u(this,"zIndex",10006);u(this,"useLeftButtonForPopup",!1);u(this,"enabled",!0);u(this,"itemCount",0);u(this,"autoExpand",!1);u(this,"smartSeparators",!1);u(this,"labels",!0);this.factoryMethod=t,t!=null&&this.init()}init(){this.table=document.createElement("table"),this.table.className="mxPopupMenu",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.div=document.createElement("div"),this.div.className="mxPopupMenu",this.div.style.display="inline",this.div.style.zIndex=this.zIndex,this.div.appendChild(this.table),mxEvent.disableContextMenu(this.div)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isPopupTrigger(t){return t.isPopupTrigger()||this.useLeftButtonForPopup&&mxEvent.isLeftMouseButton(t.getEvent())}addItem(t,e,s,n,l,r,a,o){n=n||this,this.itemCount++,n.willAddSeparator&&(n.containsItems&&this.addSeparator(n,!0),n.willAddSeparator=!1),n.containsItems=!0;var h=document.createElement("tr");h.className="mxPopupMenuItem";var d=document.createElement("td");if(d.className="mxPopupMenuIcon",e!=null){var g=document.createElement("img");g.src=e,d.appendChild(g)}else if(l!=null){var m=document.createElement("div");m.className=l,d.appendChild(m)}if(h.appendChild(d),this.labels){var f=document.createElement("td");f.className="mxPopupMenuItem"+(r!=null&&!r?" mxDisabled":""),mxUtils.write(f,t),f.align="left",h.appendChild(f);var c=document.createElement("td");c.className="mxPopupMenuItem"+(r!=null&&!r?" mxDisabled":""),c.style.paddingRight="6px",c.style.textAlign="right",h.appendChild(c),n.div==null&&this.createSubmenu(n)}if(n.tbody.appendChild(h),a!=!1&&r!=!1){var x=null;mxEvent.addGestureListeners(h,p=>{this.eventReceiver=h,n.activeRow!=h&&n.activeRow!=n&&(n.activeRow!=null&&n.activeRow.div.parentNode!=null&&this.hideSubmenu(n),h.div!=null&&(this.showSubmenu(n,h),n.activeRow=h)),document.selection!=null&&(mxClient.IS_QUIRKS||document.documentMode==8)&&(x=document.selection.createRange()),mxEvent.consume(p)},p=>{n.activeRow!=h&&n.activeRow!=n&&(n.activeRow!=null&&n.activeRow.div.parentNode!=null&&this.hideSubmenu(n),this.autoExpand&&h.div!=null&&(this.showSubmenu(n,h),n.activeRow=h)),o||(h.className="mxPopupMenuItemHover")},p=>{if(this.eventReceiver==h){if(n.activeRow!=h&&this.hideMenu(),x!=null){try{x.select()}catch{}x=null}s!=null&&s(p)}this.eventReceiver=null,mxEvent.consume(p)}),o||mxEvent.addListener(h,"mouseout",p=>{h.className="mxPopupMenuItem"})}return h}addCheckmark(t,e){var s=t.firstChild.nextSibling;s.style.backgroundImage="url('"+e+"')",s.style.backgroundRepeat="no-repeat",s.style.backgroundPosition="2px 50%"}createSubmenu(t){t.table=document.createElement("table"),t.table.className="mxPopupMenu",t.tbody=document.createElement("tbody"),t.table.appendChild(t.tbody),t.div=document.createElement("div"),t.div.className="mxPopupMenu",t.div.style.position="absolute",t.div.style.display="inline",t.div.style.zIndex=this.zIndex,t.div.appendChild(t.table);var e=document.createElement("img");e.setAttribute("src",this.submenuImage);var s=t.firstChild.nextSibling.nextSibling;s.appendChild(e)}showSubmenu(t,e){if(e.div!=null){e.div.style.left=t.div.offsetLeft+e.offsetLeft+e.offsetWidth-1+"px",e.div.style.top=t.div.offsetTop+e.offsetTop+"px",document.body.appendChild(e.div);var s=parseInt(e.div.offsetLeft),n=parseInt(e.div.offsetWidth),l=mxUtils.getDocumentScrollOrigin(document),r=document.body,a=document.documentElement,o=l.x+(r.clientWidth||a.clientWidth);s+n>o&&(e.div.style.left=Math.max(0,t.div.offsetLeft-n+-6)+"px"),mxUtils.fit(e.div)}}addSeparator(t,e){if(t=t||this,this.smartSeparators&&!e)t.willAddSeparator=!0;else if(t.tbody!=null){t.willAddSeparator=!1;var s=document.createElement("tr"),n=document.createElement("td");n.className="mxPopupMenuIcon",n.style.padding="0 0 0 0px",s.appendChild(n);var l=document.createElement("td");l.style.padding="0 0 0 0px",l.setAttribute("colSpan","2");var r=document.createElement("hr");r.setAttribute("size","1"),l.appendChild(r),s.appendChild(l),t.tbody.appendChild(s)}}popup(t,e,s,n){if(this.div!=null&&this.tbody!=null&&this.factoryMethod!=null){for(this.div.style.left=t+"px",this.div.style.top=e+"px";this.tbody.firstChild!=null;)mxEvent.release(this.tbody.firstChild),this.tbody.removeChild(this.tbody.firstChild);this.itemCount=0,this.factoryMethod(this,s,n),this.itemCount>0&&(this.showMenu(),this.fireEvent(new mxEventObject(mxEvent.SHOW)))}}isMenuShowing(){return this.div!=null&&this.div.parentNode==document.body}showMenu(){document.documentMode>=9&&(this.div.style.filter="none"),document.body.appendChild(this.div),mxUtils.fit(this.div)}hideMenu(){this.div!=null&&(this.div.parentNode!=null&&this.div.parentNode.removeChild(this.div),this.hideSubmenu(this),this.containsItems=!1,this.fireEvent(new mxEventObject(mxEvent.HIDE)))}hideSubmenu(t){t.activeRow!=null&&(this.hideSubmenu(t.activeRow),t.activeRow.div.parentNode!=null&&t.activeRow.div.parentNode.removeChild(t.activeRow.div),t.activeRow=null)}destroy(){this.div!=null&&(mxEvent.release(this.div),this.div.parentNode!=null&&this.div.parentNode.removeChild(this.div),this.div=null)}}class mxToolbar extends mxEventSource{constructor(t){super();u(this,"enabled",!0);u(this,"noReset",!1);u(this,"updateDefaultMode",!0);this.container=t}addItem(t,e,s,n,l,r){var a=document.createElement(e!=null?"img":"button"),o=l||(r!=null?"mxToolbarMode":"mxToolbarItem");a.className=o,a.setAttribute("src",e),t!=null&&(e!=null?a.setAttribute("title",t):mxUtils.write(a,t)),this.container.appendChild(a),s!=null&&(mxEvent.addListener(a,"click",s),mxClient.IS_TOUCH&&mxEvent.addListener(a,"touchend",s));var h=d=>{n!=null?a.setAttribute("src",e):a.style.backgroundColor=""};return mxEvent.addGestureListeners(a,d=>{if(n!=null?a.setAttribute("src",n):a.style.backgroundColor="gray",r!=null){this.menu==null&&(this.menu=new mxPopupMenu,this.menu.init());var g=this.currentImg;if(this.menu.isMenuShowing()&&this.menu.hideMenu(),g!=a){this.currentImg=a,this.menu.factoryMethod=r;var m=new mxPoint(a.offsetLeft,a.offsetTop+a.offsetHeight);this.menu.popup(m.x,m.y,null,d),this.menu.isMenuShowing()&&(a.className=o+"Selected",this.menu.hideMenu=function(){mxPopupMenu.prototype.hideMenu.apply(this),a.className=o,this.currentImg=null})}}},null,h),mxEvent.addListener(a,"mouseout",h),a}addCombo(t){var e=document.createElement("div");e.style.display="inline",e.className="mxToolbarComboContainer";var s=document.createElement("select");return s.className=t||"mxToolbarCombo",e.appendChild(s),this.container.appendChild(e),s}addActionCombo(t,e){var s=document.createElement("select");return s.className=e||"mxToolbarCombo",this.addOption(s,t,null),mxEvent.addListener(s,"change",function(n){var l=s.options[s.selectedIndex];s.selectedIndex=0,l.funct!=null&&l.funct(n)}),this.container.appendChild(s),s}addOption(t,e,s){var n=document.createElement("option");return mxUtils.writeln(n,e),typeof s=="function"?n.funct=s:n.setAttribute("value",s),t.appendChild(n),n}addSwitchMode(t,e,s,n,l){var r=document.createElement("img");return r.initialClassName=l||"mxToolbarMode",r.className=r.initialClassName,r.setAttribute("src",e),r.altIcon=n,t!=null&&r.setAttribute("title",t),mxEvent.addListener(r,"click",a=>{var o=this.selectedMode.altIcon;o!=null?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",o)):this.selectedMode.className=this.selectedMode.initialClassName,this.updateDefaultMode&&(this.defaultMode=r),this.selectedMode=r;var o=r.altIcon;o!=null?(r.altIcon=r.getAttribute("src"),r.setAttribute("src",o)):r.className=r.initialClassName+"Selected",this.fireEvent(new mxEventObject(mxEvent.SELECT)),s()}),this.container.appendChild(r),this.defaultMode==null&&(this.defaultMode=r,this.selectMode(r),s()),r}addMode(t,e,s,n,l,r){r=r??!0;var a=document.createElement(e!=null?"img":"button");return a.initialClassName=l||"mxToolbarMode",a.className=a.initialClassName,a.setAttribute("src",e),a.altIcon=n,t!=null&&a.setAttribute("title",t),this.enabled&&r&&(mxEvent.addListener(a,"click",o=>{this.selectMode(a,s),this.noReset=!1}),mxEvent.addListener(a,"dblclick",o=>{this.selectMode(a,s),this.noReset=!0}),this.defaultMode==null&&(this.defaultMode=a,this.defaultFunction=s,this.selectMode(a,s))),this.container.appendChild(a),a}selectMode(t,e){if(this.selectedMode!=t){if(this.selectedMode!=null){var s=this.selectedMode.altIcon;s!=null?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",s)):this.selectedMode.className=this.selectedMode.initialClassName}this.selectedMode=t;var s=this.selectedMode.altIcon;s!=null?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",s)):this.selectedMode.className=this.selectedMode.initialClassName+"Selected",this.fireEvent(new mxEventObject(mxEvent.SELECT,"function",e))}}resetMode(t){(t||!this.noReset)&&this.selectedMode!=this.defaultMode&&this.selectMode(this.defaultMode,this.defaultFunction)}addSeparator(t){return this.addItem(null,t,null)}addBreak(){mxUtils.br(this.container)}addLine(){var t=document.createElement("hr");t.style.marginRight="6px",t.setAttribute("size","1"),this.container.appendChild(t)}destroy(){mxEvent.release(this.container),this.container=null,this.defaultMode=null,this.defaultFunction=null,this.selectedMode=null,this.menu!=null&&this.menu.destroy()}}class mxDefaultToolbar{constructor(i,t){u(this,"toolbar",null);u(this,"resetHandler",null);u(this,"spacing",4);u(this,"connectOnDrop",!1);this.editor=t,i!=null&&t!=null&&this.init(i)}init(i){i!=null&&(this.toolbar=new mxToolbar(i),this.toolbar.addListener(mxEvent.SELECT,(t,e)=>{var s=e.getProperty("function");s!=null?this.editor.insertFunction=()=>{s.apply(this,arguments),this.toolbar.resetMode()}:this.editor.insertFunction=null}),this.resetHandler=()=>{this.toolbar!=null&&this.toolbar.resetMode(!0)},this.editor.graph.addListener(mxEvent.DOUBLE_CLICK,this.resetHandler),this.editor.addListener(mxEvent.ESCAPE,this.resetHandler))}addItem(i,t,e,s){var n=()=>{e!=null&&e.length>0&&this.editor.execute(e)};return this.toolbar.addItem(i,t,n,s)}addSeparator(i){i=i||mxClient.imageBasePath+"/separator.gif",this.toolbar.addSeparator(i)}addCombo(){return this.toolbar.addCombo()}addActionCombo(i){return this.toolbar.addActionCombo(i)}addActionOption(i,t,e){var s=()=>{this.editor.execute(e)};this.addOption(i,t,s)}addOption(i,t,e){return this.toolbar.addOption(i,t,e)}addMode(i,t,e,s,n){var l=()=>{this.editor.setMode(e),n!=null&&n(this.editor)};return this.toolbar.addSwitchMode(i,t,l,s)}addPrototype(i,t,e,s,n,l){var r=()=>typeof e=="function"?e():e!=null?this.editor.graph.cloneCell(e):null,a=(d,g)=>{if(typeof n=="function")n(this.editor,r(),d,g);else{let m=r();this.drop(m,d,g)}this.toolbar.resetMode(),mxEvent.consume(d)},o=this.toolbar.addMode(i,t,a,s,null,l),h=function(d,g,m){a(g,m)};return this.installDropHandler(o,h),o}drop(i,t,e){var s=this.editor.graph,n=s.getModel();if(e==null||n.isEdge(e)||!this.connectOnDrop||!s.isCellConnectable(e)){for(;e!=null&&!s.isValidDropTarget(e,[i],t);)e=n.getParent(e);this.insert(i,t,e)}else this.connect(i,t,e)}insert(i,t,e){var s=this.editor.graph;if(s.canImportCell(i)){var n=mxEvent.getClientX(t),l=mxEvent.getClientY(t),r=mxUtils.convertPoint(s.container,n,l);return s.isSplitEnabled()&&s.isSplitTarget(e,[i],t)?s.splitEdge(e,[i],null,r.x,r.y):this.editor.addVertex(e,i,r.x,r.y)}return null}connect(i,t,e){var s=this.editor.graph,n=s.getModel();if(e!=null&&s.isCellConnectable(i)&&s.isEdgeValid(null,e,i)){var l=null;n.beginUpdate();try{var r=n.getGeometry(e),a=n.getGeometry(i).clone();a.x=r.x+(r.width-a.width)/2,a.y=r.y+(r.height-a.height)/2;var o=this.spacing*s.gridSize,h=n.getDirectedEdgeCount(e,!0)*20;this.editor.horizontalFlow?a.x+=(a.width+r.width)/2+o+h:a.y+=(a.height+r.height)/2+o+h,i.setGeometry(a);var d=n.getParent(e);if(s.addCell(i,d),s.constrainChild(i),l=this.editor.createEdge(e,i),n.getGeometry(l)==null){var g=new mxGeometry;g.relative=!0,n.setGeometry(l,g)}s.addEdge(l,d,e,i)}finally{n.endUpdate()}s.setSelectionCells([i,l]),s.scrollCellToVisible(i)}}installDropHandler(i,t){var e=document.createElement("img");e.setAttribute("src",i.getAttribute("src"));var s=n=>{e.style.width=2*i.offsetWidth+"px",e.style.height=2*i.offsetHeight+"px",mxUtils.makeDraggable(i,this.editor.graph,t,e),mxEvent.removeListener(e,"load",s)};mxEvent.addListener(e,"load",s)}destroy(){this.resetHandler!=null&&(this.editor.graph.removeListener("dblclick",this.resetHandler),this.editor.removeListener("escape",this.resetHandler),this.resetHandler=null),this.toolbar!=null&&(this.toolbar.destroy(),this.toolbar=null)}}const Tt=class Tt extends mxObjectCodec{constructor(){super(new mxDefaultToolbar)}encode(i,t){return null}decode(i,t,e){if(e!=null){var s=e.editor;for(t=t.firstChild;t!=null;){if(t.nodeType==mxConstants.NODETYPE_ELEMENT&&!this.processInclude(i,t,e)){if(t.nodeName=="separator")e.addSeparator();else if(t.nodeName=="br")e.toolbar.addBreak();else if(t.nodeName=="hr")e.toolbar.addLine();else if(t.nodeName=="add"){var n=t.getAttribute("as");n=mxResources.get(n)||n;var l=t.getAttribute("icon"),r=t.getAttribute("pressedIcon"),a=t.getAttribute("action"),o=t.getAttribute("mode"),h=t.getAttribute("template"),d=t.getAttribute("toggle")!="0",g=mxUtils.getTextContent(t),m=null;if(a!=null)m=e.addItem(n,l,a,r);else if(o!=null){var f=Tt.allowEval?mxUtils.eval(g):null;m=e.addMode(n,l,o,r,f)}else if(h!=null||g!=null&&g.length>0){var c=s.templates[h],x=t.getAttribute("style");c!=null&&x!=null&&(c=s.graph.cloneCell(c),c.setStyle(x));var p=null;g!=null&&g.length>0&&Tt.allowEval&&(p=mxUtils.eval(g)),m=e.addPrototype(n,l,c,r,p,d)}else{var C=mxUtils.getChildNodes(t);if(C.length>0)if(l==null)for(var E=e.addActionCombo(n),T=0;T<C.length;T++){var S=C[T];if(S.nodeName=="separator")e.addOption(E,"---");else if(S.nodeName=="add"){var y=S.getAttribute("as"),b=S.getAttribute("action");e.addActionOption(E,y,b)}}else{var w=null,I=function(){var R=s.templates[w.value];if(R!=null){var D=R.clone(),A=w.options[w.selectedIndex].cellStyle;return A!=null&&D.setStyle(A),D}else mxLog.warn("Template "+R+" not found");return null},O=e.addPrototype(n,l,I,null,null,d);w=e.addCombo(),mxEvent.addListener(w,"change",function(){e.toolbar.selectMode(O,function(R){var D=mxUtils.convertPoint(s.graph.container,mxEvent.getClientX(R),mxEvent.getClientY(R));return s.addVertex(null,f(),D.x,D.y)}),e.toolbar.noReset=!1});for(var T=0;T<C.length;T++){var S=C[T];if(S.nodeName=="separator")e.addOption(w,"---");else if(S.nodeName=="add"){var y=S.getAttribute("as"),P=S.getAttribute("template"),M=e.addOption(w,y,P||h);M.cellStyle=S.getAttribute("style")}}}}if(m!=null){var H=t.getAttribute("id");H!=null&&H.length>0&&m.setAttribute("id",H)}}}t=t.nextSibling}}return e}};u(Tt,"allowEval",!0);let mxDefaultToolbarCodec=Tt;class mxConnectionConstraint{constructor(i,t,e,s,n){this.point=i,this.perimeter=t??!0,this.name=e,this.dx=s||0,this.dy=n||0}}class mxCellState extends mxRectangle{constructor(t,e,s){super();u(this,"invalidStyle",!1);u(this,"invalid",!0);u(this,"absolutePoints",null);u(this,"visibleSourceState",null);u(this,"visibleTargetState",null);u(this,"terminalDistance",0);u(this,"length",0);u(this,"segments",null);u(this,"shape",null);u(this,"text",null);u(this,"unscaledWidth",null);u(this,"unscaledHeight",null);this.view=t,this.cell=e,this.style=s??{},this.origin=new mxPoint,this.absoluteOffset=new mxPoint}getPerimeterBounds(t,e){if(t=t||0,e=e??new mxRectangle(this.x,this.y,this.width,this.height),this.shape!=null&&this.shape.stencil!=null&&this.shape.stencil.aspect=="fixed"){var s=this.shape.stencil.computeAspect(this.style,e.x,e.y,e.width,e.height);e.x=s.x,e.y=s.y,e.width=this.shape.stencil.w0*s.width,e.height=this.shape.stencil.h0*s.height}return t!=0&&e.grow(t),e}setAbsoluteTerminalPoint(t,e){e?(this.absolutePoints==null&&(this.absolutePoints=[]),this.absolutePoints.length==0?this.absolutePoints.push(t):this.absolutePoints[0]=t):this.absolutePoints==null?(this.absolutePoints=[],this.absolutePoints.push(null),this.absolutePoints.push(t)):this.absolutePoints.length==1?this.absolutePoints.push(t):this.absolutePoints[this.absolutePoints.length-1]=t}setCursor(t){this.shape!=null&&this.shape.setCursor(t),this.text!=null&&this.text.setCursor(t)}getVisibleTerminal(t){var e=this.getVisibleTerminalState(t);return e!=null?e.cell:null}getVisibleTerminalState(t){return t?this.visibleSourceState:this.visibleTargetState}setVisibleTerminalState(t,e){e?this.visibleSourceState=t:this.visibleTargetState=t}getCellBounds(){return this.cellBounds}getPaintBounds(){return this.paintBounds}updateCachedBounds(){var t=this.view.translate,e=this.view.scale;this.cellBounds=new mxRectangle(this.x/e-t.x,this.y/e-t.y,this.width/e,this.height/e),this.paintBounds=mxRectangle.fromRectangle(this.cellBounds),this.shape!=null&&this.shape.isPaintBoundsInverted()&&this.paintBounds.rotate90()}setState(t){this.view=t.view,this.cell=t.cell,this.style=t.style,this.absolutePoints=t.absolutePoints,this.origin=t.origin,this.absoluteOffset=t.absoluteOffset,this.boundingBox=t.boundingBox,this.terminalDistance=t.terminalDistance,this.segments=t.segments,this.length=t.length,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.unscaledWidth=t.unscaledWidth,this.unscaledHeight=t.unscaledHeight}clone(){var t=new mxCellState(this.view,this.cell,this.style);if(this.absolutePoints!=null){t.absolutePoints=[];for(var e=0;e<this.absolutePoints.length;e++)t.absolutePoints[e]=this.absolutePoints[e].clone()}return this.origin!=null&&(t.origin=this.origin.clone()),this.absoluteOffset!=null&&(t.absoluteOffset=this.absoluteOffset.clone()),this.boundingBox!=null&&(t.boundingBox=this.boundingBox.clone()),t.terminalDistance=this.terminalDistance,t.segments=this.segments,t.length=this.length,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t.unscaledWidth=this.unscaledWidth,t.unscaledHeight=this.unscaledHeight,t}destroy(){this.view.graph.cellRenderer.destroy(this)}}const N=class N{static EntityRelation(i,t,e,s,n){var l=i.view,r=l.graph,a=mxUtils.getValue(i.style,mxConstants.STYLE_SEGMENT,mxConstants.ENTITY_SEGMENT)*l.scale,o=i.absolutePoints,h=o[0],d=o[o.length-1],g=!1;if(h!=null)t=new mxCellState,t.x=h.x,t.y=h.y;else if(t!=null){var m=mxUtils.getPortConstraints(t,i,!0,mxConstants.DIRECTION_MASK_NONE);if(m!=mxConstants.DIRECTION_MASK_NONE&&m!=mxConstants.DIRECTION_MASK_WEST+mxConstants.DIRECTION_MASK_EAST)g=m==mxConstants.DIRECTION_MASK_WEST;else{var f=r.getCellGeometry(t.cell);f.relative?g=f.x<=.5:e!=null&&(g=e.x+e.width<t.x)}}else return;var c=!0;if(d!=null)e=new mxCellState,e.x=d.x,e.y=d.y;else if(e!=null){var m=mxUtils.getPortConstraints(e,i,!1,mxConstants.DIRECTION_MASK_NONE);if(m!=mxConstants.DIRECTION_MASK_NONE&&m!=mxConstants.DIRECTION_MASK_WEST+mxConstants.DIRECTION_MASK_EAST)c=m==mxConstants.DIRECTION_MASK_WEST;else{var x=r.getCellGeometry(e.cell);x.relative?c=x.x<=.5:t!=null&&(c=t.x+t.width<e.x)}}if(t!=null&&e!=null){var p=g?t.x:t.x+t.width,C=l.getRoutingCenterY(t),E=c?e.x:e.x+e.width,T=l.getRoutingCenterY(e),S=a,y=g?-S:S,b=new mxPoint(p+y,C);y=c?-S:S;var w=new mxPoint(E+y,T);if(g==c){var I=g?Math.min(p,E)-a:Math.max(p,E)+a;n.push(new mxPoint(I,C)),n.push(new mxPoint(I,T))}else if(b.x<w.x==g){var O=C+(T-C)/2;n.push(b),n.push(new mxPoint(b.x,O)),n.push(new mxPoint(w.x,O)),n.push(w)}else n.push(b),n.push(w)}}static Loop(i,t,e,s,n){var l=i.absolutePoints,r=l[0],a=l[l.length-1];if(r!=null&&a!=null){if(s!=null&&s.length>0)for(var o=0;o<s.length;o++){var h=s[o];h=i.view.transformControlPoint(i,h),n.push(new mxPoint(h.x,h.y))}return}if(t!=null){var d=i.view,g=d.graph,h=s!=null&&s.length>0?s[0]:null;h!=null&&(h=d.transformControlPoint(i,h),mxUtils.contains(t,h.x,h.y)&&(h=null));var m=0,f=0,c=0,x=0,p=mxUtils.getValue(i.style,mxConstants.STYLE_SEGMENT,g.gridSize)*d.scale,C=mxUtils.getValue(i.style,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_WEST);C==mxConstants.DIRECTION_NORTH||C==mxConstants.DIRECTION_SOUTH?(m=d.getRoutingCenterX(t),f=p):(c=d.getRoutingCenterY(t),x=p),h==null||h.x<t.x||h.x>t.x+t.width?h!=null?(m=h.x,x=Math.max(Math.abs(c-h.y),x)):C==mxConstants.DIRECTION_NORTH?c=t.y-2*f:C==mxConstants.DIRECTION_SOUTH?c=t.y+t.height+2*f:C==mxConstants.DIRECTION_EAST?m=t.x-2*x:m=t.x+t.width+2*x:h!=null&&(m=d.getRoutingCenterX(t),f=Math.max(Math.abs(m-h.x),x),c=h.y,x=0),n.push(new mxPoint(m-f,c-x)),n.push(new mxPoint(m+f,c+x))}}static ElbowConnector(i,t,e,s,n){var l=s!=null&&s.length>0?s[0]:null,r=!1,a=!1;if(t!=null&&e!=null)if(l!=null){var o=Math.min(t.x,e.x),h=Math.max(t.x+t.width,e.x+e.width),d=Math.min(t.y,e.y),g=Math.max(t.y+t.height,e.y+e.height);l=i.view.transformControlPoint(i,l),r=l.y<d||l.y>g,a=l.x<o||l.x>h}else{var o=Math.max(t.x,e.x),h=Math.min(t.x+t.width,e.x+e.width);if(r=o==h,!r){var d=Math.max(t.y,e.y),g=Math.min(t.y+t.height,e.y+e.height);a=d==g}}!a&&(r||i.style[mxConstants.STYLE_ELBOW]==mxConstants.ELBOW_VERTICAL)?N.TopToBottom(i,t,e,s,n):N.SideToSide(i,t,e,s,n)}static SideToSide(i,t,e,s,n){var l=i.view,r=s!=null&&s.length>0?s[0]:null,a=i.absolutePoints,o=a[0],h=a[a.length-1];if(r!=null&&(r=l.transformControlPoint(i,r)),o!=null&&(t=new mxCellState,t.x=o.x,t.y=o.y),h!=null&&(e=new mxCellState,e.x=h.x,e.y=h.y),t!=null&&e!=null){var d=Math.max(t.x,e.x),g=Math.min(t.x+t.width,e.x+e.width),m=r!=null?r.x:Math.round(g+(d-g)/2),f=l.getRoutingCenterY(t),c=l.getRoutingCenterY(e);if(r!=null&&(r.y>=t.y&&r.y<=t.y+t.height&&(f=r.y),r.y>=e.y&&r.y<=e.y+e.height&&(c=r.y)),!mxUtils.contains(e,m,f)&&!mxUtils.contains(t,m,f)&&n.push(new mxPoint(m,f)),!mxUtils.contains(e,m,c)&&!mxUtils.contains(t,m,c)&&n.push(new mxPoint(m,c)),n.length==1)if(r!=null)!mxUtils.contains(e,m,r.y)&&!mxUtils.contains(t,m,r.y)&&n.push(new mxPoint(m,r.y));else{var x=Math.max(t.y,e.y),p=Math.min(t.y+t.height,e.y+e.height);n.push(new mxPoint(m,x+(p-x)/2))}}}static TopToBottom(i,t,e,s,n){var l=i.view,r=s!=null&&s.length>0?s[0]:null,a=i.absolutePoints,o=a[0],h=a[a.length-1];if(r!=null&&(r=l.transformControlPoint(i,r)),o!=null&&(t=new mxCellState,t.x=o.x,t.y=o.y),h!=null&&(e=new mxCellState,e.x=h.x,e.y=h.y),t!=null&&e!=null){var d=Math.max(t.y,e.y),g=Math.min(t.y+t.height,e.y+e.height),m=l.getRoutingCenterX(t);r!=null&&r.x>=t.x&&r.x<=t.x+t.width&&(m=r.x);var f=r!=null?r.y:Math.round(g+(d-g)/2);if(!mxUtils.contains(e,m,f)&&!mxUtils.contains(t,m,f)&&n.push(new mxPoint(m,f)),r!=null&&r.x>=e.x&&r.x<=e.x+e.width?m=r.x:m=l.getRoutingCenterX(e),!mxUtils.contains(e,m,f)&&!mxUtils.contains(t,m,f)&&n.push(new mxPoint(m,f)),n.length==1)if(r!=null&&n.length==1)!mxUtils.contains(e,r.x,f)&&!mxUtils.contains(t,r.x,f)&&n.push(new mxPoint(r.x,f));else{var c=Math.max(t.x,e.x),x=Math.min(t.x+t.width,e.x+e.width);n.push(new mxPoint(c+(x-c)/2,f))}}}static SegmentConnector(i,t,e,s,n){var l=N.scalePointArray(i.absolutePoints,i.view.scale),r=N.scaleCellState(t,i.view.scale),a=N.scaleCellState(e,i.view.scale),o=1,h=n.length>0?n[0]:null,d=!0,g=null;function m(H){return H.x=Math.round(H.x*i.view.scale*10)/10,H.y=Math.round(H.y*i.view.scale*10)/10,(h==null||Math.abs(h.x-H.x)>=o||Math.abs(h.y-H.y)>=Math.max(1,i.view.scale))&&(n.push(H),h=H),h}var f=l[0];f==null&&r!=null?f=new mxPoint(i.view.getRoutingCenterX(r),i.view.getRoutingCenterY(r)):f!=null&&(f=f.clone());var c=l.length-1;if(s!=null&&s.length>0){for(var x=[],p=0;p<s.length;p++){var C=i.view.transformControlPoint(i,s[p],!0);C!=null&&x.push(C)}if(x.length==0)return;f!=null&&x[0]!=null&&(Math.abs(x[0].x-f.x)<o&&(x[0].x=f.x),Math.abs(x[0].y-f.y)<o&&(x[0].y=f.y));var E=l[c];E!=null&&x[x.length-1]!=null&&(Math.abs(x[x.length-1].x-E.x)<o&&(x[x.length-1].x=E.x),Math.abs(x[x.length-1].y-E.y)<o&&(x[x.length-1].y=E.y)),g=x[0];var T=r,S=l[0],y=!1,b=!1,w=g;S!=null&&(T=null);for(var p=0;p<2;p++){var I=S!=null&&S.x==w.x,O=S!=null&&S.y==w.y,P=T!=null&&w.y>=T.y&&w.y<=T.y+T.height,M=T!=null&&w.x>=T.x&&w.x<=T.x+T.width;if(y=O||S==null&&P,b=I||S==null&&M,!(p==0&&(y&&b||I&&O))){if(S!=null&&!O&&!I&&(P||M)){d=!P;break}if(b||y){d=y,p==1&&(d=x.length%2==0?y:b);break}}T=a,S=l[c],S!=null&&(T=null),w=x[x.length-1],I&&O&&(x=x.slice(1))}d&&(l[0]!=null&&l[0].y!=g.y||l[0]==null&&r!=null&&(g.y<r.y||g.y>r.y+r.height))?m(new mxPoint(f.x,g.y)):!d&&(l[0]!=null&&l[0].x!=g.x||l[0]==null&&r!=null&&(g.x<r.x||g.x>r.x+r.width))&&m(new mxPoint(g.x,f.y)),d?f.y=g.y:f.x=g.x;for(var p=0;p<x.length;p++)d=!d,g=x[p],d?f.y=g.y:f.x=g.x,m(f.clone())}else g=f,d=!0;if(f=l[c],f==null&&a!=null&&(f=new mxPoint(i.view.getRoutingCenterX(a),i.view.getRoutingCenterY(a))),f!=null&&g!=null&&(d&&(l[c]!=null&&l[c].y!=g.y||l[c]==null&&a!=null&&(g.y<a.y||g.y>a.y+a.height))?m(new mxPoint(f.x,g.y)):!d&&(l[c]!=null&&l[c].x!=g.x||l[c]==null&&a!=null&&(g.x<a.x||g.x>a.x+a.width))&&m(new mxPoint(g.x,f.y))),l[0]==null&&r!=null)for(;n.length>1&&n[1]!=null&&mxUtils.contains(r,n[1].x,n[1].y);)n.splice(1,1);if(l[c]==null&&a!=null)for(;n.length>1&&n[n.length-1]!=null&&mxUtils.contains(a,n[n.length-1].x,n[n.length-1].y);)n.splice(n.length-1,1);E!=null&&n[n.length-1]!=null&&Math.abs(E.x-n[n.length-1].x)<=o&&Math.abs(E.y-n[n.length-1].y)<=o&&(n.splice(n.length-1,1),n[n.length-1]!=null&&(Math.abs(n[n.length-1].x-E.x)<o&&(n[n.length-1].x=E.x),Math.abs(n[n.length-1].y-E.y)<o&&(n[n.length-1].y=E.y)))}static getJettySize(i,t){var e=mxUtils.getValue(i.style,t?mxConstants.STYLE_SOURCE_JETTY_SIZE:mxConstants.STYLE_TARGET_JETTY_SIZE,mxUtils.getValue(i.style,mxConstants.STYLE_JETTY_SIZE,N.orthBuffer));if(e=="auto"){var s=mxUtils.getValue(i.style,t?mxConstants.STYLE_STARTARROW:mxConstants.STYLE_ENDARROW,mxConstants.NONE);if(s!=mxConstants.NONE){var n=mxUtils.getNumber(i.style,t?mxConstants.STYLE_STARTSIZE:mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE);e=Math.max(2,Math.ceil((n+N.orthBuffer)/N.orthBuffer))*N.orthBuffer}else e=2*N.orthBuffer}return e}static scalePointArray(i,t){var e=[];if(i!=null)for(var s=0;s<i.length;s++)if(i[s]!=null){var n=new mxPoint(Math.round(i[s].x/t*10)/10,Math.round(i[s].y/t*10)/10);e[s]=n}else e[s]=null;else e=null;return e}static scaleCellState(i,t){var e=null;return i!=null?(e=i.clone(),e.setRect(Math.round(i.x/t*10)/10,Math.round(i.y/t*10)/10,Math.round(i.width/t*10)/10,Math.round(i.height/t*10)/10)):e=null,e}static OrthConnector(i,t,e,s,n){var l=i.view.graph,r=h==null?!1:l.getModel().isEdge(h.cell),a=d==null?!1:l.getModel().isEdge(d.cell),o=N.scalePointArray(i.absolutePoints,i.view.scale),h=N.scaleCellState(t,i.view.scale),d=N.scaleCellState(e,i.view.scale),g=o[0],m=o[o.length-1],f=h!=null?h.x:g.x,c=h!=null?h.y:g.y,x=h!=null?h.width:0,p=h!=null?h.height:0,C=d!=null?d.x:m.x,E=d!=null?d.y:m.y,T=d!=null?d.width:0,S=d!=null?d.height:0,y=N.getJettySize(i,!0),b=N.getJettySize(i,!1);h!=null&&d==h&&(b=Math.max(y,b),y=b);var w=b+y,I=!1;if(g!=null&&m!=null){var j=m.x-g.x,V=m.y-g.y;I=j*j+V*V<w*w}if(I||N.orthPointsFallback&&s!=null&&s.length>0||r||a){N.SegmentConnector(i,t,e,s,n);return}var O=[mxConstants.DIRECTION_MASK_ALL,mxConstants.DIRECTION_MASK_ALL],P=0;if(h!=null&&(O[0]=mxUtils.getPortConstraints(h,i,!0,mxConstants.DIRECTION_MASK_ALL),P=mxUtils.getValue(h.style,mxConstants.STYLE_ROTATION,0),P!=0)){var M=mxUtils.getBoundingBox(new mxRectangle(f,c,x,p),P);f=M.x,c=M.y,x=M.width,p=M.height}if(d!=null&&(O[1]=mxUtils.getPortConstraints(d,i,!1,mxConstants.DIRECTION_MASK_ALL),P=mxUtils.getValue(d.style,mxConstants.STYLE_ROTATION,0),P!=0)){var M=mxUtils.getBoundingBox(new mxRectangle(C,E,T,S),P);C=M.x,E=M.y,T=M.width,S=M.height}for(var H=[0,0],R=[[f,c,x,p],[C,E,T,S]],D=[y,b],A=0;A<2;A++)N.limits[A][1]=R[A][0]-D[A],N.limits[A][2]=R[A][1]-D[A],N.limits[A][4]=R[A][0]+R[A][2]+D[A],N.limits[A][8]=R[A][1]+R[A][3]+D[A];var G=R[0][0]+R[0][2]/2,B=R[0][1]+R[0][3]/2,tt=R[1][0]+R[1][2]/2,q=R[1][1]+R[1][3]/2,j=G-tt,V=B-q,X=0;j<0?V<0?X=2:X=1:V<=0&&(X=3,j==0&&(X=2));var Z=null;h!=null&&(Z=g);for(var et=[[.5,.5],[.5,.5]],A=0;A<2;A++)Z!=null&&(et[A][0]=(Z.x-R[A][0])/R[A][2],Math.abs(Z.x-R[A][0])<=1?H[A]=mxConstants.DIRECTION_MASK_WEST:Math.abs(Z.x-R[A][0]-R[A][2])<=1&&(H[A]=mxConstants.DIRECTION_MASK_EAST),et[A][1]=(Z.y-R[A][1])/R[A][3],Math.abs(Z.y-R[A][1])<=1?H[A]=mxConstants.DIRECTION_MASK_NORTH:Math.abs(Z.y-R[A][1]-R[A][3])<=1&&(H[A]=mxConstants.DIRECTION_MASK_SOUTH)),Z=null,d!=null&&(Z=m);var nt=R[0][1]-(R[1][1]+R[1][3]),lt=R[0][0]-(R[1][0]+R[1][2]),it=R[1][1]-(R[0][1]+R[0][3]),Q=R[1][0]-(R[0][0]+R[0][2]);N.vertexSeperations[1]=Math.max(lt-w,0),N.vertexSeperations[2]=Math.max(nt-w,0),N.vertexSeperations[4]=Math.max(it-w,0),N.vertexSeperations[3]=Math.max(Q-w,0);var Y=[],z=[],W=[];z[0]=lt>=Q?mxConstants.DIRECTION_MASK_WEST:mxConstants.DIRECTION_MASK_EAST,W[0]=nt>=it?mxConstants.DIRECTION_MASK_NORTH:mxConstants.DIRECTION_MASK_SOUTH,z[1]=mxUtils.reversePortConstraints(z[0]),W[1]=mxUtils.reversePortConstraints(W[0]);for(var rt=lt>=Q?lt:Q,It=nt>=it?nt:it,F=[[0,0],[0,0]],ut=!1,A=0;A<2;A++)H[A]==0&&(z[A]&O[A]||(z[A]=mxUtils.reversePortConstraints(z[A])),W[A]&O[A]||(W[A]=mxUtils.reversePortConstraints(W[A])),F[A][0]=W[A],F[A][1]=z[A]);It>0&&rt>0&&((z[0]&O[0])>0&&(W[1]&O[1])>0?(F[0][0]=z[0],F[0][1]=W[0],F[1][0]=W[1],F[1][1]=z[1],ut=!0):(W[0]&O[0])>0&&(z[1]&O[1])>0&&(F[0][0]=W[0],F[0][1]=z[0],F[1][0]=z[1],F[1][1]=W[1],ut=!0)),It>0&&!ut&&(F[0][0]=W[0],F[0][1]=z[0],F[1][0]=W[1],F[1][1]=z[1],ut=!0),rt>0&&!ut&&(F[0][0]=z[0],F[0][1]=W[0],F[1][0]=z[1],F[1][1]=W[1],ut=!0);for(var A=0;A<2;A++)H[A]==0&&(F[A][0]&O[A]||(F[A][0]=F[A][1]),Y[A]=F[A][0]&O[A],Y[A]|=(F[A][1]&O[A])<<8,Y[A]|=(F[1-A][A]&O[A])<<16,Y[A]|=(F[1-A][1-A]&O[A])<<24,Y[A]&15||(Y[A]=Y[A]<<8),Y[A]&3840||(Y[A]=Y[A]&15|Y[A]>>8),Y[A]&983040||(Y[A]=Y[A]&65535|(Y[A]&251658240)>>8),H[A]=Y[A]&15,(O[A]==mxConstants.DIRECTION_MASK_WEST||O[A]==mxConstants.DIRECTION_MASK_NORTH||O[A]==mxConstants.DIRECTION_MASK_EAST||O[A]==mxConstants.DIRECTION_MASK_SOUTH)&&(H[A]=O[A]));var dt=H[0]==mxConstants.DIRECTION_MASK_EAST?3:H[0],gt=H[1]==mxConstants.DIRECTION_MASK_EAST?3:H[1];dt-=X,gt-=X,dt<1&&(dt+=4),gt<1&&(gt+=4);var st=N.routePatterns[dt-1][gt-1];switch(N.wayPoints1[0][0]=R[0][0],N.wayPoints1[0][1]=R[0][1],H[0]){case mxConstants.DIRECTION_MASK_WEST:N.wayPoints1[0][0]-=y,N.wayPoints1[0][1]+=et[0][1]*R[0][3];break;case mxConstants.DIRECTION_MASK_SOUTH:N.wayPoints1[0][0]+=et[0][0]*R[0][2],N.wayPoints1[0][1]+=R[0][3]+y;break;case mxConstants.DIRECTION_MASK_EAST:N.wayPoints1[0][0]+=R[0][2]+y,N.wayPoints1[0][1]+=et[0][1]*R[0][3];break;case mxConstants.DIRECTION_MASK_NORTH:N.wayPoints1[0][0]+=et[0][0]*R[0][2],N.wayPoints1[0][1]-=y;break}for(var K=0,wt=(H[0]&(mxConstants.DIRECTION_MASK_EAST|mxConstants.DIRECTION_MASK_WEST))>0?0:1,Rt=wt,ht=0,A=0;A<st.length;A++){var Ot=st[A]&15,vt=Ot==mxConstants.DIRECTION_MASK_EAST?3:Ot;vt+=X,vt>4&&(vt-=4);var Ct=N.dirVectors[vt-1];ht=vt%2>0?0:1,ht!=wt&&(K++,N.wayPoints1[K][0]=N.wayPoints1[K-1][0],N.wayPoints1[K][1]=N.wayPoints1[K-1][1]);var Ht=(st[A]&N.TARGET_MASK)>0,Pt=(st[A]&N.SOURCE_MASK)>0,ft=(st[A]&N.SIDE_MASK)>>5;ft=ft<<X,ft>15&&(ft=ft>>4);var Mt=(st[A]&N.CENTER_MASK)>0;if((Pt||Ht)&&ft<9){var bt=0,ct=Pt?0:1;if(Mt&&ht==0?bt=R[ct][0]+et[ct][0]*R[ct][2]:Mt?bt=R[ct][1]+et[ct][1]*R[ct][3]:bt=N.limits[ct][ft],ht==0){var Dt=N.wayPoints1[K][0],Nt=(bt-Dt)*Ct[0];Nt>0&&(N.wayPoints1[K][0]+=Ct[0]*Nt)}else{var Ut=N.wayPoints1[K][1],_t=(bt-Ut)*Ct[1];_t>0&&(N.wayPoints1[K][1]+=Ct[1]*_t)}}else Mt&&(N.wayPoints1[K][0]+=Ct[0]*Math.abs(N.vertexSeperations[vt]/2),N.wayPoints1[K][1]+=Ct[1]*Math.abs(N.vertexSeperations[vt]/2));K>0&&N.wayPoints1[K][ht]==N.wayPoints1[K-1][ht]?K--:wt=ht}for(var A=0;A<=K;A++){if(A==K){var Gt=(H[1]&(mxConstants.DIRECTION_MASK_EAST|mxConstants.DIRECTION_MASK_WEST))>0?0:1,Vt=Gt==Rt?0:1;if(Vt!=(K+1)%2)break}n.push(new mxPoint(Math.round(N.wayPoints1[A][0]*i.view.scale*10)/10,Math.round(N.wayPoints1[A][1]*i.view.scale*10)/10))}for(var ot=1;ot<n.length;)n[ot-1]==null||n[ot]==null||n[ot-1].x!=n[ot].x||n[ot-1].y!=n[ot].y?ot++:n.splice(ot,1)}static getRoutePattern(i,t,e,s){var n=i[0]==mxConstants.DIRECTION_MASK_EAST?3:i[0],l=i[1]==mxConstants.DIRECTION_MASK_EAST?3:i[1];n-=t,l-=t,n<1&&(n+=4),l<1&&(l+=4);var r=N.routePatterns[n-1][l-1];return(e==0||s==0)&&N.inlineRoutePatterns[n-1][l-1]!=null&&(r=N.inlineRoutePatterns[n-1][l-1]),r}};u(N,"orthBuffer",10),u(N,"orthPointsFallback",!0),u(N,"dirVectors",[[-1,0],[0,-1],[1,0],[0,1],[-1,0],[0,-1],[1,0]]),u(N,"wayPoints1",[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]]),u(N,"routePatterns",[[[513,2308,2081,2562],[513,1090,514,2184,2114,2561],[513,1090,514,2564,2184,2562],[513,2308,2561,1090,514,2568,2308]],[[514,1057,513,2308,2081,2562],[514,2184,2114,2561],[514,2184,2562,1057,513,2564,2184],[514,1057,513,2568,2308,2561]],[[1090,514,1057,513,2308,2081,2562],[2114,2561],[1090,2562,1057,513,2564,2184],[1090,514,1057,513,2308,2561,2568]],[[2081,2562],[1057,513,1090,514,2184,2114,2561],[1057,513,1090,514,2184,2562,2564],[1057,2561,1090,514,2568,2308]]]),u(N,"inlineRoutePatterns",[[null,[2114,2568],null,null],[null,[514,2081,2114,2568],null,null],[null,[2114,2561],null,null],[[2081,2562],[1057,2114,2568],[2184,2562],null]]),u(N,"vertexSeperations",[]),u(N,"limits",[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]),u(N,"LEFT_MASK",32),u(N,"TOP_MASK",64),u(N,"RIGHT_MASK",128),u(N,"BOTTOM_MASK",256),u(N,"LEFT",1),u(N,"TOP",2),u(N,"RIGHT",4),u(N,"BOTTOM",8),u(N,"SIDE_MASK",480),u(N,"CENTER_MASK",512),u(N,"SOURCE_MASK",1024),u(N,"TARGET_MASK",2048),u(N,"VERTEX_MASK",3072);let mxEdgeStyle=N;class mxCellMarker extends mxEventSource{constructor(t,e,s,n){super();u(this,"graph",null);u(this,"enabled",!0);u(this,"hotspot",mxConstants.DEFAULT_HOTSPOT);u(this,"hotspotEnabled",!1);u(this,"validColor",null);u(this,"invalidColor",null);u(this,"currentColor",null);u(this,"validState",null);u(this,"markedState",null);t!=null&&(this.graph=t,this.validColor=e??mxConstants.DEFAULT_VALID_COLOR,this.invalidColor=s??mxConstants.DEFAULT_INVALID_COLOR,this.hotspot=n??mxConstants.DEFAULT_HOTSPOT,this.highlight=new mxCellHighlight(t))}setEnabled(t){this.enabled=t}isEnabled(){return this.enabled}setHotspot(t){this.hotspot=t}getHotspot(){return this.hotspot}setHotspotEnabled(t){this.hotspotEnabled=t}isHotspotEnabled(){return this.hotspotEnabled}hasValidState(){return this.validState!=null}getValidState(){return this.validState}getMarkedState(){return this.markedState}reset(){this.validState=null,this.markedState!=null&&(this.markedState=null,this.unmark())}process(t){var e=null;return this.isEnabled()&&(e=this.getState(t),this.setCurrentState(e,t)),e}setCurrentState(t,e,s){var n=t!=null?this.isValidState(t):!1;s=s??this.getMarkerColor(e.getEvent(),t,n),n?this.validState=t:this.validState=null,(t!=this.markedState||s!=this.currentColor)&&(this.currentColor=s,t!=null&&this.currentColor!=null?(this.markedState=t,this.mark()):this.markedState!=null&&(this.markedState=null,this.unmark()))}markCell(t,e){var s=this.graph.getView().getState(t);s!=null&&(this.currentColor=e??this.validColor,this.markedState=s,this.mark())}mark(){this.highlight.setHighlightColor(this.currentColor),this.highlight.highlight(this.markedState),this.fireEvent(new mxEventObject(mxEvent.MARK,"state",this.markedState))}unmark(){this.mark()}isValidState(t){return!0}getMarkerColor(t,e,s){return s?this.validColor:this.invalidColor}getState(t){var e=this.graph.getView(),s=this.getCell(t),n=this.getStateToMark(e.getState(s));return n!=null&&this.intersects(n,t)?n:null}getCell(t){return t.getCell()}getStateToMark(t){return t}intersects(t,e){return this.hotspotEnabled?mxUtils.intersectsHotspot(t,e.getGraphX(),e.getGraphY(),this.hotspot,mxConstants.MIN_HOTSPOT_SIZE,mxConstants.MAX_HOTSPOT_SIZE):!0}destroy(){this.graph.getView().removeListener(this.resetHandler),this.graph.getModel().removeListener(this.resetHandler),this.highlight.destroy()}}class EdgeCellMarker extends mxCellMarker{constructor(i,t){super(t),this.edgeHandler=i}getCell(i){var t=super.getCell(i);if((t==this.edgeHandler.state.cell||t==null)&&this.edgeHandler.currentPoint!=null&&(t=this.edgeHandler.graph.getCellAt(this.edgeHandler.currentPoint.x,this.edgeHandler.currentPoint.y)),t!=null&&!this.edgeHandler.graph.isCellConnectable(t)){var e=this.edgeHandler.graph.getModel().getParent(t);this.edgeHandler.graph.getModel().isVertex(e)&&this.edgeHandler.graph.isCellConnectable(e)&&(t=e)}var s=this.edgeHandler.graph.getModel();return(this.edgeHandler.graph.isSwimlane(t)&&this.edgeHandler.currentPoint!=null&&this.edgeHandler.graph.hitsSwimlaneContent(t,this.edgeHandler.currentPoint.x,this.edgeHandler.currentPoint.y)||!this.edgeHandler.isConnectableCell(t)||t==this.edgeHandler.state.cell||t!=null&&!this.edgeHandler.graph.connectableEdges&&s.isEdge(t)||s.isAncestor(this.edgeHandler.state.cell,t))&&(t=null),this.edgeHandler.graph.isCellConnectable(t)||(t=null),t}isValidState(i){var t=this.edgeHandler.graph.getModel(),e=this.edgeHandler.graph.view.getTerminalPort(i,this.edgeHandler.graph.view.getState(t.getTerminal(this.edgeHandler.state.cell,!this.edgeHandler.isSource)),!this.edgeHandler.isSource),s=e!=null?e.cell:null,n=this.edgeHandler.isSource?i.cell:s,l=this.edgeHandler.isSource?s:i.cell;return this.edgeHandler.error=this.edgeHandler.validateConnection(n,l),this.edgeHandler.error==null}}class mxGraphHandler{constructor(i){u(this,"enabled",!0);u(this,"highlightEnabled",!0);u(this,"cloneEnabled",!0);u(this,"moveEnabled",!0);u(this,"guide",null);u(this,"currentDx",null);u(this,"currentDy",null);u(this,"updateCursor",!0);u(this,"selectEnabled",!0);u(this,"connectOnDrop",!1);u(this,"scrollOnMove",!0);u(this,"minimumSize",6);u(this,"previewColor","black");u(this,"htmlPreview",!1);u(this,"shape",null);u(this,"scaleGrid",!1);u(this,"rotationEnabled",!0);u(this,"allowLivePreview",mxClient.IS_SVG);this.graph=i,this.graph.addMouseListener(this),this.panHandler=()=>{this.suspended||(this.updatePreview(),this.updateHint())},this.graph.addListener(mxEvent.PAN,this.panHandler),this.escapeHandler=(t,e)=>{this.reset()},this.graph.addListener(mxEvent.ESCAPE,this.escapeHandler),this.refreshHandler=(t,e)=>{window.setTimeout(()=>{if(this.first!=null&&!this.suspended){var s=this.currentDx,n=this.currentDy;this.currentDx=0,this.currentDy=0,this.updatePreview(),this.bounds=this.graph.getView().getBounds(this.cells),this.pBounds=this.getPreviewBounds(this.cells),this.pBounds==null?this.reset():(this.currentDx=s,this.currentDy=n,this.updatePreview(),this.updateHint(),this.livePreviewUsed&&this.setHandlesVisibleForCells(this.graph.selectionCellsHandler.getHandledSelectionCells(),!1))}},0)},this.graph.getModel().addListener(mxEvent.CHANGE,this.refreshHandler),this.keyHandler=t=>{if(this.graph.container!=null&&this.graph.container.style.visibility!="hidden"&&this.first!=null&&!this.suspended){var e=this.graph.isCloneEvent(t)&&this.graph.isCellsCloneable()&&this.isCloneEnabled();e!=this.cloning&&(this.cloning=e,this.checkPreview(),this.updatePreview())}},mxEvent.addListener(document,"keydown",this.keyHandler),mxEvent.addListener(document,"keyup",this.keyHandler)}isEnabled(){return this.enabled}setEnabled(i){this.enabled=i}isCloneEnabled(){return this.cloneEnabled}setCloneEnabled(i){this.cloneEnabled=i}isMoveEnabled(){return this.moveEnabled}setMoveEnabled(i){this.moveEnabled=i}isSelectEnabled(){return this.selectEnabled}setSelectEnabled(i){this.selectEnabled=i}isRemoveCellsFromParent(){return this.removeCellsFromParent}setRemoveCellsFromParent(i){this.removeCellsFromParent=i}isPropagateSelectionCell(i,t,e){var s=this.graph.model.getParent(i);if(t){var n=this.graph.getCellGeometry(i);return!this.graph.model.isEdge(i)&&!this.graph.model.isEdge(s)&&!this.graph.isSiblingSelected(i)&&(n==null||n.relative||!this.graph.isSwimlane(s))}else return(!this.graph.isToggleEvent(e.getEvent())||!this.graph.isSiblingSelected(i)&&!this.graph.isCellSelected(i)&&!this.graph.isSwimlane(s)||this.graph.isCellSelected(s))&&(this.graph.isToggleEvent(e.getEvent())||!this.graph.isCellSelected(s))}getInitialCellForEvent(i){var t=i.getState();if((!this.graph.isToggleEvent(i.getEvent())||!mxEvent.isAltDown(i.getEvent()))&&t!=null&&!this.graph.isCellSelected(t.cell))for(var e=this.graph.model,s=this.graph.view.getState(e.getParent(t.cell));s!=null&&!this.graph.isCellSelected(s.cell)&&(e.isVertex(s.cell)||e.isEdge(s.cell))&&this.isPropagateSelectionCell(t.cell,!0,i);)t=s,s=this.graph.view.getState(this.graph.getModel().getParent(t.cell));return t!=null?t.cell:null}isDelayedSelection(i,t){if(!this.graph.isToggleEvent(t.getEvent())||!mxEvent.isAltDown(t.getEvent()))for(;i!=null;){if(this.graph.selectionCellsHandler.isHandled(i))return this.graph.cellEditor.getEditingCell()!=i;i=this.graph.model.getParent(i)}return this.graph.isToggleEvent(t.getEvent())&&!mxEvent.isAltDown(t.getEvent())}selectDelayed(i){if(!this.graph.popupMenuHandler.isPopupTrigger(i)){var t=i.getCell();t==null&&(t=this.cell);var e=this.graph.view.getState(t);if(e!=null)if(i.isSource(e.control))this.graph.selectCellForEvent(t,i.getEvent());else{if(!this.graph.isToggleEvent(i.getEvent())||!mxEvent.isAltDown(i.getEvent()))for(var s=this.graph.getModel(),n=s.getParent(t);this.graph.view.getState(n)!=null&&(s.isVertex(n)||s.isEdge(n))&&this.isPropagateSelectionCell(t,!1,i);)t=n,n=s.getParent(t);this.graph.selectCellForEvent(t,i.getEvent())}}}consumeMouseEvent(i,t){t.consume()}mouseDown(i,t){if(!t.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&t.getState()!=null&&!mxEvent.isMultiTouchEvent(t.getEvent())){var e=this.getInitialCellForEvent(t);if(this.delayedSelection=this.isDelayedSelection(e,t),this.cell=null,this.isSelectEnabled()&&!this.delayedSelection&&this.graph.selectCellForEvent(e,t.getEvent()),this.isMoveEnabled()){var s=this.graph.model,n=s.getGeometry(e);this.graph.isCellMovable(e)&&(!s.isEdge(e)||this.graph.getSelectionCount()>1||n.points!=null&&n.points.length>0||s.getTerminal(e,!0)==null||s.getTerminal(e,!1)==null||this.graph.allowDanglingEdges||this.graph.isCloneEvent(t.getEvent())&&this.graph.isCellsCloneable())?this.start(e,t.getX(),t.getY()):this.delayedSelection&&(this.cell=e),this.cellWasClicked=!0,this.consumeMouseEvent(mxEvent.MOUSE_DOWN,t)}}}getGuideStates(){var i=this.graph.getDefaultParent(),t=this.graph.getModel(),e=s=>this.graph.view.getState(s)!=null&&t.isVertex(s)&&t.getGeometry(s)!=null&&!t.getGeometry(s).relative;return this.graph.view.getCellStates(t.filterDescendants(e,i))}getCells(i){return!this.delayedSelection&&this.graph.isCellMovable(i)?[i]:this.graph.getMovableCells(this.graph.getSelectionCells())}getPreviewBounds(i){var t=this.getBoundingBox(i);if(t!=null){if(t.width=Math.max(0,t.width-1),t.height=Math.max(0,t.height-1),t.width<this.minimumSize){var e=this.minimumSize-t.width;t.x-=e/2,t.width=this.minimumSize}else t.x=Math.round(t.x),t.width=Math.ceil(t.width);if(this.graph.view.translate,this.graph.view.scale,t.height<this.minimumSize){var s=this.minimumSize-t.height;t.y-=s/2,t.height=this.minimumSize}else t.y=Math.round(t.y),t.height=Math.ceil(t.height)}return t}getBoundingBox(i){var t=null;if(i!=null&&i.length>0){for(var e=this.graph.getModel(),s=0;s<i.length;s++)if(e.isVertex(i[s])||e.isEdge(i[s])){var n=this.graph.view.getState(i[s]);if(n!=null){var l=n;e.isVertex(i[s])&&n.shape!=null&&n.shape.boundingBox!=null&&(l=n.shape.boundingBox),t==null?t=mxRectangle.fromRectangle(l):t.add(l)}}}return t}createPreviewShape(i){var t=new mxRectangleShape(i,null,this.previewColor);return t.isDashed=!0,this.htmlPreview?(t.dialect=mxConstants.DIALECT_STRICTHTML,t.init(this.graph.container)):(t.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,t.init(this.graph.getView().getOverlayPane()),t.pointerEvents=!1,mxClient.IS_IOS&&(t.getSvgScreenOffset=function(){return 0})),t}start(i,t,e,s){this.cell=i,this.first=mxUtils.convertPoint(this.graph.container,t,e),this.cells=s??this.getCells(this.cell),this.bounds=this.graph.getView().getBounds(this.cells),this.pBounds=this.getPreviewBounds(this.cells),this.allCells=new mxDictionary,this.cloning=!1,this.cellCount=0;for(var n=0;n<this.cells.length;n++)this.cellCount+=this.addStates(this.cells[n],this.allCells);if(this.guidesEnabled){this.guide=new mxGuide(this.graph,this.getGuideStates());for(var l=this.graph.model.getParent(i),r=this.graph.model.getChildCount(l)<2,a=new mxDictionary,o=this.graph.getOpposites(this.graph.getEdges(this.cell),this.cell),n=0;n<o.length;n++){var h=this.graph.view.getState(o[n]);h!=null&&!a.get(h)&&a.put(h,!0)}this.guide.isStateIgnored=d=>{var g=this.graph.model.getParent(d.cell);return d.cell!=null&&(!this.cloning&&this.isCellMoving(d.cell)||d.cell!=(this.target||l)&&!r&&!a.get(d)&&(this.target==null||this.graph.model.getChildCount(this.target)>=2)&&g!=(this.target||l))}}}addStates(i,t){var e=this.graph.view.getState(i),s=0;if(e!=null&&t.get(i)==null){t.put(i,e),s++;for(var n=this.graph.model.getChildCount(i),l=0;l<n;l++)s+=this.addStates(this.graph.model.getChildAt(i,l),t)}return s}isCellMoving(i){return this.allCells.get(i)!=null}useGuidesForEvent(i){return this.guide!=null?this.guide.isEnabledForEvent(i.getEvent())&&!this.graph.isConstrainedEvent(i.getEvent()):!0}snap(i){var t=this.scaleGrid?this.graph.view.scale:1;return i.x=this.graph.snap(i.x/t)*t,i.y=this.graph.snap(i.y/t)*t,i}getDelta(i){var t=mxUtils.convertPoint(this.graph.container,i.getX(),i.getY());return new mxPoint(t.x-this.first.x-this.graph.panDx,t.y-this.first.y-this.graph.panDy)}updateHint(i){}removeHint(){}roundLength(i){return Math.round(i*100)/100}isValidDropTarget(i,t){return this.graph.model.getParent(this.cell)!=i}checkPreview(){this.livePreviewActive&&this.cloning?(this.resetLivePreview(),this.livePreviewActive=!1):this.maxLivePreview>=this.cellCount&&!this.livePreviewActive&&this.allowLivePreview?(!this.cloning||!this.livePreviewActive)&&(this.livePreviewActive=!0,this.livePreviewUsed=!0):!this.livePreviewUsed&&this.shape==null&&(this.shape=this.createPreviewShape(this.bounds))}mouseMove(i,t){var e=this.graph;if(!t.isConsumed()&&e.isMouseDown&&this.cell!=null&&this.first!=null&&this.bounds!=null&&!this.suspended){if(mxEvent.isMultiTouchEvent(t.getEvent())){this.reset();return}var s=this.getDelta(t),n=e.tolerance;if(this.shape!=null||this.livePreviewActive||Math.abs(s.x)>n||Math.abs(s.y)>n){this.highlight==null&&(this.highlight=new mxCellHighlight(this.graph,mxConstants.DROP_TARGET_COLOR,3));var l=e.isCloneEvent(t.getEvent())&&e.isCellsCloneable()&&this.isCloneEnabled(),r=e.isGridEnabledEvent(t.getEvent()),a=t.getCell(),o=!0,h=null;this.cloning=l,e.isDropEnabled()&&this.highlightEnabled&&(h=e.getDropTarget(this.cells,t.getEvent(),a,l));var d=e.getView().getState(h),g=!1;if(d!=null&&(l||this.isValidDropTarget(h,t)))this.target!=h&&(this.target=h,this.setHighlightColor(mxConstants.DROP_TARGET_COLOR)),g=!0;else if(this.target=null,this.connectOnDrop&&a!=null&&this.cells.length==1&&e.getModel().isVertex(a)&&e.isCellConnectable(a)&&(d=e.getView().getState(a),d!=null)){var m=e.getEdgeValidationError(null,this.cell,a),f=m==null?mxConstants.VALID_COLOR:mxConstants.INVALID_CONNECT_TARGET_COLOR;this.setHighlightColor(f),g=!0}d!=null&&g?this.highlight.highlight(d):this.highlight.hide(),this.guide!=null&&this.useGuidesForEvent(t)?(s=this.guide.move(this.bounds,s,r,l),o=!1):s=this.graph.snapDelta(s,this.bounds,!r,!1,!1),this.guide!=null&&o&&this.guide.hide(),e.isConstrainedEvent(t.getEvent())&&(Math.abs(s.x)>Math.abs(s.y)?s.y=0:s.x=0),this.checkPreview(),(this.currentDx!=s.x||this.currentDy!=s.y)&&(this.currentDx=s.x,this.currentDy=s.y,this.updatePreview())}this.updateHint(t),this.consumeMouseEvent(mxEvent.MOUSE_MOVE,t),mxEvent.consume(t.getEvent())}else if((this.isMoveEnabled()||this.isCloneEnabled())&&this.updateCursor&&!t.isConsumed()&&(t.getState()!=null||t.sourceState!=null)&&!e.isMouseDown){var c=e.getCursorForMouseEvent(t);c==null&&e.isEnabled()&&e.isCellMovable(t.getCell())&&(e.getModel().isEdge(t.getCell())?c=mxConstants.CURSOR_MOVABLE_EDGE:c=mxConstants.CURSOR_MOVABLE_VERTEX),c!=null&&t.sourceState!=null&&t.sourceState.setCursor(c)}}updatePreview(i){this.livePreviewUsed&&!i?this.cells!=null&&(this.setHandlesVisibleForCells(this.graph.selectionCellsHandler.getHandledSelectionCells(),!1),this.updateLivePreview(this.currentDx,this.currentDy)):this.updatePreviewShape()}updatePreviewShape(){this.shape!=null&&this.pBounds!=null&&(this.shape.bounds=new mxRectangle(Math.round(this.pBounds.x+this.currentDx),Math.round(this.pBounds.y+this.currentDy),this.pBounds.width,this.pBounds.height),this.shape.redraw())}updateLivePreview(i,t){if(!this.suspended){var e=[];if(this.allCells!=null&&this.allCells.visit((c,x)=>{if(this.graph.view.getState(x.cell)==null)x.destroy();else{var p=x.clone();e.push([x,p]),x.shape!=null&&(x.shape.originalPointerEvents==null&&(x.shape.originalPointerEvents=x.shape.pointerEvents),x.shape.pointerEvents=!1,x.text!=null&&(x.text.originalPointerEvents==null&&(x.text.originalPointerEvents=x.text.pointerEvents),x.text.pointerEvents=!1)),this.graph.model.isVertex(x.cell)&&(x.x+=i,x.y+=t,this.cloning||(x.view.graph.cellRenderer.redraw(x,!0),x.view.invalidate(x.cell),x.invalid=!1,x.control!=null&&x.control.node!=null&&(x.control.node.style.visibility="hidden")))}}),e.length==0)this.reset();else{for(var s=this.graph.view.scale,n=0;n<e.length;n++){var l=e[n][0];if(this.graph.model.isEdge(l.cell)){var r=this.graph.getCellGeometry(l.cell),a=[];if(r!=null&&r.points!=null)for(var o=0;o<r.points.length;o++)r.points[o]!=null&&a.push(new mxPoint(r.points[o].x+i/s,r.points[o].y+t/s));var h=l.visibleSourceState,d=l.visibleTargetState,g=e[n][1].absolutePoints;if(h==null||!this.isCellMoving(h.cell)){var m=g[0];l.setAbsoluteTerminalPoint(new mxPoint(m.x+i,m.y+t),!0),h=null}else l.view.updateFixedTerminalPoint(l,h,!0,this.graph.getConnectionConstraint(l,h,!0));if(d==null||!this.isCellMoving(d.cell)){var f=g[g.length-1];l.setAbsoluteTerminalPoint(new mxPoint(f.x+i,f.y+t),!1),d=null}else l.view.updateFixedTerminalPoint(l,d,!1,this.graph.getConnectionConstraint(l,d,!1));l.view.updatePoints(l,a,h,d),l.view.updateFloatingTerminalPoints(l,h,d),l.view.updateEdgeLabelOffset(l),l.invalid=!1,this.cloning||l.view.graph.cellRenderer.redraw(l,!0)}}this.graph.view.validate(),this.redrawHandles(e),this.resetPreviewStates(e)}}}redrawHandles(i){for(var t=0;t<i.length;t++){var e=this.graph.selectionCellsHandler.getHandler(i[t][0].cell);e!=null&&e.redraw(!0)}}resetPreviewStates(i){for(var t=0;t<i.length;t++)i[t][0].setState(i[t][1])}suspend(){this.suspended||(this.livePreviewUsed&&this.updateLivePreview(0,0),this.shape!=null&&(this.shape.node.style.visibility="hidden"),this.guide!=null&&this.guide.setVisible(!1),this.suspended=!0)}resume(){this.suspended&&(this.suspended=null,this.livePreviewUsed&&(this.livePreviewActive=!0),this.shape!=null&&(this.shape.node.style.visibility="visible"),this.guide!=null&&this.guide.setVisible(!0))}resetLivePreview(){this.allCells!=null&&(this.allCells.visit((i,t)=>{t.shape!=null&&t.shape.originalPointerEvents!=null&&(t.shape.pointerEvents=t.shape.originalPointerEvents,t.shape.originalPointerEvents=null,t.shape.bounds=null,t.text!=null&&(t.text.pointerEvents=t.text.originalPointerEvents,t.text.originalPointerEvents=null)),t.control!=null&&t.control.node!=null&&t.control.node.style.visibility=="hidden"&&(t.control.node.style.visibility=""),t.view.invalidate(t.cell)}),this.graph.view.validate())}setHandlesVisibleForCells(i,t){if(this.handlesVisible!=t){this.handlesVisible=t;for(var e=0;e<i.length;e++){var s=this.graph.selectionCellsHandler.getHandler(i[e]);s!=null&&(s.setHandlesVisible(t),t&&s.redraw())}}}setHighlightColor(i){this.highlight!=null&&this.highlight.setHighlightColor(i)}mouseUp(i,t){if(!t.isConsumed())if(this.livePreviewUsed&&this.resetLivePreview(),this.cell!=null&&this.first!=null&&(this.shape!=null||this.livePreviewUsed)&&this.currentDx!=null&&this.currentDy!=null){var e=this.graph,s=t.getCell();if(this.connectOnDrop&&this.target==null&&s!=null&&e.getModel().isVertex(s)&&e.isCellConnectable(s)&&e.isEdgeValid(null,this.cell,s))e.connectionHandler.connect(this.cell,s,t.getEvent());else{var n=e.isCloneEvent(t.getEvent())&&e.isCellsCloneable()&&this.isCloneEnabled(),l=e.getView().scale,r=this.roundLength(this.currentDx/l),a=this.roundLength(this.currentDy/l),o=this.target;e.isSplitEnabled()&&e.isSplitTarget(o,this.cells,t.getEvent())?e.splitEdge(o,this.cells,null,r,a,t.getGraphX(),t.getGraphY()):this.moveCells(this.cells,r,a,n,this.target,t.getEvent())}}else this.isSelectEnabled()&&this.delayedSelection&&this.cell!=null&&this.selectDelayed(t);this.cellWasClicked&&this.consumeMouseEvent(mxEvent.MOUSE_UP,t),this.reset()}reset(){if(this.livePreviewUsed){this.resetLivePreview();try{this.setHandlesVisibleForCells(this.graph.selectionCelltresHandler.getHandledSelectionCells(),!0)}catch{}}this.destroyShapes(),this.removeHint(),this.delayedSelection=!1,this.livePreviewActive=null,this.livePreviewUsed=null,this.cellWasClicked=!1,this.suspended=null,this.currentDx=null,this.currentDy=null,this.cellCount=null,this.cloning=!1,this.allCells=null,this.pBounds=null,this.guides=null,this.target=null,this.first=null,this.cells=null,this.cell=null}shouldRemoveCellsFromParent(i,t,e){if(this.graph.getModel().isVertex(i)){var s=this.graph.getView().getState(i);if(s!=null){var n=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(e),mxEvent.getClientY(e)),l=mxUtils.toRadians(mxUtils.getValue(s.style,mxConstants.STYLE_ROTATION)||0);if(l!=0){var r=Math.cos(-l),a=Math.sin(-l),o=new mxPoint(s.getCenterX(),s.getCenterY());n=mxUtils.getRotatedPoint(n,r,a,o)}return!mxUtils.contains(s,n.x,n.y)}}return!1}moveCells(i,t,e,s,n,l){s&&(i=this.graph.getCloneableCells(i));var r=this.graph.getModel().getParent(this.cell);n==null&&this.isRemoveCellsFromParent()&&this.shouldRemoveCellsFromParent(r,i,l)&&(n=this.graph.getDefaultParent()),s=s&&!this.graph.isCellLocked(n||this.graph.getDefaultParent()),this.graph.getModel().beginUpdate();try{var a=[];if(!s&&n!=null&&this.removeEmptyParents){for(var o=new mxDictionary,h=0;h<i.length;h++)o.put(i[h],!0);for(var h=0;h<i.length;h++){var d=this.graph.model.getParent(i[h]);d!=null&&!o.get(d)&&(o.put(d,!0),a.push(d))}}i=this.graph.moveCells(i,t,e,s,n,l);for(var g=[],h=0;h<a.length;h++)this.shouldRemoveParent(a[h])&&g.push(a[h]);this.graph.removeCells(g,!1)}finally{this.graph.getModel().endUpdate()}s&&this.graph.setSelectionCells(i),this.isSelectEnabled()&&this.scrollOnMove&&this.graph.scrollCellToVisible(i[0])}shouldRemoveParent(i){var t=this.graph.view.getState(i);return t!=null&&(this.graph.model.isEdge(t.cell)||this.graph.model.isVertex(t.cell))&&this.graph.isCellDeletable(t.cell)&&this.graph.model.getChildCount(t.cell)==0&&this.graph.isTransparentState(t)}destroyShapes(){this.shape!=null&&(this.shape.destroy(),this.shape=null),this.guide!=null&&(this.guide.destroy(),this.guide=null),this.highlight!=null&&(this.highlight.destroy(),this.highlight=null)}destroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.panHandler),this.escapeHandler!=null&&(this.graph.removeListener(this.escapeHandler),this.escapeHandler=null),this.refreshHandler!=null&&(this.graph.getModel().removeListener(this.refreshHandler),this.refreshHandler=null),mxEvent.removeListener(document,"keydown",this.keyHandler),mxEvent.removeListener(document,"keyup",this.keyHandler),this.destroyShapes(),this.removeHint()}}u(mxGraphHandler,"maxCells",50),u(mxGraphHandler,"guidesEnabled",!1),u(mxGraphHandler,"handlesVisible",!0),u(mxGraphHandler,"removeCellsFromParent",!0),u(mxGraphHandler,"removeEmptyParents",!1),u(mxGraphHandler,"maxLivePreview",0);class mxImage{constructor(i,t,e){this.src=i,this.width=t,this.height=e}}class mxConstraintHandler{constructor(i){u(this,"pointImage",new mxImage(mxClient.imageBasePath+"/point.gif",5,5));u(this,"enabled",!0);u(this,"highlightColor",mxConstants.DEFAULT_VALID_COLOR);this.graph=i,this.resetHandler=(t,e)=>{this.currentFocus!=null&&this.graph.view.getState(this.currentFocus.cell)==null?this.reset():this.redraw()},this.graph.model.addListener(mxEvent.CHANGE,this.resetHandler),this.graph.view.addListener(mxEvent.SCALE_AND_TRANSLATE,this.resetHandler),this.graph.view.addListener(mxEvent.TRANSLATE,this.resetHandler),this.graph.view.addListener(mxEvent.SCALE,this.resetHandler),this.graph.addListener(mxEvent.ROOT,this.resetHandler)}isEnabled(){return this.enabled}setEnabled(i){this.enabled=i}reset(){if(this.focusIcons!=null){for(var i=0;i<this.focusIcons.length;i++)this.focusIcons[i].destroy();this.focusIcons=null}this.focusHighlight!=null&&(this.focusHighlight.destroy(),this.focusHighlight=null),this.currentConstraint=null,this.currentFocusArea=null,this.currentPoint=null,this.currentFocus=null,this.focusPoints=null}getTolerance(i){return this.graph.getTolerance()}getImageForConstraint(i,t,e){return this.pointImage}isEventIgnored(i,t){return!1}isStateIgnored(i,t){return!1}destroyIcons(){if(this.focusIcons!=null){for(var i=0;i<this.focusIcons.length;i++)this.focusIcons[i].destroy();this.focusIcons=null,this.focusPoints=null}}destroyFocusHighlight(){this.focusHighlight!=null&&(this.focusHighlight.destroy(),this.focusHighlight=null)}isKeepFocusEvent(i){return mxEvent.isShiftDown(i.getEvent())}getCellForEvent(i,t){var e=i.getCell();if(e==null&&t!=null&&(i.getGraphX()!=t.x||i.getGraphY()!=t.y)&&(e=this.graph.getCellAt(t.x,t.y)),e!=null&&!this.graph.isCellConnectable(e)){var s=this.graph.getModel().getParent(e);this.graph.getModel().isVertex(s)&&this.graph.isCellConnectable(s)&&(e=s)}return this.graph.isCellLocked(e)?null:e}update(i,t,e,s){if(this.isEnabled()&&!this.isEventIgnored(i)){this.mouseleaveHandler==null&&this.graph.container!=null&&(this.mouseleaveHandler=()=>{this.reset()},mxEvent.addListener(this.graph.container,"mouseleave",this.resetHandler));var n=this.getTolerance(i),l=s!=null?s.x:i.getGraphX(),r=s!=null?s.y:i.getGraphY(),a=new mxRectangle(l-n,r-n,2*n,2*n),o=new mxRectangle(i.getGraphX()-n,i.getGraphY()-n,2*n,2*n),h=this.graph.view.getState(this.getCellForEvent(i,s));!this.isKeepFocusEvent(i)&&(this.currentFocusArea==null||this.currentFocus==null||h!=null||!this.graph.getModel().isVertex(this.currentFocus.cell)||!mxUtils.intersects(this.currentFocusArea,o))&&h!=this.currentFocus&&(this.currentFocusArea=null,this.currentFocus=null,this.setFocus(i,h,t)),this.currentConstraint=null,this.currentPoint=null;var d=null;if(this.focusIcons!=null&&this.constraints!=null&&(h==null||this.currentFocus==h))for(var g=o.getCenterX(),m=o.getCenterY(),f=0;f<this.focusIcons.length;f++){var c=g-this.focusIcons[f].bounds.getCenterX(),x=m-this.focusIcons[f].bounds.getCenterY(),p=c*c+x*x;if((this.intersects(this.focusIcons[f],o,t,e)||s!=null&&this.intersects(this.focusIcons[f],a,t,e))&&(d==null||p<d)){this.currentConstraint=this.constraints[f],this.currentPoint=this.focusPoints[f],d=p;var p=this.focusIcons[f].bounds.clone();if(p.grow(mxConstants.HIGHLIGHT_SIZE+1),p.width-=1,p.height-=1,this.focusHighlight==null){var C=this.createHighlightShape();C.dialect=this.graph.dialect==mxConstants.DIALECT_SVG?mxConstants.DIALECT_SVG:mxConstants.DIALECT_VML,C.pointerEvents=!1,C.init(this.graph.getView().getOverlayPane()),this.focusHighlight=C;var E=()=>this.currentFocus!=null?this.currentFocus:h;mxEvent.redirectMouseEvents(C.node,this.graph,E)}this.focusHighlight.bounds=p,this.focusHighlight.redraw()}}this.currentConstraint==null&&this.destroyFocusHighlight()}else this.currentConstraint=null,this.currentFocus=null,this.currentPoint=null}redraw(){if(this.currentFocus!=null&&this.constraints!=null&&this.focusIcons!=null){var i=this.graph.view.getState(this.currentFocus.cell);this.currentFocus=i,this.currentFocusArea=new mxRectangle(i.x,i.y,i.width,i.height);for(var t=0;t<this.constraints.length;t++){var e=this.graph.getConnectionPoint(i,this.constraints[t]),s=this.getImageForConstraint(i,this.constraints[t],e),n=new mxRectangle(Math.round(e.x-s.width/2),Math.round(e.y-s.height/2),s.width,s.height);this.focusIcons[t].bounds=n,this.focusIcons[t].redraw(),this.currentFocusArea.add(this.focusIcons[t].bounds),this.focusPoints[t]=e}}}setFocus(i,t,e){if(this.constraints=t!=null&&!this.isStateIgnored(t,e)&&this.graph.isCellConnectable(t.cell)?this.isEnabled()?this.graph.getAllConnectionConstraints(t,e)||[]:[]:null,this.constraints!=null){if(this.currentFocus=t,this.currentFocusArea=new mxRectangle(t.x,t.y,t.width,t.height),this.focusIcons!=null){for(var s=0;s<this.focusIcons.length;s++)this.focusIcons[s].destroy();this.focusIcons=null,this.focusPoints=null}this.focusPoints=[],this.focusIcons=[];for(var s=0;s<this.constraints.length;s++){var n=this.graph.getConnectionPoint(t,this.constraints[s]),l=this.getImageForConstraint(t,this.constraints[s],n),r=l.src,a=new mxRectangle(Math.round(n.x-l.width/2),Math.round(n.y-l.height/2),l.width,l.height),o=new mxImageShape(a,r);o.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,o.preserveImageAspect=!1,o.init(this.graph.getView().getDecoratorPane()),(mxClient.IS_QUIRKS||document.documentMode==8)&&mxEvent.addListener(o.node,"dragstart",function(g){return mxEvent.consume(g),!1}),o.node.previousSibling!=null&&o.node.parentNode.insertBefore(o.node,o.node.parentNode.firstChild);var h=()=>this.currentFocus!=null?this.currentFocus:t;o.redraw(),mxEvent.redirectMouseEvents(o.node,this.graph,h),this.currentFocusArea.add(o.bounds),this.focusIcons.push(o),this.focusPoints.push(n)}this.currentFocusArea.grow(this.getTolerance(i))}else this.destroyIcons(),this.destroyFocusHighlight()}createHighlightShape(){var i=new mxRectangleShape(null,this.highlightColor,this.highlightColor,mxConstants.HIGHLIGHT_STROKEWIDTH);return i.opacity=mxConstants.HIGHLIGHT_OPACITY,i}intersects(i,t,e,s){return mxUtils.intersects(i.bounds,t)}destroy(){this.reset(),this.resetHandler!=null&&(this.graph.model.removeListener(this.resetHandler),this.graph.view.removeListener(this.resetHandler),this.graph.removeListener(this.resetHandler),this.resetHandler=null),this.mouseleaveHandler!=null&&this.graph.container!=null&&(mxEvent.removeListener(this.graph.container,"mouseleave",this.mouseleaveHandler),this.mouseleaveHandler=null)}}class mxEdgeHandler{constructor(i){u(this,"graph",null);u(this,"state",null);u(this,"marker",null);u(this,"constraintHandler",null);u(this,"error",null);u(this,"shape",null);u(this,"bends",null);u(this,"labelShape",null);u(this,"cloneEnabled",!0);u(this,"addEnabled",!1);u(this,"removeEnabled",!1);u(this,"preferHtml",!1);u(this,"allowHandleBoundsCheck",!0);u(this,"handleImage",null);i!=null&&(this.state=i,this.init(),this.escapeHandler=(t,e)=>{var s=this.index!=null;this.reset(),s&&this.graph.cellRenderer.redraw(this.state,!1,i.view.isRendering())},this.state.view.graph.addListener(mxEvent.ESCAPE,this.escapeHandler))}init(){if(this.graph=this.state.view.graph,this.marker=this.createMarker(),this.constraintHandler=new mxConstraintHandler(this.graph),this.points=[],this.abspoints=this.getSelectionPoints(this.state),this.shape=this.createSelectionShape(this.abspoints),this.shape.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,this.shape.init(this.graph.getView().getOverlayPane()),this.shape.pointerEvents=!1,this.shape.setCursor(mxConstants.CURSOR_MOVABLE_EDGE),mxEvent.redirectMouseEvents(this.shape.node,this.graph,this.state),this.preferHtml=this.state.text!=null&&this.state.text.node.parentNode==this.graph.container,!this.preferHtml){var i=this.state.getVisibleTerminalState(!0);if(i!=null&&(this.preferHtml=i.text!=null&&i.text.node.parentNode==this.graph.container),!this.preferHtml){var t=this.state.getVisibleTerminalState(!1);t!=null&&(this.preferHtml=t.text!=null&&t.text.node.parentNode==this.graph.container)}}if(this.parentHighlightEnabled){var e=this.graph.model.getParent(this.state.cell);if(this.graph.model.isVertex(e)){var s=this.graph.view.getState(e);s!=null&&(this.parentHighlight=this.createParentHighlightShape(s),this.parentHighlight.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.parentHighlight.pointerEvents=!1,this.parentHighlight.rotation=Number(s.style[mxConstants.STYLE_ROTATION]||"0"),this.parentHighlight.init(this.graph.getView().getOverlayPane()))}}(this.graph.getSelectionCount()<mxGraphHandler.maxCells||mxGraphHandler.maxCells<=0)&&(this.bends=this.createBends(),this.isVirtualBendsEnabled()&&(this.virtualBends=this.createVirtualBends())),this.label=new mxPoint(this.state.absoluteOffset.x,this.state.absoluteOffset.y),this.labelShape=this.createLabelHandleShape(),this.initBend(this.labelShape),this.labelShape.setCursor(mxConstants.CURSOR_LABEL_HANDLE),this.customHandles=this.createCustomHandles(),this.redraw()}createCustomHandles(){return null}isVirtualBendsEnabled(i){return this.virtualBendsEnabled&&(this.state.style[mxConstants.STYLE_EDGE]==null||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.NONE||this.state.style[mxConstants.STYLE_NOEDGESTYLE]==1)&&mxUtils.getValue(this.state.style,mxConstants.STYLE_SHAPE,null)!="arrow"}isCellEnabled(i){return!0}isAddPointEvent(i){return mxEvent.isShiftDown(i)}isRemovePointEvent(i){return mxEvent.isShiftDown(i)}getSelectionPoints(i){return i.absolutePoints}createParentHighlightShape(i){var t=new mxRectangleShape(i,null,this.getSelectionColor());return t.strokewidth=this.getSelectionStrokeWidth(),t.isDashed=this.isSelectionDashed(),t}createSelectionShape(i){var t=new this.state.shape.constructor;return t.outline=!0,t.apply(this.state),t.isDashed=this.isSelectionDashed(),t.stroke=this.getSelectionColor(),t.isShadow=!1,t}getSelectionColor(){return mxConstants.EDGE_SELECTION_COLOR}getSelectionStrokeWidth(){return mxConstants.EDGE_SELECTION_STROKEWIDTH}isSelectionDashed(){return mxConstants.EDGE_SELECTION_DASHED}isConnectableCell(i){return!0}getCellAt(i,t){return this.outlineConnect?null:this.graph.getCellAt(i,t)}createMarker(){var i=new EdgeCellMarker(this,this.graph);return i}validateConnection(i,t){return this.graph.getEdgeValidationError(this.state.cell,i,t)}createBends(){for(var i=this.state.cell,t=[],e=0;e<this.abspoints.length;e++)if(this.isHandleVisible(e)){var s=e==0,n=e==this.abspoints.length-1,l=s||n;(l||this.graph.isCellBendable(i))&&(r=>{var a=this.createHandleShape(r);this.initBend(a,()=>()=>{this.dblClickRemoveEnabled&&this.removePoint(this.state,r)}),this.isHandleEnabled(e)&&a.setCursor(l?mxConstants.CURSOR_TERMINAL_HANDLE:mxConstants.CURSOR_BEND_HANDLE),t.push(a),l||(this.points.push(new mxPoint(0,0)),a.node.style.visibility="hidden")})(e)}return t}createVirtualBends(){var i=this.state.cell;this.abspoints[0];var t=[];if(this.graph.isCellBendable(i))for(var e=1;e<this.abspoints.length;e++)(s=>{this.initBend(s),s.setCursor(mxConstants.CURSOR_VIRTUAL_BEND_HANDLE),t.push(s)})(this.createHandleShape());return t}isHandleEnabled(i){return!0}isHandleVisible(i){var t=this.state.getVisibleTerminalState(!0),e=this.state.getVisibleTerminalState(!1),s=this.graph.getCellGeometry(this.state.cell),n=s!=null?this.graph.view.getEdgeStyle(this.state,s.points,t,e):null;return n!=mxEdgeStyle.EntityRelation||i==0||i==this.abspoints.length-1}createHandleShape(i){if(this.handleImage!=null){var t=new mxImageShape(new mxRectangle(0,0,this.handleImage.width,this.handleImage.height),this.handleImage.src);return t.preserveImageAspect=!1,t}else{var e=mxConstants.HANDLE_SIZE;return this.preferHtml&&(e-=1),new mxRectangleShape(new mxRectangle(0,0,e,e),mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)}}createLabelHandleShape(){if(this.labelHandleImage!=null){var i=new mxImageShape(new mxRectangle(0,0,this.labelHandleImage.width,this.labelHandleImage.height),this.labelHandleImage.src);return i.preserveImageAspect=!1,i}else{var t=mxConstants.LABEL_HANDLE_SIZE;return new mxRectangleShape(new mxRectangle(0,0,t,t),mxConstants.LABEL_HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)}}initBend(i,t){this.preferHtml?(i.dialect=mxConstants.DIALECT_STRICTHTML,i.init(this.graph.container)):(i.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,i.init(this.graph.getView().getOverlayPane())),mxEvent.redirectMouseEvents(i.node,this.graph,this.state,null,null,null,t),(mxClient.IS_QUIRKS||document.documentMode==8)&&mxEvent.addListener(i.node,"dragstart",function(e){return mxEvent.consume(e),!1}),mxClient.IS_TOUCH&&i.node.setAttribute("pointer-events","none")}getHandleForEvent(i){var t=mxEvent.isMouseEvent(i.getEvent())?1:this.tolerance,e=this.allowHandleBoundsCheck&&t>0?new mxRectangle(i.getGraphX()-t,i.getGraphY()-t,2*t,2*t):null,s=null,n=null;function l(a){if(a!=null&&a.node!=null&&a.node.style.display!="none"&&a.node.style.visibility!="hidden"&&(i.isSource(a)||e!=null&&mxUtils.intersects(a.bounds,e))){var o=i.getGraphX()-a.bounds.getCenterX(),h=i.getGraphY()-a.bounds.getCenterY(),d=o*o+h*h;if(s==null||d<=s)return s=d,!0}return!1}if(this.customHandles!=null&&this.isCustomHandleEvent(i)){for(var r=this.customHandles.length-1;r>=0;r--)if(l(this.customHandles[r].shape))return mxEvent.CUSTOM_HANDLE-r}if((i.isSource(this.state.text)||l(this.labelShape))&&(n=mxEvent.LABEL_HANDLE),this.bends!=null)for(var r=0;r<this.bends.length;r++)l(this.bends[r])&&(n=r);if(this.virtualBends!=null&&this.isAddVirtualBendEvent(i))for(var r=0;r<this.virtualBends.length;r++)l(this.virtualBends[r])&&(n=mxEvent.VIRTUAL_HANDLE-r);return n}isAddVirtualBendEvent(i){return!0}isCustomHandleEvent(i){return!0}mouseDown(i,t){var e=this.getHandleForEvent(t);if(this.bends!=null&&this.bends[e]!=null){var s=this.bends[e].bounds;this.snapPoint=new mxPoint(s.getCenterX(),s.getCenterY())}this.addEnabled&&e==null&&this.isAddPointEvent(t.getEvent())?(this.addPoint(this.state,t.getEvent()),t.consume()):e!=null&&!t.isConsumed()&&this.graph.isEnabled()&&(this.removeEnabled&&this.isRemovePointEvent(t.getEvent())?this.removePoint(this.state,e):(e!=mxEvent.LABEL_HANDLE||this.graph.isLabelMovable(t.getCell()))&&(e<=mxEvent.VIRTUAL_HANDLE&&mxUtils.setOpacity(this.virtualBends[mxEvent.VIRTUAL_HANDLE-e].node,100),this.start(t.getX(),t.getY(),e)),t.consume())}start(i,t,e){if(this.startX=i,this.startY=t,this.isSource=this.bends==null?!1:e==0,this.isTarget=this.bends==null?!1:e==this.bends.length-1,this.isLabel=e==mxEvent.LABEL_HANDLE,this.isSource||this.isTarget){var s=this.state.cell,n=this.graph.model.getTerminal(s,this.isSource);(n==null&&this.graph.isTerminalPointMovable(s,this.isSource)||n!=null&&this.graph.isCellDisconnectable(s,n,this.isSource))&&(this.index=e)}else this.index=e;if(this.index<=mxEvent.CUSTOM_HANDLE&&this.index>mxEvent.VIRTUAL_HANDLE&&this.customHandles!=null)for(var l=0;l<this.customHandles.length;l++)l!=mxEvent.CUSTOM_HANDLE-this.index&&this.customHandles[l].setVisible(!1)}clonePreviewState(i,t){return this.state.clone()}getSnapToTerminalTolerance(){return this.graph.gridSize*this.graph.view.scale/2}updateHint(i,t){}removeHint(){}roundLength(i){return Math.round(i)}isSnapToTerminalsEvent(i){return this.snapToTerminals&&!mxEvent.isAltDown(i.getEvent())}getPointForEvent(i){var t=this.graph.getView(),e=t.scale,s=new mxPoint(this.roundLength(i.getGraphX()/e)*e,this.roundLength(i.getGraphY()/e)*e),n=this.getSnapToTerminalTolerance(),l=!1,r=!1;if(n>0&&this.isSnapToTerminalsEvent(i)){let h=function(g){if(g!=null){var m=g.x;Math.abs(s.x-m)<n&&(s.x=m,l=!0);var f=g.y;Math.abs(s.y-f)<n&&(s.y=f,r=!0)}},d=function(g){g!=null&&h.call(this,new mxPoint(t.getRoutingCenterX(g),t.getRoutingCenterY(g)))};if(d.call(this,this.state.getVisibleTerminalState(!0)),d.call(this,this.state.getVisibleTerminalState(!1)),this.state.absolutePoints!=null)for(var a=0;a<this.state.absolutePoints.length;a++)h.call(this,this.state.absolutePoints[a])}if(this.graph.isGridEnabledEvent(i.getEvent())){var o=t.translate;l||(s.x=(this.graph.snap(s.x/e-o.x)+o.x)*e),r||(s.y=(this.graph.snap(s.y/e-o.y)+o.y)*e)}return s}getPreviewTerminalState(i){if(this.constraintHandler.update(i,this.isSource,!0,i.isSource(this.marker.highlight.shape)?null:this.currentPoint),this.constraintHandler.currentFocus!=null&&this.constraintHandler.currentConstraint!=null){this.marker.highlight!=null&&this.marker.highlight.state!=null&&this.marker.highlight.state.cell==this.constraintHandler.currentFocus.cell?this.marker.highlight.shape.stroke!="transparent"&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint()):this.marker.markCell(this.constraintHandler.currentFocus.cell,"transparent");var t=this.graph.getModel(),e=this.graph.view.getTerminalPort(this.state,this.graph.view.getState(t.getTerminal(this.state.cell,!this.isSource)),!this.isSource),s=e!=null?e.cell:null,n=this.isSource?this.constraintHandler.currentFocus.cell:s,l=this.isSource?s:this.constraintHandler.currentFocus.cell;this.error=this.validateConnection(n,l);var r=null;return this.error==null&&(r=this.constraintHandler.currentFocus),(this.error!=null||r!=null&&!this.isCellEnabled(r.cell))&&this.constraintHandler.reset(),r}else{if(this.graph.isIgnoreTerminalEvent(i.getEvent()))return this.marker.reset(),null;this.marker.process(i);var a=this.marker.getValidState();return a!=null&&!this.isCellEnabled(a.cell)&&(this.constraintHandler.reset(),this.marker.reset()),this.marker.getValidState()}}getPreviewPoints(i,t){var e=this.graph.getCellGeometry(this.state.cell),s=e.points!=null?e.points.slice():null,n=new mxPoint(i.x,i.y),l=null;if(!this.isSource&&!this.isTarget)if(this.convertPoint(n,!1),s==null)s=[n];else{if(this.index<=mxEvent.VIRTUAL_HANDLE&&s.splice(mxEvent.VIRTUAL_HANDLE-this.index,0,n),!this.isSource&&!this.isTarget){for(var r=0;r<this.bends.length;r++)if(r!=this.index){var a=this.bends[r];a!=null&&mxUtils.contains(a.bounds,i.x,i.y)&&(this.index<=mxEvent.VIRTUAL_HANDLE?s.splice(mxEvent.VIRTUAL_HANDLE-this.index,1):s.splice(this.index-1,1),l=s)}if(l==null&&this.straightRemoveEnabled&&(t==null||!mxEvent.isAltDown(t.getEvent()))){let f=function(c,x){c>0&&c<h.length-1&&mxUtils.ptSegDistSq(h[c-1].x,h[c-1].y,h[c+1].x,h[c+1].y,x.x,x.y)<o&&(s.splice(c-1,1),l=s)};var o=this.graph.tolerance*this.graph.tolerance,h=this.state.absolutePoints.slice();h[this.index]=i;var d=this.state.getVisibleTerminalState(!0);if(d!=null){var g=this.graph.getConnectionConstraint(this.state,d,!0);(g==null||this.graph.getConnectionPoint(d,g)==null)&&(h[0]=new mxPoint(d.view.getRoutingCenterX(d),d.view.getRoutingCenterY(d)))}var m=this.state.getVisibleTerminalState(!1);if(m!=null){var g=this.graph.getConnectionConstraint(this.state,m,!1);(g==null||this.graph.getConnectionPoint(m,g)==null)&&(h[h.length-1]=new mxPoint(m.view.getRoutingCenterX(m),m.view.getRoutingCenterY(m)))}f(this.index,i)}}l==null&&this.index>mxEvent.VIRTUAL_HANDLE&&(s[this.index-1]=n)}else this.graph.resetEdgesOnConnect&&(s=null);return l??s}isOutlineConnectEvent(i){var t=mxUtils.getOffset(this.graph.container),e=i.getEvent(),s=mxEvent.getClientX(e),n=mxEvent.getClientY(e),l=document.documentElement,r=(window.pageXOffset||l.scrollLeft)-(l.clientLeft||0),a=(window.pageYOffset||l.scrollTop)-(l.clientTop||0),o=this.currentPoint.x-this.graph.container.scrollLeft+t.x-r,h=this.currentPoint.y-this.graph.container.scrollTop+t.y-a;return this.outlineConnect&&!mxEvent.isShiftDown(i.getEvent())&&(i.isSource(this.marker.highlight.shape)||mxEvent.isAltDown(i.getEvent())&&i.getState()!=null||this.marker.highlight.isHighlightAt(s,n)||(o!=s||h!=n)&&i.getState()==null&&this.marker.highlight.isHighlightAt(o,h))}updatePreviewState(i,t,e,s,n){var l=this.isSource?e:this.state.getVisibleTerminalState(!0),r=this.isTarget?e:this.state.getVisibleTerminalState(!1),a=this.graph.getConnectionConstraint(i,l,!0),o=this.graph.getConnectionConstraint(i,r,!1),h=this.constraintHandler.currentConstraint;if(h==null&&n&&(e!=null?(s.isSource(this.marker.highlight.shape)&&(t=new mxPoint(s.getGraphX(),s.getGraphY())),h=this.graph.getOutlineConstraint(t,e,s),this.constraintHandler.setFocus(s,e,this.isSource),this.constraintHandler.currentConstraint=h,this.constraintHandler.currentPoint=t):h=new mxConnectionConstraint),this.outlineConnect&&this.marker.highlight!=null&&this.marker.highlight.shape!=null){var d=this.graph.view.scale;this.constraintHandler.currentConstraint!=null&&this.constraintHandler.currentFocus!=null?(this.marker.highlight.shape.stroke=n?mxConstants.OUTLINE_HIGHLIGHT_COLOR:"transparent",this.marker.highlight.shape.strokewidth=mxConstants.OUTLINE_HIGHLIGHT_STROKEWIDTH/d/d,this.marker.highlight.repaint()):this.marker.hasValidState()&&(this.marker.highlight.shape.stroke=this.graph.isCellConnectable(s.getCell())&&this.marker.getValidState()!=s.getState()?"transparent":mxConstants.DEFAULT_VALID_COLOR,this.marker.highlight.shape.strokewidth=mxConstants.HIGHLIGHT_STROKEWIDTH/d/d,this.marker.highlight.repaint())}this.isSource?a=h:this.isTarget&&(o=h),(this.isSource||this.isTarget)&&(h!=null&&h.point!=null?(i.style[this.isSource?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X]=h.point.x,i.style[this.isSource?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y]=h.point.y):(delete i.style[this.isSource?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X],delete i.style[this.isSource?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y])),i.setVisibleTerminalState(l,!0),i.setVisibleTerminalState(r,!1),(!this.isSource||l!=null)&&i.view.updateFixedTerminalPoint(i,l,!0,a),(!this.isTarget||r!=null)&&i.view.updateFixedTerminalPoint(i,r,!1,o),(this.isSource||this.isTarget)&&e==null&&(i.setAbsoluteTerminalPoint(t,this.isSource),this.marker.getMarkedState()==null&&(this.error=this.graph.allowDanglingEdges?null:"")),i.view.updatePoints(i,this.points,l,r),i.view.updateFloatingTerminalPoints(i,l,r)}mouseMove(i,t){if(this.index!=null&&this.marker!=null){if(this.currentPoint=this.getPointForEvent(t),this.error=null,!this.graph.isIgnoreTerminalEvent(t.getEvent())&&mxEvent.isShiftDown(t.getEvent())&&this.snapPoint!=null&&(Math.abs(this.snapPoint.x-this.currentPoint.x)<Math.abs(this.snapPoint.y-this.currentPoint.y)?this.currentPoint.x=this.snapPoint.x:this.currentPoint.y=this.snapPoint.y),this.index<=mxEvent.CUSTOM_HANDLE&&this.index>mxEvent.VIRTUAL_HANDLE)this.customHandles!=null&&(this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].processEvent(t),this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].positionChanged());else if(this.isLabel)this.label.x=this.currentPoint.x,this.label.y=this.currentPoint.y;else{this.points=this.getPreviewPoints(this.currentPoint,t);var e=this.isSource||this.isTarget?this.getPreviewTerminalState(t):null;if(this.constraintHandler.currentConstraint!=null&&this.constraintHandler.currentFocus!=null&&this.constraintHandler.currentPoint!=null)this.currentPoint=this.constraintHandler.currentPoint.clone();else if(this.outlineConnect){var s=this.isSource||this.isTarget?this.isOutlineConnectEvent(t):!1;s?e=this.marker.highlight.state:e!=null&&e!=t.getState()&&this.graph.isCellConnectable(t.getCell())&&this.marker.highlight.shape!=null&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint(),e=null)}e!=null&&!this.isCellEnabled(e.cell)&&(e=null,this.marker.reset());var n=this.clonePreviewState(this.currentPoint,e!=null?e.cell:null);this.updatePreviewState(n,this.currentPoint,e,t,s);var l=this.error==null?this.marker.validColor:this.marker.invalidColor;this.setPreviewColor(l),this.abspoints=n.absolutePoints,this.active=!0,this.updateHint(t,this.currentPoint)}this.drawPreview(),mxEvent.consume(t.getEvent()),t.consume()}}mouseUp(i,t){if(this.index!=null&&this.marker!=null){var e=this.state.cell,s=this.index;if(this.index=null,t.getX()!=this.startX||t.getY()!=this.startY){var n=!this.graph.isIgnoreTerminalEvent(t.getEvent())&&this.graph.isCloneEvent(t.getEvent())&&this.cloneEnabled&&this.graph.isCellsCloneable();if(this.error!=null)this.error.length>0&&this.graph.validationAlert(this.error);else if(s<=mxEvent.CUSTOM_HANDLE&&s>mxEvent.VIRTUAL_HANDLE){if(this.customHandles!=null){var l=this.graph.getModel();l.beginUpdate();try{this.customHandles[mxEvent.CUSTOM_HANDLE-s].execute(t)}finally{l.endUpdate()}}}else if(this.isLabel)this.moveLabel(this.state,this.label.x,this.label.y);else if(this.isSource||this.isTarget){var r=null;if(this.constraintHandler.currentConstraint!=null&&this.constraintHandler.currentFocus!=null&&(r=this.constraintHandler.currentFocus.cell),r==null&&this.marker.hasValidState()&&this.marker.highlight!=null&&this.marker.highlight.shape!=null&&this.marker.highlight.shape.stroke!="transparent"&&this.marker.highlight.shape.stroke!="white"&&(r=this.marker.validState.cell),r!=null){var l=this.graph.getModel(),a=l.getParent(e);l.beginUpdate();try{if(n){var o=l.getGeometry(e),n=this.graph.cloneCell(e);l.add(a,n,l.getChildCount(a)),o!=null&&(o=o.clone(),l.setGeometry(n,o));var h=l.getTerminal(e,!this.isSource);this.graph.connectCell(n,h,!this.isSource),e=n}e=this.connect(e,r,this.isSource,n,t)}finally{l.endUpdate()}}else if(this.graph.isAllowDanglingEdges()){var d=this.abspoints[this.isSource?0:this.abspoints.length-1];d.x=this.roundLength(d.x/this.graph.view.scale-this.graph.view.translate.x),d.y=this.roundLength(d.y/this.graph.view.scale-this.graph.view.translate.y);var g=this.graph.getView().getState(this.graph.getModel().getParent(e));g!=null&&(d.x-=g.origin.x,d.y-=g.origin.y),d.x-=this.graph.panDx/this.graph.view.scale,d.y-=this.graph.panDy/this.graph.view.scale,e=this.changeTerminalPoint(e,d,this.isSource,n)}}else this.active?e=this.changePoints(e,this.points,n):(this.graph.getView().invalidate(this.state.cell),this.graph.getView().validate(this.state.cell))}else this.graph.isToggleEvent(t.getEvent())&&this.graph.selectCellForEvent(this.state.cell,t.getEvent());this.marker!=null&&(this.reset(),e!=this.state.cell&&this.graph.setSelectionCell(e)),t.consume()}}reset(){if(this.active&&this.refresh(),this.error=null,this.index=null,this.label=null,this.points=null,this.snapPoint=null,this.isLabel=!1,this.isSource=!1,this.isTarget=!1,this.active=!1,this.livePreview&&this.sizers!=null)for(var i=0;i<this.sizers.length;i++)this.sizers[i]!=null&&(this.sizers[i].node.style.display="");if(this.marker!=null&&this.marker.reset(),this.constraintHandler!=null&&this.constraintHandler.reset(),this.customHandles!=null)for(var i=0;i<this.customHandles.length;i++)this.customHandles[i].reset();this.setPreviewColor(mxConstants.EDGE_SELECTION_COLOR),this.removeHint(),this.redraw()}setPreviewColor(i){this.shape!=null&&(this.shape.stroke=i)}convertPoint(i,t){var e=this.graph.getView().getScale(),s=this.graph.getView().getTranslate();t&&(i.x=this.graph.snap(i.x),i.y=this.graph.snap(i.y)),i.x=Math.round(i.x/e-s.x),i.y=Math.round(i.y/e-s.y);var n=this.graph.getView().getState(this.graph.getModel().getParent(this.state.cell));return n!=null&&(i.x-=n.origin.x,i.y-=n.origin.y),i}moveLabel(i,t,e){var s=this.graph.getModel(),n=s.getGeometry(i.cell);if(n!=null){var l=this.graph.getView().scale;if(n=n.clone(),n.relative){var r=this.graph.getView().getRelativePoint(i,t,e);n.x=Math.round(r.x*1e4)/1e4,n.y=Math.round(r.y),n.offset=new mxPoint(0,0);var r=this.graph.view.getPoint(i,n);n.offset=new mxPoint(Math.round((t-r.x)/l),Math.round((e-r.y)/l))}else{var a=i.absolutePoints,o=a[0],h=a[a.length-1];if(o!=null&&h!=null){var d=o.x+(h.x-o.x)/2,g=o.y+(h.y-o.y)/2;n.offset=new mxPoint(Math.round((t-d)/l),Math.round((e-g)/l)),n.x=0,n.y=0}}s.setGeometry(i.cell,n)}}connect(i,t,e,s,n){var l=this.graph.getModel();l.getParent(i),l.beginUpdate();try{var r=this.constraintHandler.currentConstraint;r==null&&(r=new mxConnectionConstraint),this.graph.connectCell(i,t,e,r)}finally{l.endUpdate()}return i}changeTerminalPoint(i,t,e,s){var n=this.graph.getModel();n.beginUpdate();try{if(s){var l=n.getParent(i),r=n.getTerminal(i,!e);i=this.graph.cloneCell(i),n.add(l,i,n.getChildCount(l)),n.setTerminal(i,r,!e)}var a=n.getGeometry(i);a!=null&&(a=a.clone(),a.setTerminalPoint(t,e),n.setGeometry(i,a),this.graph.connectCell(i,null,e,new mxConnectionConstraint))}finally{n.endUpdate()}return i}changePoints(i,t,e){var s=this.graph.getModel();s.beginUpdate();try{if(e){var n=s.getParent(i),l=s.getTerminal(i,!0),r=s.getTerminal(i,!1);i=this.graph.cloneCell(i),s.add(n,i,s.getChildCount(n)),s.setTerminal(i,l,!0),s.setTerminal(i,r,!1)}var a=s.getGeometry(i);a!=null&&(a=a.clone(),a.points=t,s.setGeometry(i,a))}finally{s.endUpdate()}return i}addPoint(i,t){var e=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(t),mxEvent.getClientY(t)),s=this.graph.isGridEnabledEvent(t);this.convertPoint(e,s),this.addPointAt(i,e.x,e.y),mxEvent.consume(t)}addPointAt(i,t,e){var s=this.graph.getCellGeometry(i.cell),n=new mxPoint(t,e);if(s!=null){s=s.clone();var l=this.graph.view.translate,r=this.graph.view.scale,a=new mxPoint(l.x*r,l.y*r),o=this.graph.model.getParent(this.state.cell);if(this.graph.model.isVertex(o)){var h=this.graph.view.getState(o);a=new mxPoint(h.x,h.y)}var d=mxUtils.findNearestSegment(i,n.x*r+a.x,n.y*r+a.y);s.points==null?s.points=[n]:s.points.splice(d,0,n),this.graph.getModel().setGeometry(i.cell,s),this.refresh(),this.redraw()}}removePoint(i,t){if(t>0&&t<this.abspoints.length-1){var e=this.graph.getCellGeometry(this.state.cell);e!=null&&e.points!=null&&(e=e.clone(),e.points.splice(t-1,1),this.graph.getModel().setGeometry(i.cell,e),this.refresh(),this.redraw())}}getHandleFillColor(i){var t=i==0,e=this.state.cell,s=this.graph.getModel().getTerminal(e,t),n=mxConstants.HANDLE_FILLCOLOR;return s!=null&&!this.graph.isCellDisconnectable(e,s,t)||s==null&&!this.graph.isTerminalPointMovable(e,t)?n=mxConstants.LOCKED_HANDLE_FILLCOLOR:s!=null&&this.graph.isCellDisconnectable(e,s,t)&&(n=mxConstants.CONNECT_HANDLE_FILLCOLOR),n}redraw(i){this.abspoints=this.state.absolutePoints.slice();var t=this.graph.getModel().getGeometry(this.state.cell);if(t!=null){var e=t.points;if(this.bends!=null&&this.bends.length>0&&e!=null){this.points==null&&(this.points=[]);for(var s=1;s<this.bends.length-1;s++)this.bends[s]!=null&&this.abspoints[s]!=null&&(this.points[s-1]=e[s-1])}}this.drawPreview(),i||this.redrawHandles()}redrawHandles(){var i=this.state.cell,t=this.labelShape.bounds;this.label=new mxPoint(this.state.absoluteOffset.x,this.state.absoluteOffset.y),this.labelShape.bounds=new mxRectangle(Math.round(this.label.x-t.width/2),Math.round(this.label.y-t.height/2),t.width,t.height);var e=this.graph.getLabel(i);if(this.labelShape.visible=e!=null&&e.length>0&&this.graph.isLabelMovable(i),this.bends!=null&&this.bends.length>0){var s=this.abspoints.length-1,n=this.abspoints[0],l=n.x,r=n.y;t=this.bends[0].bounds,this.bends[0].bounds=new mxRectangle(Math.floor(l-t.width/2),Math.floor(r-t.height/2),t.width,t.height),this.bends[0].fill=this.getHandleFillColor(0),this.bends[0].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[0].bounds);var a=this.abspoints[s],o=a.x,h=a.y,d=this.bends.length-1;t=this.bends[d].bounds,this.bends[d].bounds=new mxRectangle(Math.floor(o-t.width/2),Math.floor(h-t.height/2),t.width,t.height),this.bends[d].fill=this.getHandleFillColor(d),this.bends[d].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[d].bounds),this.redrawInnerBends(n,a)}if(this.abspoints!=null&&this.virtualBends!=null&&this.virtualBends.length>0){for(var g=this.abspoints[0],m=0;m<this.virtualBends.length;m++)if(this.virtualBends[m]!=null&&this.abspoints[m+1]!=null){var f=this.abspoints[m+1],t=this.virtualBends[m],c=g.x+(f.x-g.x)/2,x=g.y+(f.y-g.y)/2;t.bounds=new mxRectangle(Math.floor(c-t.bounds.width/2),Math.floor(x-t.bounds.height/2),t.bounds.width,t.bounds.height),t.redraw(),mxUtils.setOpacity(t.node,this.virtualBendOpacity),g=f,this.manageLabelHandle&&this.checkLabelHandle(t.bounds)}}if(this.labelShape!=null&&this.labelShape.redraw(),this.customHandles!=null)for(var m=0;m<this.customHandles.length;m++){var p=this.customHandles[m].shape.node.style.display;this.customHandles[m].redraw(),this.customHandles[m].shape.node.style.display=p,this.customHandles[m].shape.node.style.visibility=this.isCustomHandleVisible(this.customHandles[m])?"":"hidden"}}isCustomHandleVisible(i){return!this.graph.isEditing()&&this.state.view.graph.getSelectionCount()==1}setHandlesVisible(i){if(this.bends!=null)for(var t=0;t<this.bends.length;t++)this.bends[t].node.style.display=i?"":"none";if(this.virtualBends!=null)for(var t=0;t<this.virtualBends.length;t++)this.virtualBends[t].node.style.display=i?"":"none";if(this.labelShape!=null&&(this.labelShape.node.style.display=i?"":"none"),this.customHandles!=null)for(var t=0;t<this.customHandles.length;t++)this.customHandles[t].setVisible(i)}redrawInnerBends(i,t){for(var e=1;e<this.bends.length-1;e++)if(this.bends[e]!=null)if(this.abspoints[e]!=null){var s=this.abspoints[e].x,n=this.abspoints[e].y,l=this.bends[e].bounds;if(this.bends[e].node.style.visibility="visible",this.bends[e].bounds=new mxRectangle(Math.round(s-l.width/2),Math.round(n-l.height/2),l.width,l.height),this.manageLabelHandle)this.checkLabelHandle(this.bends[e].bounds);else if(this.handleImage==null&&this.labelShape.visible&&mxUtils.intersects(this.bends[e].bounds,this.labelShape.bounds)){var r=mxConstants.HANDLE_SIZE+3,a=mxConstants.HANDLE_SIZE+3;this.bends[e].bounds=new mxRectangle(Math.round(s-r/2),Math.round(n-a/2),r,a)}this.bends[e].redraw()}else this.bends[e].destroy(),this.bends[e]=null}checkLabelHandle(i){if(this.labelShape!=null){var t=this.labelShape.bounds;mxUtils.intersects(i,t)&&(i.getCenterY()<t.getCenterY()?t.y=i.y+i.height:t.y=i.y-t.height)}}drawPreview(){if(this.isLabel){var i=this.labelShape.bounds,t=new mxRectangle(Math.round(this.label.x-i.width/2),Math.round(this.label.y-i.height/2),i.width,i.height);this.labelShape.bounds.equals(t)||(this.labelShape.bounds=t,this.labelShape.redraw())}this.shape!=null&&!mxUtils.equalPoints(this.shape.points,this.abspoints)&&(this.shape.apply(this.state),this.shape.points=this.abspoints.slice(),this.shape.scale=this.state.view.scale,this.shape.isDashed=this.isSelectionDashed(),this.shape.stroke=this.getSelectionColor(),this.shape.strokewidth=this.getSelectionStrokeWidth()/this.shape.scale/this.shape.scale,this.shape.isShadow=!1,this.shape.redraw()),this.parentHighlight!=null&&this.parentHighlight.redraw()}refresh(){this.abspoints=this.getSelectionPoints(this.state),this.points=[],this.bends!=null&&(this.destroyBends(this.bends),this.bends=this.createBends()),this.virtualBends!=null&&(this.destroyBends(this.virtualBends),this.virtualBends=this.createVirtualBends()),this.customHandles!=null&&(this.destroyBends(this.customHandles),this.customHandles=this.createCustomHandles()),this.labelShape!=null&&this.labelShape.node!=null&&this.labelShape.node.parentNode!=null&&this.labelShape.node.parentNode.appendChild(this.labelShape.node)}destroyBends(i){if(i!=null)for(var t=0;t<i.length;t++)i[t]!=null&&i[t].destroy()}destroy(){this.escapeHandler!=null&&(this.state.view.graph.removeListener(this.escapeHandler),this.escapeHandler=null),this.marker!=null&&(this.marker.destroy(),this.marker=null),this.shape!=null&&(this.shape.destroy(),this.shape=null),this.parentHighlight!=null&&(this.parentHighlight.destroy(),this.parentHighlight=null),this.labelShape!=null&&(this.labelShape.destroy(),this.labelShape=null),this.constraintHandler!=null&&(this.constraintHandler.destroy(),this.constraintHandler=null),this.destroyBends(this.virtualBends),this.virtualBends=null,this.destroyBends(this.customHandles),this.customHandles=null,this.destroyBends(this.bends),this.bends=null,this.removeHint()}}u(mxEdgeHandler,"dblClickRemoveEnabled",!1),u(mxEdgeHandler,"mergeRemoveEnabled",!1),u(mxEdgeHandler,"straightRemoveEnabled",!1),u(mxEdgeHandler,"virtualBendsEnabled",!1),u(mxEdgeHandler,"virtualBendOpacity",20),u(mxEdgeHandler,"parentHighlightEnabled",!1),u(mxEdgeHandler,"snapToTerminals",!1),u(mxEdgeHandler,"tolerance",0),u(mxEdgeHandler,"outlineConnect",!1),u(mxEdgeHandler,"manageLabelHandle",!1);class mxElbowEdgeHandler extends mxEdgeHandler{constructor(t){super(t);u(this,"flipEnabled",!0);u(this,"doubleClickOrientationResource",mxClient.language!="none"?"doubleClickOrientation":"")}createBends(){var t=[],e=this.createHandleShape(0);return this.initBend(e),e.setCursor(mxConstants.CURSOR_TERMINAL_HANDLE),t.push(e),t.push(this.createVirtualBend(s=>{!mxEvent.isConsumed(s)&&this.flipEnabled&&(this.graph.flipEdge(this.state.cell,s),mxEvent.consume(s))})),this.points.push(new mxPoint(0,0)),e=this.createHandleShape(2),this.initBend(e),e.setCursor(mxConstants.CURSOR_TERMINAL_HANDLE),t.push(e),t}createVirtualBend(t){var e=this.createHandleShape();return this.initBend(e,t),e.setCursor(this.getCursorForBend()),this.graph.isCellBendable(this.state.cell)||(e.node.style.display="none"),e}getCursorForBend(){return this.state.style[mxConstants.STYLE_EDGE]==mxEdgeStyle.TopToBottom||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.EDGESTYLE_TOPTOBOTTOM||(this.state.style[mxConstants.STYLE_EDGE]==mxEdgeStyle.ElbowConnector||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.EDGESTYLE_ELBOW)&&this.state.style[mxConstants.STYLE_ELBOW]==mxConstants.ELBOW_VERTICAL?"row-resize":"col-resize"}getTooltipForNode(t){var e=null;return this.bends!=null&&this.bends[1]!=null&&(t==this.bends[1].node||t.parentNode==this.bends[1].node)&&(e=this.doubleClickOrientationResource,e=mxResources.get(e)||e),e}convertPoint(t,e){var s=this.graph.getView().getScale(),n=this.graph.getView().getTranslate(),l=this.state.origin;return e&&(t.x=this.graph.snap(t.x),t.y=this.graph.snap(t.y)),t.x=Math.round(t.x/s-n.x-l.x),t.y=Math.round(t.y/s-n.y-l.y),t}redrawInnerBends(t,e){var s=this.graph.getModel().getGeometry(this.state.cell),n=this.state.absolutePoints,l=null;n.length>1?(t=n[1],e=n[n.length-2]):s.points!=null&&s.points.length>0&&(l=n[0]),l==null?l=new mxPoint(t.x+(e.x-t.x)/2,t.y+(e.y-t.y)/2):l=new mxPoint(this.graph.getView().scale*(l.x+this.graph.getView().translate.x+this.state.origin.x),this.graph.getView().scale*(l.y+this.graph.getView().translate.y+this.state.origin.y));var r=this.bends[1].bounds,a=r.width,o=r.height,h=new mxRectangle(Math.round(l.x-a/2),Math.round(l.y-o/2),a,o);this.manageLabelHandle?this.checkLabelHandle(h):this.handleImage==null&&this.labelShape.visible&&mxUtils.intersects(h,this.labelShape.bounds)&&(a=mxConstants.HANDLE_SIZE+3,o=mxConstants.HANDLE_SIZE+3,h=new mxRectangle(Math.floor(l.x-a/2),Math.floor(l.y-o/2),a,o)),this.bends[1].bounds=h,this.bends[1].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[1].bounds)}}class mxEdgeSegmentHandler extends mxElbowEdgeHandler{constructor(i){super(i)}getCurrentPoints(){var i=this.state.absolutePoints;if(i!=null){var t=Math.max(1,this.graph.view.scale);if(i.length==2||i.length==3&&(Math.abs(i[0].x-i[1].x)<t&&Math.abs(i[1].x-i[2].x)<t||Math.abs(i[0].y-i[1].y)<t&&Math.abs(i[1].y-i[2].y)<t)){var e=i[0].x+(i[i.length-1].x-i[0].x)/2,s=i[0].y+(i[i.length-1].y-i[0].y)/2;i=[i[0],new mxPoint(e,s),new mxPoint(e,s),i[i.length-1]]}}return i}getPreviewPoints(i){if(this.isSource||this.isTarget)return super.getPreviewPoints(i);var t=this.getCurrentPoints(),e=this.convertPoint(t[0].clone(),!1);i=this.convertPoint(i.clone(),!1);for(var s=[],n=1;n<t.length;n++){var l=this.convertPoint(t[n].clone(),!1);n==this.index&&(Math.round(e.x-l.x)==0&&(e.x=i.x,l.x=i.x),Math.round(e.y-l.y)==0&&(e.y=i.y,l.y=i.y)),n<t.length-1&&s.push(l),e=l}if(s.length==1){var r=this.state.getVisibleTerminalState(!0),a=this.state.getVisibleTerminalState(!1),o=this.state.view.getScale(),h=this.state.view.getTranslate(),d=s[0].x*o+h.x,g=s[0].y*o+h.y;(r!=null&&mxUtils.contains(r,d,g)||a!=null&&mxUtils.contains(a,d,g))&&(s=[i,i])}return s}updatePreviewState(i,t,e,s){if(super.updatePreviewState(i,t,e,s),!this.isSource&&!this.isTarget){t=this.convertPoint(t.clone(),!1);for(var n=i.absolutePoints,l=n[0],r=n[1],a=[],o=2;o<n.length;o++){var h=n[o];(Math.round(l.x-r.x)!=0||Math.round(r.x-h.x)!=0)&&(Math.round(l.y-r.y)!=0||Math.round(r.y-h.y)!=0)&&a.push(this.convertPoint(r.clone(),!1)),l=r,r=h}var d=this.state.getVisibleTerminalState(!0),g=this.state.getVisibleTerminalState(!1),m=this.state.absolutePoints;if(a.length==0&&(Math.round(n[0].x-n[n.length-1].x)==0||Math.round(n[0].y-n[n.length-1].y)==0))a=[t,t];else if(n.length==5&&a.length==2&&d!=null&&g!=null&&m!=null&&Math.round(m[0].x-m[m.length-1].x)==0){var f=this.graph.getView(),c=f.getScale(),x=f.getTranslate(),p=f.getRoutingCenterY(d)/c-x.y,C=this.graph.getConnectionConstraint(i,d,!0);if(C!=null){var E=this.graph.getConnectionPoint(d,C);E!=null&&(this.convertPoint(E,!1),p=E.y)}var T=f.getRoutingCenterY(g)/c-x.y,S=this.graph.getConnectionConstraint(i,g,!1);if(S){var E=this.graph.getConnectionPoint(g,S);E!=null&&(this.convertPoint(E,!1),T=E.y)}a=[new mxPoint(t.x,p),new mxPoint(t.x,T)]}this.points=a,i.view.updateFixedTerminalPoints(i,d,g),i.view.updatePoints(i,this.points,d,g),i.view.updateFloatingTerminalPoints(i,d,g)}}connect(i,t,e,s,n){var l=this.graph.getModel(),r=l.getGeometry(i),a=null;if(r!=null&&r.points!=null&&r.points.length>0){var o=this.abspoints,h=o[0],d=o[1];a=[];for(var g=2;g<o.length;g++){var m=o[g];(Math.round(h.x-d.x)!=0||Math.round(d.x-m.x)!=0)&&(Math.round(h.y-d.y)!=0||Math.round(d.y-m.y)!=0)&&a.push(this.convertPoint(d.clone(),!1)),h=d,d=m}}l.beginUpdate();try{if(a!=null){var r=l.getGeometry(i);r!=null&&(r=r.clone(),r.points=a,l.setGeometry(i,r))}i=super.connect(i,t,e,s,n)}finally{l.endUpdate()}return i}getTooltipForNode(i){return null}start(i,t,e){super.start(i,t,e),this.bends!=null&&this.bends[e]!=null&&!this.isSource&&!this.isTarget&&mxUtils.setOpacity(this.bends[e].node,100)}createBends(){var i=[],n=this.createHandleShape(0);this.initBend(n),n.setCursor(mxConstants.CURSOR_TERMINAL_HANDLE),i.push(n);var t=this.getCurrentPoints();if(this.graph.isCellBendable(this.state.cell)){this.points==null&&(this.points=[]);for(var e=0;e<t.length-1;e++){n=this.createVirtualBend(),i.push(n);var s=Math.round(t[e].x-t[e+1].x)==0;Math.round(t[e].y-t[e+1].y)==0&&e<t.length-2&&(s=Math.round(t[e].x-t[e+2].x)==0),n.setCursor(s?"col-resize":"row-resize"),this.points.push(new mxPoint(0,0))}}var n=this.createHandleShape(t.length);return this.initBend(n),n.setCursor(mxConstants.CURSOR_TERMINAL_HANDLE),i.push(n),i}redraw(){this.refresh(),super.redraw()}redrawInnerBends(i,t){if(this.graph.isCellBendable(this.state.cell)){var e=this.getCurrentPoints();if(e!=null&&e.length>1){var s=!1;if(e.length==4&&Math.round(e[1].x-e[2].x)==0&&Math.round(e[1].y-e[2].y)==0)if(s=!0,Math.round(e[0].y-e[e.length-1].y)==0){var n=e[0].x+(e[e.length-1].x-e[0].x)/2;e[1]=new mxPoint(n,e[1].y),e[2]=new mxPoint(n,e[2].y)}else{var l=e[0].y+(e[e.length-1].y-e[0].y)/2;e[1]=new mxPoint(e[1].x,l),e[2]=new mxPoint(e[2].x,l)}for(var r=0;r<e.length-1;r++)if(this.bends[r+1]!=null){var i=e[r],t=e[r+1],a=new mxPoint(i.x+(t.x-i.x)/2,i.y+(t.y-i.y)/2),o=this.bends[r+1].bounds;this.bends[r+1].bounds=new mxRectangle(Math.floor(a.x-o.width/2),Math.floor(a.y-o.height/2),o.width,o.height),this.bends[r+1].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[r+1].bounds)}s&&(mxUtils.setOpacity(this.bends[1].node,this.virtualBendOpacity),mxUtils.setOpacity(this.bends[3].node,this.virtualBendOpacity))}}}}class mxEllipse extends mxShape{constructor(i,t,e,s){super(),this.bounds=i,this.fill=t,this.stroke=e,this.strokewidth=s??1}paintVertexShape(i,t,e,s,n){i.ellipse(t,e,s,n),i.fillAndStroke()}}class mxVertexHandler{constructor(i){u(this,"graph",null);u(this,"state",null);u(this,"singleSizer",!1);u(this,"index",null);u(this,"allowHandleBoundsCheck",!0);u(this,"handleImage",null);u(this,"tolerance",0);u(this,"rotationEnabled",!0);u(this,"parentHighlightEnabled",!1);u(this,"rotationRaster",!0);u(this,"rotationCursor","crosshair");u(this,"constrainGroupByChildren",!1);u(this,"horizontalOffset",0);u(this,"verticalOffset",0);i!=null&&(this.state=i,this.init(),this.escapeHandler=(t,e)=>{this.livePreview&&this.index!=null&&(this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate()),this.reset()},this.state.view.graph.addListener(mxEvent.ESCAPE,this.escapeHandler))}init(){if(this.graph=this.state.view.graph,this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.selectionBorder=this.createSelectionShape(this.bounds),this.selectionBorder.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.selectionBorder.pointerEvents=!1,this.selectionBorder.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"),this.selectionBorder.init(this.graph.getView().getOverlayPane()),mxEvent.redirectMouseEvents(this.selectionBorder.node,this.graph,this.state),this.graph.isCellMovable(this.state.cell)&&this.selectionBorder.setCursor(mxConstants.CURSOR_MOVABLE_VERTEX),mxGraphHandler.maxCells<=0||this.graph.getSelectionCount()<mxGraphHandler.maxCells){var i=this.graph.isCellResizable(this.state.cell);if(this.sizers=[],i||this.graph.isLabelMovable(this.state.cell)&&this.state.width>=2&&this.state.height>=2){var t=0;i&&(this.singleSizer||(this.sizers.push(this.createSizer("nw-resize",t++)),this.sizers.push(this.createSizer("n-resize",t++)),this.sizers.push(this.createSizer("ne-resize",t++)),this.sizers.push(this.createSizer("w-resize",t++)),this.sizers.push(this.createSizer("e-resize",t++)),this.sizers.push(this.createSizer("sw-resize",t++)),this.sizers.push(this.createSizer("s-resize",t++))),this.sizers.push(this.createSizer("se-resize",t++)));var e=this.graph.model.getGeometry(this.state.cell);e!=null&&!e.relative&&!this.graph.isSwimlane(this.state.cell)&&this.graph.isLabelMovable(this.state.cell)&&(this.labelShape=this.createSizer(mxConstants.CURSOR_LABEL_HANDLE,mxEvent.LABEL_HANDLE,mxConstants.LABEL_HANDLE_SIZE,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape))}else this.graph.isCellMovable(this.state.cell)&&!this.graph.isCellResizable(this.state.cell)&&this.state.width<2&&this.state.height<2&&(this.labelShape=this.createSizer(mxConstants.CURSOR_MOVABLE_VERTEX,mxEvent.LABEL_HANDLE,null,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape))}this.isRotationHandleVisible()&&(this.rotationShape=this.createSizer(this.rotationCursor,mxEvent.ROTATION_HANDLE,mxConstants.HANDLE_SIZE+3,mxConstants.HANDLE_FILLCOLOR),this.sizers.push(this.rotationShape)),this.customHandles=this.createCustomHandles(),this.redraw(),this.constrainGroupByChildren&&this.updateMinBounds()}isRotationHandleVisible(){return this.graph.isEnabled()&&this.rotationEnabled&&this.graph.isCellRotatable(this.state.cell)&&(mxGraphHandler.maxCells<=0||this.graph.getSelectionCount()<mxGraphHandler.maxCells)}isConstrainedEvent(i){return mxEvent.isShiftDown(i.getEvent())||this.state.style[mxConstants.STYLE_ASPECT]=="fixed"}isCenteredEvent(i,t){return!1}createCustomHandles(){return null}updateMinBounds(){var i=this.graph.getChildCells(this.state.cell);if(i.length>0&&(this.minBounds=this.graph.view.getBounds(i),this.minBounds!=null)){var t=this.state.view.scale,e=this.state.view.translate;this.minBounds.x-=this.state.x,this.minBounds.y-=this.state.y,this.minBounds.x/=t,this.minBounds.y/=t,this.minBounds.width/=t,this.minBounds.height/=t,this.x0=this.state.x/t-e.x,this.y0=this.state.y/t-e.y}}getSelectionBounds(i){return new mxRectangle(Math.round(i.x),Math.round(i.y),Math.round(i.width),Math.round(i.height))}createParentHighlightShape(i){return this.createSelectionShape(i)}createSelectionShape(i){var t=new mxRectangleShape(mxRectangle.fromRectangle(i),null,this.getSelectionColor());return t.strokewidth=this.getSelectionStrokeWidth(),t.isDashed=this.isSelectionDashed(),t}getSelectionColor(){return mxConstants.VERTEX_SELECTION_COLOR}getSelectionStrokeWidth(){return mxConstants.VERTEX_SELECTION_STROKEWIDTH}isSelectionDashed(){return mxConstants.VERTEX_SELECTION_DASHED}createSizer(i,t,e,s){e=e||mxConstants.HANDLE_SIZE;var n=new mxRectangle(0,0,e,e),l=this.createSizerShape(n,t,s);return l.isHtmlAllowed()&&this.state.text!=null&&this.state.text.node.parentNode==this.graph.container?(l.bounds.height-=1,l.bounds.width-=1,l.dialect=mxConstants.DIALECT_STRICTHTML,l.init(this.graph.container)):(l.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,l.init(this.graph.getView().getOverlayPane())),mxEvent.redirectMouseEvents(l.node,this.graph,this.state),this.graph.isEnabled()&&l.setCursor(i),this.isSizerVisible(t)||(l.visible=!1),l}isSizerVisible(i){return!0}createSizerShape(i,t,e){if(this.handleImage!=null){i=new mxRectangle(i.x,i.y,this.handleImage.width,this.handleImage.height);var s=new mxImageShape(i,this.handleImage.src);return s.preserveImageAspect=!1,s}else return t==mxEvent.ROTATION_HANDLE?new mxEllipse(i,e||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR):new mxRectangleShape(i,e||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)}moveSizerTo(i,t,e,s){i!=null&&(i.bounds.x=Math.floor(t-i.bounds.width/2),i.bounds.y=Math.floor(e-i.bounds.height/2),i.node!=null&&i.node.style.display!="none"&&i.redraw())}getHandleForEvent(i){var t=mxEvent.isMouseEvent(i.getEvent())?1:this.tolerance,e=this.allowHandleBoundsCheck&&t>0?new mxRectangle(i.getGraphX()-t,i.getGraphY()-t,2*t,2*t):null,s=l=>{var r=l!=null&&l.constructor!=mxImageShape&&this.allowHandleBoundsCheck?new mxRectangle(i.getGraphX()-l.svgStrokeTolerance,i.getGraphY()-l.svgStrokeTolerance,2*l.svgStrokeTolerance,2*l.svgStrokeTolerance):e;return l!=null&&(i.isSource(l)||r!=null&&mxUtils.intersects(l.bounds,r)&&l.node.style.display!="none"&&l.node.style.visibility!="hidden")};if(s(this.rotationShape))return mxEvent.ROTATION_HANDLE;if(s(this.labelShape))return mxEvent.LABEL_HANDLE;if(this.sizers!=null){for(var n=0;n<this.sizers.length;n++)if(s(this.sizers[n]))return n}if(this.customHandles!=null&&this.isCustomHandleEvent(i)){for(var n=this.customHandles.length-1;n>=0;n--)if(s(this.customHandles[n].shape))return mxEvent.CUSTOM_HANDLE-n}return null}isCustomHandleEvent(i){return!0}mouseDown(i,t){if(!t.isConsumed()&&this.graph.isEnabled()){var e=this.getHandleForEvent(t);e!=null&&(this.start(t.getGraphX(),t.getGraphY(),e),t.consume())}}isLivePreviewBorder(){return this.state.shape!=null&&this.state.shape.fill==null&&this.state.shape.stroke==null}start(i,t,e){if(this.selectionBorder!=null)if(this.livePreviewActive=this.livePreview&&this.graph.model.getChildCount(this.state.cell)==0,this.inTolerance=!0,this.childOffsetX=0,this.childOffsetY=0,this.index=e,this.startX=i,this.startY=t,this.index<=mxEvent.CUSTOM_HANDLE&&this.isGhostPreview())this.ghostPreview=this.createGhostPreview();else{var s=this.state.view.graph.model,n=s.getParent(this.state.cell);if(this.state.view.currentRoot!=n&&(s.isVertex(n)||s.isEdge(n))&&(this.parentState=this.state.view.graph.view.getState(n)),this.selectionBorder.node.style.display=e==mxEvent.ROTATION_HANDLE?"inline":"none",(!this.livePreviewActive||this.isLivePreviewBorder())&&(this.preview=this.createSelectionShape(this.bounds),!(mxClient.IS_SVG&&Number(this.state.style[mxConstants.STYLE_ROTATION]||"0")!=0)&&this.state.text!=null&&this.state.text.node.parentNode==this.graph.container?(this.preview.dialect=mxConstants.DIALECT_STRICTHTML,this.preview.init(this.graph.container)):(this.preview.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.preview.init(this.graph.view.getOverlayPane()))),e==mxEvent.ROTATION_HANDLE){var l=this.getRotationHandlePosition(),r=l.x-this.state.getCenterX(),a=l.y-this.state.getCenterY();this.startAngle=r!=0?Math.atan(a/r)*180/Math.PI+90:a<0?180:0,this.startDist=Math.sqrt(r*r+a*a)}if(this.livePreviewActive){this.hideSizers(),e==mxEvent.ROTATION_HANDLE?this.rotationShape.node.style.display="":e==mxEvent.LABEL_HANDLE?this.labelShape.node.style.display="":this.sizers!=null&&this.sizers[e]!=null?this.sizers[e].node.style.display="":e<=mxEvent.CUSTOM_HANDLE&&this.customHandles!=null&&this.customHandles[mxEvent.CUSTOM_HANDLE-e].setVisible(!0);var o=this.graph.getEdges(this.state.cell);this.edgeHandlers=[];for(var h=0;h<o.length;h++){var d=this.graph.selectionCellsHandler.getHandler(o[h]);d!=null&&this.edgeHandlers.push(d)}}}}createGhostPreview(){var i=this.graph.cellRenderer.createShape(this.state);return i.init(this.graph.view.getOverlayPane()),i.scale=this.state.view.scale,i.bounds=this.bounds,i.outline=!0,i}setHandlesVisible(i){if(this.sizers!=null)for(var t=0;t<this.sizers.length;t++)this.sizers[t].node.style.display=i?"":"none";if(this.customHandles!=null)for(var t=0;t<this.customHandles.length;t++)this.customHandles[t].setVisible(i)}hideSizers(){this.setHandlesVisible(!1)}checkTolerance(i){this.inTolerance&&this.startX!=null&&this.startY!=null&&(mxEvent.isMouseEvent(i.getEvent())||Math.abs(i.getGraphX()-this.startX)>this.graph.tolerance||Math.abs(i.getGraphY()-this.startY)>this.graph.tolerance)&&(this.inTolerance=!1)}updateHint(i){}removeHint(){}roundAngle(i){return Math.round(i*10)/10}roundLength(i){return Math.round(i*100)/100}mouseMove(i,t){!t.isConsumed()&&this.index!=null?(this.checkTolerance(t),this.inTolerance||(this.index<=mxEvent.CUSTOM_HANDLE?this.customHandles!=null&&(this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].processEvent(t),this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].active=!0,this.ghostPreview!=null?(this.ghostPreview.apply(this.state),this.ghostPreview.strokewidth=this.getSelectionStrokeWidth()/this.ghostPreview.scale/this.ghostPreview.scale,this.ghostPreview.isDashed=this.isSelectionDashed(),this.ghostPreview.stroke=this.getSelectionColor(),this.ghostPreview.redraw(),this.selectionBounds!=null&&(this.selectionBorder.node.style.display="none")):(this.moveToFront(),this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].positionChanged())):this.index==mxEvent.LABEL_HANDLE?this.moveLabel(t):this.index==mxEvent.ROTATION_HANDLE?this.rotateVertex(t):(this.resizeVertex(t),this.updateHint(t))),t.consume()):!this.graph.isMouseDown&&this.getHandleForEvent(t)!=null&&t.consume(!1)}isGhostPreview(){return this.state.view.graph.model.getChildCount(this.state.cell)>0}moveLabel(i){var t=new mxPoint(i.getGraphX(),i.getGraphY()),e=this.graph.view.translate,s=this.graph.view.scale;this.graph.isGridEnabledEvent(i.getEvent())&&(t.x=(this.graph.snap(t.x/s-e.x)+e.x)*s,t.y=(this.graph.snap(t.y/s-e.y)+e.y)*s);var n=this.rotationShape!=null?this.sizers.length-2:this.sizers.length-1;this.moveSizerTo(this.sizers[n],t.x,t.y,"A")}rotateVertex(i){var t=new mxPoint(i.getGraphX(),i.getGraphY()),e=this.state.x+this.state.width/2-t.x,s=this.state.y+this.state.height/2-t.y;if(this.currentAlpha=e!=0?Math.atan(s/e)*180/Math.PI+90:s<0?180:0,e>0&&(this.currentAlpha-=180),this.currentAlpha-=this.startAngle,this.rotationRaster&&this.graph.isGridEnabledEvent(i.getEvent())){var e=t.x-this.state.getCenterX(),s=t.y-this.state.getCenterY(),n=Math.sqrt(e*e+s*s),l;n-this.startDist<2?l=15:n-this.startDist<25?l=5:l=1,this.currentAlpha=Math.round(this.currentAlpha/l)*l}else this.currentAlpha=this.roundAngle(this.currentAlpha);this.selectionBorder.rotation=this.currentAlpha,this.selectionBorder.redraw(),this.livePreviewActive&&this.redrawHandles()}resizeVertex(i){var t=new mxPoint(this.state.getCenterX(),this.state.getCenterY()),e=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),s=new mxPoint(i.getGraphX(),i.getGraphY()),n=this.graph.view.translate,l=this.graph.view.scale,r=Math.cos(-e),a=Math.sin(-e),p=s.x-this.startX,C=s.y-this.startY,o=r*p-a*C,h=a*p+r*C;p=o,C=h;var d=this.graph.getCellGeometry(this.state.cell);if(this.unscaledBounds=this.union(d,p/l,C/l,this.index,this.graph.isGridEnabledEvent(i.getEvent()),1,new mxPoint(0,0),this.isConstrainedEvent(i),this.isCenteredEvent(this.state,i)),!d.relative){var g=this.graph.getMaximumGraphBounds();if(g!=null&&this.parentState!=null&&(g=mxRectangle.fromRectangle(g),g.x-=(this.parentState.x-n.x*l)/l,g.y-=(this.parentState.y-n.y*l)/l),this.graph.isConstrainChild(this.state.cell)){var m=this.graph.getCellContainmentArea(this.state.cell);if(m!=null){var f=this.graph.getOverlap(this.state.cell);f>0&&(m=mxRectangle.fromRectangle(m),m.x-=m.width*f,m.y-=m.height*f,m.width+=2*m.width*f,m.height+=2*m.height*f),g==null?g=m:(g=mxRectangle.fromRectangle(g),g.intersect(m))}}g!=null&&(this.unscaledBounds.x<g.x&&(this.unscaledBounds.width-=g.x-this.unscaledBounds.x,this.unscaledBounds.x=g.x),this.unscaledBounds.y<g.y&&(this.unscaledBounds.height-=g.y-this.unscaledBounds.y,this.unscaledBounds.y=g.y),this.unscaledBounds.x+this.unscaledBounds.width>g.x+g.width&&(this.unscaledBounds.width-=this.unscaledBounds.x+this.unscaledBounds.width-g.x-g.width),this.unscaledBounds.y+this.unscaledBounds.height>g.y+g.height&&(this.unscaledBounds.height-=this.unscaledBounds.y+this.unscaledBounds.height-g.y-g.height))}var c=this.bounds;this.bounds=new mxRectangle(Number((this.parentState!=null?this.parentState.x:n.x*l)+this.unscaledBounds.x*l),Number((this.parentState!=null?this.parentState.y:n.y*l)+this.unscaledBounds.y*l),this.unscaledBounds.width*l,this.unscaledBounds.height*l),d.relative&&this.parentState!=null&&(this.bounds.x+=this.state.x-this.parentState.x,this.bounds.y+=this.state.y-this.parentState.y),r=Math.cos(e),a=Math.sin(e);var x=new mxPoint(this.bounds.getCenterX(),this.bounds.getCenterY()),p=x.x-t.x,C=x.y-t.y,E=r*p-a*C,T=a*p+r*C,S=E-p,y=T-C,b=this.bounds.x-this.state.x,w=this.bounds.y-this.state.y,I=r*b-a*w,O=a*b+r*w;this.bounds.x+=S,this.bounds.y+=y,this.unscaledBounds.x=this.roundLength(this.unscaledBounds.x+S/l),this.unscaledBounds.y=this.roundLength(this.unscaledBounds.y+y/l),this.unscaledBounds.width=this.roundLength(this.unscaledBounds.width),this.unscaledBounds.height=this.roundLength(this.unscaledBounds.height),!this.graph.isCellCollapsed(this.state.cell)&&(S!=0||y!=0)?(this.childOffsetX=this.state.x-this.bounds.x+I,this.childOffsetY=this.state.y-this.bounds.y+O):(this.childOffsetX=0,this.childOffsetY=0),c.equals(this.bounds)||(this.livePreviewActive&&this.updateLivePreview(i),this.preview!=null?this.drawPreview():this.updateParentHighlight())}updateLivePreview(i){var t=this.graph.view.scale,e=this.graph.view.translate,s=this.state.clone();this.state.x=this.bounds.x,this.state.y=this.bounds.y,this.state.origin=new mxPoint(this.state.x/t-e.x,this.state.y/t-e.y),this.state.width=this.bounds.width,this.state.height=this.bounds.height;var n=this.state.absoluteOffset;n=new mxPoint(n.x,n.y),this.state.absoluteOffset.x=0,this.state.absoluteOffset.y=0;var l=this.graph.getCellGeometry(this.state.cell);if(l!=null){var r=l.offset||this.EMPTY_POINT;r!=null&&!l.relative&&(this.state.absoluteOffset.x=this.state.view.scale*r.x,this.state.absoluteOffset.y=this.state.view.scale*r.y),this.state.view.updateVertexLabelOffset(this.state)}this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate(),this.redrawHandles(),this.moveToFront(),this.state.control!=null&&this.state.control.node!=null&&(this.state.control.node.style.visibility="hidden"),this.state.setState(s)}moveToFront(){(this.state.text!=null&&this.state.text.node!=null&&this.state.text.node.nextSibling!=null||this.state.shape!=null&&this.state.shape.node!=null&&this.state.shape.node.nextSibling!=null&&(this.state.text==null||this.state.shape.node.nextSibling!=this.state.text.node))&&(this.state.shape!=null&&this.state.shape.node!=null&&this.state.shape.node.parentNode.appendChild(this.state.shape.node),this.state.text!=null&&this.state.text.node!=null&&this.state.text.node.parentNode.appendChild(this.state.text.node))}mouseUp(i,t){if(this.index!=null&&this.state!=null){var e=new mxPoint(t.getGraphX(),t.getGraphY()),s=this.index;this.index=null,this.ghostPreview==null&&(this.state.view.invalidate(this.state.cell,!1,!1),this.state.view.validate()),this.graph.getModel().beginUpdate();try{if(s<=mxEvent.CUSTOM_HANDLE){if(this.customHandles!=null){var n=this.state.view.graph.getCellStyle(this.state.cell);this.customHandles[mxEvent.CUSTOM_HANDLE-s].active=!1,this.customHandles[mxEvent.CUSTOM_HANDLE-s].execute(t),this.customHandles!=null&&this.customHandles[mxEvent.CUSTOM_HANDLE-s]!=null&&(this.state.style=n,this.customHandles[mxEvent.CUSTOM_HANDLE-s].positionChanged())}}else if(s==mxEvent.ROTATION_HANDLE)if(this.currentAlpha!=null){var l=this.currentAlpha-(this.state.style[mxConstants.STYLE_ROTATION]||0);l!=0&&this.rotateCell(this.state.cell,l)}else this.rotateClick();else{var r=this.graph.isGridEnabledEvent(t.getEvent()),a=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),o=Math.cos(-a),h=Math.sin(-a),d=e.x-this.startX,g=e.y-this.startY,m=o*d-h*g,f=h*d+o*g;d=m,g=f;var c=this.graph.view.scale,x=this.isRecursiveResize(this.state,t);this.resizeCell(this.state.cell,this.roundLength(d/c),this.roundLength(g/c),s,r,this.isConstrainedEvent(t),x)}}finally{this.graph.getModel().endUpdate()}t.consume(),this.reset()}}isRecursiveResize(i,t){return this.graph.isRecursiveResize(this.state)}rotateClick(){}rotateCell(i,t,e){if(t!=0){var s=this.graph.getModel();if(s.isVertex(i)||s.isEdge(i)){if(!s.isEdge(i)){var n=this.graph.getCurrentCellStyle(i),l=(n[mxConstants.STYLE_ROTATION]||0)+t;this.graph.setCellStyles(mxConstants.STYLE_ROTATION,l,[i])}var r=this.graph.getCellGeometry(i);if(r!=null){var a=this.graph.getCellGeometry(e);if(a!=null&&!s.isEdge(e)&&(r=r.clone(),r.rotate(t,new mxPoint(a.width/2,a.height/2)),s.setGeometry(i,r)),s.isVertex(i)&&!r.relative||s.isEdge(i))for(var o=s.getChildCount(i),h=0;h<o;h++)this.rotateCell(s.getChildAt(i,h),t,i)}}}}reset(){if(this.sizers!=null&&this.index!=null&&this.sizers[this.index]!=null&&this.sizers[this.index].node.style.display=="none"&&(this.sizers[this.index].node.style.display=""),this.currentAlpha=null,this.inTolerance=null,this.index=null,this.preview!=null&&(this.preview.destroy(),this.preview=null),this.ghostPreview!=null&&(this.ghostPreview.destroy(),this.ghostPreview=null),this.livePreviewActive&&this.sizers!=null){for(var i=0;i<this.sizers.length;i++)this.sizers[i]!=null&&(this.sizers[i].node.style.display="");this.state.control!=null&&this.state.control.node!=null&&(this.state.control.node.style.visibility="")}if(this.customHandles!=null)for(var i=0;i<this.customHandles.length;i++)this.customHandles[i].active?(this.customHandles[i].active=!1,this.customHandles[i].reset()):this.customHandles[i].setVisible(!0);this.selectionBorder!=null&&(this.selectionBorder.node.style.display="inline",this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview()),this.removeHint(),this.redrawHandles(),this.edgeHandlers=null,this.unscaledBounds=null,this.livePreviewActive=null}resizeCell(i,t,e,s,n,l,r){var a=this.graph.model.getGeometry(i);if(a!=null){if(s==mxEvent.LABEL_HANDLE){var o=-mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),h=Math.cos(o),d=Math.sin(o),g=this.graph.view.scale,m=mxUtils.getRotatedPoint(new mxPoint(Math.round((this.labelShape.bounds.getCenterX()-this.startX)/g),Math.round((this.labelShape.bounds.getCenterY()-this.startY)/g)),h,d);a=a.clone(),a.offset==null?a.offset=m:(a.offset.x+=m.x,a.offset.y+=m.y),this.graph.model.setGeometry(i,a)}else if(this.unscaledBounds!=null){var g=this.graph.view.scale;(this.childOffsetX!=0||this.childOffsetY!=0)&&this.moveChildren(i,Math.round(this.childOffsetX/g),Math.round(this.childOffsetY/g)),this.graph.resizeCell(i,this.unscaledBounds,r)}}}moveChildren(i,t,e){for(var s=this.graph.getModel(),n=s.getChildCount(i),l=0;l<n;l++){var r=s.getChildAt(i,l),a=this.graph.getCellGeometry(r);a!=null&&(a=a.clone(),a.translate(t,e),s.setGeometry(r,a))}}union(i,t,e,s,n,l,r,a,o){if(n=n!=null?n&&this.graph.gridEnabled:this.graph.gridEnabled,this.singleSizer){var h=i.x+i.width+t,d=i.y+i.height+e;n&&(h=this.graph.snap(h/l)*l,d=this.graph.snap(d/l)*l);var g=new mxRectangle(i.x,i.y,0,0);return g.add(new mxRectangle(h,d,0,0)),g}else{var m=i.width,f=i.height,c=i.x-r.x*l,x=c+m,p=i.y-r.y*l,C=p+f,E=c+m/2,T=p+f/2;s>4?(C=C+e,n?C=this.graph.snap(C/l)*l:C=Math.round(C/l)*l):s<3&&(p=p+e,n?p=this.graph.snap(p/l)*l:p=Math.round(p/l)*l),s==0||s==3||s==5?(c+=t,n?c=this.graph.snap(c/l)*l:c=Math.round(c/l)*l):(s==2||s==4||s==7)&&(x+=t,n?x=this.graph.snap(x/l)*l:x=Math.round(x/l)*l);var S=x-c,y=C-p;if(a){var b=this.graph.getCellGeometry(this.state.cell);if(b!=null){var w=b.width/b.height;s==1||s==2||s==7||s==6?S=y*w:y=S/w,s==0&&(c=x-S,p=C-y)}}if(o){S+=S-m,y+=y-f;var I=E-(c+S/2),O=T-(p+y/2);c+=I,p+=O,x+=I,C+=O}S<0&&(c+=S,S=Math.abs(S)),y<0&&(p+=y,y=Math.abs(y));var P=new mxRectangle(c+r.x*l,p+r.y*l,S,y);return this.minBounds!=null&&(P.width=Math.max(P.width,this.minBounds.x*l+this.minBounds.width*l+Math.max(0,this.x0*l-P.x)),P.height=Math.max(P.height,this.minBounds.y*l+this.minBounds.height*l+Math.max(0,this.y0*l-P.y))),P}}redraw(i){this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview(),i||this.redrawHandles()}getHandlePadding(){var i=new mxPoint(0,0),t=this.tolerance;return this.sizers!=null&&this.sizers.length>0&&this.sizers[0]!=null&&(this.bounds.width<2*this.sizers[0].bounds.width+2*t||this.bounds.height<2*this.sizers[0].bounds.height+2*t)&&(t/=2,i.x=this.sizers[0].bounds.width+t,i.y=this.sizers[0].bounds.height+t),i}getSizerBounds(){return this.bounds}redrawHandles(){var i=this.getSizerBounds(),t=this.tolerance;if(this.horizontalOffset=0,this.verticalOffset=0,this.state.view.scale>=.8)try{if(this.customHandles!=null)for(var e=0;e<this.customHandles.length;e++){var s=this.customHandles[e].shape.node.style.display;this.customHandles[e].redraw(),this.customHandles[e].shape.node.style.display=s,this.customHandles[e].shape.node.style.visibility=this.isCustomHandleVisible(this.customHandles[e])?"":"hidden"}}catch(p){console.log("ERROR",p)}if(this.sizers!=null&&this.sizers.length>0&&this.sizers[0]!=null){if(this.index==null&&this.manageSizers&&this.sizers.length>=8){var n=this.getHandlePadding();this.horizontalOffset=n.x,this.verticalOffset=n.y,(this.horizontalOffset!=0||this.verticalOffset!=0)&&(i=new mxRectangle(i.x,i.y,i.width,i.height),i.x-=this.horizontalOffset/2,i.width+=this.horizontalOffset,i.y-=this.verticalOffset/2,i.height+=this.verticalOffset),this.sizers.length>=8&&(i.width<2*this.sizers[0].bounds.width+2*t||i.height<2*this.sizers[0].bounds.height+2*t?(this.sizers[0].node.style.display="none",this.sizers[2].node.style.display="none",this.sizers[5].node.style.display="none",this.sizers[7].node.style.display="none"):(this.sizers[0].node.style.display="",this.sizers[2].node.style.display="",this.sizers[5].node.style.display="",this.sizers[7].node.style.display=""))}var l=i.x+i.width,r=i.y+i.height;if(this.singleSizer)this.moveSizerTo(this.sizers[0],l,r,"B");else{var a=i.x+i.width/2,o=i.y+i.height/2;if(this.sizers.length>=8){var h=["nw-resize","n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize"],d=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),g=Math.cos(d),m=Math.sin(d),f=Math.round(d*4/Math.PI),c=new mxPoint(i.getCenterX(),i.getCenterY()),x=mxUtils.getRotatedPoint(new mxPoint(i.x,i.y),g,m,c);this.moveSizerTo(this.sizers[0],x.x,x.y,"C"),this.sizers[0].setCursor(h[mxUtils.mod(0+f,h.length)]),x.x=a,x.y=i.y,x=mxUtils.getRotatedPoint(x,g,m,c),this.moveSizerTo(this.sizers[1],x.x,x.y,"D"),this.sizers[1].setCursor(h[mxUtils.mod(1+f,h.length)]),x.x=l,x.y=i.y,x=mxUtils.getRotatedPoint(x,g,m,c),this.moveSizerTo(this.sizers[2],x.x,x.y,"E"),this.sizers[2].setCursor(h[mxUtils.mod(2+f,h.length)]),x.x=i.x,x.y=o,x=mxUtils.getRotatedPoint(x,g,m,c),this.moveSizerTo(this.sizers[3],x.x,x.y,"F"),this.sizers[3].setCursor(h[mxUtils.mod(7+f,h.length)]),x.x=l,x.y=o,x=mxUtils.getRotatedPoint(x,g,m,c),this.moveSizerTo(this.sizers[4],x.x,x.y,"G"),this.sizers[4].setCursor(h[mxUtils.mod(3+f,h.length)]),x.x=i.x,x.y=r,x=mxUtils.getRotatedPoint(x,g,m,c),this.moveSizerTo(this.sizers[5],x.x,x.y,"H"),this.sizers[5].setCursor(h[mxUtils.mod(6+f,h.length)]),x.x=a,x.y=r,x=mxUtils.getRotatedPoint(x,g,m,c),this.moveSizerTo(this.sizers[6],x.x,x.y,"I"),this.sizers[6].setCursor(h[mxUtils.mod(5+f,h.length)]),x.x=l,x.y=r,x=mxUtils.getRotatedPoint(x,g,m,c),this.moveSizerTo(this.sizers[7],x.x,x.y,"J"),this.sizers[7].setCursor(h[mxUtils.mod(4+f,h.length)]),x.x=a+this.state.absoluteOffset.x,x.y=o+this.state.absoluteOffset.y,x=mxUtils.getRotatedPoint(x,g,m,c),this.moveSizerTo(this.sizers[8],x.x,x.y,"K")}else this.state.width>=2&&this.state.height>=2?this.moveSizerTo(this.sizers[0],a+this.state.absoluteOffset.x,o+this.state.absoluteOffset.y,"L"):this.moveSizerTo(this.sizers[0],this.state.x,this.state.y,"M")}}if(this.rotationShape!=null){var d=mxUtils.toRadians(this.currentAlpha!=null?this.currentAlpha:this.state.style[mxConstants.STYLE_ROTATION]||"0"),g=Math.cos(d),m=Math.sin(d),c=new mxPoint(this.state.getCenterX(),this.state.getCenterY()),x=mxUtils.getRotatedPoint(this.getRotationHandlePosition(),g,m,c);this.rotationShape.node!=null&&(this.moveSizerTo(this.rotationShape,x.x,x.y,"M"),this.rotationShape.node.style.visibility=this.state.view.graph.isEditing()?"hidden":"")}if(this.selectionBorder!=null&&(this.selectionBorder.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0")),this.edgeHandlers!=null)for(var e=0;e<this.edgeHandlers.length;e++)this.edgeHandlers[e].redraw()}isCustomHandleVisible(i){return!this.graph.isEditing()&&this.state.view.graph.getSelectionCount()==1}getRotationHandlePosition(){return new mxPoint(this.bounds.x+this.bounds.width/2,this.bounds.y+this.rotationHandleVSpacing)}isParentHighlightVisible(){return!0}updateParentHighlight(){if(this.selectionBorder!=null&&this.isParentHighlightVisible()){if(this.parentHighlight!=null){var i=this.graph.model.getParent(this.state.cell);if(this.graph.model.isVertex(i)){var t=this.graph.view.getState(i),e=this.parentHighlight.bounds;t!=null&&(e.x!=t.x||e.y!=t.y||e.width!=t.width||e.height!=t.height)&&(this.parentHighlight.bounds=mxRectangle.fromRectangle(t),this.parentHighlight.redraw())}else this.parentHighlight.destroy(),this.parentHighlight=null}else if(this.parentHighlightEnabled){var i=this.graph.model.getParent(this.state.cell);if(this.graph.model.isVertex(i)){var t=this.graph.view.getState(i);t!=null&&(this.parentHighlight=this.createParentHighlightShape(t),this.parentHighlight.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.parentHighlight.pointerEvents=!1,this.parentHighlight.rotation=Number(t.style[mxConstants.STYLE_ROTATION]||"0"),this.parentHighlight.init(this.graph.getView().getOverlayPane()),this.parentHighlight.redraw())}}}}drawPreview(){this.preview!=null&&(this.preview.bounds=this.bounds,this.preview.node.parentNode==this.graph.container&&(this.preview.bounds.width=Math.max(0,this.preview.bounds.width-1),this.preview.bounds.height=Math.max(0,this.preview.bounds.height-1)),this.preview.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"),this.preview.redraw()),this.selectionBorder.bounds=this.getSelectionBorderBounds(),this.selectionBorder.redraw(),this.updateParentHighlight()}getSelectionBorderBounds(){return this.bounds}destroy(){if(this.escapeHandler!=null&&(this.state.view.graph.removeListener(this.escapeHandler),this.escapeHandler=null),this.preview!=null&&(this.preview.destroy(),this.preview=null),this.parentHighlight!=null&&(this.parentHighlight.destroy(),this.parentHighlight=null),this.ghostPreview!=null&&(this.ghostPreview.destroy(),this.ghostPreview=null),this.selectionBorder!=null&&(this.selectionBorder.destroy(),this.selectionBorder=null),this.labelShape=null,this.removeHint(),this.sizers!=null){for(var i=0;i<this.sizers.length;i++)this.sizers[i].destroy();this.sizers=null}if(this.customHandles!=null){for(var i=0;i<this.customHandles.length;i++)this.customHandles[i].destroy();this.customHandles=null}}}u(mxVertexHandler,"livePreview",!1),u(mxVertexHandler,"manageSizers",!1),u(mxVertexHandler,"rotationHandleVSpacing",-16);class mxLabel extends mxRectangleShape{constructor(t,e,s,n){super(t,e,s,n);u(this,"spacing",2);u(this,"indicatorSize",10);u(this,"indicatorSpacing",2)}init(t){super.init(t),this.indicatorShape!=null&&(this.indicator=new this.indicatorShape,this.indicator.dialect=this.dialect,this.indicator.init(this.node))}redraw(){this.indicator!=null&&(this.indicator.fill=this.indicatorColor,this.indicator.stroke=this.indicatorStrokeColor,this.indicator.gradient=this.indicatorGradientColor,this.indicator.direction=this.indicatorDirection,this.indicator.redraw()),super.redraw()}isHtmlAllowed(){return super.isHtmlAllowed()&&this.indicatorColor==null&&this.indicatorShape==null}paintForeground(t,e,s,n,l){this.paintImage(t,e,s,n,l),this.paintIndicator(t,e,s,n,l),super.paintForeground(t,e,s,n,l)}paintImage(t,e,s,n,l){if(this.image!=null){var r=this.getImageBounds(e,s,n,l);t.image(r.x,r.y,r.width,r.height,this.image,!1,!1,!1)}}getImageBounds(t,e,s,n){var l=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_ALIGN,mxConstants.ALIGN_LEFT),r=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE),a=mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_WIDTH,mxConstants.DEFAULT_IMAGESIZE),o=mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_HEIGHT,mxConstants.DEFAULT_IMAGESIZE),h=mxUtils.getNumber(this.style,mxConstants.STYLE_SPACING,this.spacing)+5;return l==mxConstants.ALIGN_CENTER?t+=(s-a)/2:l==mxConstants.ALIGN_RIGHT?t+=s-a-h:t+=h,r==mxConstants.ALIGN_TOP?e+=h:r==mxConstants.ALIGN_BOTTOM?e+=n-o-h:e+=(n-o)/2,new mxRectangle(t,e,a,o)}paintIndicator(t,e,s,n,l){if(this.indicator!=null)this.indicator.bounds=this.getIndicatorBounds(e,s,n,l),this.indicator.paint(t);else if(this.indicatorImage!=null){var r=this.getIndicatorBounds(e,s,n,l);t.image(r.x,r.y,r.width,r.height,this.indicatorImage,!1,!1,!1)}}getIndicatorBounds(t,e,s,n){var l=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_ALIGN,mxConstants.ALIGN_LEFT),r=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE),a=mxUtils.getNumber(this.style,mxConstants.STYLE_INDICATOR_WIDTH,this.indicatorSize),o=mxUtils.getNumber(this.style,mxConstants.STYLE_INDICATOR_HEIGHT,this.indicatorSize),h=this.spacing+5;return l==mxConstants.ALIGN_RIGHT?t+=s-a-h:l==mxConstants.ALIGN_CENTER?t+=(s-a)/2:t+=h,r==mxConstants.ALIGN_BOTTOM?e+=n-o-h:r==mxConstants.ALIGN_TOP?e+=h:e+=(n-o)/2,new mxRectangle(t,e,a,o)}redrawHtmlShape(){for(super.redrawHtmlShape();this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);if(this.image!=null){var t=document.createElement("img");t.style.position="relative",t.setAttribute("border","0");var e=this.getImageBounds(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height);e.x-=this.bounds.x,e.y-=this.bounds.y,t.style.left=Math.round(e.x)+"px",t.style.top=Math.round(e.y)+"px",t.style.width=Math.round(e.width)+"px",t.style.height=Math.round(e.height)+"px",t.src=this.image,this.node.appendChild(t)}}}u(mxLabel,"imageSize",mxConstants.DEFAULT_IMAGESIZE);class mxPanningManager{constructor(i){u(this,"damper",1/6);u(this,"delay",10);u(this,"handleMouseOut",!0);u(this,"border",0);this.thread=null,this.active=!1,this.tdx=0,this.tdy=0,this.t0x=0,this.t0y=0,this.dx=0,this.dy=0,this.scrollbars=!1,this.scrollLeft=0,this.scrollTop=0,this.mouseListener={mouseDown:function(e,s){},mouseMove:function(e,s){},mouseUp:(e,s)=>{this.active&&this.stop()}},i.addMouseListener(this.mouseListener),this.mouseUpListener=()=>{this.active&&this.stop()},mxEvent.addListener(document,"mouseup",this.mouseUpListener);var t=()=>(this.scrollbars=mxUtils.hasScrollbars(i.container),this.scrollLeft=i.container.scrollLeft,this.scrollTop=i.container.scrollTop,window.setInterval(()=>{if(this.tdx-=this.dx,this.tdy-=this.dy,this.scrollbars){var e=-i.container.scrollLeft-Math.ceil(this.dx),s=-i.container.scrollTop-Math.ceil(this.dy);i.panGraph(e,s),i.panDx=this.scrollLeft-i.container.scrollLeft,i.panDy=this.scrollTop-i.container.scrollTop,i.fireEvent(new mxEventObject(mxEvent.PAN))}else i.panGraph(this.getDx(),this.getDy())},this.delay));this.isActive=function(){return this.active},this.getDx=function(){return Math.round(this.tdx)},this.getDy=function(){return Math.round(this.tdy)},this.start=function(){this.t0x=i.view.translate.x,this.t0y=i.view.translate.y,this.active=!0},this.panTo=function(e,s,n,l){this.active||this.start(),this.scrollLeft=i.container.scrollLeft,this.scrollTop=i.container.scrollTop,n=n??0,l=l??0;var r=i.container;this.dx=e+n-r.scrollLeft-r.clientWidth,this.dx<0&&Math.abs(this.dx)<this.border?this.dx=this.border+this.dx:this.handleMouseOut?this.dx=Math.max(this.dx,0):this.dx=0,this.dx==0&&(this.dx=e-r.scrollLeft,this.dx>0&&this.dx<this.border?this.dx=this.dx-this.border:this.handleMouseOut?this.dx=Math.min(0,this.dx):this.dx=0),this.dy=s+l-r.scrollTop-r.clientHeight,this.dy<0&&Math.abs(this.dy)<this.border?this.dy=this.border+this.dy:this.handleMouseOut?this.dy=Math.max(this.dy,0):this.dy=0,this.dy==0&&(this.dy=s-r.scrollTop,this.dy>0&&this.dy<this.border?this.dy=this.dy-this.border:this.handleMouseOut?this.dy=Math.min(0,this.dy):this.dy=0),this.dx!=0||this.dy!=0?(this.dx*=this.damper,this.dy*=this.damper,this.thread==null&&(this.thread=t())):this.thread!=null&&(window.clearInterval(this.thread),this.thread=null)},this.stop=function(){if(this.active)if(this.active=!1,this.thread!=null&&(window.clearInterval(this.thread),this.thread=null),this.tdx=0,this.tdy=0,this.scrollbars)i.panDx=0,i.panDy=0,i.fireEvent(new mxEventObject(mxEvent.PAN));else{var e=i.panDx,s=i.panDy;(e!=0||s!=0)&&(i.panGraph(0,0),i.view.setTranslate(this.t0x+e/i.view.scale,this.t0y+s/i.view.scale))}},this.destroy=function(){i.removeMouseListener(this.mouseListener),mxEvent.removeListener(document,"mouseup",this.mouseUpListener)}}}class mxCellOverlay extends mxEventSource{constructor(t,e,s,n,l,r){super();u(this,"defaultOverlap",.5);this.image=t,this.tooltip=e,this.align=s??this.align,this.verticalAlign=n??this.verticalAlign,this.offset=l??new mxPoint,this.cursor=r??"help"}getBounds(t){var e=t.view.graph.getModel().isEdge(t.cell),s=t.view.scale,n=null,l=this.image.width,r=this.image.height;if(e){var a=t.absolutePoints;if(a.length%2==1)n=a[Math.floor(a.length/2)];else{var o=a.length/2,h=a[o-1],d=a[o];n=new mxPoint(h.x+(d.x-h.x)/2,h.y+(d.y-h.y)/2)}}else n=new mxPoint,this.align==mxConstants.ALIGN_LEFT?n.x=t.x:this.align==mxConstants.ALIGN_CENTER?n.x=t.x+t.width/2:n.x=t.x+t.width,this.verticalAlign==mxConstants.ALIGN_TOP?n.y=t.y:this.verticalAlign==mxConstants.ALIGN_MIDDLE?n.y=t.y+t.height/2:n.y=t.y+t.height;return new mxRectangle(Math.round(n.x-(l*this.defaultOverlap-this.offset.x)*s),Math.round(n.y-(r*this.defaultOverlap-this.offset.y)*s),l*s,r*s)}toString(){return this.tooltip}}class mxRootChange{constructor(i,t){this.model=i,this.root=t,this.previous=t}execute(){this.root=this.previous,this.previous=this.model.rootChanged(this.previous)}}class mxCellEditor{constructor(i){u(this,"textarea",null);u(this,"editingCell",null);u(this,"trigger",null);u(this,"modified",!1);u(this,"autoSize",!0);u(this,"selectText",!0);u(this,"emptyLabelText",mxClient.IS_FF?"<br>":"");u(this,"escapeCancelsEditing",!0);u(this,"textNode","");u(this,"zIndex",5);u(this,"minResize",new mxRectangle(0,20));u(this,"wordWrapPadding",mxClient.IS_QUIRKS?2:mxClient.IS_IE11?0:1);u(this,"blurEnabled",!1);u(this,"initialValue",null);u(this,"align",null);this.graph=i,this.zoomHandler=()=>{this.graph.isEditing()&&this.resize()},this.graph.view.addListener(mxEvent.SCALE,this.zoomHandler),this.graph.view.addListener(mxEvent.SCALE_AND_TRANSLATE,this.zoomHandler),this.changeHandler=t=>{this.editingCell!=null&&this.graph.getView().getState(this.editingCell)==null&&this.stopEditing(!0)},this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler)}init(){this.textarea=document.createElement("div"),this.textarea.className="mxCellEditor mxPlainTextEditor",this.textarea.contentEditable=!0,mxClient.IS_GC&&(this.textarea.style.minHeight="1em"),this.textarea.style.position=this.isLegacyEditor()?"absolute":"relative",this.installListeners(this.textarea)}applyValue(i,t){this.graph.labelChanged(i.cell,t,this.trigger)}setAlign(i){this.textarea!=null&&(this.textarea.style.textAlign=i),this.align=i,this.resize()}getInitialValue(i,t){var e=mxUtils.htmlEntities(this.graph.getEditingValue(i.cell,t),!1);return!mxClient.IS_QUIRKS&&document.documentMode!=8&&document.documentMode!=9&&document.documentMode!=10&&(e=mxUtils.replaceTrailingNewlines(e,"<div><br></div>")),e.replace(/\n/g,"<br>")}getCurrentValue(i){return mxUtils.extractTextWithWhitespace(this.textarea.childNodes)}isCancelEditingKeyEvent(i){return this.escapeCancelsEditing||mxEvent.isShiftDown(i)||mxEvent.isControlDown(i)||mxEvent.isMetaDown(i)}installListeners(i){mxEvent.addListener(i,"dragstart",l=>{this.graph.stopEditing(!1),mxEvent.consume(l)}),mxEvent.addListener(i,"blur",l=>{this.blurEnabled&&this.focusLost(l)}),mxEvent.addListener(i,"keydown",l=>{mxEvent.isConsumed(l)||(this.isStopEditingEvent(l)?(this.graph.stopEditing(!1),mxEvent.consume(l)):l.keyCode==27&&(this.graph.stopEditing(this.isCancelEditingKeyEvent(l)),mxEvent.consume(l)))});var t=l=>{this.editingCell!=null&&this.clearOnChange&&i.innerHTML==this.getEmptyLabelText()&&(!mxClient.IS_FF||l.keyCode!=8&&l.keyCode!=46)&&(this.clearOnChange=!1,i.innerHTML="")};mxEvent.addListener(i,"keypress",t),mxEvent.addListener(i,"paste",t);var e=l=>{this.editingCell!=null&&(this.textarea.innerHTML.length==0||this.textarea.innerHTML=="<br>"?(this.textarea.innerHTML=this.getEmptyLabelText(),this.clearOnChange=this.textarea.innerHTML.length>0):this.clearOnChange=!1)};mxEvent.addListener(i,mxClient.IS_IE11?"keyup":"input",e),mxEvent.addListener(i,"cut",e),mxEvent.addListener(i,"paste",e);var s=mxClient.IS_IE11?"keydown":"input",n=l=>{this.editingCell!=null&&this.autoSize&&!mxEvent.isConsumed(l)&&(this.resizeThread!=null&&window.clearTimeout(this.resizeThread),this.resizeThread=window.setTimeout(()=>{this.resizeThread=null,this.resize()},0))};mxEvent.addListener(i,s,n),mxEvent.addListener(window,"resize",n),document.documentMode>=9?(mxEvent.addListener(i,"DOMNodeRemoved",n),mxEvent.addListener(i,"DOMNodeInserted",n)):(mxEvent.addListener(i,"cut",n),mxEvent.addListener(i,"paste",n))}isStopEditingEvent(i){return i.keyCode==113||this.graph.isEnterStopsCellEditing()&&i.keyCode==13&&!mxEvent.isControlDown(i)&&!mxEvent.isShiftDown(i)}isEventSource(i){return mxEvent.getSource(i)==this.textarea}resize(){var i=this.graph.getView().getState(this.editingCell);if(i==null)this.stopEditing(!0);else if(this.textarea!=null){var t=this.graph.getModel().isEdge(i.cell),e=this.graph.getView().scale,s=null;if(!this.autoSize||i.style[mxConstants.STYLE_OVERFLOW]=="fill")this.bounds=this.getEditorBounds(i),this.textarea.style.width=Math.round(this.bounds.width/e)+"px",this.textarea.style.height=Math.round(this.bounds.height/e)+"px",document.documentMode==8||mxClient.IS_QUIRKS?(this.textarea.style.left=Math.round(this.bounds.x)+"px",this.textarea.style.top=Math.round(this.bounds.y)+"px"):(this.textarea.style.left=Math.max(0,Math.round(this.bounds.x+1))+"px",this.textarea.style.top=Math.max(0,Math.round(this.bounds.y+1))+"px"),this.graph.isWrapping(i.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!=this.getEmptyLabelText()?(this.textarea.style.wordWrap=mxConstants.WORD_WRAP,this.textarea.style.whiteSpace="normal",i.style[mxConstants.STYLE_OVERFLOW]!="fill"&&(this.textarea.style.width=Math.round(this.bounds.width/e)+this.wordWrapPadding+"px")):(this.textarea.style.whiteSpace="nowrap",i.style[mxConstants.STYLE_OVERFLOW]!="fill"&&(this.textarea.style.width=""));else{var n=mxUtils.getValue(i.style,mxConstants.STYLE_LABEL_WIDTH,null);if(s=i.text!=null&&this.align==null?i.text.margin:null,s==null&&(s=mxUtils.getAlignmentAsPoint(this.align||mxUtils.getValue(i.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER),mxUtils.getValue(i.style,mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE))),t){if(this.bounds=new mxRectangle(i.absoluteOffset.x,i.absoluteOffset.y,0,0),n!=null){var l=(parseFloat(n)+2)*e;this.bounds.width=l,this.bounds.x+=s.x*l}}else{var r=mxRectangle.fromRectangle(i),a=mxUtils.getValue(i.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),o=mxUtils.getValue(i.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);if(r=i.shape!=null&&a==mxConstants.ALIGN_CENTER&&o==mxConstants.ALIGN_MIDDLE?i.shape.getLabelBounds(r):r,n!=null&&(r.width=parseFloat(n)*e),!i.view.graph.cellRenderer.legacySpacing||i.style[mxConstants.STYLE_OVERFLOW]!="width"){var h=parseInt(i.style[mxConstants.STYLE_SPACING]||2)*e,d=(parseInt(i.style[mxConstants.STYLE_SPACING_TOP]||0)+mxText.baseSpacingTop)*e+h,g=(parseInt(i.style[mxConstants.STYLE_SPACING_RIGHT]||0)+mxText.baseSpacingRight)*e+h,m=(parseInt(i.style[mxConstants.STYLE_SPACING_BOTTOM]||0)+mxText.baseSpacingBottom)*e+h,f=(parseInt(i.style[mxConstants.STYLE_SPACING_LEFT]||0)+mxText.baseSpacingLeft)*e+h,a=mxUtils.getValue(i.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),o=mxUtils.getValue(i.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);r=new mxRectangle(r.x+f,r.y+d,r.width-(a==mxConstants.ALIGN_CENTER&&n==null?f+g:0),r.height-(o==mxConstants.ALIGN_MIDDLE?d+m:0))}this.bounds=new mxRectangle(r.x+i.absoluteOffset.x,r.y+i.absoluteOffset.y,r.width,r.height)}if(this.graph.isWrapping(i.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!=this.getEmptyLabelText()){this.textarea.style.wordWrap=mxConstants.WORD_WRAP,this.textarea.style.whiteSpace="normal";var l=Math.round(this.bounds.width/(document.documentMode==8,e))+this.wordWrapPadding;this.textarea.style.position!="relative"?(this.textarea.style.width=l+"px",this.textarea.scrollWidth>l&&(this.textarea.style.width=this.textarea.scrollWidth+"px")):this.textarea.style.maxWidth=l+"px"}else this.textarea.style.whiteSpace="nowrap",this.textarea.style.width="";document.documentMode==8&&(this.textarea.style.zoom="1",this.textarea.style.height="auto");var c=this.textarea.scrollWidth,x=this.textarea.scrollHeight;document.documentMode==8?(this.textarea.style.left=Math.max(0,Math.ceil((this.bounds.x-s.x*(this.bounds.width-(c+1)*e)+c*(e-1)*0+(s.x+.5)*2)/e))+"px",this.textarea.style.top=Math.max(0,Math.ceil((this.bounds.y-s.y*(this.bounds.height-(x+.5)*e)+x*(e-1)*0+Math.abs(s.y+.5)*1)/e))+"px",this.textarea.style.width=Math.round(c*e)+"px",this.textarea.style.height=Math.round(x*e)+"px"):mxClient.IS_QUIRKS?(this.textarea.style.left=Math.max(0,Math.ceil(this.bounds.x-s.x*(this.bounds.width-(c+1)*e)+c*(e-1)*0+(s.x+.5)*2))+"px",this.textarea.style.top=Math.max(0,Math.ceil(this.bounds.y-s.y*(this.bounds.height-(x+.5)*e)+x*(e-1)*0+Math.abs(s.y+.5)*1))+"px"):(this.textarea.style.left=Math.max(0,Math.round(this.bounds.x-s.x*(this.bounds.width-2))+1)+"px",this.textarea.style.top=Math.max(0,Math.round(this.bounds.y-s.y*(this.bounds.height-4)+(s.y==-1?3:0))+1)+"px")}mxUtils.setPrefixedStyle(this.textarea.style,"transformOrigin","0px 0px"),mxUtils.setPrefixedStyle(this.textarea.style,"transform","scale("+e+","+e+")"+(s==null?"":" translate("+s.x*100+"%,"+s.y*100+"%)"))}}focusLost(){this.stopEditing(!this.graph.isInvokesStopCellEditing())}getBackgroundColor(i){return null}isLegacyEditor(){var i=!1;if(mxClient.IS_SVG){var t=this.graph.view.getDrawPane().ownerSVGElement;if(t!=null){var e=mxUtils.getCurrentStyle(t);e!=null&&(i=e.position=="absolute")}}return!i}startEditing(i,t){this.stopEditing(!0),this.align=null,this.textarea==null&&this.init(),this.graph.tooltipHandler!=null&&this.graph.tooltipHandler.hideTooltip();var e=this.graph.getView().getState(i);if(e!=null){this.graph.getView().scale;var s=mxUtils.getValue(e.style,mxConstants.STYLE_FONTSIZE,mxConstants.DEFAULT_FONTSIZE),n=mxUtils.getValue(e.style,mxConstants.STYLE_FONTFAMILY,mxConstants.DEFAULT_FONTFAMILY),l=mxUtils.getValue(e.style,mxConstants.STYLE_FONTCOLOR,"black"),r=mxUtils.getValue(e.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT),a=(mxUtils.getValue(e.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD,o=(mxUtils.getValue(e.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC,h=[];(mxUtils.getValue(e.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&h.push("underline"),(mxUtils.getValue(e.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_STRIKETHROUGH)==mxConstants.FONT_STRIKETHROUGH&&h.push("line-through"),this.textarea.style.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?Math.round(s*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT,this.textarea.style.backgroundColor=this.getBackgroundColor(e),this.textarea.style.textDecoration=h.join(" "),this.textarea.style.fontWeight=a?"bold":"normal",this.textarea.style.fontStyle=o?"italic":"",this.textarea.style.fontSize=Math.round(s)+"px",this.textarea.style.zIndex=this.zIndex,this.textarea.style.fontFamily=n,this.textarea.style.textAlign=r,this.textarea.style.outline="none",this.textarea.style.color=l;var d=this.textDirection=mxUtils.getValue(e.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION);d==mxConstants.TEXT_DIRECTION_AUTO&&e!=null&&e.text!=null&&e.text.dialect!=mxConstants.DIALECT_STRICTHTML&&!mxUtils.isNode(e.text.value)&&(d=e.text.getAutoDirection()),d==mxConstants.TEXT_DIRECTION_LTR||d==mxConstants.TEXT_DIRECTION_RTL?this.textarea.setAttribute("dir",d):this.textarea.removeAttribute("dir"),this.textarea.innerHTML=this.getInitialValue(e,t)||"",this.initialValue=this.textarea.innerHTML,this.textarea.innerHTML.length==0||this.textarea.innerHTML=="<br>"?(this.textarea.innerHTML=this.getEmptyLabelText(),this.clearOnChange=!0):this.clearOnChange=this.textarea.innerHTML==this.getEmptyLabelText(),this.graph.container.appendChild(this.textarea),this.editingCell=i,this.trigger=t,this.textNode=null,e.text!=null&&this.isHideLabel(e)&&(this.textNode=e.text.node,this.textNode.style.visibility="hidden"),this.autoSize&&(this.graph.model.isEdge(e.cell)||e.style[mxConstants.STYLE_OVERFLOW]!="fill")&&window.setTimeout(()=>{this.resize()},0),this.resize();try{this.textarea.focus(),this.isSelectText()&&this.textarea.innerHTML.length>0&&(this.textarea.innerHTML!=this.getEmptyLabelText()||!this.clearOnChange)&&document.execCommand("selectAll",!1,null)}catch{}}}isSelectText(){return this.selectText}clearSelection(){var i=null;window.getSelection?i=window.getSelection():document.selection&&(i=document.selection),i!=null&&(i.empty?i.empty():i.removeAllRanges&&i.removeAllRanges())}stopEditing(i){if(i=i||!1,this.editingCell!=null){this.textNode!=null&&(this.textNode.style.visibility="visible",this.textNode=null);var t=i?null:this.graph.view.getState(this.editingCell),e=this.initialValue;if(this.initialValue=null,this.editingCell=null,this.trigger=null,this.bounds=null,this.textarea.blur(),this.clearSelection(),this.textarea.parentNode!=null&&this.textarea.parentNode.removeChild(this.textarea),this.clearOnChange&&this.textarea.innerHTML==this.getEmptyLabelText()&&(this.textarea.innerHTML="",this.clearOnChange=!1),t!=null&&(this.textarea.innerHTML!=e||this.align!=null)){this.prepareTextarea();var s=this.getCurrentValue(t);this.graph.getModel().beginUpdate();try{s!=null&&this.applyValue(t,s),this.align!=null&&this.graph.setCellStyles(mxConstants.STYLE_ALIGN,this.align,[t.cell])}finally{this.graph.getModel().endUpdate()}}mxEvent.release(this.textarea),this.textarea=null,this.align=null}}prepareTextarea(){this.textarea.lastChild!=null&&this.textarea.lastChild.nodeName=="BR"&&this.textarea.removeChild(this.textarea.lastChild)}isHideLabel(i){return!0}getMinimumSize(i){var t=this.graph.getView().scale;return new mxRectangle(0,0,i.text==null?30:i.text.size*t+20,this.textarea.style.textAlign=="left"?120:40)}getEditorBounds(i){var t=this.graph.getModel().isEdge(i.cell),e=this.graph.getView().scale,s=this.getMinimumSize(i),n=s.width,l=s.height,r=null;if(!t&&i.view.graph.cellRenderer.legacySpacing&&i.style[mxConstants.STYLE_OVERFLOW]=="fill")r=i.shape.getLabelBounds(mxRectangle.fromRectangle(i));else{var a=parseInt(i.style[mxConstants.STYLE_SPACING]||0)*e,o=(parseInt(i.style[mxConstants.STYLE_SPACING_TOP]||0)+mxText.baseSpacingTop)*e+a,h=(parseInt(i.style[mxConstants.STYLE_SPACING_RIGHT]||0)+mxText.baseSpacingRight)*e+a,d=(parseInt(i.style[mxConstants.STYLE_SPACING_BOTTOM]||0)+mxText.baseSpacingBottom)*e+a,g=(parseInt(i.style[mxConstants.STYLE_SPACING_LEFT]||0)+mxText.baseSpacingLeft)*e+a;r=new mxRectangle(i.x,i.y,Math.max(n,i.width-g-h),Math.max(l,i.height-o-d));var m=mxUtils.getValue(i.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),f=mxUtils.getValue(i.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);if(r=i.shape!=null&&m==mxConstants.ALIGN_CENTER&&f==mxConstants.ALIGN_MIDDLE?i.shape.getLabelBounds(r):r,t?(r.x=i.absoluteOffset.x,r.y=i.absoluteOffset.y,i.text!=null&&i.text.boundingBox!=null&&(i.text.boundingBox.x>0&&(r.x=i.text.boundingBox.x),i.text.boundingBox.y>0&&(r.y=i.text.boundingBox.y))):i.text!=null&&i.text.boundingBox!=null&&(r.x=Math.min(r.x,i.text.boundingBox.x),r.y=Math.min(r.y,i.text.boundingBox.y)),r.x+=g,r.y+=o,i.text!=null&&i.text.boundingBox!=null&&(t?(r.width=Math.max(n,i.text.boundingBox.width),r.height=Math.max(l,i.text.boundingBox.height)):(r.width=Math.max(r.width,i.text.boundingBox.width),r.height=Math.max(r.height,i.text.boundingBox.height))),this.graph.getModel().isVertex(i.cell)){var c=mxUtils.getValue(i.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER);c==mxConstants.ALIGN_LEFT?r.x-=i.width:c==mxConstants.ALIGN_RIGHT&&(r.x+=i.width);var x=mxUtils.getValue(i.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);x==mxConstants.ALIGN_TOP?r.y-=i.height:x==mxConstants.ALIGN_BOTTOM&&(r.y+=i.height)}}return new mxRectangle(Math.round(r.x),Math.round(r.y),Math.round(r.width),Math.round(r.height))}getEmptyLabelText(i){return this.emptyLabelText}getEditingCell(){return this.editingCell}destroy(){this.textarea!=null&&(mxEvent.release(this.textarea),this.textarea.parentNode!=null&&this.textarea.parentNode.removeChild(this.textarea),this.textarea=null),this.changeHandler!=null&&(this.graph.getModel().removeListener(this.changeHandler),this.changeHandler=null),this.zoomHandler&&(this.graph.view.removeListener(this.zoomHandler),this.zoomHandler=null)}}const mt=class mt{static putValue(i,t){mt.values[i]=t}static getValue(i){return mt.values[i]}static getName(i){for(var t in mt.values)if(mt.values[t]==i)return t;return null}};u(mt,"values",[]);let mxStyleRegistry=mt;class mxUndoableEdit{constructor(i,t){u(this,"undone",!1);u(this,"redone",!1);this.source=i,this.changes=[],this.significant=t??!0}isEmpty(){return this.changes.length==0}isSignificant(){return this.significant}add(i){this.changes.push(i)}notify(){}die(){}undo(){if(!this.undone){this.source.fireEvent(new mxEventObject(mxEvent.START_EDIT));for(var i=this.changes.length,t=i-1;t>=0;t--){var e=this.changes[t];e.execute!=null?e.execute():e.undo!=null&&e.undo(),this.source.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",e))}this.undone=!0,this.redone=!1,this.source.fireEvent(new mxEventObject(mxEvent.END_EDIT))}this.notify()}redo(){if(!this.redone){this.source.fireEvent(new mxEventObject(mxEvent.START_EDIT));for(var i=this.changes.length,t=0;t<i;t++){var e=this.changes[t];e.execute!=null?e.execute():e.redo!=null&&e.redo(),this.source.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",e))}this.undone=!1,this.redone=!0,this.source.fireEvent(new mxEventObject(mxEvent.END_EDIT))}this.notify()}}class mxCurrentRootChange{constructor(i,t){if(this.view=i,this.root=t,this.previous=t,this.isUp=t==null,!this.isUp)for(var e=this.view.currentRoot,s=this.view.graph.getModel();e!=null;){if(e==t){this.isUp=!0;break}e=s.getParent(e)}}execute(){var i=this.view.currentRoot;this.view.currentRoot=this.previous,this.previous=i;var t=this.view.graph.getTranslateForRoot(this.view.currentRoot);t!=null&&(this.view.translate=new mxPoint(-t.x,-t.y)),this.isUp?(this.view.clear(this.view.currentRoot,!0),this.view.validate()):this.view.refresh();var e=this.isUp?mxEvent.UP:mxEvent.DOWN;this.view.fireEvent(new mxEventObject(e,"root",this.view.currentRoot,"previous",this.previous)),this.isUp=!this.isUp}}class mxGraphView extends mxEventSource{constructor(t){super();u(this,"EMPTY_POINT",new mxPoint);u(this,"doneResource",mxClient.language!="none"?"done":"");u(this,"updatingDocumentResource",mxClient.language!="none"?"updatingDocument":"");u(this,"allowEval",!1);u(this,"captureDocumentGesture",!0);u(this,"optimizeVmlReflows",!0);u(this,"rendering",!0);u(this,"currentRoot",null);u(this,"scale",1);u(this,"updateStyle",!1);u(this,"lastNode",null);u(this,"lastHtmlNode",null);u(this,"lastForegroundNode",null);u(this,"lastForegroundHtmlNode",null);this.graph=t,this.translate=new mxPoint,this.graphBounds=new mxRectangle,this.states=new mxDictionary}getGraphBounds(){return this.graphBounds}setGraphBounds(t){this.graphBounds=t}getBounds(t){var e=null;if(t!=null&&t.length>0){for(var s=this.graph.getModel(),n=0;n<t.length;n++)if(s.isVertex(t[n])||s.isEdge(t[n])){var l=this.getState(t[n]);l!=null&&(e==null?e=mxRectangle.fromRectangle(l):e.add(l))}}return e}setCurrentRoot(t){if(this.currentRoot!=t){var e=new mxCurrentRootChange(this,t);e.execute();var s=new mxUndoableEdit(this,!0);s.add(e),this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",s)),this.graph.sizeDidChange()}return t}scaleAndTranslate(t,e,s){var n=this.scale,l=new mxPoint(this.translate.x,this.translate.y);(this.scale!=t||this.translate.x!=e||this.translate.y!=s)&&(this.scale=t,this.translate.x=e,this.translate.y=s,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new mxEventObject(mxEvent.SCALE_AND_TRANSLATE,"scale",t,"previousScale",n,"translate",this.translate,"previousTranslate",l))}getScale(){return this.scale}setScale(t){var e=this.scale;this.scale!=t&&(this.scale=t,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new mxEventObject(mxEvent.SCALE,"scale",t,"previousScale",e))}getTranslate(){return this.translate}setTranslate(t,e){var s=new mxPoint(this.translate.x,this.translate.y);(this.translate.x!=t||this.translate.y!=e)&&(this.translate.x=t,this.translate.y=e,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new mxEventObject(mxEvent.TRANSLATE,"translate",this.translate,"previousTranslate",s))}viewStateChanged(){this.revalidate(),this.graph.sizeDidChange()}refresh(){this.currentRoot!=null&&this.clear(),this.revalidate()}revalidate(){this.invalidate(),this.validate()}clear(t,e,s){var n=this.graph.getModel();if(t=t||n.getRoot(),e=e??!1,s=s??!0,this.removeState(t),s&&(e||t!=this.currentRoot))for(var l=n.getChildCount(t),r=0;r<l;r++)this.clear(n.getChildAt(t,r),e);else this.invalidate(t)}invalidate(t,e,s){var n=this.graph.getModel();t=t||n.getRoot(),e=e??!0,s=s??!0;var l=this.getState(t);if(l!=null&&(l.invalid=!0),!t.invalidating){if(t.invalidating=!0,e)for(var r=n.getChildCount(t),a=0;a<r;a++){var o=n.getChildAt(t,a);this.invalidate(o,e,s)}if(s)for(var h=n.getEdgeCount(t),a=0;a<h;a++)this.invalidate(n.getEdgeAt(t,a),e,s);delete t.invalidating}}validate(t){var e=mxLog.enter("mxGraphView.validate");window.status=mxResources.get(this.updatingDocumentResource)||this.updatingDocumentResource,this.resetValidationState();var s=null;this.optimizeVmlReflows&&this.canvas!=null&&this.textDiv==null&&(document.documentMode==8&&!mxClient.IS_EM||mxClient.IS_QUIRKS)&&(this.placeholder=document.createElement("div"),this.placeholder.style.position="absolute",this.placeholder.style.width=this.canvas.clientWidth+"px",this.placeholder.style.height=this.canvas.clientHeight+"px",this.canvas.parentNode.appendChild(this.placeholder),s=this.drawPane.style.display,this.canvas.style.display="none",this.textDiv=document.createElement("div"),this.textDiv.style.position="absolute",this.textDiv.style.whiteSpace="nowrap",this.textDiv.style.visibility="hidden",this.textDiv.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",this.textDiv.style.zoom="1",document.body.appendChild(this.textDiv));var n=this.getBoundingBox(this.validateCellState(this.validateCell(t||(this.currentRoot!=null?this.currentRoot:this.graph.getModel().getRoot()))));this.setGraphBounds(n??this.getEmptyBounds()),this.validateBackground(),s!=null&&(this.canvas.style.display=s,this.textDiv.parentNode.removeChild(this.textDiv),this.placeholder!=null&&this.placeholder.parentNode.removeChild(this.placeholder),this.textDiv=null),this.resetValidationState(),window.status=mxResources.get(this.doneResource)||this.doneResource,mxLog.leave("mxGraphView.validate",e)}getEmptyBounds(){return new mxRectangle(this.translate.x*this.scale,this.translate.y*this.scale)}getBoundingBox(t,e){e=e??!0;var s=null;if(t!=null&&(t.shape!=null&&t.shape.boundingBox!=null&&(s=t.shape.boundingBox.clone()),t.text!=null&&t.text.boundingBox!=null&&(s!=null?s.add(t.text.boundingBox):s=t.text.boundingBox.clone()),e))for(var n=this.graph.getModel(),l=n.getChildCount(t.cell),r=0;r<l;r++){var a=this.getBoundingBox(this.getState(n.getChildAt(t.cell,r)));a!=null&&(s==null?s=a:s.add(a))}return s}createBackgroundPageShape(t){return new mxRectangleShape(t,"white","black")}validateBackground(){this.validateBackgroundImage(),this.validateBackgroundPage()}validateBackgroundImage(){var t=this.graph.getBackgroundImage();if(t!=null){if(this.backgroundImage==null||this.backgroundImage.image!=t.src){this.backgroundImage!=null&&this.backgroundImage.destroy();var e=new mxRectangle(0,0,1,1);this.backgroundImage=new mxImageShape(e,t.src),this.backgroundImage.dialect=this.graph.dialect,this.backgroundImage.init(this.backgroundPane),this.backgroundImage.redraw(),document.documentMode==8&&!mxClient.IS_EM&&mxEvent.addGestureListeners(this.backgroundImage.node,s=>{this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(s))},s=>{this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(s))},s=>{this.graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(s))})}this.redrawBackgroundImage(this.backgroundImage,t)}else this.backgroundImage!=null&&(this.backgroundImage.destroy(),this.backgroundImage=null)}validateBackgroundPage(){if(this.graph.pageVisible){var t=this.getBackgroundPageBounds();this.backgroundPageShape==null?(this.backgroundPageShape=this.createBackgroundPageShape(t),this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.isShadow=!0,this.backgroundPageShape.dialect=this.graph.dialect,this.backgroundPageShape.init(this.backgroundPane),this.backgroundPageShape.redraw(),this.graph.nativeDblClickEnabled&&mxEvent.addListener(this.backgroundPageShape.node,"dblclick",e=>{this.graph.dblClick(e)}),mxEvent.addGestureListeners(this.backgroundPageShape.node,e=>{this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(e))},e=>{this.graph.tooltipHandler!=null&&this.graph.tooltipHandler.isHideOnHover()&&this.graph.tooltipHandler.hide(),this.graph.isMouseDown&&!mxEvent.isConsumed(e)&&this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(e))},e=>{this.graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(e))})):(this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.bounds=t,this.backgroundPageShape.redraw())}else this.backgroundPageShape!=null&&(this.backgroundPageShape.destroy(),this.backgroundPageShape=null)}getBackgroundPageBounds(){var t=this.graph.pageFormat,e=this.scale*this.graph.pageScale,s=new mxRectangle(this.scale*this.translate.x,this.scale*this.translate.y,t.width*e,t.height*e);return s}redrawBackgroundImage(t,e){t.scale=this.scale,t.bounds.x=this.scale*this.translate.x,t.bounds.y=this.scale*this.translate.y,t.bounds.width=this.scale*e.width,t.bounds.height=this.scale*e.height,t.redraw()}validateCell(t,e){if(e=e??!0,t!=null){e=e&&this.graph.isCellVisible(t);var s=this.getState(t,e);if(s!=null&&!e)this.removeState(t);else for(var n=this.graph.getModel(),l=n.getChildCount(t),r=0;r<l;r++)this.validateCell(n.getChildAt(t,r),e&&(!this.isCellCollapsed(t)||t==this.currentRoot))}return t}validateCellState(t,e){e=e??!0;var s=null;if(t!=null&&(s=this.getState(t),s!=null)){var n=this.graph.getModel();if(s.invalid&&(s.invalid=!1,(s.style==null||s.invalidStyle)&&(s.style=this.graph.getCellStyle(s.cell),s.invalidStyle=!1),t!=this.currentRoot&&this.validateCellState(n.getParent(t),!1),s.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(t,!0),!1),!0),s.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(t,!1),!1),!1),this.updateCellState(s),t!=this.currentRoot&&!s.invalid&&(this.graph.cellRenderer.redraw(s,!1,this.isRendering()),s.updateCachedBounds())),e&&!s.invalid){s.shape!=null&&this.stateValidated(s);for(var l=n.getChildCount(t),r=0;r<l;r++)this.validateCellState(n.getChildAt(t,r))}}return s}updateCellState(t){if(t.absoluteOffset.x=0,t.absoluteOffset.y=0,t.origin.x=0,t.origin.y=0,t.length=0,t.cell!=this.currentRoot){var e=this.graph.getModel(),s=this.getState(e.getParent(t.cell));s!=null&&s.cell!=this.currentRoot&&(t.origin.x+=s.origin.x,t.origin.y+=s.origin.y);var n=this.graph.getChildOffsetForCell(t.cell);n!=null&&(t.origin.x+=n.x,t.origin.y+=n.y);var l=this.graph.getCellGeometry(t.cell);if(l!=null){if(!e.isEdge(t.cell))if(n=l.offset!=null?l.offset:this.EMPTY_POINT,l.relative&&s!=null)if(e.isEdge(s.cell)){var r=this.getPoint(s,l);r!=null&&(t.origin.x+=r.x/this.scale-s.origin.x-this.translate.x,t.origin.y+=r.y/this.scale-s.origin.y-this.translate.y)}else t.origin.x+=l.x*s.unscaledWidth+n.x,t.origin.y+=l.y*s.unscaledHeight+n.y;else t.absoluteOffset.x=this.scale*n.x,t.absoluteOffset.y=this.scale*n.y,t.origin.x+=l.x,t.origin.y+=l.y;t.x=this.scale*(this.translate.x+t.origin.x),t.y=this.scale*(this.translate.y+t.origin.y),t.width=this.scale*l.width,t.unscaledWidth=l.width,t.height=this.scale*l.height,t.unscaledHeight=l.height,e.isVertex(t.cell)&&this.updateVertexState(t,l),e.isEdge(t.cell)&&this.updateEdgeState(t,l)}}t.updateCachedBounds()}isCellCollapsed(t){return this.graph.isCellCollapsed(t)}updateVertexState(t,e){var s=this.graph.getModel(),n=this.getState(s.getParent(t.cell));if(e.relative&&n!=null&&!s.isEdge(n.cell)){var l=mxUtils.toRadians(n.style[mxConstants.STYLE_ROTATION]||"0");if(l!=0){var r=Math.cos(l),a=Math.sin(l),o=new mxPoint(t.getCenterX(),t.getCenterY()),h=new mxPoint(n.getCenterX(),n.getCenterY()),d=mxUtils.getRotatedPoint(o,r,a,h);t.x=d.x-t.width/2,t.y=d.y-t.height/2}}this.updateVertexLabelOffset(t)}updateEdgeState(t,e){var s=t.getVisibleTerminalState(!0),n=t.getVisibleTerminalState(!1);if(this.graph.model.getTerminal(t.cell,!0)!=null&&s==null||s==null&&e.getTerminalPoint(!0)==null||this.graph.model.getTerminal(t.cell,!1)!=null&&n==null||n==null&&e.getTerminalPoint(!1)==null)this.clear(t.cell,!0);else{this.updateFixedTerminalPoints(t,s,n),this.updatePoints(t,e.points,s,n),this.updateFloatingTerminalPoints(t,s,n);var l=t.absolutePoints;t.cell!=this.currentRoot&&(l==null||l.length<2||l[0]==null||l[l.length-1]==null)?this.clear(t.cell,!0):(this.updateEdgeBounds(t),this.updateEdgeLabelOffset(t))}}updateVertexLabelOffset(t){var e=mxUtils.getValue(t.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER);if(e==mxConstants.ALIGN_LEFT){var s=mxUtils.getValue(t.style,mxConstants.STYLE_LABEL_WIDTH,null);s!=null?s*=this.scale:s=t.width,t.absoluteOffset.x-=s}else if(e==mxConstants.ALIGN_RIGHT)t.absoluteOffset.x+=t.width;else if(e==mxConstants.ALIGN_CENTER){var s=mxUtils.getValue(t.style,mxConstants.STYLE_LABEL_WIDTH,null);if(s!=null){var n=mxUtils.getValue(t.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER),l=0;n==mxConstants.ALIGN_CENTER?l=.5:n==mxConstants.ALIGN_RIGHT&&(l=1),l!=0&&(t.absoluteOffset.x-=(s*this.scale-t.width)*l)}}var r=mxUtils.getValue(t.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);r==mxConstants.ALIGN_TOP?t.absoluteOffset.y-=t.height:r==mxConstants.ALIGN_BOTTOM&&(t.absoluteOffset.y+=t.height)}resetValidationState(){this.lastNode=null,this.lastHtmlNode=null,this.lastForegroundNode=null,this.lastForegroundHtmlNode=null}stateValidated(t){var e=this.graph.getModel().isEdge(t.cell)&&this.graph.keepEdgesInForeground||this.graph.getModel().isVertex(t.cell)&&this.graph.keepEdgesInBackground,s=e?this.lastForegroundHtmlNode||this.lastHtmlNode:this.lastHtmlNode,n=e?this.lastForegroundNode||this.lastNode:this.lastNode,l=this.graph.cellRenderer.insertStateAfter(t,n,s);e?(this.lastForegroundHtmlNode=l[1],this.lastForegroundNode=l[0]):(this.lastHtmlNode=l[1],this.lastNode=l[0])}updateFixedTerminalPoints(t,e,s){this.updateFixedTerminalPoint(t,e,!0,this.graph.getConnectionConstraint(t,e,!0)),this.updateFixedTerminalPoint(t,s,!1,this.graph.getConnectionConstraint(t,s,!1))}updateFixedTerminalPoint(t,e,s,n){t.setAbsoluteTerminalPoint(this.getFixedTerminalPoint(t,e,s,n),s)}getFixedTerminalPoint(t,e,s,n){var l=null;if(n!=null&&(l=this.graph.getConnectionPoint(e,n,!1)),l==null&&e==null){var r=this.scale,a=this.translate,o=t.origin,h=this.graph.getCellGeometry(t.cell);l=h.getTerminalPoint(s),l!=null&&(l=new mxPoint(r*(a.x+l.x+o.x),r*(a.y+l.y+o.y)))}return l}updateBoundsFromStencil(t){var e=null;if(t!=null&&t.shape!=null&&t.shape.stencil!=null&&t.shape.stencil.aspect=="fixed"){e=mxRectangle.fromRectangle(t);var s=t.shape.stencil.computeAspect(t.style,t.x,t.y,t.width,t.height);t.setRect(s.x,s.y,t.shape.stencil.w0*s.width,t.shape.stencil.h0*s.height)}return e}updatePoints(t,e,s,n){if(t!=null){var l=[];l.push(t.absolutePoints[0]);var r=this.getEdgeStyle(t,e,s,n);if(r!=null){var a=this.getTerminalPort(t,s,!0),o=this.getTerminalPort(t,n,!1),h=this.updateBoundsFromStencil(a),d=this.updateBoundsFromStencil(o);r(t,a,o,e,l),h!=null&&a.setRect(h.x,h.y,h.width,h.height),d!=null&&o.setRect(d.x,d.y,d.width,d.height)}else if(e!=null){for(var g=0;g<e.length;g++)if(e[g]!=null){var m=mxUtils.clone(e[g]);l.push(this.transformControlPoint(t,m))}}var f=t.absolutePoints;l.push(f[f.length-1]),t.absolutePoints=l}}transformControlPoint(t,e,s){if(t!=null&&e!=null){var n=t.origin,l=s?1:this.scale;return new mxPoint(l*(e.x+this.translate.x+n.x),l*(e.y+this.translate.y+n.y))}return null}isLoopStyleEnabled(t,e,s,n){var l=this.graph.getConnectionConstraint(t,s,!0),r=this.graph.getConnectionConstraint(t,n,!1);return(e==null||e.length<2)&&(!mxUtils.getValue(t.style,mxConstants.STYLE_ORTHOGONAL_LOOP,!1)||(l==null||l.point==null)&&(r==null||r.point==null))?s!=null&&s==n:!1}getEdgeStyle(t,e,s,n){var l=this.isLoopStyleEnabled(t,e,s,n)?mxUtils.getValue(t.style,mxConstants.STYLE_LOOP,this.graph.defaultLoopStyle):mxUtils.getValue(t.style,mxConstants.STYLE_NOEDGESTYLE,!1)?null:t.style[mxConstants.STYLE_EDGE];if(typeof l=="string"){var r=mxStyleRegistry.getValue(l);r==null&&this.isAllowEval()&&(r=mxUtils.eval(l)),l=r}return typeof l=="function"?l:null}updateFloatingTerminalPoints(t,e,s){var n=t.absolutePoints,l=n[0],r=n[n.length-1];r==null&&s!=null&&this.updateFloatingTerminalPoint(t,s,e,!1),l==null&&e!=null&&this.updateFloatingTerminalPoint(t,e,s,!0)}updateFloatingTerminalPoint(t,e,s,n){t.setAbsoluteTerminalPoint(this.getFloatingTerminalPoint(t,e,s,n),n)}getFloatingTerminalPoint(t,e,s,n){e=this.getTerminalPort(t,e,n);var l=this.getNextPoint(t,s,n),r=this.graph.isOrthogonal(t),a=mxUtils.toRadians(Number(e.style[mxConstants.STYLE_ROTATION]||"0")),o=new mxPoint(e.getCenterX(),e.getCenterY());if(a!=0){var h=Math.cos(-a),d=Math.sin(-a);l=mxUtils.getRotatedPoint(l,h,d,o)}var g=parseFloat(t.style[mxConstants.STYLE_PERIMETER_SPACING]||0);g+=parseFloat(t.style[n?mxConstants.STYLE_SOURCE_PERIMETER_SPACING:mxConstants.STYLE_TARGET_PERIMETER_SPACING]||0);var m=this.getPerimeterPoint(e,l,a==0&&r,g);if(a!=0){var h=Math.cos(a),d=Math.sin(a);m=mxUtils.getRotatedPoint(m,h,d,o)}return m}getTerminalPort(t,e,s){var n=s?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT,l=mxUtils.getValue(t.style,n);if(l!=null){var r=this.getState(this.graph.getModel().getCell(l));r!=null&&(e=r)}return e}getPerimeterPoint(t,e,s,n){var l=null;if(t!=null){var r=this.getPerimeterFunction(t);if(r!=null&&e!=null){var a=this.getPerimeterBounds(t,n);if(a.width>0||a.height>0){l=new mxPoint(e.x,e.y);var o=!1,h=!1;this.graph.model.isVertex(t.cell)&&(o=mxUtils.getValue(t.style,mxConstants.STYLE_FLIPH,0)==1,h=mxUtils.getValue(t.style,mxConstants.STYLE_FLIPV,0)==1,t.shape!=null&&t.shape.stencil!=null&&(o=mxUtils.getValue(t.style,"stencilFlipH",0)==1||o,h=mxUtils.getValue(t.style,"stencilFlipV",0)==1||h),o&&(l.x=2*a.getCenterX()-l.x),h&&(l.y=2*a.getCenterY()-l.y)),l=r(a,t,l,s),l!=null&&(o&&(l.x=2*a.getCenterX()-l.x),h&&(l.y=2*a.getCenterY()-l.y))}}l==null&&(l=this.getPoint(t))}return l}getRoutingCenterX(t){var e=t.style!=null&&parseFloat(t.style[mxConstants.STYLE_ROUTING_CENTER_X])||0;return t.getCenterX()+e*t.width}getRoutingCenterY(t){var e=t.style!=null&&parseFloat(t.style[mxConstants.STYLE_ROUTING_CENTER_Y])||0;return t.getCenterY()+e*t.height}getPerimeterBounds(t,e){return e=e??0,t!=null&&(e+=parseFloat(t.style[mxConstants.STYLE_PERIMETER_SPACING]||0)),t.getPerimeterBounds(e*this.scale)}getPerimeterFunction(t){var e=t.style[mxConstants.STYLE_PERIMETER];if(typeof e=="string"){var s=mxStyleRegistry.getValue(e);s==null&&this.isAllowEval()&&(s=mxUtils.eval(e)),e=s}return typeof e=="function"?e:null}getNextPoint(t,e,s){var n=t.absolutePoints,l=null;if(n!=null&&n.length>=2){var r=n.length;l=n[s?Math.min(1,r-1):Math.max(0,r-2)]}return l==null&&e!=null&&(l=new mxPoint(e.getCenterX(),e.getCenterY())),l}getVisibleTerminal(t,e){for(var s=this.graph.getModel(),n=s.getTerminal(t,e),l=n;n!=null&&n!=this.currentRoot;)(!this.graph.isCellVisible(l)||this.isCellCollapsed(n))&&(l=n),n=s.getParent(n);return l!=null&&(!s.contains(l)||s.getParent(l)==s.getRoot()||l==this.currentRoot)&&(l=null),l}updateEdgeBounds(t){var e=t.absolutePoints,s=e[0],n=e[e.length-1];if(s.x!=n.x||s.y!=n.y){var l=n.x-s.x,r=n.y-s.y;t.terminalDistance=Math.sqrt(l*l+r*r)}else t.terminalDistance=0;var a=0,o=[],h=s;if(h!=null){for(var d=h.x,g=h.y,m=d,f=g,c=1;c<e.length;c++){var x=e[c];if(x!=null){var l=h.x-x.x,r=h.y-x.y,p=Math.sqrt(l*l+r*r);o.push(p),a+=p,h=x,d=Math.min(h.x,d),g=Math.min(h.y,g),m=Math.max(h.x,m),f=Math.max(h.y,f)}}t.length=a,t.segments=o;var C=1;t.x=d,t.y=g,t.width=Math.max(C,m-d),t.height=Math.max(C,f-g)}}getPoint(t,e){var s=t.getCenterX(),n=t.getCenterY();if(t.segments!=null&&(e==null||e.relative)){for(var l=e!=null?e.x/2:0,r=t.absolutePoints.length,a=Math.round((l+.5)*t.length),o=t.segments[0],h=0,d=1;a>=Math.round(h+o)&&d<r-1;)h+=o,o=t.segments[d++];var g=o==0?0:(a-h)/o,m=t.absolutePoints[d-1],f=t.absolutePoints[d];if(m!=null&&f!=null){var c=0,x=0,p=0;if(e!=null){c=e.y;var C=e.offset;C!=null&&(x=C.x,p=C.y)}var E=f.x-m.x,T=f.y-m.y,S=o==0?0:T/o,y=o==0?0:E/o;s=m.x+E*g+(S*c+x)*this.scale,n=m.y+T*g-(y*c-p)*this.scale}}else if(e!=null){var C=e.offset;C!=null&&(s+=C.x,n+=C.y)}return new mxPoint(s,n)}getRelativePoint(t,e,s){var n=this.graph.getModel(),l=n.getGeometry(t.cell);if(l!=null){var r=t.absolutePoints.length;if(l.relative&&r>1){for(var a=t.length,o=t.segments,h=t.absolutePoints[0],d=t.absolutePoints[1],g=mxUtils.ptSegDistSq(h.x,h.y,d.x,d.y,e,s),m=0,f=0,c=0,x=2;x<r;x++){f+=o[x-2],d=t.absolutePoints[x];var p=mxUtils.ptSegDistSq(h.x,h.y,d.x,d.y,e,s);p<=g&&(g=p,m=x-1,c=f),h=d}var C=o[m];h=t.absolutePoints[m],d=t.absolutePoints[m+1];var E=h.x,T=h.y,S=d.x,y=d.y,b=e,w=s,I=E-S,O=T-y;b-=S,w-=y;var P=0;b=I-b,w=O-w;var M=b*I+w*O;M<=0?P=0:P=M*M/(I*I+O*O);var H=Math.sqrt(P);H>C&&(H=C);var R=Math.sqrt(mxUtils.ptSegDistSq(h.x,h.y,d.x,d.y,e,s)),D=mxUtils.relativeCcw(h.x,h.y,d.x,d.y,e,s);return D==-1&&(R=-R),new mxPoint((a/2-c-H)/a*-2,R/this.scale)}}return new mxPoint}updateEdgeLabelOffset(t){var e=t.absolutePoints;if(t.absoluteOffset.x=t.getCenterX(),t.absoluteOffset.y=t.getCenterY(),e!=null&&e.length>0&&t.segments!=null){var s=this.graph.getCellGeometry(t.cell);if(s.relative){var n=this.getPoint(t,s);n!=null&&(t.absoluteOffset=n)}else{var l=e[0],r=e[e.length-1];if(l!=null&&r!=null){var a=r.x-l.x,o=r.y-l.y,h=0,d=0,g=s.offset;g!=null&&(h=g.x,d=g.y);var m=l.x+a/2+h*this.scale,f=l.y+o/2+d*this.scale;t.absoluteOffset.x=m,t.absoluteOffset.y=f}}}}getState(t,e){e=e||!1;var s=null;return t!=null&&(s=this.states.get(t),e&&(s==null||this.updateStyle)&&this.graph.isCellVisible(t)&&(s==null?(s=this.createState(t),this.states.put(t,s)):s.style=this.graph.getCellStyle(t))),s}isRendering(){return this.rendering}setRendering(t){this.rendering=t}isAllowEval(){return this.allowEval}setAllowEval(t){this.allowEval=t}getStates(){return this.states}setStates(t){this.states=t}getCellStates(t){if(t==null)return this.states;for(var e=[],s=0;s<t.length;s++){var n=this.getState(t[s]);n!=null&&e.push(n)}return e}removeState(t){var e=null;return t!=null&&(e=this.states.remove(t),e!=null&&(this.graph.cellRenderer.destroy(e),e.invalid=!0,e.destroy())),e}createState(t){return new mxCellState(this,t,this.graph.getCellStyle(t))}getCanvas(){return this.canvas}getBackgroundPane(){return this.backgroundPane}getDrawPane(){return this.drawPane}getOverlayPane(){return this.overlayPane}getDecoratorPane(){return this.decoratorPane}isContainerEvent(t){var e=mxEvent.getSource(t);return e==this.graph.container||e.parentNode==this.backgroundPane||e.parentNode!=null&&e.parentNode.parentNode==this.backgroundPane||e==this.canvas.parentNode||e==this.canvas||e==this.backgroundPane||e==this.drawPane||e==this.overlayPane||e==this.decoratorPane}isScrollEvent(t){var e=mxUtils.getOffset(this.graph.container),s=new mxPoint(t.clientX-e.x,t.clientY-e.y),n=this.graph.container.offsetWidth,l=this.graph.container.clientWidth;if(n>l&&s.x>l+2&&s.x<=n)return!0;var r=this.graph.container.offsetHeight,a=this.graph.container.clientHeight;return r>a&&s.y>a+2&&s.y<=r}init(){this.installListeners();var t=this.graph;t.dialect==mxConstants.DIALECT_SVG?this.createSvg():t.dialect==mxConstants.DIALECT_VML?this.createVml():this.createHtml()}installListeners(){var t=this.graph,e=t.container;if(e!=null){mxClient.IS_TOUCH&&(mxEvent.addListener(e,"gesturestart",n=>{t.fireGestureEvent(n),mxEvent.consume(n)}),mxEvent.addListener(e,"gesturechange",n=>{t.fireGestureEvent(n),mxEvent.consume(n)}),mxEvent.addListener(e,"gestureend",n=>{t.fireGestureEvent(n),mxEvent.consume(n)})),mxEvent.addGestureListeners(e,n=>{this.isContainerEvent(n)&&(!mxClient.IS_IE11&&!mxClient.IS_GC&&!mxClient.IS_OP&&!mxClient.IS_SF||!this.isScrollEvent(n))&&t.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(n))},n=>{this.isContainerEvent(n)&&t.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(n))},n=>{this.isContainerEvent(n)&&t.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(n))}),mxEvent.addListener(e,"dblclick",n=>{this.isContainerEvent(n)&&t.dblClick(n)});var s=function(n){var l=null;if(mxClient.IS_TOUCH){var r=mxEvent.getClientX(n),a=mxEvent.getClientY(n),o=mxUtils.convertPoint(e,r,a);l=t.view.getState(t.getCellAt(o.x,o.y))}return l};t.addMouseListener({mouseDown:function(n,l){t.popupMenuHandler.hideMenu()},mouseMove:function(){},mouseUp:function(){}}),this.moveHandler=n=>{t.tooltipHandler!=null&&t.tooltipHandler.isHideOnHover()&&t.tooltipHandler.hide(),this.captureDocumentGesture&&t.isMouseDown&&t.container!=null&&!this.isContainerEvent(n)&&t.container.style.display!="none"&&t.container.style.visibility!="hidden"&&!mxEvent.isConsumed(n)&&t.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(n,s(n)))},this.endHandler=n=>{this.captureDocumentGesture&&t.isMouseDown&&t.container!=null&&!this.isContainerEvent(n)&&t.container.style.display!="none"&&t.container.style.visibility!="hidden"&&t.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(n))},mxEvent.addGestureListeners(document,null,this.moveHandler,this.endHandler)}}createHtml(){var t=this.graph.container;if(t!=null&&(this.canvas=this.createHtmlPane("100%","100%"),this.canvas.style.overflow="hidden",this.backgroundPane=this.createHtmlPane("1px","1px"),this.drawPane=this.createHtmlPane("1px","1px"),this.overlayPane=this.createHtmlPane("1px","1px"),this.decoratorPane=this.createHtmlPane("1px","1px"),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),this.canvas.appendChild(this.decoratorPane),t.appendChild(this.canvas),this.updateContainerStyle(t),mxClient.IS_QUIRKS)){var e=s=>{var n=this.getGraphBounds(),l=n.x+n.width+this.graph.border,r=n.y+n.height+this.graph.border;this.updateHtmlCanvasSize(l,r)};mxEvent.addListener(window,"resize",e)}}updateHtmlCanvasSize(t,e){if(this.graph.container!=null){var s=this.graph.container.offsetWidth,n=this.graph.container.offsetHeight;s<t?this.canvas.style.width=t+"px":this.canvas.style.width="100%",n<e?this.canvas.style.height=e+"px":this.canvas.style.height="100%"}}createHtmlPane(t,e){var s=document.createElement("DIV");return t!=null&&e!=null?(s.style.position="absolute",s.style.left="0px",s.style.top="0px",s.style.width=t,s.style.height=e):s.style.position="relative",s}createVml(){var t=this.graph.container;if(t!=null){var e=t.offsetWidth,s=t.offsetHeight;this.canvas=this.createVmlPane(e,s),this.canvas.style.overflow="hidden",this.backgroundPane=this.createVmlPane(e,s),this.drawPane=this.createVmlPane(e,s),this.overlayPane=this.createVmlPane(e,s),this.decoratorPane=this.createVmlPane(e,s),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),this.canvas.appendChild(this.decoratorPane),t.appendChild(this.canvas)}}createVmlPane(t,e){var s=document.createElement(mxClient.VML_PREFIX+":group");return s.style.position="absolute",s.style.left="0px",s.style.top="0px",s.style.width=t+"px",s.style.height=e+"px",s.setAttribute("coordsize",t+","+e),s.setAttribute("coordorigin","0,0"),s}createSvg(){var t=this.graph.container;this.canvas=document.createElementNS(mxConstants.NS_SVG,"g"),this.backgroundPane=document.createElementNS(mxConstants.NS_SVG,"g"),this.canvas.appendChild(this.backgroundPane),this.drawPane=document.createElementNS(mxConstants.NS_SVG,"g"),this.canvas.appendChild(this.drawPane),this.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g"),this.canvas.appendChild(this.overlayPane),this.decoratorPane=document.createElementNS(mxConstants.NS_SVG,"g"),this.canvas.appendChild(this.decoratorPane);var e=document.createElementNS(mxConstants.NS_SVG,"svg");e.style.left="0px",e.style.top="0px",e.style.width="100%",e.style.height="100%",e.style.display="block",e.appendChild(this.canvas),mxClient.IS_IE11&&(e.style.overflow="hidden"),t!=null&&(t.appendChild(e),this.updateContainerStyle(t))}updateContainerStyle(t){var e=mxUtils.getCurrentStyle(t);e!=null&&e.position=="static"&&(t.style.position="relative"),mxClient.IS_POINTER&&(t.style.touchAction="none")}destroy(){var t=this.canvas!=null?this.canvas.ownerSVGElement:null;t==null&&(t=this.canvas),t!=null&&t.parentNode!=null&&(this.clear(this.currentRoot,!0),mxEvent.removeGestureListeners(document,null,this.moveHandler,this.endHandler),mxEvent.release(this.graph.container),t.parentNode.removeChild(t),this.moveHandler=null,this.endHandler=null,this.canvas=null,this.backgroundPane=null,this.drawPane=null,this.overlayPane=null,this.decoratorPane=null)}}class mxPerimeter{static RectanglePerimeter(i,t,e,s){var n=i.getCenterX(),l=i.getCenterY(),r=e.x-n,a=e.y-l,o=Math.atan2(a,r),h=new mxPoint(0,0),d=Math.PI,g=Math.PI/2,m=g-o,f=Math.atan2(i.height,i.width);return o<-d+f||o>d-f?(h.x=i.x,h.y=l-i.width*Math.tan(o)/2):o<-f?(h.y=i.y,h.x=n-i.height*Math.tan(m)/2):o<f?(h.x=i.x+i.width,h.y=l+i.width*Math.tan(o)/2):(h.y=i.y+i.height,h.x=n+i.height*Math.tan(m)/2),s&&(e.x>=i.x&&e.x<=i.x+i.width?h.x=e.x:e.y>=i.y&&e.y<=i.y+i.height&&(h.y=e.y),e.x<i.x?h.x=i.x:e.x>i.x+i.width&&(h.x=i.x+i.width),e.y<i.y?h.y=i.y:e.y>i.y+i.height&&(h.y=i.y+i.height)),h}static EllipsePerimeter(i,t,e,s){var n=i.x,l=i.y,r=i.width/2,a=i.height/2,o=n+r,h=l+a,d=e.x,g=e.y,m=parseInt(d-o),f=parseInt(g-h);if(m==0&&f!=0)return new mxPoint(o,h+a*f/Math.abs(f));if(m==0&&f==0)return new mxPoint(d,g);if(s){if(g>=l&&g<=l+i.height){var c=g-h,x=Math.sqrt(r*r*(1-c*c/(a*a)))||0;return d<=n&&(x=-x),new mxPoint(o+x,g)}if(d>=n&&d<=n+i.width){var x=d-o,c=Math.sqrt(a*a*(1-x*x/(r*r)))||0;return g<=l&&(c=-c),new mxPoint(d,h+c)}}var p=f/m,C=h-p*o,E=r*r*p*p+a*a,T=-2*o*E,S=r*r*p*p*o*o+a*a*o*o-r*r*a*a,y=Math.sqrt(T*T-4*E*S),b=(-T+y)/(2*E),w=(-T-y)/(2*E),I=p*b+C,O=p*w+C,P=Math.sqrt(Math.pow(b-d,2)+Math.pow(I-g,2)),M=Math.sqrt(Math.pow(w-d,2)+Math.pow(O-g,2)),H=0,R=0;return P<M?(H=b,R=I):(H=w,R=O),new mxPoint(H,R)}static RhombusPerimeter(i,t,e,s){var n=i.x,l=i.y,r=i.width,a=i.height,o=n+r/2,h=l+a/2,d=e.x,g=e.y;if(o==d)return h>g?new mxPoint(o,l):new mxPoint(o,l+a);if(h==g)return o>d?new mxPoint(n,h):new mxPoint(n+r,h);var m=o,f=h;return s&&(d>=n&&d<=n+r?m=d:g>=l&&g<=l+a&&(f=g)),d<o?g<h?mxUtils.intersection(d,g,m,f,o,l,n,h):mxUtils.intersection(d,g,m,f,o,l+a,n,h):g<h?mxUtils.intersection(d,g,m,f,o,l,n+r,h):mxUtils.intersection(d,g,m,f,o,l+a,n+r,h)}static TrianglePerimeter(i,t,e,s){var n=t!=null?t.style[mxConstants.STYLE_DIRECTION]:null,l=n==mxConstants.DIRECTION_NORTH||n==mxConstants.DIRECTION_SOUTH,r=i.x,a=i.y,o=i.width,h=i.height,d=r+o/2,g=a+h/2,m=new mxPoint(r,a),f=new mxPoint(r+o,g),c=new mxPoint(r,a+h);n==mxConstants.DIRECTION_NORTH?(m=c,f=new mxPoint(d,a),c=new mxPoint(r+o,a+h)):n==mxConstants.DIRECTION_SOUTH?(f=new mxPoint(d,a+h),c=new mxPoint(r+o,a)):n==mxConstants.DIRECTION_WEST&&(m=new mxPoint(r+o,a),f=new mxPoint(r,g),c=new mxPoint(r+o,a+h));var x=e.x-d,p=e.y-g,C=l?Math.atan2(x,p):Math.atan2(p,x),E=l?Math.atan2(o,h):Math.atan2(h,o),T=!1;n==mxConstants.DIRECTION_NORTH||n==mxConstants.DIRECTION_WEST?T=C>-E&&C<E:T=C<-Math.PI+E||C>Math.PI-E;var S=null;if(T)s&&(l&&e.x>=m.x&&e.x<=c.x||!l&&e.y>=m.y&&e.y<=c.y)?l?S=new mxPoint(e.x,m.y):S=new mxPoint(m.x,e.y):n==mxConstants.DIRECTION_NORTH?S=new mxPoint(r+o/2+h*Math.tan(C)/2,a+h):n==mxConstants.DIRECTION_SOUTH?S=new mxPoint(r+o/2-h*Math.tan(C)/2,a):n==mxConstants.DIRECTION_WEST?S=new mxPoint(r+o,a+h/2+o*Math.tan(C)/2):S=new mxPoint(r,a+h/2-o*Math.tan(C)/2);else{if(s){var y=new mxPoint(d,g);e.y>=a&&e.y<=a+h?(y.x=l?d:n==mxConstants.DIRECTION_WEST?r+o:r,y.y=e.y):e.x>=r&&e.x<=r+o&&(y.x=e.x,y.y=l?n==mxConstants.DIRECTION_NORTH?a+h:a:g),x=e.x-y.x,p=e.y-y.y,d=y.x,g=y.y}l&&e.x<=r+o/2||!l&&e.y<=a+h/2?S=mxUtils.intersection(e.x,e.y,d,g,m.x,m.y,f.x,f.y):S=mxUtils.intersection(e.x,e.y,d,g,f.x,f.y,c.x,c.y)}return S==null&&(S=new mxPoint(d,g)),S}static HexagonPerimeter(i,t,e,s){var n=i.x,l=i.y,r=i.width,a=i.height,o=i.getCenterX(),h=i.getCenterY(),d=e.x,g=e.y,m=d-o,f=g-h,c=-Math.atan2(f,m),x=Math.PI,p=Math.PI/2,C=new mxPoint(o,h),E=t!=null?mxUtils.getValue(t.style,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_EAST):mxConstants.DIRECTION_EAST,T=E==mxConstants.DIRECTION_NORTH||E==mxConstants.DIRECTION_SOUTH,S=new mxPoint,y=new mxPoint;if((d<n&&g<l||d<n&&g>l+a||d>n+r&&g<l||d>n+r&&g>l+a)&&(s=!1),s){if(T){if(d==o){if(g<=l)return new mxPoint(o,l);if(g>=l+a)return new mxPoint(o,l+a)}else if(d<n){if(g==l+a/4)return new mxPoint(n,l+a/4);if(g==l+3*a/4)return new mxPoint(n,l+3*a/4)}else if(d>n+r){if(g==l+a/4)return new mxPoint(n+r,l+a/4);if(g==l+3*a/4)return new mxPoint(n+r,l+3*a/4)}else if(d==n){if(g<h)return new mxPoint(n,l+a/4);if(g>h)return new mxPoint(n,l+3*a/4)}else if(d==n+r){if(g<h)return new mxPoint(n+r,l+a/4);if(g>h)return new mxPoint(n+r,l+3*a/4)}if(g==l)return new mxPoint(o,l);if(g==l+a)return new mxPoint(o,l+a);d<o?g>l+a/4&&g<l+3*a/4?(S=new mxPoint(n,l),y=new mxPoint(n,l+a)):g<l+a/4?(S=new mxPoint(n-Math.floor(.5*r),l+Math.floor(.5*a)),y=new mxPoint(n+r,l-Math.floor(.25*a))):g>l+3*a/4&&(S=new mxPoint(n-Math.floor(.5*r),l+Math.floor(.5*a)),y=new mxPoint(n+r,l+Math.floor(1.25*a))):d>o&&(g>l+a/4&&g<l+3*a/4?(S=new mxPoint(n+r,l),y=new mxPoint(n+r,l+a)):g<l+a/4?(S=new mxPoint(n,l-Math.floor(.25*a)),y=new mxPoint(n+Math.floor(1.5*r),l+Math.floor(.5*a))):g>l+3*a/4&&(S=new mxPoint(n+Math.floor(1.5*r),l+Math.floor(.5*a)),y=new mxPoint(n,l+Math.floor(1.25*a))))}else{if(g==h){if(d<=n)return new mxPoint(n,l+a/2);if(d>=n+r)return new mxPoint(n+r,l+a/2)}else if(g<l){if(d==n+r/4)return new mxPoint(n+r/4,l);if(d==n+3*r/4)return new mxPoint(n+3*r/4,l)}else if(g>l+a){if(d==n+r/4)return new mxPoint(n+r/4,l+a);if(d==n+3*r/4)return new mxPoint(n+3*r/4,l+a)}else if(g==l){if(d<o)return new mxPoint(n+r/4,l);if(d>o)return new mxPoint(n+3*r/4,l)}else if(g==l+a){if(d<o)return new mxPoint(n+r/4,l+a);if(g>h)return new mxPoint(n+3*r/4,l+a)}if(d==n)return new mxPoint(n,h);if(d==n+r)return new mxPoint(n+r,h);g<h?d>n+r/4&&d<n+3*r/4?(S=new mxPoint(n,l),y=new mxPoint(n+r,l)):d<n+r/4?(S=new mxPoint(n-Math.floor(.25*r),l+a),y=new mxPoint(n+Math.floor(.5*r),l-Math.floor(.5*a))):d>n+3*r/4&&(S=new mxPoint(n+Math.floor(.5*r),l-Math.floor(.5*a)),y=new mxPoint(n+Math.floor(1.25*r),l+a)):g>h&&(d>n+r/4&&d<n+3*r/4?(S=new mxPoint(n,l+a),y=new mxPoint(n+r,l+a)):d<n+r/4?(S=new mxPoint(n-Math.floor(.25*r),l),y=new mxPoint(n+Math.floor(.5*r),l+Math.floor(1.5*a))):d>n+3*r/4&&(S=new mxPoint(n+Math.floor(.5*r),l+Math.floor(1.5*a)),y=new mxPoint(n+Math.floor(1.25*r),l)))}var b=o,w=h;d>=n&&d<=n+r?(b=d,g<h?w=l+a:w=l):g>=l&&g<=l+a&&(w=g,d<o?b=n+r:b=n),C=mxUtils.intersection(b,w,e.x,e.y,S.x,S.y,y.x,y.y)}else{if(T){var I=Math.atan2(a/4,r/2);if(c==I)return new mxPoint(n+r,l+Math.floor(.25*a));if(c==p)return new mxPoint(n+Math.floor(.5*r),l);if(c==x-I)return new mxPoint(n,l+Math.floor(.25*a));if(c==-I)return new mxPoint(n+r,l+Math.floor(.75*a));if(c==-p)return new mxPoint(n+Math.floor(.5*r),l+a);if(c==-x+I)return new mxPoint(n,l+Math.floor(.75*a));c<I&&c>-I?(S=new mxPoint(n+r,l),y=new mxPoint(n+r,l+a)):c>I&&c<p?(S=new mxPoint(n,l-Math.floor(.25*a)),y=new mxPoint(n+Math.floor(1.5*r),l+Math.floor(.5*a))):c>p&&c<x-I?(S=new mxPoint(n-Math.floor(.5*r),l+Math.floor(.5*a)),y=new mxPoint(n+r,l-Math.floor(.25*a))):c>x-I&&c<=x||c<-x+I&&c>=-x?(S=new mxPoint(n,l),y=new mxPoint(n,l+a)):c<-I&&c>-p?(S=new mxPoint(n+Math.floor(1.5*r),l+Math.floor(.5*a)),y=new mxPoint(n,l+Math.floor(1.25*a))):c<-p&&c>-x+I&&(S=new mxPoint(n-Math.floor(.5*r),l+Math.floor(.5*a)),y=new mxPoint(n+r,l+Math.floor(1.25*a)))}else{var I=Math.atan2(a/2,r/4);if(c==I)return new mxPoint(n+Math.floor(.75*r),l);if(c==x-I)return new mxPoint(n+Math.floor(.25*r),l);if(c==x||c==-x)return new mxPoint(n,l+Math.floor(.5*a));if(c==0)return new mxPoint(n+r,l+Math.floor(.5*a));if(c==-I)return new mxPoint(n+Math.floor(.75*r),l+a);if(c==-x+I)return new mxPoint(n+Math.floor(.25*r),l+a);c>0&&c<I?(S=new mxPoint(n+Math.floor(.5*r),l-Math.floor(.5*a)),y=new mxPoint(n+Math.floor(1.25*r),l+a)):c>I&&c<x-I?(S=new mxPoint(n,l),y=new mxPoint(n+r,l)):c>x-I&&c<x?(S=new mxPoint(n-Math.floor(.25*r),l+a),y=new mxPoint(n+Math.floor(.5*r),l-Math.floor(.5*a))):c<0&&c>-I?(S=new mxPoint(n+Math.floor(.5*r),l+Math.floor(1.5*a)),y=new mxPoint(n+Math.floor(1.25*r),l)):c<-I&&c>-x+I?(S=new mxPoint(n,l+a),y=new mxPoint(n+r,l+a)):c<-x+I&&c>-x&&(S=new mxPoint(n-Math.floor(.25*r),l),y=new mxPoint(n+Math.floor(.5*r),l+Math.floor(1.5*a)))}C=mxUtils.intersection(o,h,e.x,e.y,S.x,S.y,y.x,y.y)}return C??new mxPoint(o,h)}}class mxStylesheet{constructor(){this.styles=new Object,this.putDefaultVertexStyle(this.createDefaultVertexStyle()),this.putDefaultEdgeStyle(this.createDefaultEdgeStyle())}createDefaultVertexStyle(){var i=new Object;return i[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_RECTANGLE,i[mxConstants.STYLE_PERIMETER]=mxPerimeter.RectanglePerimeter,i[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE,i[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER,i[mxConstants.STYLE_FILLCOLOR]="#C3D9FF",i[mxConstants.STYLE_STROKECOLOR]="#6482B9",i[mxConstants.STYLE_FONTCOLOR]="#774400",i}createDefaultEdgeStyle(){var i=new Object;return i[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_CONNECTOR,i[mxConstants.STYLE_ENDARROW]=mxConstants.ARROW_CLASSIC,i[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE,i[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER,i[mxConstants.STYLE_STROKECOLOR]="#6482B9",i[mxConstants.STYLE_FONTCOLOR]="#446299",i}putDefaultVertexStyle(i){this.putCellStyle("defaultVertex",i)}putDefaultEdgeStyle(i){this.putCellStyle("defaultEdge",i)}getDefaultVertexStyle(){return this.styles.defaultVertex}getDefaultEdgeStyle(){return this.styles.defaultEdge}putCellStyle(i,t){this.styles[i]=t}getCellStyle(i,t){var e=t;if(i!=null&&i.length>0){var s=i.split(";");e!=null&&i.charAt(0)!=";"?e=mxUtils.clone(e):e=new Object;for(var n=0;n<s.length;n++){var l=s[n],r=l.indexOf("=");if(r>=0){var a=l.substring(0,r),o=l.substring(r+1);o==mxConstants.NONE?delete e[a]:mxUtils.isNumeric(o)?e[a]=parseFloat(o):e[a]=o}else{var h=this.styles[l];if(h!=null)for(var a in h)e[a]=h[a]}}}return e}}class mxSelectionChange{constructor(i,t,e){this.selectionModel=i,this.added=t!=null?t.slice():null,this.removed=e!=null?e.slice():null}execute(){var i=mxLog.enter("mxSelectionChange.execute");if(window.status=mxResources.get(this.selectionModel.updatingSelectionResource)||this.selectionModel.updatingSelectionResource,this.removed!=null)for(var t=0;t<this.removed.length;t++)this.selectionModel.cellRemoved(this.removed[t]);if(this.added!=null)for(var t=0;t<this.added.length;t++)this.selectionModel.cellAdded(this.added[t]);var e=this.added;this.added=this.removed,this.removed=e,window.status=mxResources.get(this.selectionModel.doneResource)||this.selectionModel.doneResource,mxLog.leave("mxSelectionChange.execute",i),this.selectionModel.fireEvent(new mxEventObject(mxEvent.CHANGE,"added",this.added,"removed",this.removed))}}class mxGraphSelectionModel extends mxEventSource{constructor(t){super();u(this,"doneResource",mxClient.language!="none"?"done":"");u(this,"updatingSelectionResource",mxClient.language!="none"?"updatingSelection":"");u(this,"singleSelection",!1);this.graph=t,this.cells=[]}isSingleSelection(){return this.singleSelection}setSingleSelection(t){this.singleSelection=t}isSelected(t){return t!=null?mxUtils.indexOf(this.cells,t)>=0:!1}isEmpty(){return this.cells.length==0}clear(){this.changeSelection(null,this.cells)}setCell(t){t!=null&&this.setCells([t])}setCells(t){if(t!=null){this.singleSelection&&(t=[this.getFirstSelectableCell(t)]);for(var e=[],s=0;s<t.length;s++)this.graph.isCellSelectable(t[s])&&e.push(t[s]);this.changeSelection(e,this.cells)}}getFirstSelectableCell(t){if(t!=null){for(var e=0;e<t.length;e++)if(this.graph.isCellSelectable(t[e]))return t[e]}return null}addCell(t){t!=null&&this.addCells([t])}addCells(t){if(t!=null){var e=null;this.singleSelection&&(e=this.cells,t=[this.getFirstSelectableCell(t)]);for(var s=[],n=0;n<t.length;n++)!this.isSelected(t[n])&&this.graph.isCellSelectable(t[n])&&s.push(t[n]);this.changeSelection(s,e)}}removeCell(t){t!=null&&this.removeCells([t])}removeCells(t){if(t!=null){for(var e=[],s=0;s<t.length;s++)this.isSelected(t[s])&&e.push(t[s]);this.changeSelection(null,e)}}changeSelection(t,e){if(t!=null&&t.length>0&&t[0]!=null||e!=null&&e.length>0&&e[0]!=null){var s=new mxSelectionChange(this,t,e);s.execute();var n=new mxUndoableEdit(this,!1);n.add(s),this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",n))}}cellAdded(t){t!=null&&!this.isSelected(t)&&this.cells.push(t)}cellRemoved(t){if(t!=null){var e=mxUtils.indexOf(this.cells,t);e>=0&&this.cells.splice(e,1)}}}class mxPopupMenuHandler extends mxPopupMenu{constructor(t,e){super();u(this,"graph",null);u(this,"selectOnPopup",!0);u(this,"clearSelectionOnBackground",!0);u(this,"triggerX",null);u(this,"triggerY",null);u(this,"screenX",null);u(this,"screenY",null);t!=null&&(this.graph=t,this.factoryMethod=e,this.graph.addMouseListener(this),this.gestureHandler=(s,n)=>{this.inTolerance=!1},this.graph.addListener(mxEvent.GESTURE,this.gestureHandler),this.init())}init(){super.init(),mxEvent.addGestureListeners(this.div,t=>{this.graph.tooltipHandler.hide()})}isSelectOnPopup(t){return this.selectOnPopup}mouseDown(t,e){this.isEnabled()&&!mxEvent.isMultiTouchEvent(e.getEvent())&&(this.hideMenu(),this.triggerX=e.getGraphX(),this.triggerY=e.getGraphY(),this.screenX=mxEvent.getMainEvent(e.getEvent()).screenX,this.screenY=mxEvent.getMainEvent(e.getEvent()).screenY,this.popupTrigger=this.isPopupTrigger(e),this.inTolerance=!0)}mouseMove(t,e){this.inTolerance&&this.screenX!=null&&this.screenY!=null&&(Math.abs(mxEvent.getMainEvent(e.getEvent()).screenX-this.screenX)>this.graph.tolerance||Math.abs(mxEvent.getMainEvent(e.getEvent()).screenY-this.screenY)>this.graph.tolerance)&&(this.inTolerance=!1)}mouseUp(t,e){if(this.popupTrigger&&this.inTolerance&&this.triggerX!=null&&this.triggerY!=null){var s=this.getCellForPopupEvent(e);this.graph.isEnabled()&&this.isSelectOnPopup(e)&&s!=null&&!this.graph.isCellSelected(s)?this.graph.setSelectionCell(s):this.clearSelectionOnBackground&&s==null&&this.graph.clearSelection(),this.graph.tooltipHandler.hide();var n=mxUtils.getScrollOrigin();this.popup(e.getX()+n.x+1,e.getY()+n.y+1,s,e.getEvent()),e.consume()}this.popupTrigger=!1,this.inTolerance=!1}getCellForPopupEvent(t){return t.getCell()}destroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.gestureHandler),super.destroy()}}class mxPanningHandler extends mxEventSource{constructor(t){super();u(this,"graph",null);u(this,"useLeftButtonForPanning",!1);u(this,"usePopupTrigger",!0);u(this,"ignoreCell",!1);u(this,"previewEnabled",!0);u(this,"useGrid",!1);u(this,"panningEnabled",!0);u(this,"pinchEnabled",!0);u(this,"maxScale",8);u(this,"minScale",.01);u(this,"dx",null);u(this,"dy",null);u(this,"startX",0);u(this,"startY",0);t!=null&&(this.graph=t,this.graph.addMouseListener(this),this.forcePanningHandler=(e,s)=>{var n=s.getProperty("eventName"),l=s.getProperty("event");n==mxEvent.MOUSE_DOWN&&this.isForcePanningEvent(l)&&(this.start(l),this.active=!0,this.fireEvent(new mxEventObject(mxEvent.PAN_START,"event",l)),l.consume())},this.graph.addListener(mxEvent.FIRE_MOUSE_EVENT,this.forcePanningHandler),this.gestureHandler=(e,s)=>{if(this.isPinchEnabled()){var n=s.getProperty("event");!mxEvent.isConsumed(n)&&n.type=="gesturestart"?(this.initialScale=this.graph.view.scale,!this.active&&this.mouseDownEvent!=null&&(this.start(this.mouseDownEvent),this.mouseDownEvent=null)):n.type=="gestureend"&&this.initialScale!=null&&(this.initialScale=null),this.initialScale!=null&&this.zoomGraph(n)}},this.graph.addListener(mxEvent.GESTURE,this.gestureHandler),this.mouseUpListener=()=>{this.active&&this.reset()},mxEvent.addListener(document,"mouseup",this.mouseUpListener))}isActive(){return this.active||this.initialScale!=null}isPanningEnabled(){return this.panningEnabled}setPanningEnabled(t){this.panningEnabled=t}isPinchEnabled(){return this.pinchEnabled}setPinchEnabled(t){this.pinchEnabled=t}isPanningTrigger(t){var e=t.getEvent();return this.useLeftButtonForPanning&&t.getState()==null&&mxEvent.isLeftMouseButton(e)||mxEvent.isControlDown(e)&&mxEvent.isShiftDown(e)||this.usePopupTrigger&&mxEvent.isPopupTrigger(e)}isForcePanningEvent(t){return this.ignoreCell||mxEvent.isMultiTouchEvent(t.getEvent())}mouseDown(t,e){this.mouseDownEvent=e,!e.isConsumed()&&this.isPanningEnabled()&&!this.active&&this.isPanningTrigger(e)&&(this.start(e),this.consumePanningTrigger(e))}start(t){this.dx0=-this.graph.container.scrollLeft,this.dy0=-this.graph.container.scrollTop,this.startX=t.getX(),this.startY=t.getY(),this.dx=null,this.dy=null,this.panningTrigger=!0}consumePanningTrigger(t){t.consume()}mouseMove(t,e){if(this.dx=e.getX()-this.startX,this.dy=e.getY()-this.startY,this.active)this.previewEnabled&&(this.useGrid&&(this.dx=this.graph.snap(this.dx),this.dy=this.graph.snap(this.dy)),this.graph.panGraph(this.dx+this.dx0,this.dy+this.dy0)),this.fireEvent(new mxEventObject(mxEvent.PAN,"event",e));else if(this.panningTrigger){var s=this.active;this.active=Math.abs(this.dx)>this.graph.tolerance||Math.abs(this.dy)>this.graph.tolerance,!s&&this.active&&this.fireEvent(new mxEventObject(mxEvent.PAN_START,"event",e))}(this.active||this.panningTrigger)&&e.consume()}mouseUp(t,e){if(this.active){if(this.dx!=null&&this.dy!=null){if(!this.graph.useScrollbarsForPanning||!mxUtils.hasScrollbars(this.graph.container)){var s=this.graph.getView().scale,n=this.graph.getView().translate;this.graph.panGraph(0,0),this.panGraph(n.x+this.dx/s,n.y+this.dy/s)}e.consume()}this.fireEvent(new mxEventObject(mxEvent.PAN_END,"event",e))}this.reset()}zoomGraph(t){var e=Math.round(this.initialScale*t.scale*100)/100;this.minScale!=null&&(e=Math.max(this.minScale,e)),this.maxScale!=null&&(e=Math.min(this.maxScale,e)),this.graph.view.scale!=e&&(this.graph.zoomTo(e),mxEvent.consume(t))}reset(){this.panningTrigger=!1,this.mouseDownEvent=null,this.active=!1,this.dx=null,this.dy=null}panGraph(t,e){this.graph.getView().setTranslate(t,e)}destroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.forcePanningHandler),this.graph.removeListener(this.gestureHandler),mxEvent.removeListener(document,"mouseup",this.mouseUpListener)}}class ConnectionCellMarker extends mxCellMarker{constructor(i,t,e){super(e),this.connectionHandler=i,this.hotspotEnabled=t}getCell(i){var t=super.getCell(i);if(this.connectionHandler==null)return t;if(this.connectionHandler.error=null,t==null&&this.connectionHandler.currentPoint!=null&&(t=this.connectionHandler.graph.getCellAt(this.connectionHandler.currentPoint.x,this.connectionHandler.currentPoint.y)),t!=null&&!this.connectionHandler.graph.isCellConnectable(t)){var e=this.connectionHandler.graph.getModel().getParent(t);this.connectionHandler.graph.getModel().isVertex(e)&&this.connectionHandler.graph.isCellConnectable(e)&&(t=e)}return(this.connectionHandler.graph.isSwimlane(t)&&this.connectionHandler.currentPoint!=null&&this.connectionHandler.graph.hitsSwimlaneContent(t,this.connectionHandler.currentPoint.x,this.connectionHandler.currentPoint.y)||!this.connectionHandler.isConnectableCell(t))&&(t=null),t!=null?this.connectionHandler.isConnecting()?this.connectionHandler.previous!=null&&(this.connectionHandler.error=this.connectionHandler.validateConnection(this.connectionHandler.previous.cell,t),this.connectionHandler.error!=null&&this.connectionHandler.error.length==0&&(t=null,this.connectionHandler.isCreateTarget(i.getEvent())&&(this.connectionHandler.error=null))):this.connectionHandler.isValidSource(t,i)||(t=null):this.connectionHandler.isConnecting()&&!this.connectionHandler.isCreateTarget(i.getEvent())&&!this.connectionHandler.graph.allowDanglingEdges&&(this.connectionHandler.error=""),t}isValidState(i){return this.connectionHandler.isConnecting()?this.connectionHandler.error==null:super.isValidState(i)}getMarkerColor(i,t,e){return this.connectionHandler.connectImage==null||this.connectionHandler.isConnecting()?super.getMarkerColor(i,t,e):null}intersects(i,t){return this.connectionHandler.connectImage!=null||this.connectionHandler.isConnecting()?!0:super.intersects(i,t)}}class mxConnectionHandler extends mxEventSource{constructor(t,e){super();u(this,"graph",null);u(this,"factoryMethod",!0);u(this,"moveIconFront",!1);u(this,"moveIconBack",!1);u(this,"connectImage",null);u(this,"targetConnectImage",!1);u(this,"enabled",!0);u(this,"select",!0);u(this,"createTarget",!1);u(this,"marker",null);u(this,"constraintHandler",null);u(this,"error",null);u(this,"waypointsEnabled",!1);u(this,"ignoreMouseDown",!1);u(this,"first",null);u(this,"connectIconOffset",new mxPoint(0,mxConstants.TOOLTIP_VERTICAL_OFFSET));u(this,"edgeState",null);u(this,"changeHandler",null);u(this,"drillHandler",null);u(this,"mouseDownCounter",0);u(this,"movePreviewAway",!1);u(this,"outlineConnect",!1);u(this,"livePreview",!1);u(this,"cursor",null);u(this,"insertBeforeSource",!1);t!=null&&(this.graph=t,this.factoryMethod=e,this.init(),this.escapeHandler=(s,n)=>{this.reset()},this.graph.addListener(mxEvent.ESCAPE,this.escapeHandler))}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isInsertBefore(t,e,s,n,l){return this.insertBeforeSource&&e!=s}isCreateTarget(t){return this.createTarget}setCreateTarget(t){this.createTarget=t}createShape(){var t=this.livePreview&&this.edgeState!=null?this.graph.cellRenderer.createShape(this.edgeState):new mxPolyline([],mxConstants.INVALID_COLOR);return t.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,t.scale=this.graph.view.scale,t.pointerEvents=!1,t.isDashed=!0,t.init(this.graph.getView().getOverlayPane()),mxEvent.redirectMouseEvents(t.node,this.graph,null),t}init(){this.graph.addMouseListener(this),this.marker=this.createMarker(),this.constraintHandler=new mxConstraintHandler(this.graph),this.changeHandler=t=>{this.iconState!=null&&(this.iconState=this.graph.getView().getState(this.iconState.cell)),this.iconState!=null?(this.redrawIcons(this.icons,this.iconState),this.constraintHandler.reset()):this.previous!=null&&this.graph.view.getState(this.previous.cell)==null&&this.reset()},this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler),this.graph.getView().addListener(mxEvent.SCALE,this.changeHandler),this.graph.getView().addListener(mxEvent.TRANSLATE,this.changeHandler),this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.changeHandler),this.drillHandler=t=>{this.reset()},this.graph.addListener(mxEvent.START_EDITING,this.drillHandler),this.graph.getView().addListener(mxEvent.DOWN,this.drillHandler),this.graph.getView().addListener(mxEvent.UP,this.drillHandler)}isConnectableCell(t){return!0}createMarker(){var t=new ConnectionCellMarker(this,!0,this.graph);return t}start(t,e,s,n){this.previous=t,this.first=new mxPoint(e,s),this.edgeState=n??this.createEdgeState(null),this.marker.currentColor=this.marker.validColor,this.marker.markedState=t,this.marker.mark(),this.fireEvent(new mxEventObject(mxEvent.START,"state",this.previous))}isConnecting(){return this.first!=null&&this.shape!=null}isValidSource(t,e){return this.graph.isValidSource(t)}isValidTarget(t){return!0}validateConnection(t,e){return this.isValidTarget(e)?this.graph.getEdgeValidationError(null,t,e):""}getConnectImage(t){return this.connectImage}isMoveIconToFrontForState(t){return t.text!=null&&t.text.node.parentNode==this.graph.container?!0:this.moveIconFront}createIcons(t){var e=this.getConnectImage(t);if(e!=null&&t!=null){this.iconState=t;var s=[],n=new mxRectangle(0,0,e.width,e.height),l=new mxImageShape(n,e.src,null,null,0);l.preserveImageAspect=!1,this.isMoveIconToFrontForState(t)?(l.dialect=mxConstants.DIALECT_STRICTHTML,l.init(this.graph.container)):(l.dialect=this.graph.dialect==mxConstants.DIALECT_SVG?mxConstants.DIALECT_SVG:mxConstants.DIALECT_VML,l.init(this.graph.getView().getOverlayPane()),this.moveIconBack&&l.node.previousSibling!=null&&l.node.parentNode.insertBefore(l.node,l.node.parentNode.firstChild)),l.node.style.cursor=mxConstants.CURSOR_CONNECT;var r=()=>this.currentState!=null?this.currentState:t,a=o=>{mxEvent.isConsumed(o)||(this.icon=l,this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(o,r())))};return mxEvent.redirectMouseEvents(l.node,this.graph,r,a),s.push(l),this.redrawIcons(s,this.iconState),s}return null}redrawIcons(t,e){if(t!=null&&t[0]!=null&&e!=null){var s=this.getIconPosition(t[0],e);t[0].bounds.x=s.x,t[0].bounds.y=s.y,t[0].redraw()}}getIconPosition(t,e){var s=this.graph.getView().scale,n=e.getCenterX(),l=e.getCenterY();if(this.graph.isSwimlane(e.cell)){var r=this.graph.getStartSize(e.cell);n=r.width!=0?e.x+r.width*s/2:n,l=r.height!=0?e.y+r.height*s/2:l;var a=mxUtils.toRadians(mxUtils.getValue(e.style,mxConstants.STYLE_ROTATION)||0);if(a!=0){var o=Math.cos(a),h=Math.sin(a),d=new mxPoint(e.getCenterX(),e.getCenterY()),g=mxUtils.getRotatedPoint(new mxPoint(n,l),o,h,d);n=g.x,l=g.y}}return new mxPoint(n-t.bounds.width/2,l-t.bounds.height/2)}destroyIcons(){if(this.icons!=null){for(var t=0;t<this.icons.length;t++)this.icons[t].destroy();this.icons=null,this.icon=null,this.selectedIcon=null,this.iconState=null}}isStartEvent(t){return this.constraintHandler.currentFocus!=null&&this.constraintHandler.currentConstraint!=null||this.previous!=null&&this.error==null&&(this.icons==null||this.icons!=null&&this.icon!=null)}mouseDown(t,e){if(this.mouseDownCounter++,this.isEnabled()&&this.graph.isEnabled()&&!e.isConsumed()&&!this.isConnecting()&&this.isStartEvent(e)){if(this.constraintHandler.currentConstraint!=null&&this.constraintHandler.currentFocus!=null&&this.constraintHandler.currentPoint!=null?(this.sourceConstraint=this.constraintHandler.currentConstraint,this.previous=this.constraintHandler.currentFocus,this.first=this.constraintHandler.currentPoint.clone()):this.first=new mxPoint(e.getGraphX(),e.getGraphY()),this.edgeState=this.createEdgeState(e),this.mouseDownCounter=1,this.waypointsEnabled&&this.shape==null&&(this.waypoints=null,this.shape=this.createShape(),this.edgeState!=null&&this.shape.apply(this.edgeState)),this.previous==null&&this.edgeState!=null){var s=this.graph.getPointForEvent(e.getEvent());this.edgeState.cell.geometry.setTerminalPoint(s,!0)}this.fireEvent(new mxEventObject(mxEvent.START,"state",this.previous)),e.consume()}this.selectedIcon=this.icon,this.icon=null}isImmediateConnectSource(t){return!this.graph.isCellMovable(t.cell)}createEdgeState(t){return null}isOutlineConnectEvent(t){var e=mxUtils.getOffset(this.graph.container),s=t.getEvent(),n=mxEvent.getClientX(s),l=mxEvent.getClientY(s),r=document.documentElement,a=(window.pageXOffset||r.scrollLeft)-(r.clientLeft||0),o=(window.pageYOffset||r.scrollTop)-(r.clientTop||0),h=this.currentPoint.x-this.graph.container.scrollLeft+e.x-a,d=this.currentPoint.y-this.graph.container.scrollTop+e.y-o;return this.outlineConnect&&!mxEvent.isShiftDown(t.getEvent())&&(t.isSource(this.marker.highlight.shape)||mxEvent.isAltDown(t.getEvent())&&t.getState()!=null||this.marker.highlight.isHighlightAt(n,l)||(h!=n||d!=l)&&t.getState()==null&&this.marker.highlight.isHighlightAt(h,d))}updateCurrentState(t,e){if(this.constraintHandler.update(t,this.first==null,!1,this.first==null||t.isSource(this.marker.highlight.shape)?null:e),this.constraintHandler.currentFocus!=null&&this.constraintHandler.currentConstraint!=null)this.marker.highlight!=null&&this.marker.highlight.state!=null&&this.marker.highlight.state.cell==this.constraintHandler.currentFocus.cell?this.marker.highlight.shape.stroke!="transparent"&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint()):this.marker.markCell(this.constraintHandler.currentFocus.cell,"transparent"),this.previous!=null&&(this.error=this.validateConnection(this.previous.cell,this.constraintHandler.currentFocus.cell),this.error==null&&(this.currentState=this.constraintHandler.currentFocus),(this.error!=null||this.currentState!=null&&!this.isCellEnabled(this.currentState.cell))&&this.constraintHandler.reset());else{this.graph.isIgnoreTerminalEvent(t.getEvent())?(this.marker.reset(),this.currentState=null):(this.marker.process(t),this.currentState=this.marker.getValidState()),this.currentState!=null&&!this.isCellEnabled(this.currentState.cell)&&(this.constraintHandler.reset(),this.marker.reset(),this.currentState=null);var s=this.isOutlineConnectEvent(t);if(this.currentState!=null&&s){t.isSource(this.marker.highlight.shape)&&(e=new mxPoint(t.getGraphX(),t.getGraphY()));var n=this.graph.getOutlineConstraint(e,this.currentState,t);this.constraintHandler.setFocus(t,this.currentState,!1),this.constraintHandler.currentConstraint=n,this.constraintHandler.currentPoint=e}if(this.outlineConnect&&this.marker.highlight!=null&&this.marker.highlight.shape!=null){var l=this.graph.view.scale;this.constraintHandler.currentConstraint!=null&&this.constraintHandler.currentFocus!=null?(this.marker.highlight.shape.stroke=mxConstants.OUTLINE_HIGHLIGHT_COLOR,this.marker.highlight.shape.strokewidth=mxConstants.OUTLINE_HIGHLIGHT_STROKEWIDTH/l/l,this.marker.highlight.repaint()):this.marker.hasValidState()&&(this.graph.isCellConnectable(t.getCell())&&this.marker.getValidState()!=t.getState()?(this.marker.highlight.shape.stroke="transparent",this.currentState=null):this.marker.highlight.shape.stroke=mxConstants.DEFAULT_VALID_COLOR,this.marker.highlight.shape.strokewidth=mxConstants.HIGHLIGHT_STROKEWIDTH/l/l,this.marker.highlight.repaint())}}}isCellEnabled(t){return!0}convertWaypoint(t){var e=this.graph.getView().getScale(),s=this.graph.getView().getTranslate();t.x=t.x/e-s.x,t.y=t.y/e-s.y}snapToPreview(t,e){if(!mxEvent.isAltDown(t.getEvent())&&this.previous!=null){var s=this.graph.gridSize*this.graph.view.scale/2,n=this.sourceConstraint!=null?this.first:new mxPoint(this.previous.getCenterX(),this.previous.getCenterY());Math.abs(n.x-t.getGraphX())<s&&(e.x=n.x),Math.abs(n.y-t.getGraphY())<s&&(e.y=n.y)}}mouseMove(t,e){if(!e.isConsumed()&&(this.ignoreMouseDown||this.first!=null||!this.graph.isMouseDown)){!this.isEnabled()&&this.currentState!=null&&(this.destroyIcons(),this.currentState=null);var s=this.graph.getView(),n=s.scale,l=s.translate,r=new mxPoint(e.getGraphX(),e.getGraphY());if(this.error=null,this.graph.isGridEnabledEvent(e.getEvent())&&(r=new mxPoint((this.graph.snap(r.x/n-l.x)+l.x)*n,(this.graph.snap(r.y/n-l.y)+l.y)*n)),this.snapToPreview(e,r),this.currentPoint=r,(this.first!=null||this.isEnabled()&&this.graph.isEnabled())&&(this.shape!=null||this.first==null||Math.abs(e.getGraphX()-this.first.x)>this.graph.tolerance||Math.abs(e.getGraphY()-this.first.y)>this.graph.tolerance)&&this.updateCurrentState(e,r),this.first!=null){var a=null,o=r;this.constraintHandler.currentConstraint!=null&&this.constraintHandler.currentFocus!=null&&this.constraintHandler.currentPoint!=null?(a=this.constraintHandler.currentConstraint,o=this.constraintHandler.currentPoint.clone()):this.previous!=null&&!this.graph.isIgnoreTerminalEvent(e.getEvent())&&mxEvent.isShiftDown(e.getEvent())&&(Math.abs(this.previous.getCenterX()-r.x)<Math.abs(this.previous.getCenterY()-r.y)?r.x=this.previous.getCenterX():r.y=this.previous.getCenterY());var h=this.first;if(this.selectedIcon!=null){var d=this.selectedIcon.bounds.width,g=this.selectedIcon.bounds.height;if(this.currentState!=null&&this.targetConnectImage){var m=this.getIconPosition(this.selectedIcon,this.currentState);this.selectedIcon.bounds.x=m.x,this.selectedIcon.bounds.y=m.y}else{var f=new mxRectangle(e.getGraphX()+this.connectIconOffset.x,e.getGraphY()+this.connectIconOffset.y,d,g);this.selectedIcon.bounds=f}this.selectedIcon.redraw()}if(this.edgeState!=null)this.updateEdgeState(o,a),o=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-1],h=this.edgeState.absolutePoints[0];else{if(this.currentState!=null&&this.constraintHandler.currentConstraint==null){var c=this.getTargetPerimeterPoint(this.currentState,e);c!=null&&(o=c)}if(this.sourceConstraint==null&&this.previous!=null){var x=this.waypoints!=null&&this.waypoints.length>0?this.waypoints[0]:o,c=this.getSourcePerimeterPoint(this.previous,x,e);c!=null&&(h=c)}}if(this.currentState==null&&this.movePreviewAway){var c=h;if(this.edgeState!=null&&this.edgeState.absolutePoints.length>=2){var p=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-2];p!=null&&(c=p)}var C=o.x-c.x,E=o.y-c.y,T=Math.sqrt(C*C+E*E);if(T==0)return;this.originalPoint=o.clone(),o.x-=C*4/T,o.y-=E*4/T}else this.originalPoint=null;if(this.shape==null){var C=Math.abs(e.getGraphX()-this.first.x),E=Math.abs(e.getGraphY()-this.first.y);(C>this.graph.tolerance||E>this.graph.tolerance)&&(this.shape=this.createShape(),this.edgeState!=null&&this.shape.apply(this.edgeState),this.updateCurrentState(e,r))}if(this.shape!=null){if(this.edgeState!=null)this.shape.points=this.edgeState.absolutePoints;else{var S=[h];this.waypoints!=null&&(S=S.concat(this.waypoints)),S.push(o),this.shape.points=S}this.drawPreview()}this.cursor!=null&&(this.graph.container.style.cursor=this.cursor),mxEvent.consume(e.getEvent()),e.consume()}else!this.isEnabled()||!this.graph.isEnabled()?this.constraintHandler.reset():this.previous!=this.currentState&&this.edgeState==null?(this.destroyIcons(),this.currentState!=null&&this.error==null&&this.constraintHandler.currentConstraint==null&&(this.icons=this.createIcons(this.currentState),this.icons==null&&(this.currentState.setCursor(mxConstants.CURSOR_CONNECT),e.consume())),this.previous=this.currentState):this.previous==this.currentState&&this.currentState!=null&&this.icons==null&&!this.graph.isMouseDown&&e.consume();if(!this.graph.isMouseDown&&this.currentState!=null&&this.icons!=null){for(var y=!1,b=e.getSource(),w=0;w<this.icons.length&&!y;w++)y=b==this.icons[w].node||b.parentNode==this.icons[w].node;y||this.updateIcons(this.currentState,this.icons,e)}}else this.constraintHandler.reset()}updateEdgeState(t,e){this.sourceConstraint!=null&&this.sourceConstraint.point!=null&&(this.edgeState.style[mxConstants.STYLE_EXIT_X]=this.sourceConstraint.point.x,this.edgeState.style[mxConstants.STYLE_EXIT_Y]=this.sourceConstraint.point.y),e!=null&&e.point!=null?(this.edgeState.style[mxConstants.STYLE_ENTRY_X]=e.point.x,this.edgeState.style[mxConstants.STYLE_ENTRY_Y]=e.point.y):(delete this.edgeState.style[mxConstants.STYLE_ENTRY_X],delete this.edgeState.style[mxConstants.STYLE_ENTRY_Y]),this.edgeState.absolutePoints=[null,this.currentState!=null?null:t],this.graph.view.updateFixedTerminalPoint(this.edgeState,this.previous,!0,this.sourceConstraint),this.currentState!=null&&(e==null&&(e=this.graph.getConnectionConstraint(this.edgeState,this.previous,!1)),this.edgeState.setAbsoluteTerminalPoint(null,!1),this.graph.view.updateFixedTerminalPoint(this.edgeState,this.currentState,!1,e));var s=null;if(this.waypoints!=null){s=[];for(var n=0;n<this.waypoints.length;n++){var l=this.waypoints[n].clone();this.convertWaypoint(l),s[n]=l}}this.graph.view.updatePoints(this.edgeState,s,this.previous,this.currentState),this.graph.view.updateFloatingTerminalPoints(this.edgeState,this.previous,this.currentState)}getTargetPerimeterPoint(t,e){var s=null,n=t.view,l=n.getPerimeterFunction(t);if(l!=null){var r=this.waypoints!=null&&this.waypoints.length>0?this.waypoints[this.waypoints.length-1]:new mxPoint(this.previous.getCenterX(),this.previous.getCenterY()),a=l(n.getPerimeterBounds(t),this.edgeState,r,!1);a!=null&&(s=a)}else s=new mxPoint(t.getCenterX(),t.getCenterY());return s}getSourcePerimeterPoint(t,e,s){var n=null,l=t.view,r=l.getPerimeterFunction(t),a=new mxPoint(t.getCenterX(),t.getCenterY());if(r!=null){var o=mxUtils.getValue(t.style,mxConstants.STYLE_ROTATION,0),h=-o*(Math.PI/180);o!=0&&(e=mxUtils.getRotatedPoint(new mxPoint(e.x,e.y),Math.cos(h),Math.sin(h),a));var d=r(l.getPerimeterBounds(t),t,e,!1);d!=null&&(o!=0&&(d=mxUtils.getRotatedPoint(new mxPoint(d.x,d.y),Math.cos(-h),Math.sin(-h),a)),n=d)}else n=a;return n}updateIcons(t,e,s){}isStopEvent(t){return t.getState()!=null}addWaypointForEvent(t){var e=mxUtils.convertPoint(this.graph.container,t.getX(),t.getY()),s=Math.abs(e.x-this.first.x),n=Math.abs(e.y-this.first.y),l=this.waypoints!=null||this.mouseDownCounter>1&&(s>this.graph.tolerance||n>this.graph.tolerance);if(l){this.waypoints==null&&(this.waypoints=[]);var r=this.graph.view.scale,e=new mxPoint(this.graph.snap(t.getGraphX()/r)*r,this.graph.snap(t.getGraphY()/r)*r);this.waypoints.push(e)}}checkConstraints(t,e){return t==null||e==null||t.point==null||e.point==null||!t.point.equals(e.point)||t.dx!=e.dx||t.dy!=e.dy||t.perimeter!=e.perimeter}mouseUp(t,e){if(!e.isConsumed()&&this.isConnecting()){if(this.waypointsEnabled&&!this.isStopEvent(e)){this.addWaypointForEvent(e),e.consume();return}var s=this.sourceConstraint,n=this.constraintHandler.currentConstraint,l=this.previous!=null?this.previous.cell:null,r=null;this.constraintHandler.currentConstraint!=null&&this.constraintHandler.currentFocus!=null&&(r=this.constraintHandler.currentFocus.cell),r==null&&this.currentState!=null&&(r=this.currentState.cell),this.error==null&&(l==null||r==null||l!=r||this.checkConstraints(s,n))?this.connect(l,r,e.getEvent(),e.getCell()):(this.previous!=null&&this.marker.validState!=null&&this.previous.cell==this.marker.validState.cell&&this.graph.selectCellForEvent(this.marker.source,e.getEvent()),this.error!=null&&this.error.length>0&&this.graph.validationAlert(this.error)),this.destroyIcons(),e.consume()}this.first!=null&&this.reset()}reset(){this.shape!=null&&(this.shape.destroy(),this.shape=null),this.cursor!=null&&this.graph.container!=null&&(this.graph.container.style.cursor=""),this.destroyIcons(),this.marker.reset(),this.constraintHandler.reset(),this.originalPoint=null,this.currentPoint=null,this.edgeState=null,this.previous=null,this.error=null,this.sourceConstraint=null,this.mouseDownCounter=0,this.first=null,this.fireEvent(new mxEventObject(mxEvent.RESET))}drawPreview(){this.updatePreview(this.error==null),this.shape.redraw()}updatePreview(t){this.shape.strokewidth=this.getEdgeWidth(t),this.shape.stroke=this.getEdgeColor(t)}getEdgeColor(t){return t?mxConstants.VALID_COLOR:mxConstants.INVALID_COLOR}getEdgeWidth(t){return t?3:1}connect(t,e,s,n){if(e!=null||this.isCreateTarget(s)||this.graph.allowDanglingEdges){var l=this.graph.getModel(),r=!1,a=null;l.beginUpdate();try{if(t!=null&&e==null&&!this.graph.isIgnoreTerminalEvent(s)&&this.isCreateTarget(s)&&(e=this.createTargetVertex(s,t),e!=null)){if(n=this.graph.getDropTarget([e],s,n),r=!0,n==null||!this.graph.getModel().isEdge(n)){var o=this.graph.getView().getState(n);if(o!=null){var h=l.getGeometry(e);h.x-=o.origin.x,h.y-=o.origin.y}}else n=this.graph.getDefaultParent();this.graph.addCell(e,n)}var d=this.graph.getDefaultParent();t!=null&&e!=null&&l.getParent(t)==l.getParent(e)&&l.getParent(l.getParent(t))!=l.getRoot()&&(d=l.getParent(t),t.geometry!=null&&t.geometry.relative&&e.geometry!=null&&e.geometry.relative&&(d=l.getParent(d)));var g=null,m=null;if(this.edgeState!=null&&(g=this.edgeState.cell.value,m=this.edgeState.cell.style),a=this.insertEdge(d,null,g,t,e,m),a!=null){this.graph.setConnectionConstraint(a,t,!0,this.sourceConstraint),this.graph.setConnectionConstraint(a,e,!1,this.constraintHandler.currentConstraint),this.edgeState!=null&&l.setGeometry(a,this.edgeState.cell.geometry);var d=l.getParent(t);if(this.isInsertBefore(a,t,e,s,n)){for(var f=null,h=t;h.parent!=null&&h.geometry!=null&&h.geometry.relative&&h.parent!=a.parent;)h=this.graph.model.getParent(h);h!=null&&h.parent!=null&&h.parent==a.parent&&l.add(d,a,h.parent.getIndex(h))}var c=l.getGeometry(a);if(c==null&&(c=new mxGeometry,c.relative=!0,l.setGeometry(a,c)),this.waypoints!=null&&this.waypoints.length>0){var x=this.graph.view.scale,p=this.graph.view.translate;c.points=[];for(var C=0;C<this.waypoints.length;C++){var E=this.waypoints[C];c.points.push(new mxPoint(E.x/x-p.x,E.y/x-p.y))}}if(e==null){var T=this.graph.view.translate,x=this.graph.view.scale,E=this.originalPoint!=null?new mxPoint(this.originalPoint.x/x-T.x,this.originalPoint.y/x-T.y):new mxPoint(this.currentPoint.x/x-T.x,this.currentPoint.y/x-T.y);E.x-=this.graph.panDx/this.graph.view.scale,E.y-=this.graph.panDy/this.graph.view.scale,c.setTerminalPoint(E,!1)}this.fireEvent(new mxEventObject(mxEvent.CONNECT,"cell",a,"terminal",e,"event",s,"target",n,"terminalInserted",r))}}catch(S){mxLog.show(),mxLog.debug(S.message)}finally{l.endUpdate()}this.select&&this.selectCells(a,r?e:null)}}selectCells(t,e){this.graph.setSelectionCell(t)}insertEdge(t,e,s,n,l,r){if(this.factoryMethod==null)return this.graph.insertEdge(t,e,s,n,l,r);var a=this.createEdge(s,n,l,r);return a=this.graph.addEdge(a,t,n,l),a}createTargetVertex(t,e){for(var n=this.graph.getCellGeometry(e);n!=null&&n.relative;)e=this.graph.getModel().getParent(e),n=this.graph.getCellGeometry(e);var s=this.graph.cloneCell(e),n=this.graph.getModel().getGeometry(s);if(n!=null){var l=this.graph.view.translate,r=this.graph.view.scale,a=new mxPoint(this.currentPoint.x/r-l.x,this.currentPoint.y/r-l.y);n.x=Math.round(a.x-n.width/2-this.graph.panDx/r),n.y=Math.round(a.y-n.height/2-this.graph.panDy/r);var o=this.getAlignmentTolerance();if(o>0){var h=this.graph.view.getState(e);if(h!=null){var d=h.x/r-l.x,g=h.y/r-l.y;Math.abs(d-n.x)<=o&&(n.x=Math.round(d)),Math.abs(g-n.y)<=o&&(n.y=Math.round(g))}}}return s}getAlignmentTolerance(t){return this.graph.isGridEnabled()?this.graph.gridSize/2:this.graph.tolerance}createEdge(t,e,s,n){var l=null;if(this.factoryMethod!=null&&(l=this.factoryMethod(e,s,n)),l==null){l=new mxCell(t||""),l.setEdge(!0),l.setStyle(n);var r=new mxGeometry;r.relative=!0,l.setGeometry(r)}return l}destroy(){this.graph.removeMouseListener(this),this.shape!=null&&(this.shape.destroy(),this.shape=null),this.marker!=null&&(this.marker.destroy(),this.marker=null),this.constraintHandler!=null&&(this.constraintHandler.destroy(),this.constraintHandler=null),this.changeHandler!=null&&(this.graph.getModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.changeHandler),this.changeHandler=null),this.drillHandler!=null&&(this.graph.removeListener(this.drillHandler),this.graph.getView().removeListener(this.drillHandler),this.drillHandler=null),this.escapeHandler!=null&&(this.graph.removeListener(this.escapeHandler),this.escapeHandler=null)}}class mxSelectionCellsHandler extends mxEventSource{constructor(t){super();u(this,"enabled",!0);u(this,"maxHandlers",100);this.graph=t,this.handlers=new mxDictionary,this.graph.addMouseListener(this),this.refreshHandler=(e,s)=>{this.isEnabled()&&this.refresh()},this.graph.getSelectionModel().addListener(mxEvent.CHANGE,this.refreshHandler),this.graph.getModel().addListener(mxEvent.CHANGE,this.refreshHandler),this.graph.getView().addListener(mxEvent.SCALE,this.refreshHandler),this.graph.getView().addListener(mxEvent.TRANSLATE,this.refreshHandler),this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.refreshHandler),this.graph.getView().addListener(mxEvent.DOWN,this.refreshHandler),this.graph.getView().addListener(mxEvent.UP,this.refreshHandler)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}getHandler(t){return this.handlers.get(t)}isHandled(t){return this.getHandler(t)!=null}reset(){this.handlers.visit(function(t,e){e.reset.apply(e)})}getHandledSelectionCells(){return this.graph.getSelectionCells()}refresh(){var t=this.handlers;this.handlers=new mxDictionary;for(var e=mxUtils.sortCells(this.getHandledSelectionCells(),!1),s=0;s<e.length;s++){var n=this.graph.view.getState(e[s]);if(n!=null){var l=t.remove(e[s]);l!=null&&(l.state!=n?(l.destroy(),l=null):this.isHandlerActive(l)||(l.refresh!=null&&l.refresh(),l.redraw())),l==null&&(l=this.graph.createHandler(n),this.fireEvent(new mxEventObject(mxEvent.ADD,"state",n))),l!=null&&this.handlers.put(e[s],l)}}t.visit((r,a)=>{this.fireEvent(new mxEventObject(mxEvent.REMOVE,"state",a.state)),a.destroy()})}isHandlerActive(t){return t.index!=null}updateHandler(t){var e=this.handlers.remove(t.cell);if(e!=null){var s=e.index,n=e.startX,l=e.startY;e.destroy(),e=this.graph.createHandler(t),e!=null&&(this.handlers.put(t.cell,e),s!=null&&n!=null&&l!=null&&e.start(n,l,s))}}mouseDown(t,e){if(this.graph.isEnabled()&&this.isEnabled()){var s=[t,e];this.handlers.visit(function(n,l){l.mouseDown.apply(l,s)})}}mouseMove(t,e){if(this.graph.isEnabled()&&this.isEnabled()){var s=[t,e];this.handlers.visit(function(n,l){l.mouseMove.apply(l,s)})}}mouseUp(t,e){if(this.graph.isEnabled()&&this.isEnabled()){var s=[t,e];this.handlers.visit(function(n,l){l.mouseUp.apply(l,s)})}}destroy(){this.graph.removeMouseListener(this),this.refreshHandler!=null&&(this.graph.getSelectionModel().removeListener(this.refreshHandler),this.graph.getModel().removeListener(this.refreshHandler),this.graph.getView().removeListener(this.refreshHandler),this.refreshHandler=null)}}class mxTooltipHandler{constructor(i,t){u(this,"zIndex",10005);u(this,"graph",null);u(this,"delay",null);u(this,"ignoreTouchEvents",!0);u(this,"hideOnHover",!1);u(this,"destroyed",!1);u(this,"enabled",!0);i!=null&&(this.graph=i,this.delay=t||500,this.graph.addMouseListener(this))}isEnabled(){return this.enabled}setEnabled(i){this.enabled=i}isHideOnHover(){return this.hideOnHover}setHideOnHover(i){this.hideOnHover=i}init(){document.body!=null&&(this.div=document.createElement("div"),this.div.className="mxTooltip",this.div.style.visibility="hidden",document.body.appendChild(this.div),mxEvent.addGestureListeners(this.div,i=>{this.hideTooltip()}))}getStateForEvent(i){return i.getState()}mouseDown(i,t){this.reset(t,!1),this.hideTooltip()}mouseMove(i,t){if(t.getX()!=this.lastX||t.getY()!=this.lastY){this.reset(t,!0);var e=this.getStateForEvent(t);(this.isHideOnHover()||e!=this.state||t.getSource()!=this.node&&(!this.stateSource||e!=null&&this.stateSource==(t.isSource(e.shape)||!t.isSource(e.text))))&&this.hideTooltip()}this.lastX=t.getX(),this.lastY=t.getY()}mouseUp(i,t){this.reset(t,!0),this.hideTooltip()}resetTimer(){this.thread!=null&&(window.clearTimeout(this.thread),this.thread=null)}reset(i,t,e){if((!this.ignoreTouchEvents||mxEvent.isMouseEvent(i.getEvent()))&&(this.resetTimer(),e=e??this.getStateForEvent(i),t&&this.isEnabled()&&e!=null&&(this.div==null||this.div.style.visibility=="hidden"))){var s=i.getSource(),n=i.getX(),l=i.getY(),r=i.isSource(e.shape)||i.isSource(e.text);this.thread=window.setTimeout(()=>{if(!this.graph.isEditing()&&!this.graph.popupMenuHandler.isMenuShowing()&&!this.graph.isMouseDown){var a=this.graph.getTooltip(e,s,n,l);this.show(a,n,l),this.state=e,this.node=s,this.stateSource=r}},this.delay)}}hide(){this.resetTimer(),this.hideTooltip()}hideTooltip(){this.div!=null&&(this.div.style.visibility="hidden",this.div.innerHTML="")}show(i,t,e){if(!this.destroyed&&i!=null&&i.length>0){this.div==null&&this.init();var s=mxUtils.getScrollOrigin();this.div.style.zIndex=this.zIndex,this.div.style.left=t+s.x+"px",this.div.style.top=e+mxConstants.TOOLTIP_VERTICAL_OFFSET+s.y+"px",mxUtils.isNode(i)?(this.div.innerHTML="",this.div.appendChild(i)):this.div.innerHTML=i.replace(/\n/g,"<br>"),this.div.style.visibility="",mxUtils.fit(this.div)}}destroy(){this.destroyed||(this.graph.removeMouseListener(this),mxEvent.release(this.div),this.div!=null&&this.div.parentNode!=null&&this.div.parentNode.removeChild(this.div),this.destroyed=!0,this.div=null)}}class mxVisibleChange{constructor(i,t,e){this.model=i,this.cell=t,this.visible=e,this.previous=e}execute(){this.cell!=null&&(this.visible=this.previous,this.previous=this.model.visibleStateForCellChanged(this.cell,this.previous))}}class mxCollapseChange{constructor(i,t,e){this.model=i,this.cell=t,this.collapsed=e,this.previous=e}execute(){this.cell!=null&&(this.collapsed=this.previous,this.previous=this.model.collapsedStateForCellChanged(this.cell,this.previous))}}class mxGraphModel extends mxEventSource{constructor(t){super();u(this,"root",null);u(this,"cells",null);u(this,"maintainEdgeParent",!0);u(this,"ignoreRelativeEdgeParent",!0);u(this,"createIds",!0);u(this,"prefix","");u(this,"postfix","");u(this,"nextId",0);u(this,"updateLevel",0);u(this,"endingUpdate",!1);this.currentEdit=this.createUndoableEdit(),t!=null?this.setRoot(t):this.clear()}clear(){this.setRoot(this.createRoot())}isCreateIds(){return this.createIds}setCreateIds(t){this.createIds=t}createRoot(){var t=new mxCell;return t.insert(new mxCell),t}getCell(t){return this.cells!=null?this.cells[t]:null}filterCells(t,e){var s=null;if(t!=null){s=[];for(var n=0;n<t.length;n++)e(t[n])&&s.push(t[n])}return s}getDescendants(t){return this.filterDescendants(null,t)}filterDescendants(t,e){var s=[];e=e||this.getRoot(),(t==null||t(e))&&s.push(e);for(var n=this.getChildCount(e),l=0;l<n;l++){var r=this.getChildAt(e,l);s=s.concat(this.filterDescendants(t,r))}return s}getRoot(t){var e=t||this.root;if(t!=null)for(;t!=null;)e=t,t=this.getParent(t);return e}setRoot(t){return this.execute(new mxRootChange(this,t)),t}rootChanged(t){var e=this.root;return this.root=t,this.nextId=0,this.cells=null,this.cellAdded(t),e}isRoot(t){return t!=null&&this.root==t}isLayer(t){return this.isRoot(this.getParent(t))}isAncestor(t,e){for(;e!=null&&e!=t;)e=this.getParent(e);return e==t}contains(t){return this.isAncestor(this.root,t)}getParent(t){return t!=null?t.getParent():null}add(t,e,s){if(e!=t&&t!=null&&e!=null){s==null&&(s=this.getChildCount(t));var n=t!=this.getParent(e);this.execute(new mxChildChange(this,t,e,s)),this.maintainEdgeParent&&n&&this.updateEdgeParents(e)}return e}cellAdded(t){if(t!=null){if(t.getId()==null&&this.createIds&&t.setId(this.createId(t)),t.getId()!=null){var e=this.getCell(t.getId());if(e!=t){for(;e!=null;)t.setId(this.createId(t)),e=this.getCell(t.getId());this.cells==null&&(this.cells=new Object),this.cells[t.getId()]=t}}mxUtils.isNumeric(t.getId())&&(this.nextId=Math.max(this.nextId,t.getId()));for(var s=this.getChildCount(t),n=0;n<s;n++)this.cellAdded(this.getChildAt(t,n))}}createId(t){var e=this.nextId;return this.nextId++,this.prefix+e+this.postfix}updateEdgeParents(t,e){e=e||this.getRoot(t);for(var s=this.getChildCount(t),n=0;n<s;n++){var l=this.getChildAt(t,n);this.updateEdgeParents(l,e)}for(var r=this.getEdgeCount(t),a=[],n=0;n<r;n++)a.push(this.getEdgeAt(t,n));for(var n=0;n<a.length;n++){var o=a[n];this.isAncestor(e,o)&&this.updateEdgeParent(o,e)}}updateEdgeParent(t,e){for(var s=this.getTerminal(t,!0),n=this.getTerminal(t,!1),l=null;s!=null&&!this.isEdge(s)&&s.geometry!=null&&s.geometry.relative;)s=this.getParent(s);for(;n!=null&&this.ignoreRelativeEdgeParent&&!this.isEdge(n)&&n.geometry!=null&&n.geometry.relative;)n=this.getParent(n);if(this.isAncestor(e,s)&&this.isAncestor(e,n)&&(s==n?l=this.getParent(s):l=this.getNearestCommonAncestor(s,n),l!=null&&(this.getParent(l)!=this.root||this.isAncestor(l,t))&&this.getParent(t)!=l)){var r=this.getGeometry(t);if(r!=null){var a=this.getOrigin(this.getParent(t)),o=this.getOrigin(l),h=o.x-a.x,d=o.y-a.y;r=r.clone(),r.translate(-h,-d),this.setGeometry(t,r)}this.add(l,t,this.getChildCount(l))}}getOrigin(t){var e=null;if(t!=null){if(e=this.getOrigin(this.getParent(t)),!this.isEdge(t)){var s=this.getGeometry(t);s!=null&&(e.x+=s.x,e.y+=s.y)}}else e=new mxPoint;return e}getNearestCommonAncestor(t,e){if(t!=null&&e!=null){var s=mxCellPath.create(e);if(s!=null&&s.length>0){var n=t,l=mxCellPath.create(n);if(s.length<l.length){n=e;var r=l;l=s,s=r}for(;n!=null;){var a=this.getParent(n);if(s.indexOf(l+mxCellPath.PATH_SEPARATOR)==0&&a!=null)return n;l=mxCellPath.getParentPath(l),n=a}}}return null}remove(t){return t==this.root?this.setRoot(null):this.getParent(t)!=null&&this.execute(new mxChildChange(this,null,t)),t}cellRemoved(t){if(t!=null&&this.cells!=null){for(var e=this.getChildCount(t),s=e-1;s>=0;s--)this.cellRemoved(this.getChildAt(t,s));this.cells!=null&&t.getId()!=null&&delete this.cells[t.getId()]}}parentForCellChanged(t,e,s){var n=this.getParent(t);if(e!=null)(e!=n||n.getIndex(t)!=s)&&e.insert(t,s);else if(n!=null){var l=n.getIndex(t);n.remove(l)}var r=this.contains(e),a=this.contains(n);return r&&!a?this.cellAdded(t):a&&!r&&this.cellRemoved(t),n}getChildCount(t){return t!=null?t.getChildCount():0}getChildAt(t,e){return t!=null?t.getChildAt(e):null}getChildren(t){return t!=null?t.children:null}getChildVertices(t){return this.getChildCells(t,!0,!1)}getChildEdges(t){return this.getChildCells(t,!1,!0)}getChildCells(t,e,s){e=e??!1,s=s??!1;for(var n=this.getChildCount(t),l=[],r=0;r<n;r++){var a=this.getChildAt(t,r);(!s&&!e||s&&this.isEdge(a)||e&&this.isVertex(a))&&l.push(a)}return l}getTerminal(t,e){return t!=null?t.getTerminal(e):null}setTerminal(t,e,s){var n=e!=this.getTerminal(t,s);return this.execute(new mxTerminalChange(this,t,e,s)),this.maintainEdgeParent&&n&&this.updateEdgeParent(t,this.getRoot()),e}setTerminals(t,e,s){this.beginUpdate();try{this.setTerminal(t,e,!0),this.setTerminal(t,s,!1)}finally{this.endUpdate()}}terminalForCellChanged(t,e,s){var n=this.getTerminal(t,s);return e!=null?e.insertEdge(t,s):n!=null&&n.removeEdge(t,s),n}getEdgeCount(t){return t!=null?t.getEdgeCount():0}getEdgeAt(t,e){return t!=null?t.getEdgeAt(e):null}getDirectedEdgeCount(t,e,s){for(var n=0,l=this.getEdgeCount(t),r=0;r<l;r++){var a=this.getEdgeAt(t,r);a!=s&&this.getTerminal(a,e)==t&&n++}return n}getConnections(t){return this.getEdges(t,!0,!0,!1)}getIncomingEdges(t){return this.getEdges(t,!0,!1,!1)}getOutgoingEdges(t){return this.getEdges(t,!1,!0,!1)}getEdges(t,e,s,n){e=e??!0,s=s??!0,n=n??!0;for(var l=this.getEdgeCount(t),r=[],a=0;a<l;a++){var o=this.getEdgeAt(t,a),h=this.getTerminal(o,!0),d=this.getTerminal(o,!1);(n&&h==d||h!=d&&(e&&d==t||s&&h==t))&&r.push(o)}return r}getEdgesBetween(t,e,s){s=s??!1;var n=this.getEdgeCount(t),l=this.getEdgeCount(e),r=t,a=n;l<n&&(a=l,r=e);for(var o=[],h=0;h<a;h++){var d=this.getEdgeAt(r,h),g=this.getTerminal(d,!0),m=this.getTerminal(d,!1),f=g==t&&m==e,c=m==t&&g==e;(f||!s&&c)&&o.push(d)}return o}getOpposites(t,e,s,n){s=s??!0,n=n??!0;var l=[];if(t!=null)for(var r=0;r<t.length;r++){var a=this.getTerminal(t[r],!0),o=this.getTerminal(t[r],!1);a==e&&o!=null&&o!=e&&n?l.push(o):o==e&&a!=null&&a!=e&&s&&l.push(a)}return l}getTopmostCells(t){for(var e=new mxDictionary,s=[],n=0;n<t.length;n++)e.put(t[n],!0);for(var n=0;n<t.length;n++){for(var l=t[n],r=!0,a=this.getParent(l);a!=null;){if(e.get(a)){r=!1;break}a=this.getParent(a)}r&&s.push(l)}return s}isVertex(t){return t!=null?t.isVertex():!1}isEdge(t){return t!=null?t.isEdge():!1}isConnectable(t){return t!=null?t.isConnectable():!1}getValue(t){return t!=null?t.getValue():null}setValue(t,e){return this.execute(new mxValueChange(this,t,e)),e}valueForCellChanged(t,e){return t.valueChanged(e)}getGeometry(t){return t!=null?t.getGeometry():null}setGeometry(t,e){return e!=this.getGeometry(t)&&this.execute(new mxGeometryChange(this,t,e)),e}geometryForCellChanged(t,e){var s=this.getGeometry(t);return t.setGeometry(e),s}getStyle(t){return t!=null?t.getStyle():null}setStyle(t,e){return e!=this.getStyle(t)&&this.execute(new mxStyleChange(this,t,e)),e}styleForCellChanged(t,e){var s=this.getStyle(t);return t.setStyle(e),s}isCollapsed(t){return t!=null?t.isCollapsed():!1}setCollapsed(t,e){return e!=this.isCollapsed(t)&&this.execute(new mxCollapseChange(this,t,e)),e}collapsedStateForCellChanged(t,e){var s=this.isCollapsed(t);return t.setCollapsed(e),s}isVisible(t){return t!=null?t.isVisible():!1}setVisible(t,e){return e!=this.isVisible(t)&&this.execute(new mxVisibleChange(this,t,e)),e}visibleStateForCellChanged(t,e){var s=this.isVisible(t);return t.setVisible(e),s}execute(t){t.execute(),this.beginUpdate(),this.currentEdit.add(t),this.fireEvent(new mxEventObject(mxEvent.EXECUTE,"change",t)),this.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",t)),this.endUpdate()}beginUpdate(){this.updateLevel++,this.fireEvent(new mxEventObject(mxEvent.BEGIN_UPDATE)),this.updateLevel==1&&this.fireEvent(new mxEventObject(mxEvent.START_EDIT))}endUpdate(){if(this.updateLevel--,this.updateLevel==0&&this.fireEvent(new mxEventObject(mxEvent.END_EDIT)),!this.endingUpdate){this.endingUpdate=this.updateLevel==0,this.fireEvent(new mxEventObject(mxEvent.END_UPDATE,"edit",this.currentEdit));try{if(this.endingUpdate&&!this.currentEdit.isEmpty()){this.fireEvent(new mxEventObject(mxEvent.BEFORE_UNDO,"edit",this.currentEdit));var t=this.currentEdit;this.currentEdit=this.createUndoableEdit(),t.notify(),this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",t))}}finally{this.endingUpdate=!1}}}createUndoableEdit(t){var e=new mxUndoableEdit(this,t??!0);return e.notify=function(){e.source.fireEvent(new mxEventObject(mxEvent.CHANGE,"edit",e,"changes",e.changes)),e.source.fireEvent(new mxEventObject(mxEvent.NOTIFY,"edit",e,"changes",e.changes))},e}mergeChildren(t,e,s){s=s??!0,this.beginUpdate();try{var n=new Object;this.mergeChildrenImpl(t,e,s,n);for(var l in n){var r=n[l],a=this.getTerminal(r,!0);a!=null&&(a=n[mxCellPath.create(a)],this.setTerminal(r,a,!0)),a=this.getTerminal(r,!1),a!=null&&(a=n[mxCellPath.create(a)],this.setTerminal(r,a,!1))}}finally{this.endUpdate()}}mergeChildrenImpl(t,e,s,n){this.beginUpdate();try{for(var l=t.getChildCount(),r=0;r<l;r++){var a=t.getChildAt(r);if(typeof a.getId=="function"){var o=a.getId(),h=o!=null&&(!this.isEdge(a)||!s)?this.getCell(o):null;if(h==null){var d=a.clone();d.setId(o),d.setTerminal(a.getTerminal(!0),!0),d.setTerminal(a.getTerminal(!1),!1),h=e.insert(d),this.cellAdded(h)}n[mxCellPath.create(a)]=h,this.mergeChildrenImpl(a,h,s,n)}}}finally{this.endUpdate()}}getParents(t){var e=[];if(t!=null)for(var s=new mxDictionary,n=0;n<t.length;n++){var l=this.getParent(t[n]);l!=null&&!s.get(l)&&(s.put(l,!0),e.push(l))}return e}cloneCell(t,e){return t!=null?this.cloneCells([t],e)[0]:null}cloneCells(t,e,s){e=e??!0,s=s??new Object;for(var n=[],l=0;l<t.length;l++)t[l]!=null?n.push(this.cloneCellImpl(t[l],s,e)):n.push(null);for(var l=0;l<n.length;l++)n[l]!=null&&this.restoreClone(n[l],t[l],s);return n}cloneCellImpl(t,e,s){var n=mxObjectIdentity.get(t),l=e[n];if(l==null&&(l=this.cellCloned(t),e[n]=l,s))for(var r=this.getChildCount(t),a=0;a<r;a++){var o=this.cloneCellImpl(this.getChildAt(t,a),e,!0);l.insert(o)}return l}cellCloned(t){return t.clone()}restoreClone(t,e,s){var n=this.getTerminal(e,!0);if(n!=null){var l=s[mxObjectIdentity.get(n)];l!=null&&l.insertEdge(t,!0)}var r=this.getTerminal(e,!1);if(r!=null){var l=s[mxObjectIdentity.get(r)];l!=null&&l.insertEdge(t,!1)}for(var a=this.getChildCount(t),o=0;o<a;o++)this.restoreClone(this.getChildAt(t,o),this.getChildAt(e,o),s)}}class mxGraph extends mxEventSource{constructor(t,e,s,n){super();u(this,"isMouseDown",!1);u(this,"stylesheet",null);u(this,"selectionModel",null);u(this,"cellEditor",null);u(this,"dialect",null);u(this,"gridSize",10);u(this,"gridEnabled",!0);u(this,"portsEnabled",!0);u(this,"nativeDblClickEnabled",!0);u(this,"doubleTapEnabled",!0);u(this,"doubleTapTimeout",500);u(this,"doubleTapTolerance",25);u(this,"lastTouchY",0);u(this,"lastTouchY",0);u(this,"lastTouchTime",0);u(this,"tapAndHoldEnabled",!0);u(this,"tapAndHoldDelay",500);u(this,"tapAndHoldInProgress",!1);u(this,"tapAndHoldValid",!1);u(this,"initialTouchX",0);u(this,"initialTouchY",0);u(this,"tolerance",4);u(this,"defaultOverlap",.5);u(this,"defaultParent",null);u(this,"alternateEdgeStyle",null);u(this,"backgroundImage",null);u(this,"pageVisible",!1);u(this,"pageBreaksVisible",!1);u(this,"pageBreakColor","gray");u(this,"pageBreakDashed",!0);u(this,"minPageBreakDist",20);u(this,"preferPageSize",!1);u(this,"pageFormat",mxConstants.PAGE_FORMAT_A4_PORTRAIT);u(this,"pageScale",1.5);u(this,"enabled",!0);u(this,"escapeEnabled",!0);u(this,"invokesStopCellEditing",!0);u(this,"enterStopsCellEditing",!1);u(this,"useScrollbarsForPanning",!0);u(this,"exportEnabled",!0);u(this,"importEnabled",!0);u(this,"cellsLocked",!1);u(this,"cellsCloneable",!0);u(this,"foldingEnabled",!0);u(this,"cellsEditable",!0);u(this,"cellsDeletable",!0);u(this,"cellsMovable",!0);u(this,"edgeLabelsMovable",!0);u(this,"vertexLabelsMovable",!1);u(this,"dropEnabled",!1);u(this,"splitEnabled",!0);u(this,"cellsResizable",!0);u(this,"cellsBendable",!0);u(this,"cellsSelectable",!0);u(this,"cellsDisconnectable",!0);u(this,"autoSizeCells",!1);u(this,"autoSizeCellsOnAdd",!1);u(this,"autoScroll",!0);u(this,"ignoreScrollbars",!1);u(this,"translateToScrollPosition",!1);u(this,"timerAutoScroll",!1);u(this,"allowAutoPanning",!1);u(this,"autoExtend",!0);u(this,"maximumGraphBounds",null);u(this,"minimumGraphSize",null);u(this,"minimumContainerSize",null);u(this,"maximumContainerSize",null);u(this,"resizeContainer",!1);u(this,"border",0);u(this,"keepEdgesInForeground",!1);u(this,"keepEdgesInBackground",!1);u(this,"allowNegativeCoordinates",!0);u(this,"constrainChildren",!0);u(this,"constrainRelativeChildren",!1);u(this,"extendParents",!0);u(this,"extendParentsOnAdd",!0);u(this,"extendParentsOnMove",!1);u(this,"recursiveResize",!1);u(this,"collapseToPreferredSize",!0);u(this,"zoomFactor",1.2);u(this,"keepSelectionVisibleOnZoom",!1);u(this,"centerZoom",!0);u(this,"resetViewOnRootChange",!0);u(this,"resetEdgesOnResize",!1);u(this,"resetEdgesOnMove",!1);u(this,"resetEdgesOnConnect",!0);u(this,"allowLoops",!1);u(this,"defaultLoopStyle",mxEdgeStyle.Loop);u(this,"multigraph",!0);u(this,"connectableEdges",!1);u(this,"allowDanglingEdges",!0);u(this,"cloneInvalidEdges",!1);u(this,"disconnectOnMove",!0);u(this,"labelsVisible",!0);u(this,"htmlLabels",!1);u(this,"swimlaneSelectionEnabled",!0);u(this,"swimlaneNesting",!0);u(this,"swimlaneIndicatorColorAttribute",mxConstants.STYLE_FILLCOLOR);u(this,"minFitScale",.1);u(this,"maxFitScale",8);u(this,"panDx",0);u(this,"panDy",0);u(this,"collapsedImage",new mxImage(mxClient.imageBasePath+"/collapsed.gif",9,9));u(this,"expandedImage",new mxImage(mxClient.imageBasePath+"/expanded.gif",9,9));u(this,"warningImage",new mxImage(mxClient.imageBasePath+"/warning"+(mxClient.IS_MAC?".png":".gif"),16,16));u(this,"alreadyConnectedResource",mxClient.language!="none"?"alreadyConnected":"");u(this,"containsValidationErrorsResource",mxClient.language!="none"?"containsValidationErrors":"");u(this,"collapseExpandResource",mxClient.language!="none"?"collapse-expand":"");this.mouseListeners=null,this.renderHint=s,mxClient.IS_SVG?this.dialect=mxConstants.DIALECT_SVG:s==mxConstants.RENDERING_HINT_FASTEST?this.dialect=mxConstants.DIALECT_STRICTHTML:s==mxConstants.RENDERING_HINT_FASTER?this.dialect=mxConstants.DIALECT_PREFERHTML:this.dialect=mxConstants.DIALECT_MIXEDHTML,this.model=e??new mxGraphModel,this.multiplicities=[],this.imageBundles=[],this.cellRenderer=this.createCellRenderer(),this.setSelectionModel(this.createSelectionModel()),this.setStylesheet(n??this.createStylesheet()),this.view=this.createGraphView(),this.graphModelChangeListener=(l,r)=>{this.graphModelChanged(r.getProperty("edit").changes)},this.model.addListener(mxEvent.CHANGE,this.graphModelChangeListener),this.createHandlers(),t!=null&&this.init(t),this.view.revalidate()}init(t){this.container=t,this.cellEditor=this.createCellEditor(),this.view.init(),this.sizeDidChange(),mxEvent.addListener(t,"mouseleave",()=>{this.tooltipHandler!=null&&this.tooltipHandler.hide()}),document.documentMode==8&&t.insertAdjacentHTML("beforeend","<"+mxClient.VML_PREFIX+':group style="DISPLAY: none;"></'+mxClient.VML_PREFIX+":group>")}createHandlers(){this.tooltipHandler=this.createTooltipHandler(),this.tooltipHandler.setEnabled(!1),this.selectionCellsHandler=this.createSelectionCellsHandler(),this.connectionHandler=this.createConnectionHandler(),this.connectionHandler.setEnabled(!1),this.graphHandler=this.createGraphHandler(),this.panningHandler=this.createPanningHandler(),this.panningHandler.panningEnabled=!1,this.popupMenuHandler=this.createPopupMenuHandler()}createTooltipHandler(){return new mxTooltipHandler(this)}createSelectionCellsHandler(){return new mxSelectionCellsHandler(this)}createConnectionHandler(){return new mxConnectionHandler(this)}createGraphHandler(){return new mxGraphHandler(this)}createPanningHandler(){return new mxPanningHandler(this)}createPopupMenuHandler(){return new mxPopupMenuHandler(this)}createSelectionModel(){return new mxGraphSelectionModel(this)}createStylesheet(){return new mxStylesheet}createGraphView(){return new mxGraphView(this)}createCellRenderer(){return new mxCellRenderer}createCellEditor(){return new mxCellEditor(this)}getModel(){return this.model}getView(){return this.view}getStylesheet(){return this.stylesheet}setStylesheet(t){this.stylesheet=t}getSelectionModel(){return this.selectionModel}setSelectionModel(t){this.selectionModel=t}getSelectionCellsForChanges(t,e){for(var s=new mxDictionary,n=[],l=h=>{if(!s.get(h)&&this.model.contains(h))if(this.model.isEdge(h)||this.model.isVertex(h))s.put(h,!0),n.push(h);else for(var d=this.model.getChildCount(h),g=0;g<d;g++)l(this.model.getChildAt(h,g))},r=0;r<t.length;r++){var a=t[r];if(a.constructor!=mxRootChange&&(e==null||!e(a))){var o=null;a instanceof mxChildChange?o=a.child:a.cell!=null&&a.cell instanceof mxCell&&(o=a.cell),o!=null&&l(o)}}return n}graphModelChanged(t){for(var e=0;e<t.length;e++)this.processChange(t[e]);this.updateSelection(),this.view.validate(),this.sizeDidChange()}updateSelection(){for(var t=this.getSelectionCells(),e=[],s=0;s<t.length;s++)if(!this.model.contains(t[s])||!this.isCellVisible(t[s]))e.push(t[s]);else for(var n=this.model.getParent(t[s]);n!=null&&n!=this.view.currentRoot;){if(this.isCellCollapsed(n)||!this.isCellVisible(n)){e.push(t[s]);break}n=this.model.getParent(n)}this.removeSelectionCells(e)}processChange(t){if(t instanceof mxRootChange)this.clearSelection(),this.setDefaultParent(null),this.removeStateForCell(t.previous),this.resetViewOnRootChange&&(this.view.scale=1,this.view.translate.x=0,this.view.translate.y=0),this.fireEvent(new mxEventObject(mxEvent.ROOT));else if(t instanceof mxChildChange){var e=this.model.getParent(t.child);this.view.invalidate(t.child,!0,!0),(!this.model.contains(e)||this.isCellCollapsed(e))&&(this.view.invalidate(t.child,!0,!0),this.removeStateForCell(t.child),this.view.currentRoot==t.child&&this.home()),e!=t.previous&&(e!=null&&this.view.invalidate(e,!1,!1),t.previous!=null&&this.view.invalidate(t.previous,!1,!1))}else if(t instanceof mxTerminalChange||t instanceof mxGeometryChange)(t instanceof mxTerminalChange||t.previous==null&&t.geometry!=null||t.previous!=null&&!t.previous.equals(t.geometry))&&this.view.invalidate(t.cell);else if(t instanceof mxValueChange)this.view.invalidate(t.cell,!1,!1);else if(t instanceof mxStyleChange){this.view.invalidate(t.cell,!0,!0);var s=this.view.getState(t.cell);s!=null&&(s.invalidStyle=!0)}else t.cell!=null&&t.cell instanceof mxCell&&this.removeStateForCell(t.cell)}removeStateForCell(t){for(var e=this.model.getChildCount(t),s=0;s<e;s++)this.removeStateForCell(this.model.getChildAt(t,s));this.view.invalidate(t,!1,!0),this.view.removeState(t)}addCellOverlay(t,e){t.overlays==null&&(t.overlays=[]),t.overlays.push(e);var s=this.view.getState(t);return s!=null&&this.cellRenderer.redraw(s),this.fireEvent(new mxEventObject(mxEvent.ADD_OVERLAY,"cell",t,"overlay",e)),e}getCellOverlays(t){return t.overlays}removeCellOverlay(t,e){if(e==null)this.removeCellOverlays(t);else{var s=mxUtils.indexOf(t.overlays,e);if(s>=0){t.overlays.splice(s,1),t.overlays.length==0&&(t.overlays=null);var n=this.view.getState(t);n!=null&&this.cellRenderer.redraw(n),this.fireEvent(new mxEventObject(mxEvent.REMOVE_OVERLAY,"cell",t,"overlay",e))}else e=null}return e}removeCellOverlays(t){var e=t.overlays;if(e!=null){t.overlays=null;var s=this.view.getState(t);s!=null&&this.cellRenderer.redraw(s);for(var n=0;n<e.length;n++)this.fireEvent(new mxEventObject(mxEvent.REMOVE_OVERLAY,"cell",t,"overlay",e[n]))}return e}clearCellOverlays(t){t=t??this.model.getRoot(),this.removeCellOverlays(t);for(var e=this.model.getChildCount(t),s=0;s<e;s++){var n=this.model.getChildAt(t,s);this.clearCellOverlays(n)}}setCellWarning(t,e,s,n){if(e!=null&&e.length>0){s=s??this.warningImage;var l=new mxCellOverlay(s,"<font color=red>"+e+"</font>");return n&&l.addListener(mxEvent.CLICK,(r,a)=>{this.isEnabled()&&this.setSelectionCell(t)}),this.addCellOverlay(t,l)}else this.removeCellOverlays(t);return null}startEditing(t){this.startEditingAtCell(null,t)}startEditingAtCell(t,e){(e==null||!mxEvent.isMultiTouchEvent(e))&&(t==null&&(t=this.getSelectionCell(),t!=null&&!this.isCellEditable(t)&&(t=null)),t!=null&&(this.fireEvent(new mxEventObject(mxEvent.START_EDITING,"cell",t,"event",e)),this.cellEditor.startEditing(t,e),this.fireEvent(new mxEventObject(mxEvent.EDITING_STARTED,"cell",t,"event",e))))}getEditingValue(t,e){return this.convertValueToString(t)}stopEditing(t){this.cellEditor.stopEditing(t),this.fireEvent(new mxEventObject(mxEvent.EDITING_STOPPED,"cancel",t))}labelChanged(t,e,s){this.model.beginUpdate();try{var n=t.value;this.cellLabelChanged(t,e,this.isAutoSizeCell(t)),this.fireEvent(new mxEventObject(mxEvent.LABEL_CHANGED,"cell",t,"value",e,"old",n,"event",s))}finally{this.model.endUpdate()}return t}cellLabelChanged(t,e,s){this.model.beginUpdate();try{this.model.setValue(t,e),s&&this.cellSizeUpdated(t,!1)}finally{this.model.endUpdate()}}escape(t){this.fireEvent(new mxEventObject(mxEvent.ESCAPE,"event",t))}click(t){var e=t.getEvent(),s=t.getCell(),n=new mxEventObject(mxEvent.CLICK,"event",e,"cell",s);if(t.isConsumed()&&n.consume(),this.fireEvent(n),this.isEnabled()&&!mxEvent.isConsumed(e)&&!n.isConsumed()){if(s!=null){if(this.isTransparentClickEvent(e)){var l=!1,r=this.getCellAt(t.graphX,t.graphY,null,null,null,g=>{var m=this.isCellSelected(g.cell);return l=l||m,!l||m||g.cell!=s&&this.model.isAncestor(g.cell,s)});r!=null&&(s=r)}}else if(this.isSwimlaneSelectionEnabled()&&(s=this.getSwimlaneAt(t.getGraphX(),t.getGraphY()),s!=null&&(!this.isToggleEvent(e)||!mxEvent.isAltDown(e)))){for(var a=s,o=[];a!=null;){a=this.model.getParent(a);var h=this.view.getState(a);this.isSwimlane(a)&&h!=null&&o.push(a)}if(o.length>0){o=o.reverse(),o.splice(0,0,s),o.push(s);for(var d=0;d<o.length-1;d++)this.isCellSelected(o[d])&&(s=o[this.isToggleEvent(e)?d:d+1])}}s!=null?this.selectCellForEvent(s,e):this.isToggleEvent(e)||this.clearSelection()}}isSiblingSelected(t){for(var e=this.model,s=e.getParent(t),n=e.getChildCount(s),l=0;l<n;l++){var r=e.getChildAt(s,l);if(t!=r&&this.isCellSelected(r))return!0}return!1}dblClick(t,e){var s=new mxEventObject(mxEvent.DOUBLE_CLICK,"event",t,"cell",e);this.fireEvent(s),this.isEnabled()&&!mxEvent.isConsumed(t)&&!s.isConsumed()&&e!=null&&this.isCellEditable(e)&&!this.isEditing(e)&&(this.startEditingAtCell(e,t),mxEvent.consume(t))}tapAndHold(t){var e=t.getEvent(),s=new mxEventObject(mxEvent.TAP_AND_HOLD,"event",e,"cell",t.getCell());if(this.fireEvent(s),s.isConsumed()&&(this.panningHandler.panningTrigger=!1),this.isEnabled()&&!mxEvent.isConsumed(e)&&!s.isConsumed()&&this.connectionHandler.isEnabled()){var n=this.view.getState(this.connectionHandler.marker.getCell(t));n!=null&&(this.connectionHandler.marker.currentColor=this.connectionHandler.marker.validColor,this.connectionHandler.marker.markedState=n,this.connectionHandler.marker.mark(),this.connectionHandler.first=new mxPoint(t.getGraphX(),t.getGraphY()),this.connectionHandler.edgeState=this.connectionHandler.createEdgeState(t),this.connectionHandler.previous=n,this.connectionHandler.fireEvent(new mxEventObject(mxEvent.START,"state",this.connectionHandler.previous)))}}scrollPointToVisible(t,e,s,n){if(!this.timerAutoScroll&&(this.ignoreScrollbars||mxUtils.hasScrollbars(this.container))){var l=this.container;if(n=n??20,t>=l.scrollLeft&&e>=l.scrollTop&&t<=l.scrollLeft+l.clientWidth&&e<=l.scrollTop+l.clientHeight){var r=l.scrollLeft+l.clientWidth-t;if(r<n){var a=l.scrollLeft;if(l.scrollLeft+=n-r,s&&a==l.scrollLeft){if(this.dialect==mxConstants.DIALECT_SVG){var o=this.view.getDrawPane().ownerSVGElement,h=this.container.scrollWidth+n-r;o.style.width=h+"px"}else{var h=Math.max(l.clientWidth,l.scrollWidth)+n-r,d=this.view.getCanvas();d.style.width=h+"px"}l.scrollLeft+=n-r}}else r=t-l.scrollLeft,r<n&&(l.scrollLeft-=n-r);var g=l.scrollTop+l.clientHeight-e;if(g<n){var a=l.scrollTop;if(l.scrollTop+=n-g,a==l.scrollTop&&s){if(this.dialect==mxConstants.DIALECT_SVG){var o=this.view.getDrawPane().ownerSVGElement,m=this.container.scrollHeight+n-g;o.style.height=m+"px"}else{var m=Math.max(l.clientHeight,l.scrollHeight)+n-g,d=this.view.getCanvas();d.style.height=m+"px"}l.scrollTop+=n-g}}else g=e-l.scrollTop,g<n&&(l.scrollTop-=n-g)}}else this.allowAutoPanning&&!this.panningHandler.isActive()&&(this.panningManager==null&&(this.panningManager=this.createPanningManager()),this.panningManager.panTo(t+this.panDx,e+this.panDy))}createPanningManager(){return new mxPanningManager(this)}getBorderSizes(){var t=mxUtils.getCurrentStyle(this.container);return new mxRectangle(mxUtils.parseCssNumber(t.paddingLeft)+(t.borderLeftStyle!="none"?mxUtils.parseCssNumber(t.borderLeftWidth):0),mxUtils.parseCssNumber(t.paddingTop)+(t.borderTopStyle!="none"?mxUtils.parseCssNumber(t.borderTopWidth):0),mxUtils.parseCssNumber(t.paddingRight)+(t.borderRightStyle!="none"?mxUtils.parseCssNumber(t.borderRightWidth):0),mxUtils.parseCssNumber(t.paddingBottom)+(t.borderBottomStyle!="none"?mxUtils.parseCssNumber(t.borderBottomWidth):0))}getPreferredPageSize(t,e,s){this.view.scale;var n=this.view.translate,l=this.pageFormat,r=this.pageScale,a=new mxRectangle(0,0,Math.ceil(l.width*r),Math.ceil(l.height*r)),o=this.pageBreaksVisible?Math.ceil(e/a.width):1,h=this.pageBreaksVisible?Math.ceil(s/a.height):1;return new mxRectangle(0,0,o*a.width+2+n.x,h*a.height+2+n.y)}fit(t,e,s,n,l,r,a){if(this.container!=null){t=t??this.getBorder(),e=e??!1,s=s??0,n=n??!0,l=l??!1,r=r??!1;var o=this.getBorderSizes(),h=this.container.offsetWidth-o.x-o.width-1,d=a??this.container.offsetHeight-o.y-o.height-1,g=this.view.getGraphBounds();if(g.width>0&&g.height>0){e&&g.x!=null&&g.y!=null&&(g=g.clone(),g.width+=g.x,g.height+=g.y,g.x=0,g.y=0);var m=this.view.scale,f=g.width/m,c=g.height/m;this.backgroundImage!=null&&(f=Math.max(f,this.backgroundImage.width-g.x/m),c=Math.max(c,this.backgroundImage.height-g.y/m));var x=(e?t:2*t)+s+1;h-=x,d-=x;var p=l?d/c:r?h/f:Math.min(h/f,d/c);if(this.minFitScale!=null&&(p=Math.max(p,this.minFitScale)),this.maxFitScale!=null&&(p=Math.min(p,this.maxFitScale)),n)if(e)this.view.scale!=p&&this.view.setScale(p);else if(mxUtils.hasScrollbars(this.container)){this.view.setScale(p);var T=this.getGraphBounds();T.x!=null&&(this.container.scrollLeft=T.x),T.y!=null&&(this.container.scrollTop=T.y)}else{var C=g.x!=null?Math.floor(this.view.translate.x-g.x/m+t/p+s/2):t,E=g.y!=null?Math.floor(this.view.translate.y-g.y/m+t/p+s/2):t;this.view.scaleAndTranslate(p,C,E)}else return p}}return this.view.scale}sizeDidChange(){var t=this.getGraphBounds();if(this.container!=null){var e=this.getBorder(),s=Math.max(0,t.x)+t.width+2*e,n=Math.max(0,t.y)+t.height+2*e;if(this.minimumContainerSize!=null&&(s=Math.max(s,this.minimumContainerSize.width),n=Math.max(n,this.minimumContainerSize.height)),this.resizeContainer&&this.doResizeContainer(s,n),this.preferPageSize||this.pageVisible){var l=this.getPreferredPageSize(t,Math.max(1,s),Math.max(1,n));l!=null&&(s=l.width*this.view.scale,n=l.height*this.view.scale)}if(this.minimumGraphSize!=null&&(s=Math.max(s,this.minimumGraphSize.width*this.view.scale),n=Math.max(n,this.minimumGraphSize.height*this.view.scale)),s=Math.ceil(s),n=Math.ceil(n),this.dialect==mxConstants.DIALECT_SVG){var r=this.view.getDrawPane().ownerSVGElement;r!=null&&(r.style.minWidth=Math.max(1,s)+"px",r.style.minHeight=Math.max(1,n)+"px",r.style.width="100%",r.style.height="100%")}else mxClient.IS_QUIRKS?this.view.updateHtmlCanvasSize(Math.max(1,s),Math.max(1,n)):(this.view.canvas.style.minWidth=Math.max(1,s)+"px",this.view.canvas.style.minHeight=Math.max(1,n)+"px");this.updatePageBreaks(this.pageBreaksVisible,s,n)}this.fireEvent(new mxEventObject(mxEvent.SIZE,"bounds",t))}doResizeContainer(t,e){this.maximumContainerSize!=null&&(t=Math.min(this.maximumContainerSize.width,t),e=Math.min(this.maximumContainerSize.height,e)),this.container.style.width=Math.ceil(t)+"px",this.container.style.height=Math.ceil(e)+"px"}updatePageBreaks(t,e,s){var n=this.view.scale,l=this.view.translate,r=this.pageFormat,a=n*this.pageScale,o=new mxRectangle(0,0,r.width*a,r.height*a),h=mxRectangle.fromRectangle(this.getGraphBounds());h.width=Math.max(1,h.width),h.height=Math.max(1,h.height),o.x=Math.floor((h.x-l.x*n)/o.width)*o.width+l.x*n,o.y=Math.floor((h.y-l.y*n)/o.height)*o.height+l.y*n,h.width=Math.ceil((h.width+(h.x-o.x))/o.width)*o.width,h.height=Math.ceil((h.height+(h.y-o.y))/o.height)*o.height,t=t&&Math.min(o.width,o.height)>this.minPageBreakDist;var d=t?Math.ceil(h.height/o.height)+1:0,g=t?Math.ceil(h.width/o.width)+1:0,m=(g-1)*o.width,f=(d-1)*o.height;this.horizontalPageBreaks==null&&d>0&&(this.horizontalPageBreaks=[]),this.verticalPageBreaks==null&&g>0&&(this.verticalPageBreaks=[]);var c=x=>{if(x!=null){for(var p=x==this.horizontalPageBreaks?d:g,C=0;C<=p;C++){var E=x==this.horizontalPageBreaks?[new mxPoint(Math.round(o.x),Math.round(o.y+C*o.height)),new mxPoint(Math.round(o.x+m),Math.round(o.y+C*o.height))]:[new mxPoint(Math.round(o.x+C*o.width),Math.round(o.y)),new mxPoint(Math.round(o.x+C*o.width),Math.round(o.y+f))];if(x[C]!=null)x[C].points=E,x[C].redraw();else{var T=new mxPolyline(E,this.pageBreakColor);T.dialect=this.dialect,T.pointerEvents=!1,T.isDashed=this.pageBreakDashed,T.init(this.view.backgroundPane),T.redraw(),x[C]=T}}for(var C=p;C<x.length;C++)x[C].destroy();x.splice(p,x.length-p)}};c(this.horizontalPageBreaks),c(this.verticalPageBreaks)}getCurrentCellStyle(t,e){var s=e?null:this.view.getState(t);return s!=null?s.style:this.getCellStyle(t)}getCellStyle(t){var e=this.model.getStyle(t),s=null;return this.model.isEdge(t)?s=this.stylesheet.getDefaultEdgeStyle():s=this.stylesheet.getDefaultVertexStyle(),e!=null&&(s=this.postProcessCellStyle(this.stylesheet.getCellStyle(e,s))),s==null&&(s=new Object),s}postProcessCellStyle(t){if(t!=null){var e=t[mxConstants.STYLE_IMAGE],s=this.getImageFromBundles(e);if(s!=null?t[mxConstants.STYLE_IMAGE]=s:s=e,s!=null&&s.substring(0,11)=="data:image/"){if(s.substring(0,20)=="data:image/svg+xml,<")s=s.substring(0,19)+encodeURIComponent(s.substring(19));else if(s.substring(0,22)!="data:image/svg+xml,%3C"){var n=s.indexOf(",");n>0&&s.substring(n-7,n+1)!=";base64,"&&(s=s.substring(0,n)+";base64,"+s.substring(n+1))}t[mxConstants.STYLE_IMAGE]=s}}return t}setCellStyle(t,e){if(e=e||this.getSelectionCells(),e!=null){this.model.beginUpdate();try{for(var s=0;s<e.length;s++)this.model.setStyle(e[s],t)}finally{this.model.endUpdate()}}}toggleCellStyle(t,e,s){return s=s||this.getSelectionCell(),this.toggleCellStyles(t,e,[s])}toggleCellStyles(t,e,s){e=e??!1,s=s||this.getSelectionCells();var n=null;if(s!=null&&s.length>0){var l=this.getCurrentCellStyle(s[0]);n=mxUtils.getValue(l,t,e)?0:1,this.setCellStyles(t,n,s)}return n}setCellStyles(t,e,s){s=s||this.getSelectionCells(),mxUtils.setCellStyles(this.model,s,t,e)}toggleCellStyleFlags(t,e,s){this.setCellStyleFlags(t,e,null,s)}setCellStyleFlags(t,e,s,n){if(n=n||this.getSelectionCells(),n!=null&&n.length>0){if(s==null){var l=this.getCurrentCellStyle(n[0]),r=parseInt(l[t]||0);s=(r&e)!=e}mxUtils.setCellStyleFlags(this.model,n,t,e,s)}}alignCells(t,e,s){if(e==null&&(e=this.getSelectionCells()),e!=null&&e.length>1){if(s==null)for(var n=0;n<e.length;n++){var l=this.view.getState(e[n]);if(l!=null&&!this.model.isEdge(e[n]))if(s==null)if(t==mxConstants.ALIGN_CENTER){s=l.x+l.width/2;break}else if(t==mxConstants.ALIGN_RIGHT)s=l.x+l.width;else if(t==mxConstants.ALIGN_TOP)s=l.y;else if(t==mxConstants.ALIGN_MIDDLE){s=l.y+l.height/2;break}else t==mxConstants.ALIGN_BOTTOM?s=l.y+l.height:s=l.x;else t==mxConstants.ALIGN_RIGHT?s=Math.max(s,l.x+l.width):t==mxConstants.ALIGN_TOP?s=Math.min(s,l.y):t==mxConstants.ALIGN_BOTTOM?s=Math.max(s,l.y+l.height):s=Math.min(s,l.x)}if(s!=null){var r=this.view.scale;this.model.beginUpdate();try{for(var n=0;n<e.length;n++){var l=this.view.getState(e[n]);if(l!=null){var a=this.getCellGeometry(e[n]);a!=null&&!this.model.isEdge(e[n])&&(a=a.clone(),t==mxConstants.ALIGN_CENTER?a.x+=(s-l.x-l.width/2)/r:t==mxConstants.ALIGN_RIGHT?a.x+=(s-l.x-l.width)/r:t==mxConstants.ALIGN_TOP?a.y+=(s-l.y)/r:t==mxConstants.ALIGN_MIDDLE?a.y+=(s-l.y-l.height/2)/r:t==mxConstants.ALIGN_BOTTOM?a.y+=(s-l.y-l.height)/r:a.x+=(s-l.x)/r,this.resizeCell(e[n],a))}}this.fireEvent(new mxEventObject(mxEvent.ALIGN_CELLS,"align",t,"cells",e))}finally{this.model.endUpdate()}}}return e}flipEdge(t){if(t!=null&&this.alternateEdgeStyle!=null){this.model.beginUpdate();try{var e=this.model.getStyle(t);e==null||e.length==0?this.model.setStyle(t,this.alternateEdgeStyle):this.model.setStyle(t,null),this.resetEdge(t),this.fireEvent(new mxEventObject(mxEvent.FLIP_EDGE,"edge",t))}finally{this.model.endUpdate()}}return t}addImageBundle(t){this.imageBundles.push(t)}removeImageBundle(t){for(var e=[],s=0;s<this.imageBundles.length;s++)this.imageBundles[s]!=t&&e.push(this.imageBundles[s]);this.imageBundles=e}getImageFromBundles(t){if(t!=null)for(var e=0;e<this.imageBundles.length;e++){var s=this.imageBundles[e].getImage(t);if(s!=null)return s}return null}orderCells(t,e){e==null&&(e=mxUtils.sortCells(this.getSelectionCells(),!0)),this.model.beginUpdate();try{this.cellsOrdered(e,t),this.fireEvent(new mxEventObject(mxEvent.ORDER_CELLS,"back",t,"cells",e))}finally{this.model.endUpdate()}return e}cellsOrdered(t,e){if(t!=null){this.model.beginUpdate();try{for(var s=0;s<t.length;s++){var n=this.model.getParent(t[s]);e?this.model.add(n,t[s],s):this.model.add(n,t[s],this.model.getChildCount(n)-1)}this.fireEvent(new mxEventObject(mxEvent.CELLS_ORDERED,"back",e,"cells",t))}finally{this.model.endUpdate()}}}groupCells(t,e,s){s==null&&(s=mxUtils.sortCells(this.getSelectionCells(),!0)),s=this.getCellsForGroup(s),t==null&&(t=this.createGroupCell(s));var n=this.getBoundsForGroup(t,s,e);if(s.length>0&&n!=null){var l=this.model.getParent(t);l==null&&(l=this.model.getParent(s[0])),this.model.beginUpdate();try{this.getCellGeometry(t)==null&&this.model.setGeometry(t,new mxGeometry);var r=this.model.getChildCount(l);this.cellsAdded([t],l,r,null,null,!1,!1,!1),r=this.model.getChildCount(t),this.cellsAdded(s,t,r,null,null,!1,!1,!1),this.cellsMoved(s,-n.x,-n.y,!1,!1,!1),this.cellsResized([t],[n],!1),this.fireEvent(new mxEventObject(mxEvent.GROUP_CELLS,"group",t,"border",e,"cells",s))}finally{this.model.endUpdate()}}return t}getCellsForGroup(t){var e=[];if(t!=null&&t.length>0){var s=this.model.getParent(t[0]);e.push(t[0]);for(var n=1;n<t.length;n++)this.model.getParent(t[n])==s&&e.push(t[n])}return e}getBoundsForGroup(t,e,s){var n=this.getBoundingBoxFromGeometry(e,!0);if(n!=null){if(this.isSwimlane(t)){var l=this.getStartSize(t);n.x-=l.width,n.y-=l.height,n.width+=l.width,n.height+=l.height}s!=null&&(n.x-=s,n.y-=s,n.width+=2*s,n.height+=2*s)}return n}createGroupCell(t){var e=new mxCell("");return e.setVertex(!0),e.setConnectable(!1),e}ungroupCells(t){var e=[];if(t==null){t=this.getSelectionCells();for(var s=[],n=0;n<t.length;n++)this.model.getChildCount(t[n])>0&&s.push(t[n]);t=s}if(t!=null&&t.length>0){this.model.beginUpdate();try{for(var n=0;n<t.length;n++){var l=this.model.getChildren(t[n]);if(l!=null&&l.length>0){l=l.slice();var r=this.model.getParent(t[n]),a=this.model.getChildCount(r);this.cellsAdded(l,r,a,null,null,!0),e=e.concat(l)}}this.removeCellsAfterUngroup(t),this.fireEvent(new mxEventObject(mxEvent.UNGROUP_CELLS,"cells",t))}finally{this.model.endUpdate()}}return e}removeCellsAfterUngroup(t){this.cellsRemoved(this.addAllEdges(t))}removeCellsFromParent(t){t==null&&(t=this.getSelectionCells()),this.model.beginUpdate();try{var e=this.getDefaultParent(),s=this.model.getChildCount(e);this.cellsAdded(t,e,s,null,null,!0),this.fireEvent(new mxEventObject(mxEvent.REMOVE_CELLS_FROM_PARENT,"cells",t))}finally{this.model.endUpdate()}return t}updateGroupBounds(t,e,s,n,l,r,a){t==null&&(t=this.getSelectionCells()),e=e??0,s=s??!1,n=n??0,l=l??0,r=r??0,a=a??0,this.model.beginUpdate();try{for(var o=t.length-1;o>=0;o--){var h=this.getCellGeometry(t[o]);if(h!=null){var d=this.getChildCells(t[o]);if(d!=null&&d.length>0){var g=this.getBoundingBoxFromGeometry(d,!0);if(g!=null&&g.width>0&&g.height>0){var m=0,f=0;if(this.isSwimlane(t[o])){var c=this.getStartSize(t[o]);m=c.width,f=c.height}h=h.clone(),s&&(h.x=Math.round(h.x+g.x-e-m-a),h.y=Math.round(h.y+g.y-e-f-n)),h.width=Math.round(g.width+2*e+m+a+l),h.height=Math.round(g.height+2*e+f+n+r),this.model.setGeometry(t[o],h),this.moveCells(d,e+m-g.x+a,e+f-g.y+n)}}}}}finally{this.model.endUpdate()}return t}getBoundingBox(t){var e=null;if(t!=null&&t.length>0){for(var s=0;s<t.length;s++)if(this.model.isVertex(t[s])||this.model.isEdge(t[s])){var n=this.view.getBoundingBox(this.view.getState(t[s]),!0);n!=null&&(e==null?e=mxRectangle.fromRectangle(n):e.add(n))}}return e}cloneCell(t,e,s,n){return this.cloneCells([t],e,s,n)[0]}cloneCells(t,e,s,n){e=e??!0;var l=null;if(t!=null){for(var r=new mxDictionary,a=[],o=0;o<t.length;o++)r.put(t[o],!0),a.push(t[o]);if(a.length>0){var h=this.view.scale,d=this.view.translate;l=this.model.cloneCells(t,!0,s);for(var o=0;o<t.length;o++)if(!e&&this.model.isEdge(l[o])&&this.getEdgeValidationError(l[o],this.model.getTerminal(l[o],!0),this.model.getTerminal(l[o],!1))!=null)l[o]=null;else{var g=this.model.getGeometry(l[o]);if(g!=null){var m=this.view.getState(t[o]),f=this.view.getState(this.model.getParent(t[o]));if(m!=null&&f!=null){var c=n?0:f.origin.x,x=n?0:f.origin.y;if(this.model.isEdge(l[o])){var p=m.absolutePoints;if(p!=null){for(var C=this.model.getTerminal(t[o],!0);C!=null&&!r.get(C);)C=this.model.getParent(C);C==null&&p[0]!=null&&g.setTerminalPoint(new mxPoint(p[0].x/h-d.x,p[0].y/h-d.y),!0);for(var E=this.model.getTerminal(t[o],!1);E!=null&&!r.get(E);)E=this.model.getParent(E);var T=p.length-1;E==null&&p[T]!=null&&g.setTerminalPoint(new mxPoint(p[T].x/h-d.x,p[T].y/h-d.y),!1);var S=g.points;if(S!=null)for(var y=0;y<S.length;y++)S[y].x+=c,S[y].y+=x}}else g.translate(c,x)}}}}else l=[]}return l}insertVertex(t,e,s,n,l,r,a,o,h){var d=this.createVertex(t,e,s,n,l,r,a,o,h);return this.addCell(d,t)}createVertex(t,e,s,n,l,r,a,o,h){var d=new mxGeometry(n,l,r,a);d.relative=h??!1;var g=new mxCell(s,d,o);return g.setId(e),g.setVertex(!0),g.setConnectable(!0),g}insertEdge(t,e,s,n,l,r){var a=this.createEdge(t,e,s,n,l,r);return this.addEdge(a,t,n,l)}createEdge(t,e,s,n,l,r){var a=new mxCell(s,new mxGeometry,r);return a.setId(e),a.setEdge(!0),a.geometry.relative=!0,a}addEdge(t,e,s,n,l){return this.addCell(t,e,l,s,n)}addCell(t,e,s,n,l){return this.addCells([t],e,s,n,l)[0]}addCells(t,e,s,n,l,r){e==null&&(e=this.getDefaultParent()),s==null&&(s=this.model.getChildCount(e)),this.model.beginUpdate();try{this.cellsAdded(t,e,s,n,l,r??!1,!0),this.fireEvent(new mxEventObject(mxEvent.ADD_CELLS,"cells",t,"parent",e,"index",s,"source",n,"target",l))}finally{this.model.endUpdate()}return t}cellsAdded(t,e,s,n,l,r,a,o){if(t!=null&&e!=null&&s!=null){this.model.beginUpdate();try{for(var h=r?this.view.getState(e):null,d=h!=null?h.origin:null,g=new mxPoint(0,0),m=0;m<t.length;m++)if(t[m]==null)s--;else{var f=this.model.getParent(t[m]);if(d!=null&&t[m]!=e&&e!=f){var c=this.view.getState(f),x=c!=null?c.origin:g,p=this.model.getGeometry(t[m]);if(p!=null){var C=x.x-d.x,E=x.y-d.y;p=p.clone(),p.translate(C,E),!p.relative&&this.model.isVertex(t[m])&&!this.isAllowNegativeCoordinates()&&(p.x=Math.max(0,p.x),p.y=Math.max(0,p.y)),this.model.setGeometry(t[m],p)}}e==f&&s+m>this.model.getChildCount(e)&&s--,this.model.add(e,t[m],s+m),this.autoSizeCellsOnAdd&&this.autoSizeCell(t[m],!0),(o==null||o)&&this.isExtendParentsOnAdd(t[m])&&this.isExtendParent(t[m])&&this.extendParent(t[m]),(a==null||a)&&this.constrainChild(t[m]),n!=null&&this.cellConnected(t[m],n,!0),l!=null&&this.cellConnected(t[m],l,!1)}this.fireEvent(new mxEventObject(mxEvent.CELLS_ADDED,"cells",t,"parent",e,"index",s,"source",n,"target",l,"absolute",r))}finally{this.model.endUpdate()}}}autoSizeCell(t,e){if(e=e??!0,e)for(var s=this.model.getChildCount(t),n=0;n<s;n++)this.autoSizeCell(this.model.getChildAt(t,n));this.getModel().isVertex(t)&&this.isAutoSizeCell(t)&&this.updateCellSize(t)}removeCells(t,e){if(e=e??!0,t==null&&(t=this.getDeletableCells(this.getSelectionCells())),e)t=this.getDeletableCells(this.addAllEdges(t));else{t=t.slice();for(var s=this.getDeletableCells(this.getAllEdges(t)),n=new mxDictionary,l=0;l<t.length;l++)n.put(t[l],!0);for(var l=0;l<s.length;l++)this.view.getState(s[l])==null&&!n.get(s[l])&&(n.put(s[l],!0),t.push(s[l]))}this.model.beginUpdate();try{this.cellsRemoved(t),this.fireEvent(new mxEventObject(mxEvent.REMOVE_CELLS,"cells",t,"includeEdges",e))}finally{this.model.endUpdate()}return t}cellsRemoved(t){if(t!=null&&t.length>0){var e=this.view.scale,s=this.view.translate;this.model.beginUpdate();try{for(var n=new mxDictionary,l=0;l<t.length;l++)n.put(t[l],!0);for(var l=0;l<t.length;l++){for(var r=this.getAllEdges([t[l]]),a=(d,g)=>{var m=this.model.getGeometry(d);if(m!=null){for(var f=this.model.getTerminal(d,g),c=!1,x=f;x!=null;){if(t[l]==x){c=!0;break}x=this.model.getParent(x)}if(c){m=m.clone();var p=this.view.getState(d);if(p!=null&&p.absolutePoints!=null){var C=p.absolutePoints,E=g?0:C.length-1;m.setTerminalPoint(new mxPoint(C[E].x/e-s.x-p.origin.x,C[E].y/e-s.y-p.origin.y),g)}else{var T=this.view.getState(f);T!=null&&m.setTerminalPoint(new mxPoint(T.getCenterX()/e-s.x,T.getCenterY()/e-s.y),g)}this.model.setGeometry(d,m),this.model.setTerminal(d,null,g)}}},o=0;o<r.length;o++)n.get(r[o])||(n.put(r[o],!0),a(r[o],!0),a(r[o],!1));this.model.remove(t[l])}this.fireEvent(new mxEventObject(mxEvent.CELLS_REMOVED,"cells",t))}finally{this.model.endUpdate()}}}splitEdge(t,e,s,n,l,r,a,o){n=n||0,l=l||0,o=o??this.model.getParent(t);var h=this.model.getTerminal(t,!0);this.model.beginUpdate();try{if(s==null){s=this.cloneCell(t);var d=this.view.getState(t),g=this.getCellGeometry(s);if(g!=null&&g.points!=null&&d!=null){var m=this.view.translate,f=this.view.scale,c=mxUtils.findNearestSegment(d,(n+m.x)*f,(l+m.y)*f);g.points=g.points.slice(0,c),g=this.getCellGeometry(t),g!=null&&g.points!=null&&(g=g.clone(),g.points=g.points.slice(c),this.model.setGeometry(t,g))}}this.cellsMoved(e,n,l,!1,!1),this.cellsAdded(e,o,this.model.getChildCount(o),null,null,!0),this.cellsAdded([s],o,this.model.getChildCount(o),h,e[0],!1),this.cellConnected(t,e[0],!0),this.fireEvent(new mxEventObject(mxEvent.SPLIT_EDGE,"edge",t,"cells",e,"newEdge",s,"dx",n,"dy",l))}finally{this.model.endUpdate()}return s}toggleCells(t,e,s){e==null&&(e=this.getSelectionCells()),s&&(e=this.addAllEdges(e)),this.model.beginUpdate();try{this.cellsToggled(e,t),this.fireEvent(new mxEventObject(mxEvent.TOGGLE_CELLS,"show",t,"cells",e,"includeEdges",s))}finally{this.model.endUpdate()}return e}cellsToggled(t,e){if(t!=null&&t.length>0){this.model.beginUpdate();try{for(var s=0;s<t.length;s++)this.model.setVisible(t[s],e)}finally{this.model.endUpdate()}}}foldCells(t,e,s,n,l){e=e??!1,s==null&&(s=this.getFoldableCells(this.getSelectionCells(),t)),this.stopEditing(!1),this.model.beginUpdate();try{this.cellsFolded(s,t,e,n),this.fireEvent(new mxEventObject(mxEvent.FOLD_CELLS,"collapse",t,"recurse",e,"cells",s))}finally{this.model.endUpdate()}return s}cellsFolded(t,e,s,n){if(t!=null&&t.length>0){this.model.beginUpdate();try{for(var l=0;l<t.length;l++)if((!n||this.isCellFoldable(t[l],e))&&e!=this.isCellCollapsed(t[l])){if(this.model.setCollapsed(t[l],e),this.swapBounds(t[l],e),this.isExtendParent(t[l])&&this.extendParent(t[l]),s){var r=this.model.getChildren(t[l]);this.cellsFolded(r,e,s)}this.constrainChild(t[l])}this.fireEvent(new mxEventObject(mxEvent.CELLS_FOLDED,"cells",t,"collapse",e,"recurse",s))}finally{this.model.endUpdate()}}}swapBounds(t,e){if(t!=null){var s=this.model.getGeometry(t);s!=null&&(s=s.clone(),this.updateAlternateBounds(t,s,e),s.swap(),this.model.setGeometry(t,s))}}updateAlternateBounds(t,e,s){if(t!=null&&e!=null){var n=this.getCurrentCellStyle(t);if(e.alternateBounds==null){var l=e;if(this.collapseToPreferredSize){var r=this.getPreferredSizeForCell(t);if(r!=null){l=r;var a=mxUtils.getValue(n,mxConstants.STYLE_STARTSIZE);a>0&&(l.height=Math.max(l.height,a))}}e.alternateBounds=new mxRectangle(0,0,l.width,l.height)}if(e.alternateBounds!=null){e.alternateBounds.x=e.x,e.alternateBounds.y=e.y;var o=mxUtils.toRadians(n[mxConstants.STYLE_ROTATION]||0);if(o!=0){var h=e.alternateBounds.getCenterX()-e.getCenterX(),d=e.alternateBounds.getCenterY()-e.getCenterY(),g=Math.cos(o),m=Math.sin(o),f=g*h-m*d,c=m*h+g*d;e.alternateBounds.x+=f-h,e.alternateBounds.y+=c-d}}}}addAllEdges(t){var e=t.slice();return mxUtils.removeDuplicates(e.concat(this.getAllEdges(t)))}getAllEdges(t){var e=[];if(t!=null)for(var s=0;s<t.length;s++){for(var n=this.model.getEdgeCount(t[s]),l=0;l<n;l++)e.push(this.model.getEdgeAt(t[s],l));var r=this.model.getChildren(t[s]);e=e.concat(this.getAllEdges(r))}return e}updateCellSize(t,e){e=e??!1,this.model.beginUpdate();try{this.cellSizeUpdated(t,e),this.fireEvent(new mxEventObject(mxEvent.UPDATE_CELL_SIZE,"cell",t,"ignoreChildren",e))}finally{this.model.endUpdate()}return t}cellSizeUpdated(t,e){if(t!=null){this.model.beginUpdate();try{var s=this.getPreferredSizeForCell(t),n=this.model.getGeometry(t);if(s!=null&&n!=null){var l=this.isCellCollapsed(t);if(n=n.clone(),this.isSwimlane(t)){var r=this.getCellStyle(t),a=this.model.getStyle(t);a==null&&(a=""),mxUtils.getValue(r,mxConstants.STYLE_HORIZONTAL,!0)?(a=mxUtils.setStyle(a,mxConstants.STYLE_STARTSIZE,s.height+8),l&&(n.height=s.height+8),n.width=s.width):(a=mxUtils.setStyle(a,mxConstants.STYLE_STARTSIZE,s.width+8),l&&(n.width=s.width+8),n.height=s.height),this.model.setStyle(t,a)}else{var o=this.view.createState(t),h=o.style[mxConstants.STYLE_ALIGN]||mxConstants.ALIGN_CENTER;h==mxConstants.ALIGN_RIGHT?n.x+=n.width-s.width:h==mxConstants.ALIGN_CENTER&&(n.x+=Math.round((n.width-s.width)/2));var d=this.getVerticalAlign(o);d==mxConstants.ALIGN_BOTTOM?n.y+=n.height-s.height:d==mxConstants.ALIGN_MIDDLE&&(n.y+=Math.round((n.height-s.height)/2)),n.width=s.width,n.height=s.height}if(!e&&!l){var g=this.view.getBounds(this.model.getChildren(t));if(g!=null){var m=this.view.translate,f=this.view.scale,c=(g.x+g.width)/f-n.x-m.x,x=(g.y+g.height)/f-n.y-m.y;n.width=Math.max(n.width,c),n.height=Math.max(n.height,x)}}this.cellsResized([t],[n],!1)}}finally{this.model.endUpdate()}}}getPreferredSizeForCell(t,e){var s=null;if(t!=null){var n=this.view.createState(t),l=n.style;if(!this.model.isEdge(t)){var r=l[mxConstants.STYLE_FONTSIZE]||mxConstants.DEFAULT_FONTSIZE,a=0,o=0;(this.getImage(n)!=null||l[mxConstants.STYLE_IMAGE]!=null)&&l[mxConstants.STYLE_SHAPE]==mxConstants.SHAPE_LABEL&&(l[mxConstants.STYLE_VERTICAL_ALIGN]==mxConstants.ALIGN_MIDDLE&&(a+=parseFloat(l[mxConstants.STYLE_IMAGE_WIDTH])||mxLabel.imageSize),l[mxConstants.STYLE_ALIGN]!=mxConstants.ALIGN_CENTER&&(o+=parseFloat(l[mxConstants.STYLE_IMAGE_HEIGHT])||mxLabel.imageSize)),a+=2*(l[mxConstants.STYLE_SPACING]||0),a+=l[mxConstants.STYLE_SPACING_LEFT]||0,a+=l[mxConstants.STYLE_SPACING_RIGHT]||0,o+=2*(l[mxConstants.STYLE_SPACING]||0),o+=l[mxConstants.STYLE_SPACING_TOP]||0,o+=l[mxConstants.STYLE_SPACING_BOTTOM]||0;var h=this.getFoldingImage(n);h!=null&&(a+=h.width+8);var d=this.cellRenderer.getLabelValue(n);if(d!=null&&d.length>0){this.isHtmlLabel(n.cell)||(d=mxUtils.htmlEntities(d,!1)),d=d.replace(/\n/g,"<br>");var g=mxUtils.getSizeForString(d,r,l[mxConstants.STYLE_FONTFAMILY],e,l[mxConstants.STYLE_FONTSTYLE]),m=g.width+a,f=g.height+o;if(!mxUtils.getValue(l,mxConstants.STYLE_HORIZONTAL,!0)){var c=f;f=m,m=c}this.gridEnabled&&(m=this.snap(m+this.gridSize/2),f=this.snap(f+this.gridSize/2)),s=new mxRectangle(0,0,m,f)}else{var x=4*this.gridSize;s=new mxRectangle(0,0,x,x)}}}return s}resizeCell(t,e,s){return this.resizeCells([t],[e],s)[0]}resizeCells(t,e,s){s=s??this.isRecursiveResize(),this.model.beginUpdate();try{var n=this.cellsResized(t,e,s);this.fireEvent(new mxEventObject(mxEvent.RESIZE_CELLS,"cells",t,"bounds",e,"previous",n))}finally{this.model.endUpdate()}return t}cellsResized(t,e,s){s=s??!1;var n=[];if(t!=null&&e!=null&&t.length==e.length){this.model.beginUpdate();try{for(var l=0;l<t.length;l++)n.push(this.cellResized(t[l],e[l],!1,s)),this.isExtendParent(t[l])&&this.extendParent(t[l]),this.constrainChild(t[l]);this.resetEdgesOnResize&&this.resetEdges(t),this.fireEvent(new mxEventObject(mxEvent.CELLS_RESIZED,"cells",t,"bounds",e,"previous",n))}finally{this.model.endUpdate()}}return n}cellResized(t,e,s,n){var l=this.model.getGeometry(t);if(l!=null&&(l.x!=e.x||l.y!=e.y||l.width!=e.width||l.height!=e.height)){var r=l.clone();if(!s&&r.relative){var a=r.offset;a!=null&&(a.x+=e.x-r.x,a.y+=e.y-r.y)}else r.x=e.x,r.y=e.y;r.width=e.width,r.height=e.height,!r.relative&&this.model.isVertex(t)&&!this.isAllowNegativeCoordinates()&&(r.x=Math.max(0,r.x),r.y=Math.max(0,r.y)),this.model.beginUpdate();try{n&&this.resizeChildCells(t,r),this.model.setGeometry(t,r),this.constrainChildCells(t)}finally{this.model.endUpdate()}}return l}resizeChildCells(t,e){for(var s=this.model.getGeometry(t),n=e.width/s.width,l=e.height/s.height,r=this.model.getChildCount(t),a=0;a<r;a++)this.scaleCell(this.model.getChildAt(t,a),n,l,!0)}constrainChildCells(t){for(var e=this.model.getChildCount(t),s=0;s<e;s++)this.constrainChild(this.model.getChildAt(t,s))}scaleCell(t,e,s,n){var l=this.model.getGeometry(t);if(l!=null){var r=this.getCurrentCellStyle(t);l=l.clone();var a=l.x,o=l.y,h=l.width,d=l.height;l.scale(e,s,r[mxConstants.STYLE_ASPECT]=="fixed"),r[mxConstants.STYLE_RESIZE_WIDTH]=="1"?l.width=h*e:r[mxConstants.STYLE_RESIZE_WIDTH]=="0"&&(l.width=h),r[mxConstants.STYLE_RESIZE_HEIGHT]=="1"?l.height=d*s:r[mxConstants.STYLE_RESIZE_HEIGHT]=="0"&&(l.height=d),this.isCellMovable(t)||(l.x=a,l.y=o),this.isCellResizable(t)||(l.width=h,l.height=d),this.model.isVertex(t)?this.cellResized(t,l,!0,n):this.model.setGeometry(t,l)}}extendParent(t){if(t!=null){var e=this.model.getParent(t),s=this.getCellGeometry(e);if(e!=null&&s!=null&&!this.isCellCollapsed(e)){var n=this.getCellGeometry(t);n!=null&&!n.relative&&(s.width<n.x+n.width||s.height<n.y+n.height)&&(s=s.clone(),s.width=Math.max(s.width,n.x+n.width),s.height=Math.max(s.height,n.y+n.height),this.cellsResized([e],[s],!1))}}}importCells(t,e,s,n,l,r){return this.moveCells(t,e,s,!0,n,l,r)}moveCells(t,e,s,n,l,r,a){if(e=e??0,s=s??0,n=n??!1,t!=null&&(e!=0||s!=0||n||l!=null)){t=this.model.getTopmostCells(t),this.model.beginUpdate();try{for(var o=new mxDictionary,h=0;h<t.length;h++)o.put(t[h],!0);for(var d=p=>{for(;p!=null;){if(o.get(p))return!0;p=this.model.getParent(p)}return!1},g=[],h=0;h<t.length;h++){var m=this.getCellGeometry(t[h]),f=this.model.getParent(t[h]);(m==null||!m.relative||!this.model.isEdge(f)||!d(this.model.getTerminal(f,!0))&&!d(this.model.getTerminal(f,!1)))&&g.push(t[h])}t=g,n&&(t=this.cloneCells(t,this.isCloneInvalidEdges(),a),l==null&&(l=this.getDefaultParent()));var c=this.isAllowNegativeCoordinates();if(l!=null&&this.setAllowNegativeCoordinates(!0),this.cellsMoved(t,e,s,!n&&this.isDisconnectOnMove()&&this.isAllowDanglingEdges(),l==null,this.isExtendParentsOnMove()&&l==null),this.setAllowNegativeCoordinates(c),l!=null){var x=this.model.getChildCount(l);this.cellsAdded(t,l,x,null,null,!0)}this.fireEvent(new mxEventObject(mxEvent.MOVE_CELLS,"cells",t,"dx",e,"dy",s,"clone",n,"target",l,"event",r))}finally{this.model.endUpdate()}}return t}cellsMoved(t,e,s,n,l,r){if(t!=null&&(e!=0||s!=0)){r=r??!1,this.model.beginUpdate();try{n&&this.disconnectGraph(t);for(var a=0;a<t.length;a++)this.translateCell(t[a],e,s),r&&this.isExtendParent(t[a])?this.extendParent(t[a]):l&&this.constrainChild(t[a]);this.resetEdgesOnMove&&this.resetEdges(t),this.fireEvent(new mxEventObject(mxEvent.CELLS_MOVED,"cells",t,"dx",e,"dy",s,"disconnect",n))}finally{this.model.endUpdate()}}}translateCell(t,e,s){var n=this.model.getGeometry(t);if(n!=null){if(e=parseFloat(e),s=parseFloat(s),n=n.clone(),n.translate(e,s),!n.relative&&this.model.isVertex(t)&&!this.isAllowNegativeCoordinates()&&(n.x=Math.max(0,parseFloat(n.x)),n.y=Math.max(0,parseFloat(n.y))),n.relative&&!this.model.isEdge(t)){var l=this.model.getParent(t),r=0;if(this.model.isVertex(l)){var a=this.getCurrentCellStyle(l);r=mxUtils.getValue(a,mxConstants.STYLE_ROTATION,0)}if(r!=0){var o=mxUtils.toRadians(-r),h=Math.cos(o),d=Math.sin(o),g=mxUtils.getRotatedPoint(new mxPoint(e,s),h,d,new mxPoint(0,0));e=g.x,s=g.y}n.offset==null?n.offset=new mxPoint(e,s):(n.offset.x=parseFloat(n.offset.x)+e,n.offset.y=parseFloat(n.offset.y)+s)}this.model.setGeometry(t,n)}}getCellContainmentArea(t){if(t!=null&&!this.model.isEdge(t)){var e=this.model.getParent(t);if(e!=null&&e!=this.getDefaultParent()){var s=this.model.getGeometry(e);if(s!=null){var n=0,l=0,r=s.width,a=s.height;if(this.isSwimlane(e)){var o=this.getStartSize(e),h=this.getCurrentCellStyle(e),d=mxUtils.getValue(h,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_EAST),g=mxUtils.getValue(h,mxConstants.STYLE_FLIPH,0)==1,m=mxUtils.getValue(h,mxConstants.STYLE_FLIPV,0)==1;if(d==mxConstants.DIRECTION_SOUTH||d==mxConstants.DIRECTION_NORTH){var f=o.width;o.width=o.height,o.height=f}(d==mxConstants.DIRECTION_EAST&&!m||d==mxConstants.DIRECTION_NORTH&&!g||d==mxConstants.DIRECTION_WEST&&m||d==mxConstants.DIRECTION_SOUTH&&g)&&(n=o.width,l=o.height),r-=o.width,a-=o.height}return new mxRectangle(n,l,r,a)}}}return null}getMaximumGraphBounds(){return this.maximumGraphBounds}constrainChild(t,e){if(t!=null){var s=this.getCellGeometry(t);if(s!=null&&(this.isConstrainRelativeChildren()||!s.relative)){var n=this.model.getParent(t);this.getCellGeometry(n);var l=this.getMaximumGraphBounds();if(l!=null){var r=this.getBoundingBoxFromGeometry([n],!1);r!=null&&(l=mxRectangle.fromRectangle(l),l.x-=r.x,l.y-=r.y)}if(this.isConstrainChild(t)){var a=this.getCellContainmentArea(t);if(a!=null){var o=this.getOverlap(t);o>0&&(a=mxRectangle.fromRectangle(a),a.x-=a.width*o,a.y-=a.height*o,a.width+=2*a.width*o,a.height+=2*a.height*o),l==null?l=a:(l=mxRectangle.fromRectangle(l),l.intersect(a))}}if(l!=null){var h=[t];if(!this.isCellCollapsed(t))for(var d=this.model.getDescendants(t),g=0;g<d.length;g++)this.isCellVisible(d[g])&&h.push(d[g]);var m=this.getBoundingBoxFromGeometry(h,!1);if(m!=null){s=s.clone();var f=0;s.width>l.width&&(f=s.width-l.width,s.width-=f),m.x+m.width>l.x+l.width&&(f-=m.x+m.width-l.x-l.width-f);var c=0;s.height>l.height&&(c=s.height-l.height,s.height-=c),m.y+m.height>l.y+l.height&&(c-=m.y+m.height-l.y-l.height-c),m.x<l.x&&(f-=m.x-l.x),m.y<l.y&&(c-=m.y-l.y),(f!=0||c!=0)&&(s.relative?(s.offset==null&&(s.offset=new mxPoint),s.offset.x+=f,s.offset.y+=c):(s.x+=f,s.y+=c)),this.model.setGeometry(t,s)}}}}}resetEdges(t){if(t!=null){for(var e=new mxDictionary,s=0;s<t.length;s++)e.put(t[s],!0);this.model.beginUpdate();try{for(var s=0;s<t.length;s++){var n=this.model.getEdges(t[s]);if(n!=null)for(var l=0;l<n.length;l++){var r=this.view.getState(n[l]),a=r!=null?r.getVisibleTerminal(!0):this.view.getVisibleTerminal(n[l],!0),o=r!=null?r.getVisibleTerminal(!1):this.view.getVisibleTerminal(n[l],!1);(!e.get(a)||!e.get(o))&&this.resetEdge(n[l])}this.resetEdges(this.model.getChildren(t[s]))}}finally{this.model.endUpdate()}}}resetEdge(t){var e=this.model.getGeometry(t);return e!=null&&e.points!=null&&e.points.length>0&&(e=e.clone(),e.points=[],this.model.setGeometry(t,e)),t}getOutlineConstraint(t,e,s){if(e.shape!=null){var n=this.view.getPerimeterBounds(e),l=e.style[mxConstants.STYLE_DIRECTION];if(l==mxConstants.DIRECTION_NORTH||l==mxConstants.DIRECTION_SOUTH){n.x+=n.width/2-n.height/2,n.y+=n.height/2-n.width/2;var r=n.width;n.width=n.height,n.height=r}var a=mxUtils.toRadians(e.shape.getShapeRotation());if(a!=0){var o=Math.cos(-a),h=Math.sin(-a),d=new mxPoint(n.getCenterX(),n.getCenterY());t=mxUtils.getRotatedPoint(t,o,h,d)}var g=1,m=1,f=0,c=0;if(this.getModel().isVertex(e.cell)){var x=e.style[mxConstants.STYLE_FLIPH],p=e.style[mxConstants.STYLE_FLIPV];if(e.shape!=null&&e.shape.stencil!=null&&(x=mxUtils.getValue(e.style,"stencilFlipH",0)==1||x,p=mxUtils.getValue(e.style,"stencilFlipV",0)==1||p),l==mxConstants.DIRECTION_NORTH||l==mxConstants.DIRECTION_SOUTH){var r=x;x=p,p=r}x&&(g=-1,f=-n.width),p&&(m=-1,c=-n.height)}t=new mxPoint((t.x-n.x)*g-f+n.x,(t.y-n.y)*m-c+n.y);var C=n.width==0?0:Math.round((t.x-n.x)*1e3/n.width)/1e3,E=n.height==0?0:Math.round((t.y-n.y)*1e3/n.height)/1e3;return new mxConnectionConstraint(new mxPoint(C,E),!1)}return null}getAllConnectionConstraints(t,e){return t!=null&&t.shape!=null&&t.shape.stencil!=null?t.shape.stencil.constraints:null}getConnectionConstraint(t,e,s){var n=null,l=t.style[s?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X];if(l!=null){var r=t.style[s?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y];r!=null&&(n=new mxPoint(parseFloat(l),parseFloat(r)))}var a=!1,o=0,h=0;return n!=null&&(a=mxUtils.getValue(t.style,s?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,!0),o=parseFloat(t.style[s?mxConstants.STYLE_EXIT_DX:mxConstants.STYLE_ENTRY_DX]),h=parseFloat(t.style[s?mxConstants.STYLE_EXIT_DY:mxConstants.STYLE_ENTRY_DY]),o=isFinite(o)?o:0,h=isFinite(h)?h:0),new mxConnectionConstraint(n,a,null,o,h)}setConnectionConstraint(t,e,s,n){if(n!=null){this.model.beginUpdate();try{n==null||n.point==null?(this.setCellStyles(s?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X,null,[t]),this.setCellStyles(s?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y,null,[t]),this.setCellStyles(s?mxConstants.STYLE_EXIT_DX:mxConstants.STYLE_ENTRY_DX,null,[t]),this.setCellStyles(s?mxConstants.STYLE_EXIT_DY:mxConstants.STYLE_ENTRY_DY,null,[t]),this.setCellStyles(s?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,null,[t])):n.point!=null&&(this.setCellStyles(s?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X,n.point.x,[t]),this.setCellStyles(s?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y,n.point.y,[t]),this.setCellStyles(s?mxConstants.STYLE_EXIT_DX:mxConstants.STYLE_ENTRY_DX,n.dx,[t]),this.setCellStyles(s?mxConstants.STYLE_EXIT_DY:mxConstants.STYLE_ENTRY_DY,n.dy,[t]),n.perimeter?this.setCellStyles(s?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,null,[t]):this.setCellStyles(s?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,"0",[t]))}finally{this.model.endUpdate()}}}getConnectionPoint(t,e,s){s=s??!0;var n=null;if(t!=null&&e.point!=null){var l=this.view.getPerimeterBounds(t),r=new mxPoint(l.getCenterX(),l.getCenterY()),a=t.style[mxConstants.STYLE_DIRECTION],o=0;a!=null&&mxUtils.getValue(t.style,mxConstants.STYLE_ANCHOR_POINT_DIRECTION,1)==1&&(a==mxConstants.DIRECTION_NORTH?o+=270:a==mxConstants.DIRECTION_WEST?o+=180:a==mxConstants.DIRECTION_SOUTH&&(o+=90),(a==mxConstants.DIRECTION_NORTH||a==mxConstants.DIRECTION_SOUTH)&&l.rotate90());var h=this.view.scale;n=new mxPoint(l.x+e.point.x*l.width+e.dx*h,l.y+e.point.y*l.height+e.dy*h);var d=t.style[mxConstants.STYLE_ROTATION]||0;if(e.perimeter){if(o!=0){var g=0,m=0;o==90?m=1:o==180?g=-1:o==270&&(m=-1),n=mxUtils.getRotatedPoint(n,g,m,r)}n=this.view.getPerimeterPoint(t,n,!1)}else if(d+=o,this.getModel().isVertex(t.cell)){var f=t.style[mxConstants.STYLE_FLIPH]==1,c=t.style[mxConstants.STYLE_FLIPV]==1;if(t.shape!=null&&t.shape.stencil!=null&&(f=mxUtils.getValue(t.style,"stencilFlipH",0)==1||f,c=mxUtils.getValue(t.style,"stencilFlipV",0)==1||c),a==mxConstants.DIRECTION_NORTH||a==mxConstants.DIRECTION_SOUTH){var x=f;f=c,c=x}f&&(n.x=2*l.getCenterX()-n.x),c&&(n.y=2*l.getCenterY()-n.y)}if(d!=0&&n!=null){var p=mxUtils.toRadians(d),g=Math.cos(p),m=Math.sin(p);n=mxUtils.getRotatedPoint(n,g,m,r)}}return s&&n!=null&&(n.x=Math.round(n.x),n.y=Math.round(n.y)),n}connectCell(t,e,s,n){this.model.beginUpdate();try{var l=this.model.getTerminal(t,s);this.cellConnected(t,e,s,n),this.fireEvent(new mxEventObject(mxEvent.CONNECT_CELL,"edge",t,"terminal",e,"source",s,"previous",l))}finally{this.model.endUpdate()}return t}cellConnected(t,e,s,n){if(t!=null){this.model.beginUpdate();try{var l=this.model.getTerminal(t,s);if(this.setConnectionConstraint(t,e,s,n),this.isPortsEnabled()){var r=null;this.isPort(e)&&(r=e.getId(),e=this.getTerminalForPort(e,s));var a=s?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT;this.setCellStyles(a,r,[t])}this.model.setTerminal(t,e,s),this.resetEdgesOnConnect&&this.resetEdge(t),this.fireEvent(new mxEventObject(mxEvent.CELL_CONNECTED,"edge",t,"terminal",e,"source",s,"previous",l))}finally{this.model.endUpdate()}}}disconnectGraph(t){if(t!=null){this.model.beginUpdate();try{for(var e=this.view.scale,s=this.view.translate,n=new mxDictionary,l=0;l<t.length;l++)n.put(t[l],!0);for(var l=0;l<t.length;l++)if(this.model.isEdge(t[l])){var r=this.model.getGeometry(t[l]);if(r!=null){var a=this.view.getState(t[l]),o=this.view.getState(this.model.getParent(t[l]));if(a!=null&&o!=null){r=r.clone();var h=-o.origin.x,d=-o.origin.y,g=a.absolutePoints,m=this.model.getTerminal(t[l],!0);if(m!=null&&this.isCellDisconnectable(t[l],m,!0)){for(;m!=null&&!n.get(m);)m=this.model.getParent(m);m==null&&(r.setTerminalPoint(new mxPoint(g[0].x/e-s.x+h,g[0].y/e-s.y+d),!0),this.model.setTerminal(t[l],null,!0))}var f=this.model.getTerminal(t[l],!1);if(f!=null&&this.isCellDisconnectable(t[l],f,!1)){for(;f!=null&&!n.get(f);)f=this.model.getParent(f);if(f==null){var c=g.length-1;r.setTerminalPoint(new mxPoint(g[c].x/e-s.x+h,g[c].y/e-s.y+d),!1),this.model.setTerminal(t[l],null,!1)}}this.model.setGeometry(t[l],r)}}}}finally{this.model.endUpdate()}}}getCurrentRoot(){return this.view.currentRoot}getTranslateForRoot(t){return null}isPort(t){return!1}getTerminalForPort(t,e){return this.model.getParent(t)}getChildOffsetForCell(t){return null}enterGroup(t){t=t||this.getSelectionCell(),t!=null&&this.isValidRoot(t)&&(this.view.setCurrentRoot(t),this.clearSelection())}exitGroup(){var t=this.model.getRoot(),e=this.getCurrentRoot();if(e!=null){for(var s=this.model.getParent(e);s!=t&&!this.isValidRoot(s)&&this.model.getParent(s)!=t;)s=this.model.getParent(s);s==t||this.model.getParent(s)==t?this.view.setCurrentRoot(null):this.view.setCurrentRoot(s);var n=this.view.getState(e);n!=null&&this.setSelectionCell(e)}}home(){var t=this.getCurrentRoot();if(t!=null){this.view.setCurrentRoot(null);var e=this.view.getState(t);e!=null&&this.setSelectionCell(t)}}isValidRoot(t){return t!=null}getGraphBounds(){return this.view.getGraphBounds()}getCellBounds(t,e,s){var n=[t];e&&(n=n.concat(this.model.getEdges(t)));var l=this.view.getBounds(n);if(s)for(var r=this.model.getChildCount(t),a=0;a<r;a++){var o=this.getCellBounds(this.model.getChildAt(t,a),e,!0);l!=null?l.add(o):l=o}return l}getBoundingBoxFromGeometry(t,e){e=e??!1;var s=null;if(t!=null){for(var n=0;n<t.length;n++)if(e||this.model.isVertex(t[n])){var l=this.getCellGeometry(t[n]);if(l!=null){var r=null;if(this.model.isEdge(t[n])){var a=function(c){c!=null&&(h==null?h=new mxRectangle(c.x,c.y,0,0):h.add(new mxRectangle(c.x,c.y,0,0)))};this.model.getTerminal(t[n],!0)==null&&a(l.getTerminalPoint(!0)),this.model.getTerminal(t[n],!1)==null&&a(l.getTerminalPoint(!1));var o=l.points;if(o!=null&&o.length>0)for(var h=new mxRectangle(o[0].x,o[0].y,0,0),d=1;d<o.length;d++)a(o[d]);r=h}else{var g=this.model.getParent(t[n]);if(l.relative){if(this.model.isVertex(g)&&g!=this.view.currentRoot){var h=this.getBoundingBoxFromGeometry([g],!1);h!=null&&(r=new mxRectangle(l.x*h.width,l.y*h.height,l.width,l.height),mxUtils.indexOf(t,g)>=0&&(r.x+=h.x,r.y+=h.y))}}else if(r=mxRectangle.fromRectangle(l),this.model.isVertex(g)&&mxUtils.indexOf(t,g)>=0){var h=this.getBoundingBoxFromGeometry([g],!1);h!=null&&(r.x+=h.x,r.y+=h.y)}r!=null&&l.offset!=null&&(r.x+=l.offset.x,r.y+=l.offset.y);var m=this.getCurrentCellStyle(t[n]);if(r!=null){var f=mxUtils.getValue(m,mxConstants.STYLE_ROTATION,0);f!=0&&(r=mxUtils.getBoundingBox(r,f))}}r!=null&&(s==null?s=mxRectangle.fromRectangle(r):s.add(r))}}}return s}refresh(t){this.view.clear(t,t==null),this.view.validate(),this.sizeDidChange(),this.fireEvent(new mxEventObject(mxEvent.REFRESH))}snap(t){return this.gridEnabled&&(t=Math.round(t/this.gridSize)*this.gridSize),t}snapDelta(t,e,s,n,l){var r=this.view.translate,a=this.view.scale;if(!s&&this.gridEnabled){var o=this.gridSize*a*.5;if(!n){var h=e.x-(this.snap(e.x/a-r.x)+r.x)*a;Math.abs(t.x-h)<o?t.x=0:t.x=this.snap(t.x/a)*a-h}if(!l){var d=e.y-(this.snap(e.y/a-r.y)+r.y)*a;Math.abs(t.y-d)<o?t.y=0:t.y=this.snap(t.y/a)*a-d}}else{var o=.5*a;if(!n){var h=e.x-(Math.round(e.x/a-r.x)+r.x)*a;Math.abs(t.x-h)<o?t.x=0:t.x=Math.round(t.x/a)*a-h}if(!l){var d=e.y-(Math.round(e.y/a-r.y)+r.y)*a;Math.abs(t.y-d)<o?t.y=0:t.y=Math.round(t.y/a)*a-d}}return t}panGraph(t,e){if(this.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.container))this.container.scrollLeft=-t,this.container.scrollTop=-e;else{var s=this.view.getCanvas();if(this.dialect==mxConstants.DIALECT_SVG)if(t==0&&e==0){if(s.removeAttribute("transform"),this.shiftPreview1!=null){for(var n=this.shiftPreview1.firstChild;n!=null;){var l=n.nextSibling;this.container.appendChild(n),n=l}for(this.shiftPreview1.parentNode!=null&&this.shiftPreview1.parentNode.removeChild(this.shiftPreview1),this.shiftPreview1=null,this.container.appendChild(s.parentNode),n=this.shiftPreview2.firstChild;n!=null;){var l=n.nextSibling;this.container.appendChild(n),n=l}this.shiftPreview2.parentNode!=null&&this.shiftPreview2.parentNode.removeChild(this.shiftPreview2),this.shiftPreview2=null}}else{if(s.setAttribute("transform","translate("+t+","+e+")"),this.shiftPreview1==null){this.shiftPreview1=document.createElement("div"),this.shiftPreview1.style.position="absolute",this.shiftPreview1.style.overflow="visible",this.shiftPreview2=document.createElement("div"),this.shiftPreview2.style.position="absolute",this.shiftPreview2.style.overflow="visible";for(var r=this.shiftPreview1,n=this.container.firstChild;n!=null;){var l=n.nextSibling;n!=s.parentNode?r.appendChild(n):r=this.shiftPreview2,n=l}this.shiftPreview1.firstChild!=null&&this.container.insertBefore(this.shiftPreview1,s.parentNode),this.shiftPreview2.firstChild!=null&&this.container.appendChild(this.shiftPreview2)}this.shiftPreview1.style.left=t+"px",this.shiftPreview1.style.top=e+"px",this.shiftPreview2.style.left=t+"px",this.shiftPreview2.style.top=e+"px"}else s.style.left=t+"px",s.style.top=e+"px";this.panDx=t,this.panDy=e,this.fireEvent(new mxEventObject(mxEvent.PAN))}}zoomIn(){this.zoom(this.zoomFactor)}zoomOut(){this.zoom(1/this.zoomFactor)}zoomActual(){this.view.scale==1?this.view.setTranslate(0,0):(this.view.translate.x=0,this.view.translate.y=0,this.view.setScale(1))}zoomTo(t,e){this.zoom(t/this.view.scale,e)}center(t,e,s,n){t=t??!0,e=e??!0,s=s??.5,n=n??.5;var l=mxUtils.hasScrollbars(this.container),r=2*this.getBorder(),a=this.container.clientWidth-r,o=this.container.clientHeight-r,h=this.getGraphBounds(),d=this.view.translate,g=this.view.scale,m=t?a-h.width:0,f=e?o-h.height:0;if(!l)this.view.setTranslate(t?Math.floor(d.x-h.x*g+m*s/g):d.x,e?Math.floor(d.y-h.y*g+f*n/g):d.y);else{h.x-=d.x,h.y-=d.y;var c=this.container.scrollWidth,x=this.container.scrollHeight;c>a&&(m=0),x>o&&(f=0),this.view.setTranslate(Math.floor(m/2-h.x),Math.floor(f/2-h.y)),this.container.scrollLeft=(c-a)/2,this.container.scrollTop=(x-o)/2}}zoom(t,e){e=e??this.centerZoom;var s=Math.round(this.view.scale*t*100)/100,n=this.view.getState(this.getSelectionCell());if(t=s/this.view.scale,this.keepSelectionVisibleOnZoom&&n!=null){var l=new mxRectangle(n.x*t,n.y*t,n.width*t,n.height*t);this.view.scale=s,this.scrollRectToVisible(l)||(this.view.revalidate(),this.view.setScale(s))}else{var r=mxUtils.hasScrollbars(this.container);if(e&&!r){var a=this.container.offsetWidth,o=this.container.offsetHeight;if(t>1){var h=(t-1)/(s*2);a*=-h,o*=-h}else{var h=(1/t-1)/(this.view.scale*2);a*=h,o*=h}this.view.scaleAndTranslate(s,this.view.translate.x+a,this.view.translate.y+o)}else{var d=this.view.translate.x,g=this.view.translate.y,m=this.container.scrollLeft,f=this.container.scrollTop;if(this.view.setScale(s),r){var a=0,o=0;e&&(a=this.container.offsetWidth*(t-1)/2,o=this.container.offsetHeight*(t-1)/2),this.container.scrollLeft=(this.view.translate.x-d)*this.view.scale+Math.round(m*t+a),this.container.scrollTop=(this.view.translate.y-g)*this.view.scale+Math.round(f*t+o)}}}}zoomToRect(t){var e=this.container.clientWidth/t.width,s=this.container.clientHeight/t.height,n=e/s;t.x=Math.max(0,t.x),t.y=Math.max(0,t.y);var l=Math.min(this.container.scrollWidth,t.x+t.width),r=Math.min(this.container.scrollHeight,t.y+t.height);if(t.width=l-t.x,t.height=r-t.y,n<1){var a=t.height/n,o=(a-t.height)/2;t.height=a;var h=Math.min(t.y,o);t.y=t.y-h,r=Math.min(this.container.scrollHeight,t.y+t.height),t.height=r-t.y}else{var d=t.width*n,g=(d-t.width)/2;t.width=d;var m=Math.min(t.x,g);t.x=t.x-m,l=Math.min(this.container.scrollWidth,t.x+t.width),t.width=l-t.x}var f=this.container.clientWidth/t.width,c=this.view.scale*f;mxUtils.hasScrollbars(this.container)?(this.view.setScale(c),this.container.scrollLeft=Math.round(t.x*f),this.container.scrollTop=Math.round(t.y*f)):this.view.scaleAndTranslate(c,this.view.translate.x-t.x/this.view.scale,this.view.translate.y-t.y/this.view.scale)}scrollCellToVisible(t,e){var s=-this.view.translate.x,n=-this.view.translate.y,l=this.view.getState(t);if(l!=null){var r=new mxRectangle(s+l.x,n+l.y,l.width,l.height);if(e&&this.container!=null){var a=this.container.clientWidth,o=this.container.clientHeight;r.x=r.getCenterX()-a/2,r.width=a,r.y=r.getCenterY()-o/2,r.height=o}var h=new mxPoint(this.view.translate.x,this.view.translate.y);if(this.scrollRectToVisible(r)){var d=new mxPoint(this.view.translate.x,this.view.translate.y);this.view.translate.x=h.x,this.view.translate.y=h.y,this.view.setTranslate(d.x,d.y)}}}scrollRectToVisible(t){var e=!1;if(t!=null){var s=this.container.offsetWidth,n=this.container.offsetHeight,l=Math.min(s,t.width),r=Math.min(n,t.height);if(mxUtils.hasScrollbars(this.container)){var a=this.container;t.x+=this.view.translate.x,t.y+=this.view.translate.y;var o=a.scrollLeft-t.x,h=Math.max(o-a.scrollLeft,0);o>0?a.scrollLeft-=o+2:(o=t.x+l-a.scrollLeft-a.clientWidth,o>0&&(a.scrollLeft+=o+2));var d=a.scrollTop-t.y,g=Math.max(0,d-a.scrollTop);d>0?a.scrollTop-=d+2:(d=t.y+r-a.scrollTop-a.clientHeight,d>0&&(a.scrollTop+=d+2)),!this.useScrollbarsForPanning&&(h!=0||g!=0)&&this.view.setTranslate(h,g)}else{var m=-this.view.translate.x,f=-this.view.translate.y,c=this.view.scale;t.x+l>m+s&&(this.view.translate.x-=(t.x+l-s-m)/c,e=!0),t.y+r>f+n&&(this.view.translate.y-=(t.y+r-n-f)/c,e=!0),t.x<m&&(this.view.translate.x+=(m-t.x)/c,e=!0),t.y<f&&(this.view.translate.y+=(f-t.y)/c,e=!0),e&&(this.view.refresh(),this.selectionCellsHandler!=null&&this.selectionCellsHandler.refresh())}}return e}getCellGeometry(t){return this.model.getGeometry(t)}isCellVisible(t){return this.model.isVisible(t)}isCellCollapsed(t){return this.model.isCollapsed(t)}isCellConnectable(t){return this.model.isConnectable(t)}isOrthogonal(t){var e=t.style[mxConstants.STYLE_ORTHOGONAL];if(e!=null)return e;var s=this.view.getEdgeStyle(t);return s==mxEdgeStyle.SegmentConnector||s==mxEdgeStyle.ElbowConnector||s==mxEdgeStyle.SideToSide||s==mxEdgeStyle.TopToBottom||s==mxEdgeStyle.EntityRelation||s==mxEdgeStyle.OrthConnector}isLoop(t){var e=t.getVisibleTerminalState(!0),s=t.getVisibleTerminalState(!1);return e!=null&&e==s}isCloneEvent(t){return mxEvent.isControlDown(t)}isTransparentClickEvent(t){return!1}isToggleEvent(t){return mxClient.IS_MAC?mxEvent.isMetaDown(t):mxEvent.isControlDown(t)}isGridEnabledEvent(t){return t!=null&&!mxEvent.isAltDown(t)}isConstrainedEvent(t){return mxEvent.isShiftDown(t)}isIgnoreTerminalEvent(t){return!1}validationAlert(t){mxUtils.alert(t)}isEdgeValid(t,e,s){return this.getEdgeValidationError(t,e,s)==null}getEdgeValidationError(t,e,s){if(t!=null&&!this.isAllowDanglingEdges()&&(e==null||s==null))return"";if(t!=null&&this.model.getTerminal(t,!0)==null&&this.model.getTerminal(t,!1)==null)return null;if(!this.allowLoops&&e==s&&e!=null||!this.isValidConnection(e,s))return"";if(e!=null&&s!=null){var n="";if(!this.multigraph){var l=this.model.getEdgesBetween(e,s,!0);(l.length>1||l.length==1&&l[0]!=t)&&(n+=(mxResources.get(this.alreadyConnectedResource)||this.alreadyConnectedResource)+`
`)}var r=this.model.getDirectedEdgeCount(e,!0,t),a=this.model.getDirectedEdgeCount(s,!1,t);if(this.multiplicities!=null)for(var o=0;o<this.multiplicities.length;o++){var h=this.multiplicities[o].check(this,t,e,s,r,a);h!=null&&(n+=h)}var h=this.validateEdge(t,e,s);return h!=null&&(n+=h),n.length>0?n:null}return this.allowDanglingEdges?null:""}validateEdge(t,e,s){return null}validateGraph(t,e){t=t??this.model.getRoot(),e=e??new Object;for(var s=!0,n=this.model.getChildCount(t),l=0;l<n;l++){var r=this.model.getChildAt(t,l),a=e;this.isValidRoot(r)&&(a=new Object);var o=this.validateGraph(r,a);o!=null?this.setCellWarning(r,o.replace(/\n/g,"<br>")):this.setCellWarning(r,null),s=s&&o==null}var h="";this.isCellCollapsed(t)&&!s&&(h+=(mxResources.get(this.containsValidationErrorsResource)||this.containsValidationErrorsResource)+`
`),this.model.isEdge(t)?h+=this.getEdgeValidationError(t,this.model.getTerminal(t,!0),this.model.getTerminal(t,!1))||"":h+=this.getCellValidationError(t)||"";var d=this.validateCell(t,e);return d!=null&&(h+=d),this.model.getParent(t)==null&&this.view.validate(),h.length>0||!s?h:null}getCellValidationError(t){var e=this.model.getDirectedEdgeCount(t,!0),s=this.model.getDirectedEdgeCount(t,!1),n=this.model.getValue(t),l="";if(this.multiplicities!=null)for(var r=0;r<this.multiplicities.length;r++){var a=this.multiplicities[r];(a.source&&mxUtils.isNode(n,a.type,a.attr,a.value)&&(e>a.max||e<a.min)||!a.source&&mxUtils.isNode(n,a.type,a.attr,a.value)&&(s>a.max||s<a.min))&&(l+=a.countError+`
`)}return l.length>0?l:null}validateCell(t,e){return null}getBackgroundImage(){return this.backgroundImage}setBackgroundImage(t){this.backgroundImage=t}getFoldingImage(t){if(t!=null&&this.foldingEnabled&&!this.getModel().isEdge(t.cell)){var e=this.isCellCollapsed(t.cell);if(this.isCellFoldable(t.cell,!e))return e?this.collapsedImage:this.expandedImage}return null}convertValueToString(t){var e=this.model.getValue(t);if(e!=null){if(mxUtils.isNode(e))return e.nodeName;if(typeof e.toString=="function")return e.toString()}return""}getLabel(t){var e="";if(this.labelsVisible&&t!=null){var s=this.getCurrentCellStyle(t);mxUtils.getValue(s,mxConstants.STYLE_NOLABEL,!1)||(e=this.convertValueToString(t))}return e}isHtmlLabel(t){return this.isHtmlLabels()}isHtmlLabels(){return this.htmlLabels}setHtmlLabels(t){this.htmlLabels=t}isWrapping(t){return this.getCurrentCellStyle(t)[mxConstants.STYLE_WHITE_SPACE]=="wrap"}isLabelClipped(t){return this.getCurrentCellStyle(t)[mxConstants.STYLE_OVERFLOW]=="hidden"}getTooltip(t,e,s,n){var l=null;if(t!=null){if(t.control!=null&&(e==t.control.node||e.parentNode==t.control.node)&&(l=this.collapseExpandResource,l=mxUtils.htmlEntities(mxResources.get(l)||l).replace(/\\n/g,"<br>")),l==null&&t.overlays!=null&&t.overlays.visit(function(a,o){l==null&&(e==o.node||e.parentNode==o.node)&&(l=o.overlay.toString())}),l==null){var r=this.selectionCellsHandler.getHandler(t.cell);r!=null&&typeof r.getTooltipForNode=="function"&&(l=r.getTooltipForNode(e))}l==null&&(l=this.getTooltipForCell(t.cell))}return l}getTooltipForCell(t){var e=null;return t!=null&&t.getTooltip!=null?e=t.getTooltip():e=this.convertValueToString(t),e}getLinkForCell(t){return null}getCursorForMouseEvent(t){return this.getCursorForCell(t.getCell())}getCursorForCell(t){return null}getStartSize(t,e){var s=new mxRectangle,n=this.getCurrentCellStyle(t,e),l=parseInt(mxUtils.getValue(n,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE));return mxUtils.getValue(n,mxConstants.STYLE_HORIZONTAL,!0)?s.height=l:s.width=l,s}getSwimlaneDirection(t){var e=mxUtils.getValue(t,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_EAST),s=mxUtils.getValue(t,mxConstants.STYLE_FLIPH,0)==1,n=mxUtils.getValue(t,mxConstants.STYLE_FLIPV,0)==1,l=mxUtils.getValue(t,mxConstants.STYLE_HORIZONTAL,!0),r=l?0:3;e==mxConstants.DIRECTION_NORTH?r--:e==mxConstants.DIRECTION_WEST?r+=2:e==mxConstants.DIRECTION_SOUTH&&(r+=1);var a=mxUtils.mod(r,2);return s&&a==1&&(r+=2),n&&a==0&&(r+=2),[mxConstants.DIRECTION_NORTH,mxConstants.DIRECTION_EAST,mxConstants.DIRECTION_SOUTH,mxConstants.DIRECTION_WEST][mxUtils.mod(r,4)]}getActualStartSize(t,e){var s=new mxRectangle;if(this.isSwimlane(t,e)){var n=this.getCurrentCellStyle(t,e),l=parseInt(mxUtils.getValue(n,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE)),r=this.getSwimlaneDirection(n);r==mxConstants.DIRECTION_NORTH?s.y=l:r==mxConstants.DIRECTION_WEST?s.x=l:r==mxConstants.DIRECTION_SOUTH?s.height=l:s.width=l}return s}getImage(t){return t!=null&&t.style!=null?t.style[mxConstants.STYLE_IMAGE]:null}isTransparentState(t){var e=!1;if(t!=null){var s=mxUtils.getValue(t.style,mxConstants.STYLE_STROKECOLOR,mxConstants.NONE),n=mxUtils.getValue(t.style,mxConstants.STYLE_FILLCOLOR,mxConstants.NONE);e=s==mxConstants.NONE&&n==mxConstants.NONE&&this.getImage(t)==null}return e}getVerticalAlign(t){return t!=null&&t.style!=null?t.style[mxConstants.STYLE_VERTICAL_ALIGN]||mxConstants.ALIGN_MIDDLE:null}getIndicatorColor(t){return t!=null&&t.style!=null?t.style[mxConstants.STYLE_INDICATOR_COLOR]:null}getIndicatorGradientColor(t){return t!=null&&t.style!=null?t.style[mxConstants.STYLE_INDICATOR_GRADIENTCOLOR]:null}getIndicatorShape(t){return t!=null&&t.style!=null?t.style[mxConstants.STYLE_INDICATOR_SHAPE]:null}getIndicatorImage(t){return t!=null&&t.style!=null?t.style[mxConstants.STYLE_INDICATOR_IMAGE]:null}getBorder(){return this.border}setBorder(t){this.border=t}isSwimlane(t,e){return t!=null&&this.model.getParent(t)!=this.model.getRoot()&&!this.model.isEdge(t)?this.getCurrentCellStyle(t,e)[mxConstants.STYLE_SHAPE]==mxConstants.SHAPE_SWIMLANE:!1}isResizeContainer(){return this.resizeContainer}setResizeContainer(t){this.resizeContainer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isEscapeEnabled(){return this.escapeEnabled}setEscapeEnabled(t){this.escapeEnabled=t}isInvokesStopCellEditing(){return this.invokesStopCellEditing}setInvokesStopCellEditing(t){this.invokesStopCellEditing=t}isEnterStopsCellEditing(){return this.enterStopsCellEditing}setEnterStopsCellEditing(t){this.enterStopsCellEditing=t}isCellLocked(t){var e=this.model.getGeometry(t);return this.isCellsLocked()||e!=null&&this.model.isVertex(t)&&e.relative}isCellsLocked(){return this.cellsLocked}setCellsLocked(t){this.cellsLocked=t}getCloneableCells(t){return this.model.filterCells(t,e=>this.isCellCloneable(e))}isCellCloneable(t){var e=this.getCurrentCellStyle(t);return this.isCellsCloneable()&&e[mxConstants.STYLE_CLONEABLE]!=0}isCellsCloneable(){return this.cellsCloneable}setCellsCloneable(t){this.cellsCloneable=t}getExportableCells(t){return this.model.filterCells(t,e=>this.canExportCell(e))}canExportCell(t){return this.exportEnabled}getImportableCells(t){return this.model.filterCells(t,e=>this.canImportCell(e))}canImportCell(t){return this.importEnabled}isCellSelectable(t){return this.isCellsSelectable()}isCellsSelectable(){return this.cellsSelectable}setCellsSelectable(t){this.cellsSelectable=t}getDeletableCells(t){return this.model.filterCells(t,e=>this.isCellDeletable(e))}isCellDeletable(t){var e=this.getCurrentCellStyle(t);return this.isCellsDeletable()&&e[mxConstants.STYLE_DELETABLE]!=0}isCellsDeletable(){return this.cellsDeletable}setCellsDeletable(t){this.cellsDeletable=t}isLabelMovable(t){return!this.isCellLocked(t)&&(this.model.isEdge(t)&&this.edgeLabelsMovable||this.model.isVertex(t)&&this.vertexLabelsMovable)}isCellRotatable(t){var e=this.getCurrentCellStyle(t);return e[mxConstants.STYLE_ROTATABLE]!=0}getMovableCells(t){return this.model.filterCells(t,e=>this.isCellMovable(e))}isCellMovable(t){var e=this.getCurrentCellStyle(t);return this.isCellsMovable()&&!this.isCellLocked(t)&&e[mxConstants.STYLE_MOVABLE]!=0}isCellsMovable(){return this.cellsMovable}setCellsMovable(t){this.cellsMovable=t}isGridEnabled(){return this.gridEnabled}setGridEnabled(t){this.gridEnabled=t}isPortsEnabled(){return this.portsEnabled}setPortsEnabled(t){this.portsEnabled=t}getGridSize(){return this.gridSize}setGridSize(t){this.gridSize=t}getTolerance(){return this.tolerance}setTolerance(t){this.tolerance=t}isVertexLabelsMovable(){return this.vertexLabelsMovable}setVertexLabelsMovable(t){this.vertexLabelsMovable=t}isEdgeLabelsMovable(){return this.edgeLabelsMovable}setEdgeLabelsMovable(t){this.edgeLabelsMovable=t}isSwimlaneNesting(){return this.swimlaneNesting}setSwimlaneNesting(t){this.swimlaneNesting=t}isSwimlaneSelectionEnabled(){return this.swimlaneSelectionEnabled}setSwimlaneSelectionEnabled(t){this.swimlaneSelectionEnabled=t}isMultigraph(){return this.multigraph}setMultigraph(t){this.multigraph=t}isAllowLoops(){return this.allowLoops}setAllowDanglingEdges(t){this.allowDanglingEdges=t}isAllowDanglingEdges(){return this.allowDanglingEdges}setConnectableEdges(t){this.connectableEdges=t}isConnectableEdges(){return this.connectableEdges}setCloneInvalidEdges(t){this.cloneInvalidEdges=t}isCloneInvalidEdges(){return this.cloneInvalidEdges}setAllowLoops(t){this.allowLoops=t}isDisconnectOnMove(){return this.disconnectOnMove}setDisconnectOnMove(t){this.disconnectOnMove=t}isDropEnabled(){return this.dropEnabled}setDropEnabled(t){this.dropEnabled=t}isSplitEnabled(){return this.splitEnabled}setSplitEnabled(t){this.splitEnabled=t}isCellResizable(t){var e=this.getCurrentCellStyle(t);return this.isCellsResizable()&&!this.isCellLocked(t)&&mxUtils.getValue(e,mxConstants.STYLE_RESIZABLE,"1")!="0"}isCellsResizable(){return this.cellsResizable}setCellsResizable(t){this.cellsResizable=t}isTerminalPointMovable(t,e){return!0}isCellBendable(t){var e=this.getCurrentCellStyle(t);return this.isCellsBendable()&&!this.isCellLocked(t)&&e[mxConstants.STYLE_BENDABLE]!=0}isCellsBendable(){return this.cellsBendable}setCellsBendable(t){this.cellsBendable=t}isCellEditable(t){var e=this.getCurrentCellStyle(t);return this.isCellsEditable()&&!this.isCellLocked(t)&&e[mxConstants.STYLE_EDITABLE]!=0}isCellsEditable(){return this.cellsEditable}setCellsEditable(t){this.cellsEditable=t}isCellDisconnectable(t,e,s){return this.isCellsDisconnectable()&&!this.isCellLocked(t)}isCellsDisconnectable(){return this.cellsDisconnectable}setCellsDisconnectable(t){this.cellsDisconnectable=t}isValidSource(t){return t==null&&this.allowDanglingEdges||t!=null&&(!this.model.isEdge(t)||this.connectableEdges)&&this.isCellConnectable(t)}isValidTarget(t){return this.isValidSource(t)}isValidConnection(t,e){return this.isValidSource(t)&&this.isValidTarget(e)}setConnectable(t){this.connectionHandler.setEnabled(t)}isConnectable(){return this.connectionHandler.isEnabled()}setTooltips(t){this.tooltipHandler.setEnabled(t)}setPanning(t){this.panningHandler.panningEnabled=t}isEditing(t){if(this.cellEditor!=null){var e=this.cellEditor.getEditingCell();return t==null?e!=null:t==e}return!1}isAutoSizeCell(t){var e=this.getCurrentCellStyle(t);return this.isAutoSizeCells()||e[mxConstants.STYLE_AUTOSIZE]==1}isAutoSizeCells(){return this.autoSizeCells}setAutoSizeCells(t){this.autoSizeCells=t}isExtendParent(t){return!this.getModel().isEdge(t)&&this.isExtendParents()}isExtendParents(){return this.extendParents}setExtendParents(t){this.extendParents=t}isExtendParentsOnAdd(t){return this.extendParentsOnAdd}setExtendParentsOnAdd(t){this.extendParentsOnAdd=t}isExtendParentsOnMove(){return this.extendParentsOnMove}setExtendParentsOnMove(t){this.extendParentsOnMove=t}isRecursiveResize(t){return this.recursiveResize}setRecursiveResize(t){this.recursiveResize=t}isConstrainChild(t){return this.isConstrainChildren()&&!this.getModel().isEdge(this.getModel().getParent(t))}isConstrainChildren(){return this.constrainChildren}setConstrainChildren(t){this.constrainChildren=t}isConstrainRelativeChildren(){return this.constrainRelativeChildren}setConstrainRelativeChildren(t){this.constrainRelativeChildren=t}isAllowNegativeCoordinates(){return this.allowNegativeCoordinates}setAllowNegativeCoordinates(t){this.allowNegativeCoordinates=t}getOverlap(t){return this.isAllowOverlapParent(t)?this.defaultOverlap:0}isAllowOverlapParent(t){return!1}getFoldableCells(t,e){return this.model.filterCells(t,s=>this.isCellFoldable(s,e))}isCellFoldable(t,e){var s=this.getCurrentCellStyle(t);return this.model.getChildCount(t)>0&&s[mxConstants.STYLE_FOLDABLE]!=0}isValidDropTarget(t,e,s){return t!=null&&(this.isSplitEnabled()&&this.isSplitTarget(t,e,s)||!this.model.isEdge(t)&&(this.isSwimlane(t)||this.model.getChildCount(t)>0&&!this.isCellCollapsed(t)))}isSplitTarget(t,e,s){if(this.model.isEdge(t)&&e!=null&&e.length==1&&this.isCellConnectable(e[0])&&this.getEdgeValidationError(t,this.model.getTerminal(t,!0),e[0])==null){var n=this.model.getTerminal(t,!0),l=this.model.getTerminal(t,!1);return!this.model.isAncestor(e[0],n)&&!this.model.isAncestor(e[0],l)}return!1}getDropTarget(t,e,s,n){if(!this.isSwimlaneNesting()){for(var l=0;l<t.length;l++)if(this.isSwimlane(t[l]))return null}var r=mxUtils.convertPoint(this.container,mxEvent.getClientX(e),mxEvent.getClientY(e));r.x-=this.panDx,r.y-=this.panDy;var a=this.getSwimlaneAt(r.x,r.y);if(s==null)s=a;else if(a!=null){for(var o=this.model.getParent(a);o!=null&&this.isSwimlane(o)&&o!=s;)o=this.model.getParent(o);o==s&&(s=a)}for(;s!=null&&!this.isValidDropTarget(s,t,e)&&!this.model.isLayer(s);)s=this.model.getParent(s);if(n==null||!n)for(var h=s;h!=null&&mxUtils.indexOf(t,h)<0;)h=this.model.getParent(h);return!this.model.isLayer(s)&&h==null?s:null}getDefaultParent(){var t=this.getCurrentRoot();if(t==null&&(t=this.defaultParent,t==null)){var e=this.model.getRoot();t=this.model.getChildAt(e,0)}return t}setDefaultParent(t){this.defaultParent=t}getSwimlane(t){for(;t!=null&&!this.isSwimlane(t);)t=this.model.getParent(t);return t}getSwimlaneAt(t,e,s){if(s==null&&(s=this.getCurrentRoot(),s==null&&(s=this.model.getRoot())),s!=null)for(var n=this.model.getChildCount(s),l=0;l<n;l++){var r=this.model.getChildAt(s,l);if(r!=null){var a=this.getSwimlaneAt(t,e,r);if(a!=null)return a;if(this.isCellVisible(r)&&this.isSwimlane(r)){var o=this.view.getState(r);if(this.intersects(o,t,e))return r}}}return null}getCellAt(t,e,s,n,l,r){if(n=n??!0,l=l??!0,s==null&&(s=this.getCurrentRoot(),s==null&&(s=this.getModel().getRoot())),s!=null)for(var a=this.model.getChildCount(s),o=a-1;o>=0;o--){var h=this.model.getChildAt(s,o),d=this.getCellAt(t,e,h,n,l,r);if(d!=null)return d;if(this.isCellVisible(h)&&(l&&this.model.isEdge(h)||n&&this.model.isVertex(h))){var g=this.view.getState(h);if(g!=null&&(r==null||!r(g,t,e))&&this.intersects(g,t,e))return h}}return null}intersects(t,e,s){if(t!=null){var n=t.absolutePoints;if(n!=null)for(var l=this.tolerance*this.tolerance,r=n[0],a=1;a<n.length;a++){var o=n[a],h=mxUtils.ptSegDistSq(r.x,r.y,o.x,o.y,e,s);if(h<=l)return!0;r=o}else{var d=mxUtils.toRadians(mxUtils.getValue(t.style,mxConstants.STYLE_ROTATION)||0);if(d!=0){var g=Math.cos(-d),m=Math.sin(-d),f=new mxPoint(t.getCenterX(),t.getCenterY()),r=mxUtils.getRotatedPoint(new mxPoint(e,s),g,m,f);e=r.x,s=r.y}if(mxUtils.contains(t,e,s))return!0}}return!1}hitsSwimlaneContent(t,e,s){var n=this.getView().getState(t),l=this.getStartSize(t);if(n!=null){var r=this.getView().getScale();if(e-=n.x,s-=n.y,l.width>0&&e>0&&e>l.width*r)return!0;if(l.height>0&&s>0&&s>l.height*r)return!0}return!1}getChildVertices(t){return this.getChildCells(t,!0,!1)}getChildEdges(t){return this.getChildCells(t,!1,!0)}getChildCells(t,e,s){t=t??this.getDefaultParent(),e=e??!1,s=s??!1;for(var n=this.model.getChildCells(t,e,s),l=[],r=0;r<n.length;r++)this.isCellVisible(n[r])&&l.push(n[r]);return l}getConnections(t,e){return this.getEdges(t,e,!0,!0,!1)}getIncomingEdges(t,e){return this.getEdges(t,e,!0,!1,!1)}getOutgoingEdges(t,e){return this.getEdges(t,e,!1,!0,!1)}getEdges(t,e,s,n,l,r){s=s??!0,n=n??!0,l=l??!0,r=r??!1;for(var a=[],o=this.isCellCollapsed(t),h=this.model.getChildCount(t),d=0;d<h;d++){var g=this.model.getChildAt(t,d);(o||!this.isCellVisible(g))&&(a=a.concat(this.model.getEdges(g,s,n)))}a=a.concat(this.model.getEdges(t,s,n));for(var m=[],d=0;d<a.length;d++){var f=this.view.getState(a[d]),c=f!=null?f.getVisibleTerminal(!0):this.view.getVisibleTerminal(a[d],!0),x=f!=null?f.getVisibleTerminal(!1):this.view.getVisibleTerminal(a[d],!1);(l&&c==x||c!=x&&(s&&x==t&&(e==null||this.isValidAncestor(c,e,r))||n&&c==t&&(e==null||this.isValidAncestor(x,e,r))))&&m.push(a[d])}return m}isValidAncestor(t,e,s){return s?this.model.isAncestor(e,t):this.model.getParent(t)==e}getOpposites(t,e,s,n){s=s??!0,n=n??!0;var l=[],r=new mxDictionary;if(t!=null)for(var a=0;a<t.length;a++){var o=this.view.getState(t[a]),h=o!=null?o.getVisibleTerminal(!0):this.view.getVisibleTerminal(t[a],!0),d=o!=null?o.getVisibleTerminal(!1):this.view.getVisibleTerminal(t[a],!1);h==e&&d!=null&&d!=e&&n?r.get(d)||(r.put(d,!0),l.push(d)):d==e&&h!=null&&h!=e&&s&&(r.get(h)||(r.put(h,!0),l.push(h)))}return l}getEdgesBetween(t,e,s){s=s??!1;for(var n=this.getEdges(t),l=[],r=0;r<n.length;r++){var a=this.view.getState(n[r]),o=a!=null?a.getVisibleTerminal(!0):this.view.getVisibleTerminal(n[r],!0),h=a!=null?a.getVisibleTerminal(!1):this.view.getVisibleTerminal(n[r],!1);(o==t&&h==e||!s&&o==e&&h==t)&&l.push(n[r])}return l}getPointForEvent(t,e){var s=mxUtils.convertPoint(this.container,mxEvent.getClientX(t),mxEvent.getClientY(t)),n=this.view.scale,l=this.view.translate,r=e!=!1?this.gridSize/2:0;return s.x=this.snap(s.x/n-l.x-r),s.y=this.snap(s.y/n-l.y-r),s}getCells(t,e,s,n,l,r){if(r=r??[],s>0||n>0){var a=this.getModel(),o=t+s,h=e+n;if(l==null&&(l=this.getCurrentRoot(),l==null&&(l=a.getRoot())),l!=null)for(var d=a.getChildCount(l),g=0;g<d;g++){var m=a.getChildAt(l,g),f=this.view.getState(m);if(f!=null&&this.isCellVisible(m)){var c=mxUtils.getValue(f.style,mxConstants.STYLE_ROTATION)||0,x=f;c!=0&&(x=mxUtils.getBoundingBox(x,c)),(a.isEdge(m)||a.isVertex(m))&&x.x>=t&&x.y+x.height<=h&&x.y>=e&&x.x+x.width<=o?r.push(m):this.getCells(t,e,s,n,m,r)}}}return r}getCellsBeyond(t,e,s,n,l){var r=[];if((n||l)&&(s==null&&(s=this.getDefaultParent()),s!=null))for(var a=this.model.getChildCount(s),o=0;o<a;o++){var h=this.model.getChildAt(s,o),d=this.view.getState(h);this.isCellVisible(h)&&d!=null&&(!n||d.x>=t)&&(!l||d.y>=e)&&r.push(h)}return r}findTreeRoots(t,e,s){e=e??!1,s=s??!1;var n=[];if(t!=null){for(var l=this.getModel(),r=l.getChildCount(t),a=null,o=0,h=0;h<r;h++){var d=l.getChildAt(t,h);if(this.model.isVertex(d)&&this.isCellVisible(d)){for(var g=this.getConnections(d,e?t:null),m=0,f=0,c=0;c<g.length;c++){var x=this.view.getVisibleTerminal(g[c],!0);x==d?m++:f++}(s&&m==0&&f>0||!s&&f==0&&m>0)&&n.push(d);var p=s?f-m:m-f;p>o&&(o=p,a=d)}}n.length==0&&a!=null&&n.push(a)}return n}traverse(t,e,s,n,l,r){if(s!=null&&t!=null&&(e=e??!0,r=r??!1,l=l||new mxDictionary,!l.get(t))){l.put(t,!0);var a=s(t,n);if(a==null||a){var o=this.model.getEdgeCount(t);if(o>0)for(var h=0;h<o;h++){var d=this.model.getEdgeAt(t,h),g=this.model.getTerminal(d,!0)==t;if(!e||!r==g){var m=this.model.getTerminal(d,!g);this.traverse(m,e,s,d,l,r)}}}}}isCellSelected(t){return this.getSelectionModel().isSelected(t)}isSelectionEmpty(){return this.getSelectionModel().isEmpty()}clearSelection(){return this.getSelectionModel().clear()}getSelectionCount(){return this.getSelectionModel().cells.length}getSelectionCell(){return this.getSelectionModel().cells[0]}getSelectionCells(){return this.getSelectionModel().cells.slice()}setSelectionCell(t){this.getSelectionModel().setCell(t)}setSelectionCells(t){this.getSelectionModel().setCells(t)}addSelectionCell(t){this.getSelectionModel().addCell(t)}addSelectionCells(t){this.getSelectionModel().addCells(t)}removeSelectionCell(t){this.getSelectionModel().removeCell(t)}removeSelectionCells(t){this.getSelectionModel().removeCells(t)}selectRegion(t,e){var s=this.getCells(t.x,t.y,t.width,t.height);return this.selectCellsForEvent(s,e),s}selectNextCell(){this.selectCell(!0)}selectPreviousCell(){this.selectCell()}selectParentCell(){this.selectCell(!1,!0)}selectChildCell(){this.selectCell(!1,!1,!0)}selectCell(t,e,s){var n=this.selectionModel,l=n.cells.length>0?n.cells[0]:null;n.cells.length>1&&n.clear();var r=l!=null?this.model.getParent(l):this.getDefaultParent(),a=this.model.getChildCount(r);if(l==null&&a>0){var o=this.model.getChildAt(r,0);this.setSelectionCell(o)}else if((l==null||e)&&this.view.getState(r)!=null&&this.model.getGeometry(r)!=null)this.getCurrentRoot()!=r&&this.setSelectionCell(r);else if(l!=null&&s){var h=this.model.getChildCount(l);if(h>0){var o=this.model.getChildAt(l,0);this.setSelectionCell(o)}}else if(a>0){var d=r.getIndex(l);if(t){d++;var o=this.model.getChildAt(r,d%a);this.setSelectionCell(o)}else{d--;var g=d<0?a-1:d,o=this.model.getChildAt(r,g);this.setSelectionCell(o)}}}selectAll(t,e){t=t||this.getDefaultParent();var s=e?this.model.filterDescendants(n=>n!=t&&this.view.getState(n)!=null,t):this.model.getChildren(t);s!=null&&this.setSelectionCells(s)}selectVertices(t,e){this.selectCells(!0,!1,t,e)}selectEdges(t){this.selectCells(!1,!0,t)}selectCells(t,e,s,n){s=s||this.getDefaultParent();var l=a=>this.view.getState(a)!=null&&((n||this.model.getChildCount(a)==0)&&this.model.isVertex(a)&&t&&!this.model.isEdge(this.model.getParent(a))||this.model.isEdge(a)&&e),r=this.model.filterDescendants(l,s);r!=null&&this.setSelectionCells(r)}selectCellForEvent(t,e){var s=this.isCellSelected(t);this.isToggleEvent(e)?s?this.removeSelectionCell(t):this.addSelectionCell(t):(!s||this.getSelectionCount()!=1)&&this.setSelectionCell(t)}selectCellsForEvent(t,e){this.isToggleEvent(e)?this.addSelectionCells(t):this.setSelectionCells(t)}createHandler(t){var e=null;if(t!=null)if(this.model.isEdge(t.cell)){var s=t.getVisibleTerminalState(!0),n=t.getVisibleTerminalState(!1),l=this.getCellGeometry(t.cell),r=this.view.getEdgeStyle(t,l!=null?l.points:null,s,n);e=this.createEdgeHandler(t,r)}else e=this.createVertexHandler(t);return e}createVertexHandler(t){return new mxVertexHandler(t)}createEdgeHandler(t,e){var s=null;return e==mxEdgeStyle.Loop||e==mxEdgeStyle.ElbowConnector||e==mxEdgeStyle.SideToSide||e==mxEdgeStyle.TopToBottom?s=this.createElbowEdgeHandler(t):e==mxEdgeStyle.SegmentConnector||e==mxEdgeStyle.OrthConnector?s=this.createEdgeSegmentHandler(t):s=new mxEdgeHandler(t),s}createEdgeSegmentHandler(t){return new mxEdgeSegmentHandler(t)}createElbowEdgeHandler(t){return new mxElbowEdgeHandler(t)}addMouseListener(t){this.mouseListeners==null&&(this.mouseListeners=[]),this.mouseListeners.push(t)}removeMouseListener(t){if(this.mouseListeners!=null){for(var e=0;e<this.mouseListeners.length;e++)if(this.mouseListeners[e]==t){this.mouseListeners.splice(e,1);break}}}updateMouseEvent(t,e){if(t.graphX==null||t.graphY==null){var s=mxUtils.convertPoint(this.container,t.getX(),t.getY());t.graphX=s.x-this.panDx,t.graphY=s.y-this.panDy,t.getCell()==null&&this.isMouseDown&&e==mxEvent.MOUSE_MOVE&&(t.state=this.view.getState(this.getCellAt(s.x,s.y,null,null,null,function(n){return n.shape==null||n.shape.paintBackground!=mxRectangleShape.prototype.paintBackground||mxUtils.getValue(n.style,mxConstants.STYLE_POINTER_EVENTS,"1")=="1"||n.shape.fill!=null&&n.shape.fill!=mxConstants.NONE})))}return t}getStateForTouchEvent(t){var e=mxEvent.getClientX(t),s=mxEvent.getClientY(t),n=mxUtils.convertPoint(this.container,e,s);return this.view.getState(this.getCellAt(n.x,n.y))}isEventIgnored(t,e,s){var n=mxEvent.isMouseEvent(e.getEvent()),l=!1;return e.getEvent()==this.lastEvent?l=!0:this.lastEvent=e.getEvent(),this.eventSource!=null&&t!=mxEvent.MOUSE_MOVE?(mxEvent.removeGestureListeners(this.eventSource,null,this.mouseMoveRedirect,this.mouseUpRedirect),this.mouseMoveRedirect=null,this.mouseUpRedirect=null,this.eventSource=null):!mxClient.IS_GC&&this.eventSource!=null&&e.getSource()!=this.eventSource?l=!0:mxClient.IS_TOUCH&&t==mxEvent.MOUSE_DOWN&&!n&&!mxEvent.isPenEvent(e.getEvent())&&(this.eventSource=e.getSource(),this.mouseMoveRedirect=r=>{this.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(r,this.getStateForTouchEvent(r)))},this.mouseUpRedirect=r=>{this.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(r,this.getStateForTouchEvent(r)))},mxEvent.addGestureListeners(this.eventSource,null,this.mouseMoveRedirect,this.mouseUpRedirect)),this.isSyntheticEventIgnored(t,e,s)&&(l=!0),!mxEvent.isPopupTrigger(this.lastEvent)&&t!=mxEvent.MOUSE_MOVE&&this.lastEvent.detail==2?!0:(t==mxEvent.MOUSE_UP&&this.isMouseDown?this.isMouseDown=!1:t==mxEvent.MOUSE_DOWN&&!this.isMouseDown?(this.isMouseDown=!0,this.isMouseTrigger=n):!l&&((!mxClient.IS_FF||t!=mxEvent.MOUSE_MOVE)&&this.isMouseDown&&this.isMouseTrigger!=n||t==mxEvent.MOUSE_DOWN&&this.isMouseDown||t==mxEvent.MOUSE_UP&&!this.isMouseDown)&&(l=!0),!l&&t==mxEvent.MOUSE_DOWN&&(this.lastMouseX=e.getX(),this.lastMouseY=e.getY()),l)}isSyntheticEventIgnored(t,e,s){var n=!1,l=mxEvent.isMouseEvent(e.getEvent());return this.ignoreMouseEvents&&l&&t!=mxEvent.MOUSE_MOVE?(this.ignoreMouseEvents=t!=mxEvent.MOUSE_UP,n=!0):mxClient.IS_FF&&!l&&t==mxEvent.MOUSE_UP&&(this.ignoreMouseEvents=!0),n}isEventSourceIgnored(t,e){var s=e.getSource(),n=s.nodeName!=null?s.nodeName.toLowerCase():"",l=!mxEvent.isMouseEvent(e.getEvent())||mxEvent.isLeftMouseButton(e.getEvent());return t==mxEvent.MOUSE_DOWN&&l&&(n=="select"||n=="option"||n=="input"&&s.type!="checkbox"&&s.type!="radio"&&s.type!="button"&&s.type!="submit"&&s.type!="file")}getEventState(t){return t}fireMouseEvent(t,e,s){if(this.isEventSourceIgnored(t,e)){this.tooltipHandler!=null&&this.tooltipHandler.hide();return}if(s==null&&(s=this),e=this.updateMouseEvent(e,t),!this.nativeDblClickEnabled&&!mxEvent.isPopupTrigger(e.getEvent())||this.doubleTapEnabled&&mxClient.IS_TOUCH&&(mxEvent.isTouchEvent(e.getEvent())||mxEvent.isPenEvent(e.getEvent()))){var n=new Date().getTime();if(!mxClient.IS_QUIRKS&&t==mxEvent.MOUSE_DOWN||mxClient.IS_QUIRKS&&t==mxEvent.MOUSE_UP&&!this.fireDoubleClick)if(this.lastTouchEvent!=null&&this.lastTouchEvent!=e.getEvent()&&n-this.lastTouchTime<this.doubleTapTimeout&&Math.abs(this.lastTouchX-e.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-e.getY())<this.doubleTapTolerance&&this.doubleClickCounter<2){this.doubleClickCounter++;var l=!1;if(t==mxEvent.MOUSE_UP){if(e.getCell()==this.lastTouchCell&&this.lastTouchCell!=null){this.lastTouchTime=0;var r=this.lastTouchCell;this.lastTouchCell=null,mxClient.IS_QUIRKS&&e.getSource().fireEvent("ondblclick"),this.dblClick(e.getEvent(),r),l=!0}}else this.fireDoubleClick=!0,this.lastTouchTime=0;if(!mxClient.IS_QUIRKS||l){mxEvent.consume(e.getEvent());return}}else(this.lastTouchEvent==null||this.lastTouchEvent!=e.getEvent())&&(this.lastTouchCell=e.getCell(),this.lastTouchX=e.getX(),this.lastTouchY=e.getY(),this.lastTouchTime=n,this.lastTouchEvent=e.getEvent(),this.doubleClickCounter=0);else if((this.isMouseDown||t==mxEvent.MOUSE_UP)&&this.fireDoubleClick){this.fireDoubleClick=!1;var r=this.lastTouchCell;this.lastTouchCell=null,this.isMouseDown=!1;var a=r!=null||(mxEvent.isTouchEvent(e.getEvent())||mxEvent.isPenEvent(e.getEvent()))&&(mxClient.IS_GC||mxClient.IS_SF);a&&Math.abs(this.lastTouchX-e.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-e.getY())<this.doubleTapTolerance?this.dblClick(e.getEvent(),r):mxEvent.consume(e.getEvent());return}}if(!this.isEventIgnored(t,e,s)){if(e.state=this.getEventState(e.getState()),this.fireEvent(new mxEventObject(mxEvent.FIRE_MOUSE_EVENT,"eventName",t,"event",e)),mxClient.IS_OP||mxClient.IS_SF||mxClient.IS_GC||mxClient.IS_IE11||e.getEvent().target!=this.container){if(t==mxEvent.MOUSE_MOVE&&this.isMouseDown&&this.autoScroll&&!mxEvent.isMultiTouchEvent(e.getEvent))this.scrollPointToVisible(e.getGraphX(),e.getGraphY(),this.autoExtend);else if(t==mxEvent.MOUSE_UP&&this.ignoreScrollbars&&this.translateToScrollPosition&&(this.container.scrollLeft!=0||this.container.scrollTop!=0)){var o=this.view.scale,h=this.view.translate;this.view.setTranslate(h.x-this.container.scrollLeft/o,h.y-this.container.scrollTop/o),this.container.scrollLeft=0,this.container.scrollTop=0}if(this.mouseListeners!=null){var d=[s,e];e.getEvent().preventDefault||(e.getEvent().returnValue=!0);for(var g=0;g<this.mouseListeners.length;g++){var m=this.mouseListeners[g];t==mxEvent.MOUSE_DOWN?m.mouseDown.apply(m,d):t==mxEvent.MOUSE_MOVE?m.mouseMove.apply(m,d):t==mxEvent.MOUSE_UP&&m.mouseUp.apply(m,d)}}t==mxEvent.MOUSE_UP&&this.click(e)}if((mxEvent.isTouchEvent(e.getEvent())||mxEvent.isPenEvent(e.getEvent()))&&t==mxEvent.MOUSE_DOWN&&this.tapAndHoldEnabled&&!this.tapAndHoldInProgress){this.tapAndHoldInProgress=!0,this.initialTouchX=e.getGraphX(),this.initialTouchY=e.getGraphY();var f=function(){this.tapAndHoldValid&&this.tapAndHold(e),this.tapAndHoldInProgress=!1,this.tapAndHoldValid=!1};this.tapAndHoldThread&&window.clearTimeout(this.tapAndHoldThread),this.tapAndHoldThread=window.setTimeout(mxUtils.bind(this,f),this.tapAndHoldDelay),this.tapAndHoldValid=!0}else t==mxEvent.MOUSE_UP?(this.tapAndHoldInProgress=!1,this.tapAndHoldValid=!1):this.tapAndHoldValid&&(this.tapAndHoldValid=Math.abs(this.initialTouchX-e.getGraphX())<this.tolerance&&Math.abs(this.initialTouchY-e.getGraphY())<this.tolerance);t==mxEvent.MOUSE_DOWN&&this.isEditing()&&!this.cellEditor.isEventSource(e.getEvent())&&this.stopEditing(!this.isInvokesStopCellEditing()),this.consumeMouseEvent(t,e,s)}}consumeMouseEvent(t,e,s){t==mxEvent.MOUSE_DOWN&&mxEvent.isTouchEvent(e.getEvent())&&e.consume(!1)}fireGestureEvent(t,e){this.lastTouchTime=0,this.fireEvent(new mxEventObject(mxEvent.GESTURE,"event",t,"cell",e))}destroy(){this.destroyed||(this.destroyed=!0,this.tooltipHandler!=null&&this.tooltipHandler.destroy(),this.selectionCellsHandler!=null&&this.selectionCellsHandler.destroy(),this.panningHandler!=null&&this.panningHandler.destroy(),this.popupMenuHandler!=null&&this.popupMenuHandler.destroy(),this.connectionHandler!=null&&this.connectionHandler.destroy(),this.graphHandler!=null&&this.graphHandler.destroy(),this.cellEditor!=null&&this.cellEditor.destroy(),this.view!=null&&this.view.destroy(),this.model!=null&&this.graphModelChangeListener!=null&&(this.model.removeListener(this.graphModelChangeListener),this.graphModelChangeListener=null),this.container=null)}}class mxOutline{constructor(i,t){u(this,"outline",null);u(this,"graphRenderHint",mxConstants.RENDERING_HINT_FASTER);u(this,"enabled",!0);u(this,"showViewport",!0);u(this,"border",10);u(this,"sizerSize",8);u(this,"labelsVisible",!1);u(this,"updateOnPan",!1);u(this,"sizerImage",null);u(this,"minScale",1e-4);u(this,"suspended",!1);u(this,"forceVmlHandles",document.documentMode==8);this.source=i,t!=null&&this.init(t)}createGraph(i){var t=new mxGraph(i,this.source.getModel(),this.graphRenderHint,this.source.getStylesheet());return t.foldingEnabled=!1,t.autoScroll=!1,t}init(i){this.outline=this.createGraph(i);var t=this.outline.graphModelChanged;if(this.outline.graphModelChanged=l=>{!this.suspended&&this.outline!=null&&t.apply(this.outline,arguments)},mxClient.IS_SVG){var e=this.outline.getView().getCanvas().parentNode;e.setAttribute("shape-rendering","optimizeSpeed"),e.setAttribute("image-rendering","optimizeSpeed")}this.outline.labelsVisible=this.labelsVisible,this.outline.setEnabled(!1),this.updateHandler=(l,r)=>{!this.suspended&&!this.active&&this.update()},this.source.getModel().addListener(mxEvent.CHANGE,this.updateHandler),this.outline.addMouseListener(this);var s=this.source.getView();s.addListener(mxEvent.SCALE,this.updateHandler),s.addListener(mxEvent.TRANSLATE,this.updateHandler),s.addListener(mxEvent.SCALE_AND_TRANSLATE,this.updateHandler),s.addListener(mxEvent.DOWN,this.updateHandler),s.addListener(mxEvent.UP,this.updateHandler),mxEvent.addListener(this.source.container,"scroll",this.updateHandler),this.panHandler=l=>{this.updateOnPan&&this.updateHandler.apply(this,arguments)},this.source.addListener(mxEvent.PAN,this.panHandler),this.refreshHandler=l=>{this.outline.setStylesheet(this.source.getStylesheet()),this.outline.refresh()},this.source.addListener(mxEvent.REFRESH,this.refreshHandler),this.bounds=new mxRectangle(0,0,0,0),this.selectionBorder=new mxRectangleShape(this.bounds,null,mxConstants.OUTLINE_COLOR,mxConstants.OUTLINE_STROKEWIDTH),this.selectionBorder.dialect=this.outline.dialect,this.forceVmlHandles&&(this.selectionBorder.isHtmlAllowed=function(){return!1}),this.selectionBorder.init(this.outline.getView().getOverlayPane());var n=l=>{var r=mxEvent.getSource(l),a=h=>{this.outline.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(h))},o=h=>{mxEvent.removeGestureListeners(r,null,a,o),this.outline.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(h))};mxEvent.addGestureListeners(r,null,a,o),this.outline.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(l))};mxEvent.addGestureListeners(this.selectionBorder.node,n),this.sizer=this.createSizer(),this.forceVmlHandles&&(this.sizer.isHtmlAllowed=function(){return!1}),this.sizer.init(this.outline.getView().getOverlayPane()),this.enabled&&(this.sizer.node.style.cursor="nwse-resize"),mxEvent.addGestureListeners(this.sizer.node,n),this.selectionBorder.node.style.display=this.showViewport?"":"none",this.sizer.node.style.display=this.selectionBorder.node.style.display,this.selectionBorder.node.style.cursor="move",this.update(!1)}isEnabled(){return this.enabled}setEnabled(i){this.enabled=i}setZoomEnabled(i){this.sizer.node.style.visibility=i?"visible":"hidden"}refresh(){this.update(!0)}createSizer(){if(this.sizerImage!=null){var i=new mxImageShape(new mxRectangle(0,0,this.sizerImage.width,this.sizerImage.height),this.sizerImage.src);return i.dialect=this.outline.dialect,i}else{var i=new mxRectangleShape(new mxRectangle(0,0,this.sizerSize,this.sizerSize),mxConstants.OUTLINE_HANDLE_FILLCOLOR,mxConstants.OUTLINE_HANDLE_STROKECOLOR);return i.dialect=this.outline.dialect,i}}getSourceContainerSize(){return new mxRectangle(0,0,this.source.container.scrollWidth,this.source.container.scrollHeight)}getOutlineOffset(i){return null}getSourceGraphBounds(){return this.source.getGraphBounds()}update(i){if(this.source!=null&&this.source.container!=null&&this.outline!=null&&this.outline.container!=null){var t=this.source.view.scale,e=this.getSourceGraphBounds(),s=new mxRectangle(e.x/t+this.source.panDx,e.y/t+this.source.panDy,e.width/t,e.height/t),n=new mxRectangle(0,0,this.source.container.clientWidth/t,this.source.container.clientHeight/t),l=s.clone();l.add(n);var r=this.getSourceContainerSize(),a=Math.max(r.width/t,l.width),o=Math.max(r.height/t,l.height),h=Math.max(0,this.outline.container.clientWidth-this.border),d=Math.max(0,this.outline.container.clientHeight-this.border),g=Math.min(h/a,d/o),m=isNaN(g)?this.minScale:Math.max(this.minScale,g);if(m>0){this.outline.getView().scale!=m&&(this.outline.getView().scale=m,i=!0);var f=this.outline.getView();f.currentRoot!=this.source.getView().currentRoot&&f.setCurrentRoot(this.source.getView().currentRoot);var c=this.source.view.translate,x=c.x+this.source.panDx,p=c.y+this.source.panDy,C=this.getOutlineOffset(m);C!=null&&(x+=C.x,p+=C.y),s.x<0&&(x=x-s.x),s.y<0&&(p=p-s.y),(f.translate.x!=x||f.translate.y!=p)&&(f.translate.x=x,f.translate.y=p,i=!0);var E=f.translate;m=this.source.getView().scale;var T=m/f.scale,S=1/f.scale,y=this.source.container;this.bounds=new mxRectangle((E.x-c.x-this.source.panDx)/S,(E.y-c.y-this.source.panDy)/S,y.clientWidth/T,y.clientHeight/T),this.bounds.x+=this.source.container.scrollLeft*f.scale/m,this.bounds.y+=this.source.container.scrollTop*f.scale/m;var b=this.selectionBorder.bounds;(b.x!=this.bounds.x||b.y!=this.bounds.y||b.width!=this.bounds.width||b.height!=this.bounds.height)&&(this.selectionBorder.bounds=this.bounds,this.selectionBorder.redraw());var b=this.sizer.bounds,w=new mxRectangle(this.bounds.x+this.bounds.width-b.width/2,this.bounds.y+this.bounds.height-b.height/2,b.width,b.height);(b.x!=w.x||b.y!=w.y||b.width!=w.width||b.height!=w.height)&&(this.sizer.bounds=w,this.sizer.node.style.visibility!="hidden"&&this.sizer.redraw()),i&&this.outline.view.revalidate()}}}mouseDown(i,t){if(this.enabled&&this.showViewport){var e=mxEvent.isMouseEvent(t.getEvent())?0:this.source.tolerance,s=this.source.allowHandleBoundsCheck&&e>0?new mxRectangle(t.getGraphX()-e,t.getGraphY()-e,2*e,2*e):null;this.zoom=t.isSource(this.sizer)||s!=null&&mxUtils.intersects(shape.bounds,s),this.startX=t.getX(),this.startY=t.getY(),this.active=!0,this.source.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.source.container)?(this.dx0=this.source.container.scrollLeft,this.dy0=this.source.container.scrollTop):(this.dx0=0,this.dy0=0)}t.consume()}mouseMove(i,t){if(this.active){this.selectionBorder.node.style.display=this.showViewport?"":"none",this.sizer.node.style.display=this.selectionBorder.node.style.display;var e=this.getTranslateForEvent(t),s=e.x,n=e.y,l=null;if(this.zoom){var a=this.source.container,o=a.clientWidth/a.clientHeight;n=s/o,l=new mxRectangle(this.bounds.x,this.bounds.y,Math.max(1,this.bounds.width+s),Math.max(1,this.bounds.height+n)),this.selectionBorder.bounds=l,this.selectionBorder.redraw()}else{var r=this.outline.getView().scale;l=new mxRectangle(this.bounds.x+s,this.bounds.y+n,this.bounds.width,this.bounds.height),this.selectionBorder.bounds=l,this.selectionBorder.redraw(),s/=r,s*=this.source.getView().scale,n/=r,n*=this.source.getView().scale,this.source.panGraph(-s-this.dx0,-n-this.dy0)}var h=this.sizer.bounds;this.sizer.bounds=new mxRectangle(l.x+l.width-h.width/2,l.y+l.height-h.height/2,h.width,h.height),this.sizer.node.style.visibility!="hidden"&&this.sizer.redraw(),t.consume()}}getTranslateForEvent(i){return new mxPoint(i.getX()-this.startX,i.getY()-this.startY)}mouseUp(i,t){if(this.active){var e=this.getTranslateForEvent(t),s=e.x,n=e.y;if(Math.abs(s)>0||Math.abs(n)>0){if(this.zoom){var r=this.selectionBorder.bounds.width,a=this.source.getView().scale;this.source.zoomTo(Math.max(this.minScale,a-s*a/r),!1)}else if(!this.source.useScrollbarsForPanning||!mxUtils.hasScrollbars(this.source.container)){this.source.panGraph(0,0),s/=this.outline.getView().scale,n/=this.outline.getView().scale;var l=this.source.getView().translate;this.source.getView().setTranslate(l.x-s,l.y-n)}this.update(),t.consume()}this.index=null,this.active=!1}}destroy(){this.source!=null&&(this.source.removeListener(this.panHandler),this.source.removeListener(this.refreshHandler),this.source.getModel().removeListener(this.updateHandler),this.source.getView().removeListener(this.updateHandler),mxEvent.removeListener(this.source.container,"scroll",this.updateHandler),this.source=null),this.outline!=null&&(this.outline.removeMouseListener(this),this.outline.destroy(),this.outline=null),this.selectionBorder!=null&&(this.selectionBorder.destroy(),this.selectionBorder=null),this.sizer!=null&&(this.sizer.destroy(),this.sizer=null)}}class mxForm{constructor(i){this.table=document.createElement("table"),this.table.className=i,this.body=document.createElement("tbody"),this.table.appendChild(this.body)}getTable(){return this.table}addButtons(i,t){var e=document.createElement("tr"),s=document.createElement("td");e.appendChild(s),s=document.createElement("td");var n=document.createElement("button");mxUtils.write(n,mxResources.get("ok")||"OK"),s.appendChild(n),mxEvent.addListener(n,"click",function(){i()}),n=document.createElement("button"),mxUtils.write(n,mxResources.get("cancel")||"Cancel"),s.appendChild(n),mxEvent.addListener(n,"click",function(){t()}),e.appendChild(s),this.body.appendChild(e)}addText(i,t,e){var s=document.createElement("input");return s.setAttribute("type",e||"text"),s.value=t,this.addField(i,s)}addCheckbox(i,t){var e=document.createElement("input");return e.setAttribute("type","checkbox"),this.addField(i,e),t&&(e.checked=!0),e}addTextarea(i,t,e){var s=document.createElement("textarea");return mxClient.IS_NS&&e--,s.setAttribute("rows",e||2),s.value=t,this.addField(i,s)}addCombo(i,t,e){var s=document.createElement("select");return e!=null&&s.setAttribute("size",e),t&&s.setAttribute("multiple","true"),this.addField(i,s)}addOption(i,t,e,s){var n=document.createElement("option");mxUtils.writeln(n,t),n.setAttribute("value",e),s&&n.setAttribute("selected",s),i.appendChild(n)}addField(i,t){var e=document.createElement("tr"),s=document.createElement("td");return mxUtils.write(s,i),e.appendChild(s),s=document.createElement("td"),s.appendChild(t),e.appendChild(s),this.body.appendChild(e),t}}class mxGraphLayout{constructor(i){u(this,"useBoundingBox",!0);u(this,"parent",null);this.graph=i}moveCell(i,t,e){}resizeCell(i,t){}execute(i){}getGraph(){return this.graph}getConstraint(i,t,e,s){return this.graph.getCurrentCellStyle(t)[i]}static traverse(i,t,e,s,n){if(e!=null&&i!=null&&(t=t??!0,n=n||new mxDictionary,!n.get(i))){n.put(i,!0);var l=e(i,s);if(l==null||l){var r=this.graph.model.getEdgeCount(i);if(r>0)for(var a=0;a<r;a++){var o=this.graph.model.getEdgeAt(i,a),h=this.graph.model.getTerminal(o,!0)==i;if(!t||h){var d=this.graph.view.getVisibleTerminal(o,!h);this.traverse(d,t,e,o,n)}}}}}isAncestor(i,t,e){if(!e)return this.graph.model.getParent(t)==i;if(t==i)return!1;for(;t!=null&&t!=i;)t=this.graph.model.getParent(t);return t==i}isVertexMovable(i){return this.graph.isCellMovable(i)}isVertexIgnored(i){return!this.graph.getModel().isVertex(i)||!this.graph.isCellVisible(i)}isEdgeIgnored(i){var t=this.graph.getModel();return!t.isEdge(i)||!this.graph.isCellVisible(i)||t.getTerminal(i,!0)==null||t.getTerminal(i,!1)==null}setEdgeStyleEnabled(i,t){this.graph.setCellStyles(mxConstants.STYLE_NOEDGESTYLE,t?"0":"1",[i])}setOrthogonalEdge(i,t){this.graph.setCellStyles(mxConstants.STYLE_ORTHOGONAL,t?"1":"0",[i])}getParentOffset(i){var t=new mxPoint;if(i!=null&&i!=this.parent){var e=this.graph.getModel();if(e.isAncestor(this.parent,i))for(var s=e.getGeometry(i);i!=this.parent;)t.x=t.x+s.x,t.y=t.y+s.y,i=e.getParent(i),s=e.getGeometry(i)}return t}setEdgePoints(i,t){if(i!=null){var e=this.graph.model,s=e.getGeometry(i);if(s==null?(s=new mxGeometry,s.setRelative(!0)):s=s.clone(),this.parent!=null&&t!=null)for(var n=e.getParent(i),l=this.getParentOffset(n),r=0;r<t.length;r++)t[r].x=t[r].x-l.x,t[r].y=t[r].y-l.y;s.points=t,e.setGeometry(i,s)}}setVertexLocation(i,t,e){var s=this.graph.getModel(),n=s.getGeometry(i),l=null;if(n!=null){if(l=new mxRectangle(t,e,n.width,n.height),this.useBoundingBox){var r=this.graph.getView().getState(i);if(r!=null&&r.text!=null&&r.text.boundingBox!=null){var a=this.graph.getView().scale,o=r.text.boundingBox;r.text.boundingBox.x<r.x&&(t+=(r.x-o.x)/a,l.width=o.width),r.text.boundingBox.y<r.y&&(e+=(r.y-o.y)/a,l.height=o.height)}}if(this.parent!=null){var h=s.getParent(i);if(h!=null&&h!=this.parent){var d=this.getParentOffset(h);t=t-d.x,e=e-d.y}}(n.x!=t||n.y!=e)&&(n=n.clone(),n.x=t,n.y=e,s.setGeometry(i,n))}return l}getVertexBounds(i){var t=this.graph.getModel().getGeometry(i);if(this.useBoundingBox){var e=this.graph.getView().getState(i);if(e!=null&&e.text!=null&&e.text.boundingBox!=null){var s=this.graph.getView().scale,n=e.text.boundingBox,l=Math.max(e.x-n.x,0)/s,r=Math.max(e.y-n.y,0)/s,a=Math.max(n.x+n.width-(e.x+e.width),0)/s,o=Math.max(n.y+n.height-(e.y+e.height),0)/s;t=new mxRectangle(t.x-l,t.y-r,t.width+l+a,t.height+r+o)}}if(this.parent!=null){var h=this.graph.getModel().getParent(i);if(t=t.clone(),h!=null&&h!=this.parent){var d=this.getParentOffset(h);t.x=t.x+d.x,t.y=t.y+d.y}}return new mxRectangle(t.x,t.y,t.width,t.height)}arrangeGroups(i,t,e,s,n,l){return this.graph.updateGroupBounds(i,t,!0,e,s,n,l)}}class WeightedCellSorter{constructor(i,t){u(this,"nudge",!1);u(this,"visited",!1);u(this,"rankIndex",null);this.cell=i,this.weightedValue=t}static compare(i,t){return i!=null&&t!=null?t.weightedValue>i.weightedValue?-1:t.weightedValue<i.weightedValue?1:t.nudge?-1:1:0}}class mxCompactTreeLayout extends mxGraphLayout{constructor(t,e,s){super(t);u(this,"resizeParent",!0);u(this,"maintainParentLocation",!1);u(this,"groupPadding",10);u(this,"groupPaddingTop",0);u(this,"groupPaddingRight",0);u(this,"groupPaddingBottom",0);u(this,"groupPaddingLeft",0);u(this,"parentsChanged",null);u(this,"moveTree",!1);u(this,"visited",null);u(this,"levelDistance",10);u(this,"nodeDistance",20);u(this,"resetEdges",!0);u(this,"prefHozEdgeSep",5);u(this,"prefVertEdgeOff",4);u(this,"minEdgeJetty",8);u(this,"channelBuffer",4);u(this,"edgeRouting",!0);u(this,"sortEdges",!1);u(this,"alignRanks",!1);u(this,"maxRankHeight",null);u(this,"root",null);u(this,"node",null);this.horizontal=e??!0,this.invert=s??!1}isVertexIgnored(t){return super.isVertexIgnored(t)||this.graph.getConnections(t).length==0}isHorizontal(){return this.horizontal}execute(t,e){this.parent=t;var s=this.graph.getModel();if(e==null)if(this.graph.getEdges(t,s.getParent(t),this.invert,!this.invert,!1).length>0)this.root=t;else{var n=this.graph.findTreeRoots(t,!0,this.invert);if(n.length>0){for(var l=0;l<n.length;l++)if(!this.isVertexIgnored(n[l])&&this.graph.getEdges(n[l],null,this.invert,!this.invert,!1).length>0){this.root=n[l];break}}}else this.root=e;if(this.root!=null){if(this.resizeParent?this.parentsChanged=new Object:this.parentsChanged=null,this.parentX=null,this.parentY=null,t!=this.root&&s.isVertex(t)!=null&&this.maintainParentLocation){var r=this.graph.getCellGeometry(t);r!=null&&(this.parentX=r.x,this.parentY=r.y)}s.beginUpdate();try{if(this.visited=new Object,this.node=this.dfs(this.root,t),this.alignRanks&&(this.maxRankHeight=[],this.findRankHeights(this.node,0),this.setCellHeights(this.node,0)),this.node!=null){this.layout(this.node);var a=this.graph.gridSize,o=a;if(!this.moveTree){var h=this.getVertexBounds(this.root);h!=null&&(a=h.x,o=h.y)}var d=null;if(this.isHorizontal()?d=this.horizontalLayout(this.node,a,o):d=this.verticalLayout(this.node,null,a,o),d!=null){var g=0,m=0;d.x<0&&(g=Math.abs(a-d.x)),d.y<0&&(m=Math.abs(o-d.y)),(g!=0||m!=0)&&this.moveNode(this.node,g,m),this.resizeParent&&this.adjustParents(),this.edgeRouting&&this.localEdgeProcessing(this.node)}if(this.parentX!=null&&this.parentY!=null){var r=this.graph.getCellGeometry(t);r!=null&&(r=r.clone(),r.x=this.parentX,r.y=this.parentY,s.setGeometry(t,r))}}}finally{s.endUpdate()}}}moveNode(t,e,s){t.x+=e,t.y+=s,this.apply(t);for(var n=t.child;n!=null;)this.moveNode(n,e,s),n=n.next}sortOutgoingEdges(t,e){var s=new mxDictionary;e.sort(function(n,l){var r=n.getTerminal(n.getTerminal(!1)==t),a=s.get(r);a==null&&(a=mxCellPath.create(r).split(mxCellPath.PATH_SEPARATOR),s.put(r,a));var o=l.getTerminal(l.getTerminal(!1)==t),h=s.get(o);return h==null&&(h=mxCellPath.create(o).split(mxCellPath.PATH_SEPARATOR),s.put(o,h)),mxCellPath.compare(a,h)})}findRankHeights(t,e){(this.maxRankHeight[e]==null||this.maxRankHeight[e]<t.height)&&(this.maxRankHeight[e]=t.height);for(var s=t.child;s!=null;)this.findRankHeights(s,e+1),s=s.next}setCellHeights(t,e){this.maxRankHeight[e]!=null&&this.maxRankHeight[e]>t.height&&(t.height=this.maxRankHeight[e]);for(var s=t.child;s!=null;)this.setCellHeights(s,e+1),s=s.next}dfs(t,e){var s=mxCellPath.create(t),n=null;if(t!=null&&this.visited[s]==null&&!this.isVertexIgnored(t)){this.visited[s]=t,n=this.createNode(t);var l=this.graph.getModel(),r=null,a=this.graph.getEdges(t,e,this.invert,!this.invert,!1,!0),o=this.graph.getView();this.sortEdges&&this.sortOutgoingEdges(t,a);for(var h=0;h<a.length;h++){var d=a[h];if(!this.isEdgeIgnored(d)){this.resetEdges&&this.setEdgePoints(d,null),this.edgeRouting&&(this.setEdgeStyleEnabled(d,!1),this.setEdgePoints(d,null));var g=o.getState(d),m=g!=null?g.getVisibleTerminal(this.invert):o.getVisibleTerminal(d,this.invert),f=this.dfs(m,e);f!=null&&l.getGeometry(m)!=null&&(r==null?n.child=f:r.next=f,r=f)}}}return n}layout(t){if(t!=null){for(var e=t.child;e!=null;)this.layout(e),e=e.next;t.child!=null?this.attachParent(t,this.join(t)):this.layoutLeaf(t)}}horizontalLayout(t,e,s,n){t.x+=e+t.offsetX,t.y+=s+t.offsetY,n=this.apply(t,n);var l=t.child;if(l!=null){n=this.horizontalLayout(l,t.x,t.y,n);for(var r=t.y+l.offsetY,a=l.next;a!=null;)n=this.horizontalLayout(a,t.x+l.offsetX,r,n),r+=a.offsetY,a=a.next}return n}verticalLayout(t,e,s,n,l){t.x+=s+t.offsetY,t.y+=n+t.offsetX,l=this.apply(t,l);var r=t.child;if(r!=null){l=this.verticalLayout(r,t,t.x,t.y,l);for(var a=t.x+r.offsetY,o=r.next;o!=null;)l=this.verticalLayout(o,t,a,t.y+r.offsetX,l),a+=o.offsetY,o=o.next}return l}attachParent(t,e){var s=this.nodeDistance+this.levelDistance,n=(e-t.width)/2-this.nodeDistance,l=n+t.width+2*this.nodeDistance-e;t.child.offsetX=s+t.height,t.child.offsetY=l,t.contour.upperHead=this.createLine(t.height,0,this.createLine(s,l,t.contour.upperHead)),t.contour.lowerHead=this.createLine(t.height,0,this.createLine(s,n,t.contour.lowerHead))}layoutLeaf(t){var e=2*this.nodeDistance;t.contour.upperTail=this.createLine(t.height+e,0),t.contour.upperHead=t.contour.upperTail,t.contour.lowerTail=this.createLine(0,-t.width-e),t.contour.lowerHead=this.createLine(t.height+e,0,t.contour.lowerTail)}join(t){var e=2*this.nodeDistance,s=t.child;t.contour=s.contour;var n=s.width+e,l=n;for(s=s.next;s!=null;){var r=this.merge(t.contour,s.contour);s.offsetY=r+n,s.offsetX=0,n=s.width+e,l+=r+n,s=s.next}return l}merge(t,e){for(var s=0,n=0,l=0,r=t.lowerHead,a=e.upperHead;a!=null&&r!=null;){var o=this.offset(s,n,a.dx,a.dy,r.dx,r.dy);n+=o,l+=o,s+a.dx<=r.dx?(s+=a.dx,n+=a.dy,a=a.next):(s-=r.dx,n-=r.dy,r=r.next)}if(a!=null){var h=this.bridge(t.upperTail,0,0,a,s,n);t.upperTail=h.next!=null?e.upperTail:h,t.lowerTail=e.lowerTail}else{var h=this.bridge(e.lowerTail,s,n,r,0,0);h.next==null&&(t.lowerTail=h)}return t.lowerHead=e.lowerHead,l}offset(t,e,s,n,l,r){var a=0;if(l<=t||t+s<=0)return 0;var o=l*n-s*r;if(o>0)if(t<0){var h=t*n;a=h/s-e}else if(t>0){var h=t*r;a=h/l-e}else a=-e;else if(l<t+s){var h=(l-t)*n;a=r-(e+h/s)}else if(l>t+s){var h=(s+t)*r;a=h/l-(e+n)}else a=r-(e+n);return a>0?a:0}bridge(t,e,s,n,l,r){var a=l+n.dx-e,o=0,h=0;n.dx==0?o=n.dy:(h=a*n.dy,o=h/n.dx);var d=this.createLine(a,o,n.next);return t.next=this.createLine(0,r+n.dy-o-s,d),d}createNode(t){var e=new Object;e.cell=t,e.x=0,e.y=0,e.width=0,e.height=0;var s=this.getVertexBounds(t);return s!=null&&(this.isHorizontal()?(e.width=s.height,e.height=s.width):(e.width=s.width,e.height=s.height)),e.offsetX=0,e.offsetY=0,e.contour=new Object,e}apply(t,e){var s=this.graph.getModel(),n=t.cell,l=s.getGeometry(n);if(n!=null&&l!=null){if(this.isVertexMovable(n)&&(l=this.setVertexLocation(n,t.x,t.y),this.resizeParent)){var r=s.getParent(n),a=mxCellPath.create(r);this.parentsChanged[a]==null&&(this.parentsChanged[a]=r)}e==null?e=new mxRectangle(l.x,l.y,l.width,l.height):e=new mxRectangle(Math.min(e.x,l.x),Math.min(e.y,l.y),Math.max(e.x+e.width,l.x+l.width),Math.max(e.y+e.height,l.y+l.height))}return e}createLine(t,e,s){var n=new Object;return n.dx=t,n.dy=e,n.next=s,n}adjustParents(){var t=[];for(var e in this.parentsChanged)t.push(this.parentsChanged[e]);this.arrangeGroups(mxUtils.sortCells(t,!0),this.groupPadding,this.groupPaddingTop,this.groupPaddingRight,this.groupPaddingBottom,this.groupPaddingLeft)}localEdgeProcessing(t){this.processNodeOutgoing(t);for(var e=t.child;e!=null;)this.localEdgeProcessing(e),e=e.next}processNodeOutgoing(t){for(var e=t.child,s=t.cell,n=0,l=[];e!=null;){n++;var r=e.x;this.horizontal&&(r=e.y),l.push(new WeightedCellSorter(e,r)),e=e.next}l.sort(WeightedCellSorter.compare);var a=t.width,o=(n+1)*this.prefHozEdgeSep;a>o+2*this.prefHozEdgeSep&&(a-=2*this.prefHozEdgeSep);var h=a/n,d=h/2;a>o+2*this.prefHozEdgeSep&&(d+=this.prefHozEdgeSep);var g=this.minEdgeJetty-this.prefVertEdgeOff,m=this.getVertexBounds(s);e=t.child;for(var f=0;f<l.length;f++){for(var c=l[f].cell.cell,x=this.getVertexBounds(c),p=this.graph.getEdgesBetween(s,c,!1),C=[],E=0,T=0,S=0;S<p.length;S++)this.horizontal?(E=m.x+m.width,T=m.y+d,C.push(new mxPoint(E,T)),E=m.x+m.width+g,C.push(new mxPoint(E,T)),T=x.y+x.height/2,C.push(new mxPoint(E,T)),this.setEdgePoints(p[S],C)):(E=m.x+d,T=m.y+m.height,C.push(new mxPoint(E,T)),T=m.y+m.height+g,C.push(new mxPoint(E,T)),E=x.x+x.width/2,C.push(new mxPoint(E,T)),this.setEdgePoints(p[S],C));f<n/2?g+=this.prefVertEdgeOff:f>n/2&&(g-=this.prefVertEdgeOff),d+=h}}}class mxStackLayout extends mxGraphLayout{constructor(t,e,s,n,l,r){super(t);u(this,"marginTop",0);u(this,"marginLeft",0);u(this,"marginRight",0);u(this,"marginBottom",0);u(this,"keepFirstLocation",!1);u(this,"fill",!1);u(this,"resizeParent",!1);u(this,"resizeParentMax",!1);u(this,"resizeLast",!1);u(this,"wrap",null);u(this,"borderCollapse",!0);u(this,"allowGaps",!1);u(this,"gridSize",0);this.horizontal=e??!0,this.spacing=s??0,this.x0=n??0,this.y0=l??0,this.border=r??0}isHorizontal(){return this.horizontal}moveCell(t,e,s){var n=this.graph.getModel(),l=n.getParent(t),r=this.isHorizontal();if(t!=null&&l!=null){var a=0,o=0,h=n.getChildCount(l),d=r?e:s,g=this.graph.getView().getState(l);for(g!=null&&(d-=r?g.x:g.y),d/=this.graph.view.scale,a=0;a<h;a++){var m=n.getChildAt(l,a);if(m!=t){var f=n.getGeometry(m);if(f!=null){var c=r?f.x+f.width/2:f.y+f.height/2;if(o<=d&&c>d)break;o=c}}}var x=l.getIndex(t);x=Math.max(0,a-(a>x?1:0)),n.add(l,t,x)}}getParentSize(t){var e=this.graph.getModel(),s=e.getGeometry(t);if(this.graph.container!=null&&(s==null&&e.isLayer(t)||t==this.graph.getView().currentRoot)){var n=this.graph.container.offsetWidth-1,l=this.graph.container.offsetHeight-1;s=new mxRectangle(0,0,n,l)}return s}getLayoutCells(t){for(var e=this.graph.getModel(),s=e.getChildCount(t),n=[],l=0;l<s;l++){var r=e.getChildAt(t,l);!this.isVertexIgnored(r)&&this.isVertexMovable(r)&&n.push(r)}return this.allowGaps&&n.sort((a,o)=>{var h=this.graph.getCellGeometry(a),d=this.graph.getCellGeometry(o);return h.y==d.y?0:h.y>d.y>0?1:-1}),n}snap(t){if(this.gridSize!=null&&this.gridSize>0&&(t=Math.max(t,this.gridSize),t/this.gridSize>1)){var e=t%this.gridSize;t+=e>this.gridSize/2?this.gridSize-e:-e}return t}execute(t){if(t!=null){var e=this.getParentSize(t),s=this.isHorizontal(),n=this.graph.getModel(),l=null;e!=null&&(l=s?e.height-this.marginTop-this.marginBottom:e.width-this.marginLeft-this.marginRight),l-=2*this.border;var r=this.x0+this.border+this.marginLeft,a=this.y0+this.border+this.marginTop;if(this.graph.isSwimlane(t)){var o=this.graph.getCellStyle(t),h=mxUtils.getNumber(o,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE),d=mxUtils.getValue(o,mxConstants.STYLE_HORIZONTAL,!0)==1;e!=null&&(d?h=Math.min(h,e.height):h=Math.min(h,e.width)),s==d&&(l-=h),d?a+=h:r+=h}n.beginUpdate();try{for(var g=0,m=null,f=0,c=null,x=this.getLayoutCells(t),p=0;p<x.length;p++){var C=x[p],E=n.getGeometry(C);if(E!=null){E=E.clone(),this.wrap!=null&&m!=null&&(s&&m.x+m.width+E.width+2*this.spacing>this.wrap||!s&&m.y+m.height+E.height+2*this.spacing>this.wrap)&&(m=null,s?a+=g+this.spacing:r+=g+this.spacing,g=0),g=Math.max(g,s?E.height:E.width);var T=0;if(!this.borderCollapse){var S=this.graph.getCellStyle(C);T=mxUtils.getNumber(S,mxConstants.STYLE_STROKEWIDTH,1)}if(m!=null){var y=f+this.spacing+Math.floor(T/2);s?E.x=this.snap((this.allowGaps?Math.max(y,E.x):y)-this.marginLeft)+this.marginLeft:E.y=this.snap((this.allowGaps?Math.max(y,E.y):y)-this.marginTop)+this.marginTop}else this.keepFirstLocation||(s?E.x=this.allowGaps&&E.x>r?Math.max(this.snap(E.x-this.marginLeft)+this.marginLeft,r):r:E.y=this.allowGaps&&E.y>a?Math.max(this.snap(E.y-this.marginTop)+this.marginTop,a):a);s?E.y=a:E.x=r,this.fill&&l!=null&&(s?E.height=l:E.width=l),s?E.width=this.snap(E.width):E.height=this.snap(E.height),this.setChildGeometry(C,E),c=C,m=E,s?f=m.x+m.width+Math.floor(T/2):f=m.y+m.height+Math.floor(T/2)}}this.resizeParent&&e!=null&&m!=null&&!this.graph.isCellCollapsed(t)?this.updateParentGeometry(t,e,m):this.resizeLast&&e!=null&&m!=null&&c!=null&&(s?m.width=e.width-m.x-this.spacing-this.marginRight-this.marginLeft:m.height=e.height-m.y-this.spacing-this.marginBottom,this.setChildGeometry(c,m))}finally{n.endUpdate()}}}setChildGeometry(t,e){var s=this.graph.getCellGeometry(t);(s==null||e.x!=s.x||e.y!=s.y||e.width!=s.width||e.height!=s.height)&&this.graph.getModel().setGeometry(t,e)}updateParentGeometry(t,e,s){var n=this.isHorizontal(),l=this.graph.getModel(),r=e.clone();if(n){var a=s.x+s.width+this.marginRight+this.border;this.resizeParentMax?r.width=Math.max(r.width,a):r.width=a}else{var a=s.y+s.height+this.marginBottom+this.border;this.resizeParentMax?r.height=Math.max(r.height,a):r.height=a}(e.x!=r.x||e.y!=r.y||e.width!=r.width||e.height!=r.height)&&l.setGeometry(t,r)}}class mxCellAttributeChange{constructor(i,t,e){this.cell=i,this.attribute=t,this.value=e,this.previous=e}execute(){if(this.cell!=null){var i=this.cell.getAttribute(this.attribute);this.previous==null?this.cell.value.removeAttribute(this.attribute):this.cell.setAttribute(this.attribute,this.previous),this.previous=i}}}class mxDivResizer{constructor(i,t){u(this,"resizeWidth",!0);u(this,"resizeHeight",!0);u(this,"handlingResize",!1);if(i.nodeName.toLowerCase()=="div"){t==null&&(t=window),this.div=i;var e=mxUtils.getCurrentStyle(i);e!=null&&(this.resizeWidth=e.width=="auto",this.resizeHeight=e.height=="auto"),mxEvent.addListener(t,"resize",s=>{this.handlingResize||(this.handlingResize=!0,this.resize(),this.handlingResize=!1)}),this.resize()}}resize(){var i=this.getDocumentWidth(),t=this.getDocumentHeight(),e=parseInt(this.div.style.left),s=parseInt(this.div.style.right),n=parseInt(this.div.style.top),l=parseInt(this.div.style.bottom);this.resizeWidth&&!isNaN(e)&&!isNaN(s)&&e>=0&&s>=0&&i-s-e>0&&(this.div.style.width=i-s-e+"px"),this.resizeHeight&&!isNaN(n)&&!isNaN(l)&&n>=0&&l>=0&&t-n-l>0&&(this.div.style.height=t-n-l+"px")}getDocumentWidth(){return document.body.clientWidth}getDocumentHeight(){return document.body.clientHeight}}class mxRubberband{constructor(i){u(this,"defaultOpacity",20);u(this,"enabled",!0);u(this,"div",null);u(this,"sharedDiv",null);u(this,"currentX",0);u(this,"currentY",0);u(this,"fadeOut",!1);i!=null&&(this.graph=i,this.graph.addMouseListener(this),this.forceRubberbandHandler=(t,e)=>{var s=e.getProperty("eventName"),n=e.getProperty("event");if(s==mxEvent.MOUSE_DOWN&&this.isForceRubberbandEvent(n)){var l=mxUtils.getOffset(this.graph.container),r=mxUtils.getScrollOrigin(this.graph.container);r.x-=l.x,r.y-=l.y,this.start(n.getX()+r.x,n.getY()+r.y),n.consume(!1)}},this.graph.addListener(mxEvent.FIRE_MOUSE_EVENT,this.forceRubberbandHandler),this.panHandler=()=>{this.repaint()},this.graph.addListener(mxEvent.PAN,this.panHandler),this.gestureHandler=(t,e)=>{this.first!=null&&this.reset()},this.graph.addListener(mxEvent.GESTURE,this.gestureHandler))}isEnabled(){return this.enabled}setEnabled(i){this.enabled=i}isForceRubberbandEvent(i){return mxEvent.isAltDown(i.getEvent())}mouseDown(i,t){if(!t.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&t.getState()==null&&!mxEvent.isMultiTouchEvent(t.getEvent())){var e=mxUtils.getOffset(this.graph.container),s=mxUtils.getScrollOrigin(this.graph.container);s.x-=e.x,s.y-=e.y,this.start(t.getX()+s.x,t.getY()+s.y),t.consume(!1)}}start(i,t){this.first=new mxPoint(i,t);var e=this.graph.container;function s(n){var l=new mxMouseEvent(n),r=mxUtils.convertPoint(e,l.getX(),l.getY());return l.graphX=r.x,l.graphY=r.y,l}this.dragHandler=n=>{this.mouseMove(this.graph,s(n))},this.dropHandler=n=>{this.mouseUp(this.graph,s(n))},mxClient.IS_FF&&mxEvent.addGestureListeners(document,null,this.dragHandler,this.dropHandler)}mouseMove(i,t){if(!t.isConsumed()&&this.first!=null){var e=mxUtils.getScrollOrigin(this.graph.container),s=mxUtils.getOffset(this.graph.container);e.x-=s.x,e.y-=s.y;var n=t.getX()+e.x,l=t.getY()+e.y,r=this.first.x-n,a=this.first.y-l,o=this.graph.tolerance;(this.div!=null||Math.abs(r)>o||Math.abs(a)>o)&&(this.div==null&&(this.div=this.createShape()),mxUtils.clearSelection(),this.update(n,l),t.consume())}}createShape(){this.sharedDiv==null&&(this.sharedDiv=document.createElement("div"),this.sharedDiv.className="mxRubberband",mxUtils.setOpacity(this.sharedDiv,this.defaultOpacity)),this.graph.container.appendChild(this.sharedDiv);var i=this.sharedDiv;return mxClient.IS_SVG&&document.documentMode>=10&&this.fadeOut&&(this.sharedDiv=null),i}isActive(i,t){return this.div!=null&&this.div.style.display!="none"}mouseUp(i,t){var e=this.isActive();this.reset(),e&&(this.execute(t.getEvent()),t.consume())}execute(i){var t=new mxRectangle(this.x,this.y,this.width,this.height);this.graph.selectRegion(t,i)}reset(){if(this.div!=null)if(mxClient.IS_SVG&&document.documentMode>=10&&this.fadeOut){var i=this.div;mxUtils.setPrefixedStyle(i.style,"transition","all 0.2s linear"),i.style.pointerEvents="none",i.style.opacity=0,window.setTimeout(function(){i.parentNode.removeChild(i)},200)}else this.div.parentNode.removeChild(this.div);mxEvent.removeGestureListeners(document,null,this.dragHandler,this.dropHandler),this.dragHandler=null,this.dropHandler=null,this.currentX=0,this.currentY=0,this.first=null,this.div=null}update(i,t){this.currentX=i,this.currentY=t,this.repaint()}repaint(){if(this.div!=null){var i=this.currentX-this.graph.panDx,t=this.currentY-this.graph.panDy;this.x=Math.min(this.first.x,i),this.y=Math.min(this.first.y,t),this.width=Math.max(this.first.x,i)-this.x,this.height=Math.max(this.first.y,t)-this.y;var e=0,s=0;this.div.style.left=this.x+e+"px",this.div.style.top=this.y+s+"px",this.div.style.width=Math.max(1,this.width)+"px",this.div.style.height=Math.max(1,this.height)+"px"}}destroy(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),this.graph.removeListener(this.forceRubberbandHandler),this.graph.removeListener(this.panHandler),this.reset(),this.sharedDiv!=null&&(this.sharedDiv=null))}}class mxLayoutManager extends mxEventSource{constructor(t){super();u(this,"graph",null);u(this,"bubbling",!0);u(this,"enabled",!0);this.undoHandler=(e,s)=>{this.isEnabled()&&this.beforeUndo(s.getProperty("edit"))},this.moveHandler=(e,s)=>{this.isEnabled()&&this.cellsMoved(s.getProperty("cells"),s.getProperty("event"))},this.resizeHandler=(e,s)=>{this.isEnabled()&&this.cellsResized(s.getProperty("cells"),s.getProperty("bounds"),s.getProperty("previous"))},this.setGraph(t)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isBubbling(){return this.bubbling}setBubbling(t){this.bubbling=t}getGraph(){return this.graph}setGraph(t){if(this.graph!=null){var e=this.graph.getModel();e.removeListener(this.undoHandler),this.graph.removeListener(this.moveHandler),this.graph.removeListener(this.resizeHandler)}if(this.graph=t,this.graph!=null){var e=this.graph.getModel();e.addListener(mxEvent.BEFORE_UNDO,this.undoHandler),this.graph.addListener(mxEvent.MOVE_CELLS,this.moveHandler),this.graph.addListener(mxEvent.RESIZE_CELLS,this.resizeHandler)}}hasLayout(t){return this.getLayout(t,mxEvent.LAYOUT_CELLS)}getLayout(t,e){return null}beforeUndo(t){this.executeLayoutForCells(this.getCellsForChanges(t.changes))}cellsMoved(t,e){if(t!=null&&e!=null)for(var s=mxUtils.convertPoint(this.getGraph().container,mxEvent.getClientX(e),mxEvent.getClientY(e)),n=0;n<t.length;n++){var l=this.getAncestorLayout(t[n],mxEvent.MOVE_CELLS);l!=null&&l.moveCell(t[n],s.x,s.y)}}cellsResized(t,e,s){if(t!=null&&e!=null)for(var n=0;n<t.length;n++){var l=this.getAncestorLayout(t[n],mxEvent.RESIZE_CELLS);l!=null&&l.resizeCell(t[n],e[n],s[n])}}getAncestorLayout(t,e){for(var s=this.getGraph().getModel();t!=null;){var n=this.getLayout(t,e);if(n!=null)return n;t=s.getParent(t)}return null}getCellsForChanges(t){for(var e=[],s=0;s<t.length;s++){var n=t[s];if(n instanceof mxRootChange)return[];e=e.concat(this.getCellsForChange(n))}return e}getCellsForChange(t){return t instanceof mxChildChange?this.addCellsWithLayout(t.child,this.addCellsWithLayout(t.previous)):t instanceof mxTerminalChange||t instanceof mxGeometryChange?this.addCellsWithLayout(t.cell):t instanceof mxVisibleChange||t instanceof mxStyleChange?this.addCellsWithLayout(t.cell):[]}addCellsWithLayout(t,e){return this.addDescendantsWithLayout(t,this.addAncestorsWithLayout(t,e))}addAncestorsWithLayout(t,e){if(e=e??[],t!=null){var s=this.hasLayout(t);if(s!=null&&e.push(t),this.isBubbling()){var n=this.getGraph().getModel();this.addAncestorsWithLayout(n.getParent(t),e)}}return e}addDescendantsWithLayout(t,e){if(e=e??[],t!=null&&this.hasLayout(t))for(var s=this.getGraph().getModel(),n=0;n<s.getChildCount(t);n++){var l=s.getChildAt(t,n);this.hasLayout(l)&&(e.push(l),this.addDescendantsWithLayout(l,e))}return e}executeLayoutForCells(t){var e=mxUtils.sortCells(t,!1);this.layoutCells(e,!0),this.layoutCells(e.reverse(),!1)}layoutCells(t,e){if(t.length>0){var s=this.getGraph().getModel();s.beginUpdate();try{for(var n=null,l=0;l<t.length;l++)t[l]!=s.getRoot()&&t[l]!=n&&(this.executeLayout(t[l],e),n=t[l]);this.fireEvent(new mxEventObject(mxEvent.LAYOUT_CELLS,"cells",t))}finally{s.endUpdate()}}}executeLayout(t,e){var s=this.getLayout(t,e?mxEvent.BEGIN_UPDATE:mxEvent.END_UPDATE);s!=null&&s.execute(t)}destroy(){this.setGraph(null)}}class mxSwimlaneManager extends mxEventSource{constructor(t,e,s,n){super();u(this,"graph",null);u(this,"enabled",!0);this.horizontal=e??!0,this.addEnabled=s??!0,this.resizeEnabled=n??!0,this.addHandler=(l,r)=>{this.isEnabled()&&this.isAddEnabled()&&this.cellsAdded(r.getProperty("cells"))},this.resizeHandler=(l,r)=>{this.isEnabled()&&this.isResizeEnabled()&&this.cellsResized(r.getProperty("cells"))},this.setGraph(t)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isHorizontal(){return this.horizontal}setHorizontal(t){this.horizontal=t}isAddEnabled(){return this.addEnabled}setAddEnabled(t){this.addEnabled=t}isResizeEnabled(){return this.resizeEnabled}setResizeEnabled(t){this.resizeEnabled=t}getGraph(){return this.graph}setGraph(t){this.graph!=null&&(this.graph.removeListener(this.addHandler),this.graph.removeListener(this.resizeHandler)),this.graph=t,this.graph!=null&&(this.graph.addListener(mxEvent.ADD_CELLS,this.addHandler),this.graph.addListener(mxEvent.CELLS_RESIZED,this.resizeHandler))}isSwimlaneIgnored(t){return!this.getGraph().isSwimlane(t)}isCellHorizontal(t){if(this.graph.isSwimlane(t)){var e=this.graph.getCellStyle(t);return mxUtils.getValue(e,mxConstants.STYLE_HORIZONTAL,1)==1}return!this.isHorizontal()}cellsAdded(t){if(t!=null){var e=this.getGraph().getModel();e.beginUpdate();try{for(var s=0;s<t.length;s++)this.isSwimlaneIgnored(t[s])||this.swimlaneAdded(t[s])}finally{e.endUpdate()}}}swimlaneAdded(t){for(var e=this.getGraph().getModel(),s=e.getParent(t),n=e.getChildCount(s),l=null,r=0;r<n;r++){var a=e.getChildAt(s,r);if(a!=t&&!this.isSwimlaneIgnored(a)&&(l=e.getGeometry(a),l!=null))break}if(l!=null){var o=s!=null?this.isCellHorizontal(s):this.horizontal;this.resizeSwimlane(t,l.width,l.height,o)}}cellsResized(t){if(t!=null){var e=this.getGraph().getModel();e.beginUpdate();try{for(var s=0;s<t.length;s++)if(!this.isSwimlaneIgnored(t[s])){var n=e.getGeometry(t[s]);if(n!=null){for(var l=new mxRectangle(0,0,n.width,n.height),r=t[s],a=r;a!=null;){r=a,a=e.getParent(a);var o=this.graph.isSwimlane(a)?this.graph.getStartSize(a):new mxRectangle;l.width+=o.width,l.height+=o.height}var h=a!=null?this.isCellHorizontal(a):this.horizontal;this.resizeSwimlane(r,l.width,l.height,h)}}}finally{e.endUpdate()}}}resizeSwimlane(t,e,s,n){var l=this.getGraph().getModel();l.beginUpdate();try{var r=this.isCellHorizontal(t);if(!this.isSwimlaneIgnored(t)){var a=l.getGeometry(t);a!=null&&(n&&a.height!=s||!n&&a.width!=e)&&(a=a.clone(),n?a.height=s:a.width=e,l.setGeometry(t,a))}var o=this.graph.isSwimlane(t)?this.graph.getStartSize(t):new mxRectangle;e-=o.width,s-=o.height;for(var h=l.getChildCount(t),d=0;d<h;d++){var g=l.getChildAt(t,d);this.resizeSwimlane(g,e,s,r)}}finally{l.endUpdate()}}destroy(){this.setGraph(null)}}const J=class J{static setCells(i){J.cells=i}static getCells(){return J.cells}static isEmpty(){return J.getCells()==null}static cut(i,t){return t=J.copy(i,t),J.insertCount=0,J.removeCells(i,t),t}static removeCells(i,t){i.removeCells(t)}static copy(i,t){t=t||i.getSelectionCells();var e=i.getExportableCells(i.model.getTopmostCells(t));return J.insertCount=1,J.setCells(i.cloneCells(e)),e}static paste(i){var t=null;if(!J.isEmpty()){t=i.getImportableCells(J.getCells());var e=J.insertCount*J.STEPSIZE,s=i.getDefaultParent();t=i.importCells(t,e,e,s),J.insertCount++,i.setSelectionCells(t)}return t}};u(J,"STEPSIZE",10),u(J,"insertCount",1),u(J,"cells",null);let mxClipboard=J;class mxPrintPreview{constructor(i,t,e,s,n,l,r,a,o){u(this,"marginTop",0);u(this,"marginBottom",0);u(this,"autoOrigin",!0);u(this,"printOverlays",!1);u(this,"printControls",!1);u(this,"printBackgroundImage",!1);u(this,"backgroundColor","#ffffff");u(this,"wnd",null);u(this,"targetWindow",null);u(this,"pageCount",0);u(this,"clipping",!0);this.graph=i,this.scale=t??1/i.pageScale,this.border=s??0,this.pageFormat=mxRectangle.fromRectangle(e??i.pageFormat),this.title=a??"Printer-friendly version",this.x0=n??0,this.y0=l??0,this.borderColor=r,this.pageSelector=o??!0}getWindow(){return this.wnd}getDoctype(){var i="";return document.documentMode==5?i='<meta http-equiv="X-UA-Compatible" content="IE=5">':document.documentMode==8?i='<meta http-equiv="X-UA-Compatible" content="IE=8">':document.documentMode>8&&(i='<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->'),i}appendGraph(i,t,e,s,n,l){this.graph=i,this.scale=t??1/i.pageScale,this.x0=e,this.y0=s,this.open(null,null,n,l)}open(i,t,e,s){var n=this.graph.cellRenderer.initializeOverlay,l=null;try{this.printOverlays&&(this.graph.cellRenderer.initializeOverlay=function(M,H){H.init(M.view.getDrawPane())}),this.printControls&&(this.graph.cellRenderer.initControl=function(M,H,R,D){H.dialect=M.view.graph.dialect,H.init(M.view.getDrawPane())}),this.wnd=t??this.wnd;var r=!1;this.wnd==null&&(r=!0,this.wnd=window.open());var a=this.wnd.document;if(r){var o=this.getDoctype();o!=null&&o.length>0&&a.writeln(o),document.compatMode==="CSS1Compat"&&a.writeln("<!DOCTYPE html>"),a.writeln("<html>"),a.writeln("<head>"),this.writeHead(a,i),a.writeln("</head>"),a.writeln('<body class="mxPage">')}var h=this.graph.getGraphBounds().clone(),d=this.graph.getView().getScale(),g=d/this.scale,m=this.graph.getView().getTranslate();this.autoOrigin||(this.x0-=m.x*this.scale,this.y0-=m.y*this.scale,h.width+=h.x,h.height+=h.y,h.x=0,h.y=0,this.border=0);var f=this.pageFormat.width-this.border*2,c=this.pageFormat.height-this.border*2;this.pageFormat.height+=this.marginTop+this.marginBottom,h.width/=g,h.height/=g;var x=Math.max(1,Math.ceil((h.width+this.x0)/f)),p=Math.max(1,Math.ceil((h.height+this.y0)/c));this.pageCount=x*p;var C=()=>{if(this.pageSelector&&(p>1||x>1)){var M=this.createPageSelector(p,x);a.body.appendChild(M)}},E=(M,H)=>{if(this.borderColor!=null&&(M.style.borderColor=this.borderColor,M.style.borderStyle="solid",M.style.borderWidth="1px"),M.style.background=this.backgroundColor,(e||H)&&(M.style.pageBreakAfter="always"),r&&(document.documentMode>=11||mxClient.IS_EDGE))a.writeln(M.outerHTML),M.parentNode.removeChild(M);else if(document.documentMode>=11||mxClient.IS_EDGE){var R=a.createElement("div");R.innerHTML=M.outerHTML,R=R.getElementsByTagName("div")[0],a.body.appendChild(R),M.parentNode.removeChild(M)}else M.parentNode.removeChild(M),a.body.appendChild(M);(e||H)&&this.addPageBreak(a)},T=this.getCoverPages(this.pageFormat.width,this.pageFormat.height);if(T!=null)for(var S=0;S<T.length;S++)E(T[S],!0);for(var y=this.getAppendices(this.pageFormat.width,this.pageFormat.height),S=0;S<p;S++)for(var b=S*c/this.scale-this.y0/this.scale+(h.y-m.y*d)/d,w=0;w<x;w++){if(this.wnd==null)return null;var I=w*f/this.scale-this.x0/this.scale+(h.x-m.x*d)/d,O=S*x+w+1,P=new mxRectangle(I,b,f,c);l=this.renderPage(this.pageFormat.width,this.pageFormat.height,0,0,H=>{this.addGraphFragment(-I,-b,this.scale,O,H,P),this.printBackgroundImage&&this.insertBackgroundImage(H,-I,-b)},O),l.setAttribute("id","mxPage-"+O),E(l,y!=null||S<p-1||w<x-1)}if(y!=null)for(var S=0;S<y.length;S++)E(y[S],S<y.length-1);r&&!s&&(this.closeDocument(),C()),this.wnd.focus()}catch{l!=null&&l.parentNode!=null&&l.parentNode.removeChild(l)}finally{this.graph.cellRenderer.initializeOverlay=n}return this.wnd}addPageBreak(i){var t=i.createElement("hr");t.className="mxPageBreak",i.body.appendChild(t)}closeDocument(){try{if(this.wnd!=null&&this.wnd.document!=null){var i=this.wnd.document;this.writePostfix(i),i.writeln("</body>"),i.writeln("</html>"),i.close(),mxEvent.release(i.body)}}catch{}}writeHead(i,t){this.title!=null&&i.writeln("<title>"+this.title+"</title>"),mxClient.link("stylesheet",mxClient.basePath+"/css/common.css",i),i.writeln('<style type="text/css">'),i.writeln("@media print {"),i.writeln("  * { -webkit-print-color-adjust: exact; }"),i.writeln("  table.mxPageSelector { display: none; }"),i.writeln("  hr.mxPageBreak { display: none; }"),i.writeln("}"),i.writeln("@media screen {"),i.writeln("  table.mxPageSelector { position: fixed; right: 10px; top: 10px;font-family: Arial; font-size:10pt; border: solid 1px darkgray;background: white; border-collapse:collapse; }"),i.writeln("  table.mxPageSelector td { border: solid 1px gray; padding:4px; }"),i.writeln("  body.mxPage { background: gray; }"),i.writeln("}"),t!=null&&i.writeln(t),i.writeln("</style>")}writePostfix(i){}createPageSelector(i,t){var e=this.wnd.document,s=e.createElement("table");s.className="mxPageSelector",s.setAttribute("border","0");for(var n=e.createElement("tbody"),l=0;l<i;l++){for(var r=e.createElement("tr"),a=0;a<t;a++){var o=l*t+a+1,h=e.createElement("td"),d=e.createElement("a");if(d.setAttribute("href","#mxPage-"+o),mxClient.IS_NS&&!mxClient.IS_SF&&!mxClient.IS_GC){var g="var page = document.getElementById('mxPage-"+o+"');page.scrollIntoView(true);event.preventDefault();";d.setAttribute("onclick",g)}mxUtils.write(d,o,e),h.appendChild(d),r.appendChild(h)}n.appendChild(r)}return s.appendChild(n),s}renderPage(i,t,e,s,n,l){var r=this.wnd.document,a=document.createElement("div"),o=null;try{if(e!=0||s!=0){a.style.position="relative",a.style.width=i+"px",a.style.height=t+"px",a.style.pageBreakInside="avoid";var h=document.createElement("div");h.style.position="relative",h.style.top=this.border+"px",h.style.left=this.border+"px",h.style.width=i-2*this.border+"px",h.style.height=t-2*this.border+"px",h.style.overflow="hidden";var d=document.createElement("div");d.style.position="relative",d.style.marginLeft=e+"px",d.style.marginTop=s+"px",r.documentMode==8&&(h.style.position="absolute",d.style.position="absolute"),r.documentMode==10&&(d.style.width="100%",d.style.height="100%"),h.appendChild(d),a.appendChild(h),document.body.appendChild(a),o=d}else{a.style.width=i+"px",a.style.height=t+"px",a.style.overflow="hidden",a.style.pageBreakInside="avoid",r.documentMode==8&&(a.style.position="relative");var h=document.createElement("div");h.style.width=i-2*this.border+"px",h.style.height=t-2*this.border+"px",h.style.overflow="hidden",h.style.top=this.border+"px",h.style.left=this.border+"px",this.graph.dialect==mxConstants.DIALECT_VML&&(h.style.position="absolute"),a.appendChild(h),document.body.appendChild(a),o=h}}catch(g){throw a.parentNode.removeChild(a),a=null,g}return n(o),a}getRoot(){var i=this.graph.view.currentRoot;return i==null&&(i=this.graph.getModel().getRoot()),i}addGraphFragment(i,t,e,s,n,l){var r=this.graph.getView(),a=this.graph.container;this.graph.container=n;var o=r.getCanvas(),h=r.getBackgroundPane(),d=r.getDrawPane(),g=r.getOverlayPane(),m=e;if(this.graph.dialect==mxConstants.DIALECT_SVG){if(r.createSvg(),!mxClient.NO_FO){var f=r.getDrawPane().parentNode;f.getAttribute("transform"),f.setAttribute("transformOrigin","0 0"),f.setAttribute("transform","scale("+e+","+e+")translate("+i+","+t+")"),e=1,i=0,t=0}}else this.graph.dialect==mxConstants.DIALECT_VML?r.createVml():r.createHtml();var c=r.isEventsEnabled();r.setEventsEnabled(!1);var x=this.graph.isEnabled();this.graph.setEnabled(!1);var p=r.getTranslate();r.translate=new mxPoint(i,t);var C=this.graph.cellRenderer.redraw,E=r.states,T=r.scale;if(this.clipping){var S=new mxRectangle((l.x+p.x)*T,(l.y+p.y)*T,l.width*T/m,l.height*T/m);this.graph.cellRenderer.redraw=function(M,H,R){if(M!=null){var D=E.get(M.cell);if(D!=null){var A=r.getBoundingBox(D,!1);if(A!=null&&A.width>0&&A.height>0&&!mxUtils.intersects(S,A))return}}C.apply(this,arguments)}}var y=null;try{var b=[this.getRoot()];y=new mxTemporaryCellStates(r,e,b,null,M=>this.getLinkForCellState(M))}finally{for(var w=n.firstChild;w!=null;){var I=w.nextSibling,O=w.nodeName.toLowerCase();O=="svg"?(w.style.overflow="hidden",w.style.position="relative",w.style.top=this.marginTop+"px",w.setAttribute("width",l.width),w.setAttribute("height",l.height),w.style.width="",w.style.height=""):w.style.cursor!="default"&&O!="div"&&w.parentNode.removeChild(w),w=I}if(this.printBackgroundImage){var P=n.getElementsByTagName("svg");P.length>0&&(P[0].style.position="absolute")}r.overlayPane.parentNode.removeChild(r.overlayPane),this.graph.setEnabled(x),this.graph.container=a,this.graph.cellRenderer.redraw=C,r.canvas=o,r.backgroundPane=h,r.drawPane=d,r.overlayPane=g,r.translate=p,y.destroy(),r.setEventsEnabled(c)}}getLinkForCellState(i){return this.graph.getLinkForCell(i.cell)}insertBackgroundImage(i,t,e){var s=this.graph.backgroundImage;if(s!=null){var n=document.createElement("img");n.style.position="absolute",n.style.marginLeft=Math.round(t*this.scale)+"px",n.style.marginTop=Math.round(e*this.scale)+"px",n.setAttribute("width",Math.round(this.scale*s.width)),n.setAttribute("height",Math.round(this.scale*s.height)),n.src=s.src,i.insertBefore(n,i.firstChild)}}getCoverPages(){return null}getAppendices(){return null}print(i){var t=this.open(i);t!=null&&t.print()}close(){this.wnd!=null&&(this.wnd.close(),this.wnd=null)}}class mxUndoManager extends mxEventSource{constructor(t){super();u(this,"history",null);u(this,"indexOfNextAdd",0);this.size=t??100,this.clear()}isEmpty(){return this.history.length==0}clear(){this.history=[],this.indexOfNextAdd=0,this.fireEvent(new mxEventObject(mxEvent.CLEAR))}canUndo(){return this.indexOfNextAdd>0}undo(){for(;this.indexOfNextAdd>0;){var t=this.history[--this.indexOfNextAdd];if(t.undo(),t.isSignificant()){this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",t));break}}}canRedo(){return this.indexOfNextAdd<this.history.length}redo(){for(var t=this.history.length;this.indexOfNextAdd<t;){var e=this.history[this.indexOfNextAdd++];if(e.redo(),e.isSignificant()){this.fireEvent(new mxEventObject(mxEvent.REDO,"edit",e));break}}}undoableEditHappened(t){this.trim(),this.size>0&&this.size==this.history.length&&this.history.shift(),this.history.push(t),this.indexOfNextAdd=this.history.length,this.fireEvent(new mxEventObject(mxEvent.ADD,"edit",t))}trim(){if(this.history.length>this.indexOfNextAdd)for(var t=this.history.splice(this.indexOfNextAdd,this.history.length-this.indexOfNextAdd),e=0;e<t.length;e++)t[e].die()}}class mxEditor extends mxEventSource{constructor(t){super();u(this,"askZoomResource",mxClient.language!="none"?"askZoom":"");u(this,"lastSavedResource",mxClient.language!="none"?"lastSaved":"");u(this,"currentFileResource",mxClient.language!="none"?"currentFile":"");u(this,"propertiesResource",mxClient.language!="none"?"properties":"");u(this,"tasksResource",mxClient.language!="none"?"tasks":"");u(this,"helpResource",mxClient.language!="none"?"help":"");u(this,"outlineResource",mxClient.language!="none"?"outline":"");u(this,"outline",null);u(this,"graph",null);u(this,"graphRenderHint",null);u(this,"toolbar",null);u(this,"status",null);u(this,"popupHandler",null);u(this,"undoManager",null);u(this,"keyHandler",null);u(this,"dblClickAction","edit");u(this,"swimlaneRequired",!1);u(this,"disableContextMenu",!0);u(this,"insertFunction",null);u(this,"forcedInserting",!1);u(this,"templates",null);u(this,"defaultEdge",null);u(this,"defaultEdgeStyle",null);u(this,"defaultGroup",null);u(this,"groupBorderSize",null);u(this,"filename",null);u(this,"linefeed","&#xa;");u(this,"postParameterName","xml");u(this,"escapePostData",!0);u(this,"urlPost",null);u(this,"urlImage",null);u(this,"horizontalFlow",!1);u(this,"layoutDiagram",!1);u(this,"swimlaneSpacing",0);u(this,"maintainSwimlanes",!1);u(this,"layoutSwimlanes",!1);u(this,"cycleAttributeValues",null);u(this,"cycleAttributeIndex",0);u(this,"cycleAttributeName","fillColor");u(this,"tasks",null);u(this,"tasksWindowImage",null);u(this,"tasksTop",20);u(this,"help",null);u(this,"helpWindowImage",null);u(this,"urlHelp",null);u(this,"helpWidth",300);u(this,"helpHeight",260);u(this,"propertiesWidth",240);u(this,"propertiesHeight",null);u(this,"movePropertiesDialog",!1);u(this,"validating",!1);u(this,"modified",!1);this.actions=[],this.addActions(),document.body!=null&&(this.cycleAttributeValues=[],this.popupHandler=new mxDefaultPopupMenu,this.undoManager=new mxUndoManager,this.graph=this.createGraph(),this.toolbar=this.createToolbar(),this.keyHandler=new mxDefaultKeyHandler(this),this.configure(t),this.graph.swimlaneIndicatorColorAttribute=this.cycleAttributeName,this.onInit!=null&&this.onInit())}isModified(){return this.modified}setModified(t){this.modified=t}addActions(){this.addAction("save",function(t){t.save()}),this.addAction("print",function(t){var e=new mxPrintPreview(t.graph,1);e.open()}),this.addAction("show",function(t){mxUtils.show(t.graph,null,10,10)}),this.addAction("exportImage",function(t){var e=t.getUrlImage();if(e==null||mxClient.IS_LOCAL)t.execute("show");else{var s=mxUtils.getViewXml(t.graph,1),n=mxUtils.getXml(s,`
`);mxUtils.submit(e,t.postParameterName+"="+encodeURIComponent(n),document,"_blank")}}),this.addAction("refresh",function(t){t.graph.refresh()}),this.addAction("cut",function(t){t.graph.isEnabled()&&mxClipboard.cut(t.graph)}),this.addAction("copy",function(t){t.graph.isEnabled()&&mxClipboard.copy(t.graph)}),this.addAction("paste",function(t){t.graph.isEnabled()&&mxClipboard.paste(t.graph)}),this.addAction("delete",function(t){t.graph.isEnabled()&&t.graph.removeCells()}),this.addAction("group",function(t){t.graph.isEnabled()&&t.graph.setSelectionCell(t.groupCells())}),this.addAction("ungroup",function(t){t.graph.isEnabled()&&t.graph.setSelectionCells(t.graph.ungroupCells())}),this.addAction("removeFromParent",function(t){t.graph.isEnabled()&&t.graph.removeCellsFromParent()}),this.addAction("undo",function(t){t.graph.isEnabled()&&t.undo()}),this.addAction("redo",function(t){t.graph.isEnabled()&&t.redo()}),this.addAction("zoomIn",function(t){t.graph.zoomIn()}),this.addAction("zoomOut",function(t){t.graph.zoomOut()}),this.addAction("actualSize",function(t){t.graph.zoomActual()}),this.addAction("fit",function(t){t.graph.fit()}),this.addAction("showProperties",function(t,e){t.showProperties(e)}),this.addAction("selectAll",function(t){t.graph.isEnabled()&&t.graph.selectAll()}),this.addAction("selectNone",function(t){t.graph.isEnabled()&&t.graph.clearSelection()}),this.addAction("selectVertices",function(t){t.graph.isEnabled()&&t.graph.selectVertices()}),this.addAction("selectEdges",function(t){t.graph.isEnabled()&&t.graph.selectEdges()}),this.addAction("edit",function(t,e){t.graph.isEnabled()&&t.graph.isCellEditable(e)&&t.graph.startEditingAtCell(e)}),this.addAction("toBack",function(t,e){t.graph.isEnabled()&&t.graph.orderCells(!0)}),this.addAction("toFront",function(t,e){t.graph.isEnabled()&&t.graph.orderCells(!1)}),this.addAction("enterGroup",function(t,e){t.graph.enterGroup(e)}),this.addAction("exitGroup",function(t){t.graph.exitGroup()}),this.addAction("home",function(t){t.graph.home()}),this.addAction("selectPrevious",function(t){t.graph.isEnabled()&&t.graph.selectPreviousCell()}),this.addAction("selectNext",function(t){t.graph.isEnabled()&&t.graph.selectNextCell()}),this.addAction("selectParent",function(t){t.graph.isEnabled()&&t.graph.selectParentCell()}),this.addAction("selectChild",function(t){t.graph.isEnabled()&&t.graph.selectChildCell()}),this.addAction("collapse",function(t){t.graph.isEnabled()&&t.graph.foldCells(!0)}),this.addAction("collapseAll",function(t){if(t.graph.isEnabled()){var e=t.graph.getChildVertices();t.graph.foldCells(!0,!1,e)}}),this.addAction("expand",function(t){t.graph.isEnabled()&&t.graph.foldCells(!1)}),this.addAction("expandAll",function(t){if(t.graph.isEnabled()){var e=t.graph.getChildVertices();t.graph.foldCells(!1,!1,e)}}),this.addAction("bold",function(t){t.graph.isEnabled()&&t.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_BOLD)}),this.addAction("italic",function(t){t.graph.isEnabled()&&t.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_ITALIC)}),this.addAction("underline",function(t){t.graph.isEnabled()&&t.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_UNDERLINE)}),this.addAction("alignCellsLeft",function(t){t.graph.isEnabled()&&t.graph.alignCells(mxConstants.ALIGN_LEFT)}),this.addAction("alignCellsCenter",function(t){t.graph.isEnabled()&&t.graph.alignCells(mxConstants.ALIGN_CENTER)}),this.addAction("alignCellsRight",function(t){t.graph.isEnabled()&&t.graph.alignCells(mxConstants.ALIGN_RIGHT)}),this.addAction("alignCellsTop",function(t){t.graph.isEnabled()&&t.graph.alignCells(mxConstants.ALIGN_TOP)}),this.addAction("alignCellsMiddle",function(t){t.graph.isEnabled()&&t.graph.alignCells(mxConstants.ALIGN_MIDDLE)}),this.addAction("alignCellsBottom",function(t){t.graph.isEnabled()&&t.graph.alignCells(mxConstants.ALIGN_BOTTOM)}),this.addAction("alignFontLeft",function(t){t.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT)}),this.addAction("alignFontCenter",function(t){t.graph.isEnabled()&&t.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER)}),this.addAction("alignFontRight",function(t){t.graph.isEnabled()&&t.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_RIGHT)}),this.addAction("alignFontTop",function(t){t.graph.isEnabled()&&t.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_TOP)}),this.addAction("alignFontMiddle",function(t){t.graph.isEnabled()&&t.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE)}),this.addAction("alignFontBottom",function(t){t.graph.isEnabled()&&t.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_BOTTOM)}),this.addAction("zoom",function(t){var e=t.graph.getView().scale*100,s=parseFloat(mxUtils.prompt(mxResources.get(t.askZoomResource)||t.askZoomResource,e))/100;isNaN(s)||t.graph.getView().setScale(s)}),this.addAction("toggleTasks",function(t){t.tasks!=null?t.tasks.setVisible(!t.tasks.isVisible()):t.showTasks()}),this.addAction("toggleHelp",function(t){t.help!=null?t.help.setVisible(!t.help.isVisible()):t.showHelp()}),this.addAction("toggleOutline",function(t){t.outline==null?t.showOutline():t.outline.setVisible(!t.outline.isVisible())}),this.addAction("toggleConsole",function(t){mxLog.setVisible(!mxLog.isVisible())})}configure(t){if(t!=null){var e=new mxCodec(t.ownerDocument);e.decode(t,this),this.resetHistory()}}resetFirstTime(){document.cookie="mxgraph=seen; expires=Fri, 27 Jul 2001 02:47:11 UTC; path=/"}resetHistory(){this.lastSnapshot=new Date().getTime(),this.undoManager.clear(),this.ignoredChanges=0,this.setModified(!1)}addAction(t,e){this.actions[t]=e}execute(t,e,s){var n=this.actions[t];if(n!=null)try{var l=arguments;l[0]=this,n.apply(this,l)}catch(r){throw mxUtils.error("Cannot execute "+t+": "+r.message,280,!0),r}else mxUtils.error("Cannot find action "+t,280,!0)}addTemplate(t,e){this.templates[t]=e}getTemplate(t){return this.templates[t]}createGraph(){var t=new mxGraph(null,null,this.graphRenderHint);return t.setTooltips(!0),t.setPanning(!0),this.installDblClickHandler(t),this.installUndoHandler(t),this.installDrillHandler(t),this.installChangeHandler(t),this.installInsertHandler(t),t.popupMenuHandler.factoryMethod=(e,s,n)=>this.createPopupMenu(e,s,n),t.connectionHandler.factoryMethod=(e,s)=>this.createEdge(e,s),this.createSwimlaneManager(t),this.createLayoutManager(t),t}createSwimlaneManager(t){var e=new mxSwimlaneManager(t,!1);return e.isHorizontal=()=>this.horizontalFlow,e.isEnabled=()=>this.maintainSwimlanes,e}createLayoutManager(t){var e=new mxLayoutManager(t),s=this;return e.getLayout=function(n){var l=null,r=s.graph.getModel();return r.getParent(n)!=null&&(s.layoutSwimlanes&&t.isSwimlane(n)?(s.swimlaneLayout==null&&(s.swimlaneLayout=s.createSwimlaneLayout()),l=s.swimlaneLayout):s.layoutDiagram&&(t.isValidRoot(n)||r.getParent(r.getParent(n))==null)&&(s.diagramLayout==null&&(s.diagramLayout=s.createDiagramLayout()),l=s.diagramLayout)),l},e}setGraphContainer(t){this.graph.container==null&&(this.graph.init(t),this.rubberband=new mxRubberband(this.graph),this.disableContextMenu&&mxEvent.disableContextMenu(t),mxClient.IS_QUIRKS&&new mxDivResizer(t))}installDblClickHandler(t){t.addListener(mxEvent.DOUBLE_CLICK,(e,s)=>{var n=s.getProperty("cell");n!=null&&t.isEnabled()&&this.dblClickAction!=null&&(this.execute(this.dblClickAction,n),s.consume())})}installUndoHandler(t){var e=(n,l)=>{var r=l.getProperty("edit");this.undoManager.undoableEditHappened(r)};t.getModel().addListener(mxEvent.UNDO,e),t.getView().addListener(mxEvent.UNDO,e);var s=function(n,l){var r=l.getProperty("edit").changes;t.setSelectionCells(t.getSelectionCellsForChanges(r))};this.undoManager.addListener(mxEvent.UNDO,s),this.undoManager.addListener(mxEvent.REDO,s)}installDrillHandler(t){var e=s=>{this.fireEvent(new mxEventObject(mxEvent.ROOT))};t.getView().addListener(mxEvent.DOWN,e),t.getView().addListener(mxEvent.UP,e)}installChangeHandler(t){var e=(s,n)=>{this.setModified(!0),this.validating==!0&&t.validateGraph();for(var l=n.getProperty("edit").changes,r=0;r<l.length;r++){var a=l[r];if(a instanceof mxRootChange||a instanceof mxValueChange&&a.cell==this.graph.model.root||a instanceof mxCellAttributeChange&&a.cell==this.graph.model.root){this.fireEvent(new mxEventObject(mxEvent.ROOT));break}}};t.getModel().addListener(mxEvent.CHANGE,e)}installInsertHandler(t){var e=this,s={mouseDown:function(n,l){e.insertFunction!=null&&!l.isPopupTrigger()&&(e.forcedInserting||l.getState()==null)&&(e.graph.clearSelection(),e.insertFunction(l.getEvent(),l.getCell()),this.isActive=!0,l.consume())},mouseMove:function(n,l){this.isActive&&l.consume()},mouseUp:function(n,l){this.isActive&&(this.isActive=!1,l.consume())}};t.addMouseListener(s)}createDiagramLayout(){var t=this.graph.gridSize,e=new mxStackLayout(this.graph,!this.horizontalFlow,this.swimlaneSpacing,2*t,2*t);return e.isVertexIgnored=function(s){return!e.graph.isSwimlane(s)},e}createSwimlaneLayout(){return new mxCompactTreeLayout(this.graph,this.horizontalFlow)}createToolbar(){return new mxDefaultToolbar(null,this)}setToolbarContainer(t){this.toolbar.init(t),mxClient.IS_QUIRKS&&new mxDivResizer(t)}setStatusContainer(t){this.status==null&&(this.status=t,this.addListener(mxEvent.SAVE,()=>{var e=new Date().toLocaleString();this.setStatus((mxResources.get(this.lastSavedResource)||this.lastSavedResource)+": "+e)}),this.addListener(mxEvent.OPEN,()=>{this.setStatus((mxResources.get(this.currentFileResource)||this.currentFileResource)+": "+this.filename)}),mxClient.IS_QUIRKS&&new mxDivResizer(t))}setStatus(t){this.status!=null&&t!=null&&(this.status.innerHTML=t)}setTitleContainer(t){this.addListener(mxEvent.ROOT,e=>{t.innerHTML=this.getTitle()}),mxClient.IS_QUIRKS&&new mxDivResizer(t)}treeLayout(t,e){if(t!=null){var s=new mxCompactTreeLayout(this.graph,e);s.execute(t)}}getTitle(){for(var t="",e=this.graph,s=e.getCurrentRoot();s!=null&&e.getModel().getParent(e.getModel().getParent(s))!=null;)e.isValidRoot(s)&&(t=" > "+e.convertValueToString(s)+t),s=e.getModel().getParent(s);var n=this.getRootTitle();return n+t}getRootTitle(){var t=this.graph.getModel().getRoot();return this.graph.convertValueToString(t)}undo(){this.undoManager.undo()}redo(){this.undoManager.redo()}groupCells(){var t=this.groupBorderSize!=null?this.groupBorderSize:this.graph.gridSize;return this.graph.groupCells(this.createGroup(),t)}createGroup(){var t=this.graph.getModel();return t.cloneCell(this.defaultGroup)}open(t){if(t!=null){var e=mxUtils.load(t).getXml();this.readGraphModel(e.documentElement),this.filename=t,this.fireEvent(new mxEventObject(mxEvent.OPEN,"filename",t))}}readGraphModel(t){var e=new mxCodec(t.ownerDocument);e.decode(t,this.graph.getModel()),this.resetHistory()}save(t,e){if(t=t||this.getUrlPost(),t!=null&&t.length>0){var s=this.writeGraphModel(e);this.postDiagram(t,s),this.setModified(!1)}this.fireEvent(new mxEventObject(mxEvent.SAVE,"url",t))}postDiagram(t,e){this.escapePostData&&(e=encodeURIComponent(e)),mxUtils.post(t,this.postParameterName+"="+e,s=>{this.fireEvent(new mxEventObject(mxEvent.POST,"request",s,"url",t,"data",e))})}writeGraphModel(t){t=t??this.linefeed;var e=new mxCodec,s=e.encode(this.graph.getModel());return mxUtils.getXml(s,t)}getUrlPost(){return this.urlPost}getUrlImage(){return this.urlImage}swapStyles(t,e){var s=this.graph.getStylesheet().styles[e];this.graph.getView().getStylesheet().putCellStyle(e,this.graph.getStylesheet().styles[t]),this.graph.getStylesheet().putCellStyle(t,s),this.graph.refresh()}showProperties(t){if(t=t||this.graph.getSelectionCell(),t==null&&(t=this.graph.getCurrentRoot(),t==null&&(t=this.graph.getModel().getRoot())),t!=null){this.graph.stopEditing(!0);var e=mxUtils.getOffset(this.graph.container),s=e.x+10,n=e.y;if(this.properties!=null&&!this.movePropertiesDialog)s=this.properties.getX(),n=this.properties.getY();else{var l=this.graph.getCellBounds(t);l!=null&&(s+=l.x+Math.min(200,l.width),n+=l.y)}this.hideProperties();var r=this.createProperties(t);r!=null&&(this.properties=new mxWindow(mxResources.get(this.propertiesResource)||this.propertiesResource,r,s,n,this.propertiesWidth,this.propertiesHeight,!1),this.properties.setVisible(!0))}}isPropertiesVisible(){return this.properties!=null}createProperties(t){var e=this.graph.getModel(),s=e.getValue(t);if(mxUtils.isNode(s)){var n=new mxForm("properties"),l=n.addText("ID",t.getId());l.setAttribute("readonly","true");var r=null,a=null,o=null,h=null,d=null;e.isVertex(t)&&(r=e.getGeometry(t),r!=null&&(a=n.addText("top",r.y),o=n.addText("left",r.x),h=n.addText("width",r.width),d=n.addText("height",r.height)));for(var g=e.getStyle(t),m=n.addText("Style",g||""),f=s.attributes,c=[],x=0;x<f.length;x++){var p=f[x].value;c[x]=n.addTextarea(f[x].nodeName,p,f[x].nodeName=="label"?4:2)}var C=()=>{this.hideProperties(),e.beginUpdate();try{r!=null&&(r=r.clone(),r.x=parseFloat(o.value),r.y=parseFloat(a.value),r.width=parseFloat(h.value),r.height=parseFloat(d.value),e.setGeometry(t,r)),m.value.length>0?e.setStyle(t,m.value):e.setStyle(t,null);for(var T=0;T<f.length;T++){var S=new mxCellAttributeChange(t,f[T].nodeName,c[T].value);e.execute(S)}this.graph.isAutoSizeCell(t)&&this.graph.updateCellSize(t)}finally{e.endUpdate()}},E=()=>{this.hideProperties()};return n.addButtons(C,E),n.table}return null}hideProperties(){this.properties!=null&&(this.properties.destroy(),this.properties=null)}showTasks(){if(this.tasks==null){var t=document.createElement("div");t.style.padding="4px",t.style.paddingLeft="20px";var e=document.body.clientWidth,s=new mxWindow(mxResources.get(this.tasksResource)||this.tasksResource,t,e-220,this.tasksTop,200);s.setClosable(!0),s.destroyOnClose=!1;var n=l=>{mxEvent.release(t),t.innerHTML="",this.createTasks(t)};this.graph.getModel().addListener(mxEvent.CHANGE,n),this.graph.getSelectionModel().addListener(mxEvent.CHANGE,n),this.graph.addListener(mxEvent.ROOT,n),this.tasksWindowImage!=null&&s.setImage(this.tasksWindowImage),this.tasks=s,this.createTasks(t)}this.tasks.setVisible(!0)}refreshTasks(t){if(this.tasks!=null){var t=this.tasks.content;mxEvent.release(t),t.innerHTML="",this.createTasks(t)}}createTasks(t){}showHelp(t){if(this.help==null){var e=document.createElement("iframe");e.setAttribute("src",mxResources.get("urlHelp")||this.urlHelp),e.setAttribute("height","100%"),e.setAttribute("width","100%"),e.setAttribute("frameBorder","0"),e.style.backgroundColor="white";var s=document.body.clientWidth,n=document.body.clientHeight||document.documentElement.clientHeight,l=new mxWindow(mxResources.get(this.helpResource)||this.helpResource,e,(s-this.helpWidth)/2,(n-this.helpHeight)/3,this.helpWidth,this.helpHeight);if(l.setMaximizable(!0),l.setClosable(!0),l.destroyOnClose=!1,l.setResizable(!0),this.helpWindowImage!=null&&l.setImage(this.helpWindowImage),mxClient.IS_NS){var r=function(a){var o=l.div.offsetHeight;e.setAttribute("height",o-26+"px")};l.addListener(mxEvent.RESIZE_END,r),l.addListener(mxEvent.MAXIMIZE,r),l.addListener(mxEvent.NORMALIZE,r),l.addListener(mxEvent.SHOW,r)}this.help=l}this.help.setVisible(!0)}showOutline(){var t=this.outline==null;if(t){var e=document.createElement("div");e.style.overflow="hidden",e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.background="white",e.style.cursor="move",document.documentMode==8&&(e.style.filter="progid:DXImageTransform.Microsoft.alpha(opacity=100)");var s=new mxWindow(mxResources.get(this.outlineResource)||this.outlineResource,e,600,480,200,200,!1),n=new mxOutline(this.graph,e);s.setClosable(!0),s.setResizable(!0),s.destroyOnClose=!1,s.addListener(mxEvent.RESIZE_END,function(){n.update()}),this.outline=s,this.outline.outline=n}this.outline.setVisible(!0),this.outline.outline.update(!0)}setMode(t){t=="select"?(this.graph.panningHandler.useLeftButtonForPanning=!1,this.graph.setConnectable(!1)):t=="connect"?(this.graph.panningHandler.useLeftButtonForPanning=!1,this.graph.setConnectable(!0)):t=="pan"&&(this.graph.panningHandler.useLeftButtonForPanning=!0,this.graph.setConnectable(!1))}createPopupMenu(t,e,s){this.popupHandler.createMenu(this,t,e,s)}createEdge(t,e){var s=null;if(this.defaultEdge!=null){var n=this.graph.getModel();s=n.cloneCell(this.defaultEdge)}else{s=new mxCell(""),s.setEdge(!0);var l=new mxGeometry;l.relative=!0,s.setGeometry(l)}var r=this.getEdgeStyle();return r!=null&&s.setStyle(r),s}getEdgeStyle(){return this.defaultEdgeStyle}consumeCycleAttribute(t){return this.cycleAttributeValues!=null&&this.cycleAttributeValues.length>0&&this.graph.isSwimlane(t)?this.cycleAttributeValues[this.cycleAttributeIndex++%this.cycleAttributeValues.length]:null}cycleAttribute(t){if(this.cycleAttributeName!=null){var e=this.consumeCycleAttribute(t);e!=null&&t.setStyle(t.getStyle()+";"+this.cycleAttributeName+"="+e)}}addVertex(t,e,s,n){for(var l=this.graph.getModel();t!=null&&!this.graph.isValidDropTarget(t);)t=l.getParent(t);t=t??this.graph.getSwimlaneAt(s,n);var r=this.graph.getView().scale,a=l.getGeometry(e),o=l.getGeometry(t);if(this.graph.isSwimlane(e)&&!this.graph.swimlaneNesting)t=null;else{if(t==null&&this.swimlaneRequired)return null;if(t!=null&&o!=null){var h=this.graph.getView().getState(t);if(h!=null){if(s-=h.origin.x*r,n-=h.origin.y*r,this.graph.isConstrainedMoving){var d=a.width,g=a.height,m=h.x+h.width;s+d>m&&(s-=s+d-m),m=h.y+h.height,n+g>m&&(n-=n+g-m)}}else o!=null&&(s-=o.x*r,n-=o.y*r)}}a=Object.assign(Object.create(Object.getPrototypeOf(a)),a),a.x=this.graph.snap(s/r-this.graph.getView().translate.x-this.graph.gridSize/2),a.y=this.graph.snap(n/r-this.graph.getView().translate.y-this.graph.gridSize/2),e.setGeometry(a),t==null&&(t=this.graph.getDefaultParent()),this.cycleAttribute(e),this.fireEvent(new mxEventObject(mxEvent.BEFORE_ADD_VERTEX,"vertex",e,"parent",t)),l.beginUpdate();try{e=this.graph.addCell(e,t),e!=null&&(this.graph.constrainChild(e),this.fireEvent(new mxEventObject(mxEvent.ADD_VERTEX,"vertex",e)))}finally{l.endUpdate()}return e!=null&&(this.graph.setSelectionCell(e),this.graph.scrollCellToVisible(e),this.fireEvent(new mxEventObject(mxEvent.AFTER_ADD_VERTEX,"vertex",e))),e}destroy(){this.destroyed||(this.destroyed=!0,this.tasks!=null&&this.tasks.destroy(),this.outline!=null&&this.outline.destroy(),this.properties!=null&&this.properties.destroy(),this.keyHandler!=null&&this.keyHandler.destroy(),this.rubberband!=null&&this.rubberband.destroy(),this.toolbar!=null&&this.toolbar.destroy(),this.graph!=null&&this.graph.destroy(),this.status=null,this.templates=null)}}class mxEditorCodec extends mxObjectCodec{constructor(){super(new mxEditor,["modified","lastSnapshot","ignoredChanges","undoManager","graphContainer","toolbarContainer"])}afterDecode(i,t,e){var s=t.getAttribute("defaultEdge");s!=null&&(t.removeAttribute("defaultEdge"),e.defaultEdge=e.templates[s]);var n=t.getAttribute("defaultGroup");return n!=null&&(t.removeAttribute("defaultGroup"),e.defaultGroup=e.templates[n]),e}decodeChild(i,t,e){if(t.nodeName=="Array"){var s=t.getAttribute("as");if(s=="templates"){this.decodeTemplates(i,t,e);return}}else if(t.nodeName=="ui"){this.decodeUi(i,t,e);return}super.decodeChild(i,t,e)}decodeUi(i,t,e){for(var s=t.firstChild;s!=null;){if(s.nodeName=="add"){var n=s.getAttribute("as"),l=s.getAttribute("element"),r=s.getAttribute("style"),a=null;if(l!=null)a=document.getElementById(l),a!=null&&r!=null&&(a.style.cssText+=";"+r);else{var o=parseInt(s.getAttribute("x")),h=parseInt(s.getAttribute("y")),d=s.getAttribute("width"),g=s.getAttribute("height");a=document.createElement("div"),a.style.cssText=r;var m=new mxWindow(mxResources.get(n)||n,a,o,h,d,g,!1,!0);m.setVisible(!0)}n=="graph"?e.setGraphContainer(a):n=="toolbar"?e.setToolbarContainer(a):n=="title"?e.setTitleContainer(a):n=="status"?e.setStatusContainer(a):n=="map"&&e.setMapContainer(a)}else s.nodeName=="resource"?mxResources.add(s.getAttribute("basename")):s.nodeName=="stylesheet"&&mxClient.link("stylesheet",s.getAttribute("name"));s=s.nextSibling}}decodeTemplates(i,t,e){e.templates==null&&(e.templates=[]);for(var s=mxUtils.getChildNodes(t),n=0;n<s.length;n++){for(var l=s[n].getAttribute("as"),r=s[n].firstChild;r!=null&&r.nodeType!=1;)r=r.nextSibling;r!=null&&(e.templates[l]=i.decodeCell(r))}}}class mxGenericChangeCodec extends mxObjectCodec{constructor(i,t){super(i,["model","previous"],["cell"]),this.variable=t}afterDecode(i,t,e){return mxUtils.isNode(e.cell)&&(e.cell=i.decodeCell(e.cell,!1)),e.previous=e[this.variable],e}}class mxGraphCodec extends mxObjectCodec{constructor(){super(new mxGraph,["graphListeners","eventListeners","view","container","cellRenderer","editor","selection"])}}class mxGraphViewCodec extends mxObjectCodec{constructor(){super(new mxGraphView)}encode(i,t){return this.encodeCell(i,t,t.graph.getModel().getRoot())}encodeCell(i,t,e){var s=t.graph.getModel(),n=t.getState(e),l=s.getParent(e);if(l==null||n!=null){var r=s.getChildCount(e),a=t.graph.getCellGeometry(e),o=null;if(l==s.getRoot()?o="layer":l==null?o="graph":s.isEdge(e)?o="edge":r>0&&a!=null?o="group":s.isVertex(e)&&(o="vertex"),o!=null){var h=i.document.createElement(o),d=t.graph.getLabel(e);if(d!=null&&(h.setAttribute("label",t.graph.getLabel(e)),t.graph.isHtmlLabel(e)&&h.setAttribute("html",!0)),l==null){var g=t.getGraphBounds();g!=null&&(h.setAttribute("x",Math.round(g.x)),h.setAttribute("y",Math.round(g.y)),h.setAttribute("width",Math.round(g.width)),h.setAttribute("height",Math.round(g.height))),h.setAttribute("scale",t.scale)}else if(n!=null&&a!=null){for(var m in n.style){var f=n.style[m];typeof f=="function"&&typeof f=="object"&&(f=mxStyleRegistry.getName(f)),f!=null&&typeof f!="function"&&typeof f!="object"&&h.setAttribute(m,f)}var c=n.absolutePoints;if(c!=null&&c.length>0){for(var x=Math.round(c[0].x)+","+Math.round(c[0].y),m=1;m<c.length;m++)x+=" "+Math.round(c[m].x)+","+Math.round(c[m].y);h.setAttribute("points",x)}else h.setAttribute("x",Math.round(n.x)),h.setAttribute("y",Math.round(n.y)),h.setAttribute("width",Math.round(n.width)),h.setAttribute("height",Math.round(n.height));var p=n.absoluteOffset;p!=null&&(p.x!=0&&h.setAttribute("dx",Math.round(p.x)),p.y!=0&&h.setAttribute("dy",Math.round(p.y)))}for(var m=0;m<r;m++){var C=this.encodeCell(i,t,s.getChildAt(e,m));C!=null&&h.appendChild(C)}}}return h}}class mxModelCodec extends mxObjectCodec{constructor(){super(new mxGraphModel)}encodeObject(i,t,e){var s=i.document.createElement("root");i.encodeCell(t.getRoot(),s),e.appendChild(s)}decodeChild(i,t,e){t.nodeName=="root"?this.decodeRoot(i,t,e):super.decodeChild(i,t,e)}decodeRoot(i,t,e){for(var s=null,n=t.firstChild;n!=null;){var l=i.decodeCell(n);l!=null&&l.getParent()==null&&(s=l),n=n.nextSibling}s!=null&&e.setRoot(s)}}class mxRootChangeCodec extends mxObjectCodec{constructor(){super(new mxRootChange,["model","previous","root"])}afterEncode(i,t,e){return i.encodeCell(t.root,e),e}beforeDecode(i,t,e){if(t.firstChild!=null&&t.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT){t=t.cloneNode(!0);var s=t.firstChild;e.root=i.decodeCell(s,!1);var n=s.nextSibling;for(s.parentNode.removeChild(s),s=n;s!=null;)n=s.nextSibling,i.decodeCell(s),s.parentNode.removeChild(s),s=n}return t}afterDecode(i,t,e){return e.previous=e.root,e}}const At=class At extends mxObjectCodec{constructor(){super(new mxStylesheet)}encode(i,t){var e=i.document.createElement(this.getName());for(var s in t.styles){var n=t.styles[s],l=i.document.createElement("add");if(s!=null){l.setAttribute("as",s);for(var r in n){var a=this.getStringValue(r,n[r]);if(a!=null){var o=i.document.createElement("add");o.setAttribute("value",a),o.setAttribute("as",r),l.appendChild(o)}}l.childNodes.length>0&&e.appendChild(l)}}return e}getStringValue(i,t){var e=typeof t;return e=="function"?t=mxStyleRegistry.getName(t):e=="object"&&(t=null),t}decode(i,t,e){var s=e||new this.template.constructor,n=t.getAttribute("id");for(n!=null&&(i.objects[n]=s),t=t.firstChild;t!=null;){if(!this.processInclude(i,t,s)&&t.nodeName=="add"){var l=t.getAttribute("as");if(l!=null){var r=t.getAttribute("extend"),a=r!=null?mxUtils.clone(s.styles[r]):null;a==null&&(r!=null&&mxLog.warn("mxStylesheetCodec.decode: stylesheet "+r+" not found to extend"),a=new Object);for(var o=t.firstChild;o!=null;){if(o.nodeType==mxConstants.NODETYPE_ELEMENT){var h=o.getAttribute("as");if(o.nodeName=="add"){var d=mxUtils.getTextContent(o),g=null;d!=null&&d.length>0&&At.allowEval?g=mxUtils.eval(d):(g=o.getAttribute("value"),mxUtils.isNumeric(g)&&(g=parseFloat(g))),g!=null&&(a[h]=g)}else o.nodeName=="remove"&&delete a[h]}o=o.nextSibling}s.putCellStyle(l,a)}}t=t.nextSibling}return s}};u(At,"allowEval",!0);let mxStylesheetCodec=At;class mxTerminalChangeCodec extends mxObjectCodec{constructor(){super(new mxTerminalChange,["model","previous"],["cell","terminal"])}afterDecode(i,t,e){return e.previous=e.terminal,e}}class mxCylinder extends mxShape{constructor(t,e,s,n){super();u(this,"maxHeight",40);u(this,"svgStrokeTolerance",0);this.bounds=t,this.fill=e,this.stroke=s,this.strokewidth=n??1}paintVertexShape(t,e,s,n,l){t.translate(e,s),t.begin(),this.redrawPath(t,e,s,n,l,!1),t.fillAndStroke(),(!this.outline||this.style==null||mxUtils.getValue(this.style,mxConstants.STYLE_BACKGROUND_OUTLINE,0)==0)&&(t.setShadow(!1),t.begin(),this.redrawPath(t,e,s,n,l,!0),t.stroke())}getCylinderSize(t,e,s,n){return Math.min(this.maxHeight,Math.round(n/5))}redrawPath(t,e,s,n,l,r){var a=this.getCylinderSize(e,s,n,l);(r&&this.fill!=null||!r&&this.fill==null)&&(t.moveTo(0,a),t.curveTo(0,2*a,n,2*a,n,a),r||(t.stroke(),t.begin())),r||(t.moveTo(0,a),t.curveTo(0,-a/3,n,-a/3,n,a),t.lineTo(n,l-a),t.curveTo(n,l+a/3,0,l+a/3,0,l-a),t.close())}}class mxRhombus extends mxShape{constructor(i,t,e,s){super(),this.bounds=i,this.fill=t,this.stroke=e,this.strokewidth=s??1}isRoundable(){return!0}paintVertexShape(i,t,e,s,n){var l=s/2,r=n/2,a=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;i.begin(),this.addPoints(i,[new mxPoint(t+l,e),new mxPoint(t+s,e+r),new mxPoint(t+l,e+n),new mxPoint(t,e+r)],this.isRounded,a,!0),i.fillAndStroke()}}class mxSwimlane extends mxShape{constructor(t,e,s,n){super();u(this,"imageSize",16);this.bounds=t,this.fill=e,this.stroke=s,this.strokewidth=n??1}isRoundable(t,e,s,n,l){return!0}getTitleSize(){return Math.max(0,mxUtils.getValue(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE))}getLabelBounds(t){var e=this.getTitleSize(),s=new mxRectangle(t.x,t.y,t.width,t.height),n=this.isHorizontal(),l=mxUtils.getValue(this.style,mxConstants.STYLE_FLIPH,0)==1,r=mxUtils.getValue(this.style,mxConstants.STYLE_FLIPV,0)==1,a=this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH,o=n==!a,h=!o&&l!=(this.direction==mxConstants.DIRECTION_SOUTH||this.direction==mxConstants.DIRECTION_WEST),d=o&&r!=(this.direction==mxConstants.DIRECTION_SOUTH||this.direction==mxConstants.DIRECTION_WEST);if(a){var g=Math.min(s.width,e*this.scale);(h||d)&&(s.x+=s.width-g),s.width=g}else{var g=Math.min(s.height,e*this.scale);(h||d)&&(s.y+=s.height-g),s.height=g}return s}getGradientBounds(t,e,s,n,l){var r=this.getTitleSize();return this.isHorizontal()?(r=Math.min(r,l),new mxRectangle(e,s,n,r)):(r=Math.min(r,n),new mxRectangle(e,s,r,l))}getSwimlaneArcSize(t,e,s){if(mxUtils.getValue(this.style,mxConstants.STYLE_ABSOLUTE_ARCSIZE,0)=="1")return Math.min(t/2,Math.min(e/2,mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2));var n=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.RECTANGLE_ROUNDING_FACTOR*100)/100;return s*n*3}isHorizontal(){return mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,1)==1}paintVertexShape(t,e,s,n,l){var r=this.getTitleSize(),a=mxUtils.getValue(this.style,mxConstants.STYLE_SWIMLANE_FILLCOLOR,mxConstants.NONE),o=mxUtils.getValue(this.style,mxConstants.STYLE_SWIMLANE_LINE,1)==1,h=0;this.isHorizontal()?r=Math.min(r,l):r=Math.min(r,n),t.translate(e,s),this.isRounded?(h=this.getSwimlaneArcSize(n,l,r),h=Math.min((this.isHorizontal()?l:n)-r,Math.min(r,h)),this.paintRoundedSwimlane(t,e,s,n,l,r,h,a,o)):this.paintSwimlane(t,e,s,n,l,r,a,o);var d=mxUtils.getValue(this.style,mxConstants.STYLE_SEPARATORCOLOR,mxConstants.NONE);if(this.paintSeparator(t,e,s,n,l,r,d),this.image!=null){var g=this.getImageBounds(e,s,n,l);t.image(g.x-e,g.y-s,g.width,g.height,this.image,!1,!1,!1)}this.glass&&(t.setShadow(!1),this.paintGlassEffect(t,0,0,n,r,h))}paintSwimlane(t,e,s,n,l,r,a,o){t.begin();var h=!0;this.style!=null&&(h=mxUtils.getValue(this.style,mxConstants.STYLE_POINTER_EVENTS,"1")=="1"),!h&&(this.fill==null||this.fill==mxConstants.NONE)&&(t.pointerEvents=!1),this.isHorizontal()?(t.moveTo(0,r),t.lineTo(0,0),t.lineTo(n,0),t.lineTo(n,r),t.fillAndStroke(),r<l&&((a==mxConstants.NONE||!h)&&(t.pointerEvents=!1),a!=mxConstants.NONE&&t.setFillColor(a),t.begin(),t.moveTo(0,r),t.lineTo(0,l),t.lineTo(n,l),t.lineTo(n,r),a==mxConstants.NONE?t.stroke():t.fillAndStroke())):(t.moveTo(r,0),t.lineTo(0,0),t.lineTo(0,l),t.lineTo(r,l),t.fillAndStroke(),r<n&&((a==mxConstants.NONE||!h)&&(t.pointerEvents=!1),a!=mxConstants.NONE&&t.setFillColor(a),t.begin(),t.moveTo(r,0),t.lineTo(n,0),t.lineTo(n,l),t.lineTo(r,l),a==mxConstants.NONE?t.stroke():t.fillAndStroke())),o&&this.paintDivider(t,e,s,n,l,r,a==mxConstants.NONE)}paintRoundedSwimlane(t,e,s,n,l,r,a,o,h){t.begin();var d=!0;this.style!=null&&(d=mxUtils.getValue(this.style,mxConstants.STYLE_POINTER_EVENTS,"1")=="1"),!d&&(this.fill==null||this.fill==mxConstants.NONE)&&(t.pointerEvents=!1),this.isHorizontal()?(t.moveTo(n,r),t.lineTo(n,a),t.quadTo(n,0,n-Math.min(n/2,a),0),t.lineTo(Math.min(n/2,a),0),t.quadTo(0,0,0,a),t.lineTo(0,r),t.fillAndStroke(),r<l&&((o==mxConstants.NONE||!d)&&(t.pointerEvents=!1),o!=mxConstants.NONE&&t.setFillColor(o),t.begin(),t.moveTo(0,r),t.lineTo(0,l-a),t.quadTo(0,l,Math.min(n/2,a),l),t.lineTo(n-Math.min(n/2,a),l),t.quadTo(n,l,n,l-a),t.lineTo(n,r),o==mxConstants.NONE?t.stroke():t.fillAndStroke())):(t.moveTo(r,0),t.lineTo(a,0),t.quadTo(0,0,0,Math.min(l/2,a)),t.lineTo(0,l-Math.min(l/2,a)),t.quadTo(0,l,a,l),t.lineTo(r,l),t.fillAndStroke(),r<n&&((o==mxConstants.NONE||!d)&&(t.pointerEvents=!1),o!=mxConstants.NONE&&t.setFillColor(o),t.begin(),t.moveTo(r,l),t.lineTo(n-a,l),t.quadTo(n,l,n,l-Math.min(l/2,a)),t.lineTo(n,Math.min(l/2,a)),t.quadTo(n,0,n-a,0),t.lineTo(r,0),o==mxConstants.NONE?t.stroke():t.fillAndStroke())),h&&this.paintDivider(t,e,s,n,l,r,o==mxConstants.NONE)}paintDivider(t,e,s,n,l,r,a){a||t.setShadow(!1),t.begin(),this.isHorizontal()?(t.moveTo(0,r),t.lineTo(n,r)):(t.moveTo(r,0),t.lineTo(r,l)),t.stroke()}paintSeparator(t,e,s,n,l,r,a){a!=mxConstants.NONE&&(t.setStrokeColor(a),t.setDashed(!0),t.begin(),this.isHorizontal()?(t.moveTo(n,r),t.lineTo(n,l)):(t.moveTo(r,0),t.lineTo(n,0)),t.stroke(),t.setDashed(!1))}getImageBounds(t,e,s,n){return this.isHorizontal()?new mxRectangle(t+s-this.imageSize,e,this.imageSize,this.imageSize):new mxRectangle(t,e,this.imageSize,this.imageSize)}}class mxDoubleEllipse extends mxShape{constructor(t,e,s,n){super();u(this,"vmlScale",10);this.bounds=t,this.fill=e,this.stroke=s,this.strokewidth=n??1}paintBackground(t,e,s,n,l){t.ellipse(e,s,n,l),t.fillAndStroke()}paintForeground(t,e,s,n,l){if(!this.outline){var r=mxUtils.getValue(this.style,mxConstants.STYLE_MARGIN,Math.min(3+this.strokewidth,Math.min(n/5,l/5)));e+=r,s+=r,n-=2*r,l-=2*r,n>0&&l>0&&t.ellipse(e,s,n,l),t.stroke()}}getLabelBounds(t){var e=mxUtils.getValue(this.style,mxConstants.STYLE_MARGIN,Math.min(3+this.strokewidth,Math.min(t.width/5/this.scale,t.height/5/this.scale)))*this.scale;return new mxRectangle(t.x+e,t.y+e,t.width-2*e,t.height-2*e)}}class mxArrowConnector extends mxShape{constructor(t,e,s,n,l,r,a){super();u(this,"useSvgBoundingBox",!0);this.points=t,this.fill=e,this.stroke=s,this.strokewidth=n??1,this.arrowWidth=l??mxConstants.ARROW_WIDTH,this.arrowSpacing=r??mxConstants.ARROW_SPACING,this.startSize=mxConstants.ARROW_SIZE/5,this.endSize=mxConstants.ARROW_SIZE/5}resetStyles(){super.resetStyles(),this.arrowSpacing=mxConstants.ARROW_SPACING}apply(t){super.apply(t),this.style!=null&&(this.startSize=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.ARROW_SIZE/5)*3,this.endSize=mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,mxConstants.ARROW_SIZE/5)*3)}augmentBoundingBox(t){super.augmentBoundingBox(t);var e=this.getEdgeWidth();this.isMarkerStart()&&(e=Math.max(e,this.getStartArrowWidth())),this.isMarkerEnd()&&(e=Math.max(e,this.getEndArrowWidth())),t.grow((e/2+this.strokewidth)*this.scale)}paintEdgeShape(t,e){var s=this.strokewidth;this.outline&&(s=Math.max(1,mxUtils.getNumber(this.style,mxConstants.STYLE_STROKEWIDTH,this.strokewidth)));for(var n=this.getStartArrowWidth()+s,l=this.getEndArrowWidth()+s,r=this.outline?this.getEdgeWidth()+s:this.getEdgeWidth(),a=this.isOpenEnded(),o=this.isMarkerStart(),h=this.isMarkerEnd(),d=a?0:this.arrowSpacing+s/2,g=this.startSize+s,m=this.endSize+s,f=this.isArrowRounded(),c=e[e.length-1],x=1;x<e.length-1&&e[x].x==e[0].x&&e[x].y==e[0].y;)x++;var p=e[x].x-e[0].x,C=e[x].y-e[0].y,E=Math.sqrt(p*p+C*C);if(E!=0){var T=p/E,S,y=T,b=C/E,w,I=b,O=r*b,P=-r*T,M=[];f?t.setLineJoin("round"):e.length>2&&t.setMiterLimit(1.42),t.begin();var H=T,R=b;if(o&&!a)this.paintMarker(t,e[0].x,e[0].y,T,b,g,n,r,d,!0);else{var D=e[0].x+O/2+d*T,A=e[0].y+P/2+d*b,G=e[0].x-O/2+d*T,B=e[0].y-P/2+d*b;a?(t.moveTo(D,A),M.push(function(){t.lineTo(G,B)})):(t.moveTo(G,B),t.lineTo(D,A))}for(var tt=0,q=0,j=0,V=0;V<e.length-2;V++){var X=mxUtils.relativeCcw(e[V].x,e[V].y,e[V+1].x,e[V+1].y,e[V+2].x,e[V+2].y);if(tt=e[V+2].x-e[V+1].x,q=e[V+2].y-e[V+1].y,j=Math.sqrt(tt*tt+q*q),j!=0){y=tt/j,I=q/j;var Z=T*y+b*I,et=Math.max(Math.sqrt((Z+1)/2),.04);S=T+y,w=b+I;var nt=Math.sqrt(S*S+w*w);if(nt!=0){S=S/nt,w=w/nt;var lt=Math.max(et,Math.min(this.strokewidth/200+.04,.35)),it=X!=0&&f?Math.max(.1,lt):Math.max(et,.06),Q=e[V+1].x+w*r/2/it,Y=e[V+1].y-S*r/2/it,z=e[V+1].x-w*r/2/it,W=e[V+1].y+S*r/2/it;if(X==0||!f)t.lineTo(Q,Y),function(st,K){M.push(function(){t.lineTo(st,K)})}(z,W);else if(X==-1){var rt=z+b*r,It=W-T*r,F=z+I*r,ut=W-y*r;t.lineTo(rt,It),t.quadTo(Q,Y,F,ut),function(st,K){M.push(function(){t.lineTo(st,K)})}(z,W)}else t.lineTo(Q,Y),function(st,K){var wt=Q-b*r,Rt=Y+T*r,ht=Q-I*r,Ot=Y+y*r;M.push(function(){t.quadTo(st,K,wt,Rt)}),M.push(function(){t.lineTo(ht,Ot)})}(z,W);T=y,b=I}}}if(O=r*I,P=-r*y,h&&!a)this.paintMarker(t,c.x,c.y,-T,-b,m,l,r,d,!1);else{t.lineTo(c.x-d*y+O/2,c.y-d*I+P/2);var dt=c.x-d*y-O/2,gt=c.y-d*I-P/2;a?(t.moveTo(dt,gt),M.splice(0,0,function(){t.moveTo(dt,gt)})):t.lineTo(dt,gt)}for(var V=M.length-1;V>=0;V--)M[V]();a?(t.end(),t.stroke()):(t.close(),t.fillAndStroke()),t.setShadow(!1),t.setMiterLimit(4),f&&t.setLineJoin("flat"),e.length>2&&(t.setMiterLimit(4),o&&!a&&(t.begin(),this.paintMarker(t,e[0].x,e[0].y,H,R,g,n,r,d,!0),t.stroke(),t.end()),h&&!a&&(t.begin(),this.paintMarker(t,c.x,c.y,-T,-b,m,l,r,d,!0),t.stroke(),t.end()))}}paintMarker(t,e,s,n,l,r,a,o,h,d){var g=o/a,m=o*l/2,f=-o*n/2,c=(h+r)*n,x=(h+r)*l;d?t.moveTo(e-m+c,s-f+x):t.lineTo(e-m+c,s-f+x),t.lineTo(e-m/g+c,s-f/g+x),t.lineTo(e+h*n,s+h*l),t.lineTo(e+m/g+c,s+f/g+x),t.lineTo(e+m+c,s+f+x)}isArrowRounded(){return this.isRounded}getStartArrowWidth(){return mxConstants.ARROW_WIDTH}getEndArrowWidth(){return mxConstants.ARROW_WIDTH}getEdgeWidth(){return mxConstants.ARROW_WIDTH/3}isOpenEnded(){return!1}isMarkerStart(){return mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,mxConstants.NONE)!=mxConstants.NONE}isMarkerEnd(){return mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,mxConstants.NONE)!=mxConstants.NONE}}class mxArrow extends mxShape{constructor(i,t,e,s,n,l,r){super(),this.points=i,this.fill=t,this.stroke=e,this.strokewidth=s??1,this.arrowWidth=n??mxConstants.ARROW_WIDTH,this.spacing=l??mxConstants.ARROW_SPACING,this.endSize=r??mxConstants.ARROW_SIZE}augmentBoundingBox(i){super.augmentBoundingBox(i);var t=Math.max(this.arrowWidth,this.endSize);i.grow((t/2+this.strokewidth)*this.scale)}paintEdgeShape(i,t){var e=mxConstants.ARROW_SPACING,s=mxConstants.ARROW_WIDTH,n=mxConstants.ARROW_SIZE,l=t[0],r=t[t.length-1],a=r.x-l.x,o=r.y-l.y,h=Math.sqrt(a*a+o*o),d=h-2*e-n,g=a/h,m=o/h,f=d*g,c=d*m,x=s*m/3,p=-s*g/3,C=l.x-x/2+e*g,E=l.y-p/2+e*m,T=C+x,S=E+p,y=T+f,b=S+c,w=y+x,I=b+p,O=w-3*x,P=I-3*p;i.begin(),i.moveTo(C,E),i.lineTo(T,S),i.lineTo(y,b),i.lineTo(w,I),i.lineTo(r.x-e*g,r.y-e*m),i.lineTo(O,P),i.lineTo(O+x,P+p),i.close(),i.fillAndStroke()}}class mxLine extends mxShape{constructor(i,t,e,s){super(),this.bounds=i,this.stroke=t,this.strokewidth=e??1,this.vertical=s??this.vertical}paintVertexShape(i,t,e,s,n){if(i.begin(),this.vertical){var l=t+s/2;i.moveTo(l,e),i.lineTo(l,e+n)}else{var l=e+n/2;i.moveTo(t,l),i.lineTo(t+s,l)}i.stroke()}}class mxActor extends mxShape{constructor(i,t,e,s){super(),this.bounds=i,this.fill=t,this.stroke=e,this.strokewidth=s??1}paintVertexShape(i,t,e,s,n){i.translate(t,e),i.begin(),this.redrawPath(i,t,e,s,n),i.fillAndStroke()}redrawPath(i,t,e,s,n){var l=s/3;i.moveTo(0,n),i.curveTo(0,3*n/5,0,2*n/5,s/2,2*n/5),i.curveTo(s/2-l,2*n/5,s/2-l,0,s/2,0),i.curveTo(s/2+l,0,s/2+l,2*n/5,s/2,2*n/5),i.curveTo(s,2*n/5,s,3*n/5,s,n),i.close()}}class mxCloud extends mxActor{constructor(i,t,e,s){super(),this.bounds=i,this.fill=t,this.stroke=e,this.strokewidth=s??1}redrawPath(i,t,e,s,n){i.moveTo(.25*s,.25*n),i.curveTo(.05*s,.25*n,0,.5*n,.16*s,.55*n),i.curveTo(0,.66*n,.18*s,.9*n,.31*s,.8*n),i.curveTo(.4*s,n,.7*s,n,.8*s,.8*n),i.curveTo(s,.8*n,s,.6*n,.875*s,.5*n),i.curveTo(s,.3*n,.8*s,.1*n,.625*s,.2*n),i.curveTo(.5*s,.05*n,.3*s,.05*n,.25*s,.25*n),i.close()}}class mxHexagon extends mxActor{constructor(){super()}redrawPath(i,t,e,s,n){var l=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;this.addPoints(i,[new mxPoint(.25*s,0),new mxPoint(.75*s,0),new mxPoint(s,.5*n),new mxPoint(.75*s,n),new mxPoint(.25*s,n),new mxPoint(0,.5*n)],this.isRounded,l,!0)}}class mxTriangle extends mxActor{constructor(){super()}isRoundable(){return!0}redrawPath(i,t,e,s,n){var l=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;this.addPoints(i,[new mxPoint(0,0),new mxPoint(s,.5*n),new mxPoint(0,n)],this.isRounded,l,!0)}}function bootstrap(){typeof window.mxLoadResources>"u"&&(window.mxLoadResources=!0),typeof window.mxForceIncludes>"u"&&(window.mxForceIncludes=!1),typeof window.mxResourceExtension>"u"&&(mxResources.extension=".txt"),typeof window.mxLoadStylesheets>"u"&&(window.mxLoadStylesheets=!0),typeof window.mxBasePath<"u"&&window.mxBasePath.length>0?(window.mxBasePath.substring(window.mxBasePath.length-1)=="/"&&(window.mxBasePath=window.mxBasePath.substring(0,window.mxBasePath.length-1)),mxClient.basePath=window.mxBasePath):mxClient.basePath=".",typeof window.mxImageBasePath<"u"&&window.mxImageBasePath.length>0?(window.mxImageBasePath.substring(window.mxImageBasePath.length-1)=="/"&&(window.mxImageBasePath=window.mxImageBasePath.substring(0,window.mxImageBasePath.length-1)),mxClient.imageBasePath=window.mxImageBasePath):mxClient.imageBasePath=mxClient.basePath+"/images",typeof window.mxLanguage<"u"&&window.mxLanguage!=null?mxClient.language=window.mxLanguage:mxClient.language=mxClient.IS_IE?navigator.userLanguage:navigator.language,typeof window.mxDefaultLanguage<"u"&&window.mxDefaultLanguage!=null?mxClient.defaultLanguage=window.mxDefaultLanguage:mxClient.defaultLanguage="en",window.mxLoadStylesheets&&mxClient.link("stylesheet",mxClient.basePath+"/css/common.css"),typeof mxLanguages<"u"&&window.mxLanguages!=null&&(mxClient.languages=window.mxLanguages),mxClient.IS_VML&&(mxClient.IS_SVG?mxClient.IS_VML=!1:(document.namespaces!=null&&(document.documentMode==8?(document.namespaces.add(mxClient.VML_PREFIX,"urn:schemas-microsoft-com:vml","#default#VML"),document.namespaces.add(mxClient.OFFICE_PREFIX,"urn:schemas-microsoft-com:office:office","#default#VML")):(document.namespaces.add(mxClient.VML_PREFIX,"urn:schemas-microsoft-com:vml"),document.namespaces.add(mxClient.OFFICE_PREFIX,"urn:schemas-microsoft-com:office:office"))),mxClient.IS_QUIRKS&&document.styleSheets.length>=30?function(){var v=document.createElement("style");v.type="text/css",v.styleSheet.cssText=mxClient.VML_PREFIX+"\\:*{behavior:url(#default#VML)}"+mxClient.OFFICE_PREFIX+"\\:*{behavior:url(#default#VML)}",document.getElementsByTagName("head")[0].appendChild(v)}():document.createStyleSheet().cssText=mxClient.VML_PREFIX+"\\:*{behavior:url(#default#VML)}"+mxClient.OFFICE_PREFIX+"\\:*{behavior:url(#default#VML)}",window.mxLoadStylesheets&&mxClient.link("stylesheet",mxClient.basePath+"/css/explorer.css"))),window.mxLoadResources?mxResources.add(mxClient.basePath+"/resources/editor"):mxClient.defaultBundles.push(mxClient.basePath+"/resources/editor"),window.mxLoadResources?mxResources.add(mxClient.basePath+"/resources/graph"):mxClient.defaultBundles.push(mxClient.basePath+"/resources/graph"),mxMarker.addMarker("classic",createArrow(2)),mxMarker.addMarker("classicThin",createArrow(3)),mxMarker.addMarker("block",createArrow(2)),mxMarker.addMarker("blockThin",createArrow(3)),mxMarker.addMarker("open",createOpenArrow(2)),mxMarker.addMarker("openThin",createOpenArrow(3)),mxMarker.addMarker("oval",oval),mxMarker.addMarker("diamond",diamond),mxMarker.addMarker("diamondThin",diamond),mxCellRenderer.registerShape(mxConstants.SHAPE_RECTANGLE,mxRectangleShape),mxCellRenderer.registerShape(mxConstants.SHAPE_ELLIPSE,mxEllipse),mxCellRenderer.registerShape(mxConstants.SHAPE_RHOMBUS,mxRhombus),mxCellRenderer.registerShape(mxConstants.SHAPE_CYLINDER,mxCylinder),mxCellRenderer.registerShape(mxConstants.SHAPE_CONNECTOR,mxConnector),mxCellRenderer.registerShape(mxConstants.SHAPE_ACTOR,mxActor),mxCellRenderer.registerShape(mxConstants.SHAPE_TRIANGLE,mxTriangle),mxCellRenderer.registerShape(mxConstants.SHAPE_HEXAGON,mxHexagon),mxCellRenderer.registerShape(mxConstants.SHAPE_CLOUD,mxCloud),mxCellRenderer.registerShape(mxConstants.SHAPE_LINE,mxLine),mxCellRenderer.registerShape(mxConstants.SHAPE_ARROW,mxArrow),mxCellRenderer.registerShape(mxConstants.SHAPE_ARROW_CONNECTOR,mxArrowConnector),mxCellRenderer.registerShape(mxConstants.SHAPE_DOUBLE_ELLIPSE,mxDoubleEllipse),mxCellRenderer.registerShape(mxConstants.SHAPE_SWIMLANE,mxSwimlane),mxCellRenderer.registerShape(mxConstants.SHAPE_IMAGE,mxImageShape),mxCellRenderer.registerShape(mxConstants.SHAPE_LABEL,mxLabel),mxCodecRegistry.register(new mxChildChangeCodec),mxCodecRegistry.register(new mxCellCodec),mxCodecRegistry.register(new mxDefaultKeyHandlerCodec),mxCodecRegistry.register(new mxDefaultPopupMenuCodec),mxCodecRegistry.register(new mxDefaultToolbarCodec),mxCodecRegistry.register(new mxEditorCodec),mxCodecRegistry.register(new mxGenericChangeCodec(new mxValueChange,"value")),mxCodecRegistry.register(new mxGenericChangeCodec(new mxStyleChange,"style")),mxCodecRegistry.register(new mxGenericChangeCodec(new mxGeometryChange,"geometry")),mxCodecRegistry.register(new mxGenericChangeCodec(new mxCollapseChange,"collapsed")),mxCodecRegistry.register(new mxGenericChangeCodec(new mxVisibleChange,"visible")),mxCodecRegistry.register(new mxGenericChangeCodec(new mxCellAttributeChange,"value")),mxCodecRegistry.register(new mxGraphCodec),mxCodecRegistry.register(new mxGraphViewCodec),mxCodecRegistry.register(new mxModelCodec),mxCodecRegistry.register(new mxRootChangeCodec),mxCodecRegistry.register(new mxStylesheetCodec),mxCodecRegistry.register(new mxTerminalChangeCodec),mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ELBOW,mxEdgeStyle.ElbowConnector),mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ENTITY_RELATION,mxEdgeStyle.EntityRelation),mxStyleRegistry.putValue(mxConstants.EDGESTYLE_LOOP,mxEdgeStyle.Loop),mxStyleRegistry.putValue(mxConstants.EDGESTYLE_SIDETOSIDE,mxEdgeStyle.SideToSide),mxStyleRegistry.putValue(mxConstants.EDGESTYLE_TOPTOBOTTOM,mxEdgeStyle.TopToBottom),mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ORTHOGONAL,mxEdgeStyle.OrthConnector),mxStyleRegistry.putValue(mxConstants.EDGESTYLE_SEGMENT,mxEdgeStyle.SegmentConnector),mxStyleRegistry.putValue(mxConstants.PERIMETER_ELLIPSE,mxPerimeter.EllipsePerimeter),mxStyleRegistry.putValue(mxConstants.PERIMETER_RECTANGLE,mxPerimeter.RectanglePerimeter),mxStyleRegistry.putValue(mxConstants.PERIMETER_RHOMBUS,mxPerimeter.RhombusPerimeter),mxStyleRegistry.putValue(mxConstants.PERIMETER_TRIANGLE,mxPerimeter.TrianglePerimeter),mxStyleRegistry.putValue(mxConstants.PERIMETER_HEXAGON,mxPerimeter.HexagonPerimeter)}class mxCellTracker extends mxCellMarker{constructor(i,t,e){super(i,t),this.graph.addMouseListener(this),e!=null&&(this.getCell=e)}mouseDown(i,t){}mouseMove(i,t){this.isEnabled()&&this.process(t)}mouseUp(i,t){}destroy(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),super.destroy())}}class mxHandle{constructor(i,t,e,s){u(this,"ignoreGrid",!1);u(this,"cursor","default");this.graph=i.view.graph,this.state=i,this.cursor=t??this.cursor,this.image=e??this.image,this.shape=s??null,this.init()}getPosition(i){}setPosition(i,t,e){}execute(i){}copyStyle(i){this.graph.setCellStyles(i,this.state.style[i],[this.state.cell])}processEvent(i){var t=this.graph.view.scale,e=this.graph.view.translate,s=new mxPoint(i.getGraphX()/t-e.x,i.getGraphY()/t-e.y);this.shape!=null&&this.shape.bounds!=null&&(s.x-=this.shape.bounds.width/t/4,s.y-=this.shape.bounds.height/t/4);var n=-mxUtils.toRadians(this.getRotation()),l=-mxUtils.toRadians(this.getTotalRotation())-n;s=this.flipPoint(this.rotatePoint(this.snapPoint(this.rotatePoint(s,n),this.ignoreGrid||!this.graph.isGridEnabledEvent(i.getEvent())),l)),this.setPosition(this.state.getPaintBounds(),s,i),this.redraw()}positionChanged(){this.state.text!=null&&this.state.text.apply(this.state),this.state.shape!=null&&this.state.shape.apply(this.state),this.graph.cellRenderer.redraw(this.state,!0)}getRotation(){return this.state.shape!=null?this.state.shape.getRotation():0}getTotalRotation(){return this.state.shape!=null?this.state.shape.getShapeRotation():0}init(){var i=this.isHtmlRequired();this.image!=null?(this.shape=new mxImageShape(new mxRectangle(0,0,this.image.width,this.image.height),this.image.src),this.shape.preserveImageAspect=!1):this.shape==null&&(this.shape=this.createShape(i)),this.initShape(i)}createShape(i){var t=new mxRectangle(0,0,mxConstants.HANDLE_SIZE,mxConstants.HANDLE_SIZE);return new mxRectangleShape(t,mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)}initShape(i){i&&this.shape.isHtmlAllowed()?(this.shape.dialect=mxConstants.DIALECT_STRICTHTML,this.shape.init(this.graph.container)):(this.shape.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,this.cursor!=null&&this.shape.init(this.graph.getView().getOverlayPane())),mxEvent.redirectMouseEvents(this.shape.node,this.graph,this.state),this.shape.node.style.cursor=this.cursor}redraw(){if(this.shape!=null&&this.state.shape!=null){var i=this.getPosition(this.state.getPaintBounds());if(i!=null){var t=mxUtils.toRadians(this.getTotalRotation());i=this.rotatePoint(this.flipPoint(i),t);var e=this.graph.view.scale,s=this.graph.view.translate;this.shape.bounds.x=Math.floor((i.x+s.x)*e-this.shape.bounds.width/2),isNaN(this.shape.bounds.x)&&console.log("#1 ************ NaN Err"),this.shape.bounds.y=Math.floor((i.y+s.y)*e-this.shape.bounds.height/2),this.shape.redraw()}}}isHtmlRequired(){return this.state.text!=null&&this.state.text.node.parentNode==this.graph.container}rotatePoint(i,t){var e=this.state.getCellBounds(),s=new mxPoint(e.getCenterX(),e.getCenterY()),n=Math.cos(t),l=Math.sin(t);return mxUtils.getRotatedPoint(i,n,l,s)}flipPoint(i){if(this.state.shape!=null){var t=this.state.getCellBounds();this.state.shape.flipH&&(i.x=2*t.x+t.width-i.x),this.state.shape.flipV&&(i.y=2*t.y+t.height-i.y)}return i}snapPoint(i,t){return t||(i.x=this.graph.snap(i.x),i.y=this.graph.snap(i.y)),i}setVisible(i){this.shape!=null&&this.shape.node!=null&&(this.shape.node.style.display=i?"":"none")}reset(){this.setVisible(!0),this.state.style=this.graph.getCellStyle(this.state.cell),this.positionChanged()}destroy(){this.shape!=null&&(this.shape.destroy(),this.shape=null)}}class mxCircleLayout extends mxGraphLayout{constructor(t,e){super(t);u(this,"moveCircle",!1);u(this,"x0",0);u(this,"y0",0);u(this,"resetEdges",!0);u(this,"disableEdgeStyle",!0);this.radius=e??100}execute(t){var e=this.graph.getModel();e.beginUpdate();try{for(var s=0,n=null,l=null,r=[],a=e.getChildCount(t),o=0;o<a;o++){var h=e.getChildAt(t,o);if(this.isVertexIgnored(h))this.isEdgeIgnored(h)||(this.resetEdges&&this.graph.resetEdge(h),this.disableEdgeStyle&&this.setEdgeStyleEnabled(h,!1));else{r.push(h);var d=this.getVertexBounds(h);n==null?n=d.y:n=Math.min(n,d.y),l==null?l=d.x:l=Math.min(l,d.x),s=Math.max(s,Math.max(d.width,d.height))}}var g=this.getRadius(r.length,s);this.moveCircle&&(l=this.x0,n=this.y0),this.circle(r,g,l,n)}finally{e.endUpdate()}}getRadius(t,e){return Math.max(t*e/Math.PI,this.radius)}circle(t,e,s,n){for(var l=t.length,r=2*Math.PI/l,a=0;a<l;a++)this.isVertexMovable(t[a])&&this.setVertexLocation(t[a],Math.round(s+e+e*Math.sin(a*r)),Math.round(n+e+e*Math.cos(a*r)))}}class mxCompositeLayout extends mxGraphLayout{constructor(i,t,e){super(i),this.layouts=t,this.master=e}moveCell(i,t,e){this.master!=null?this.master.moveCell.apply(this.master,arguments):this.layouts[0].moveCell.apply(this.layouts[0],arguments)}execute(i){var t=this.graph.getModel();t.beginUpdate();try{for(var e=0;e<this.layouts.length;e++)this.layouts[e].execute.apply(this.layouts[e],arguments)}finally{t.endUpdate()}}}class mxEdgeLabelLayout extends mxGraphLayout{constructor(i,t){super(i)}execute(i){for(var t=this.graph.view,e=this.graph.getModel(),s=[],n=[],l=e.getChildCount(i),r=0;r<l;r++){var a=e.getChildAt(i,r),o=t.getState(a);o!=null&&(this.isVertexIgnored(a)?this.isEdgeIgnored(a)||s.push(o):n.push(o))}this.placeLabels(n,s)}placeLabels(i,t){var e=this.graph.getModel();e.beginUpdate();try{for(var s=0;s<t.length;s++){var n=t[s];if(n!=null&&n.text!=null&&n.text.boundingBox!=null)for(var l=0;l<i.length;l++){var r=i[l];r!=null&&this.avoid(n,r)}}}finally{e.endUpdate()}}avoid(i,t){var e=this.graph.getModel(),s=i.text.boundingBox;if(mxUtils.intersects(s,t)){var n=-s.y-s.height+t.y,l=-s.y+t.y+t.height,r=Math.abs(n)<Math.abs(l)?n:l,a=-s.x-s.width+t.x,o=-s.x+t.x+t.width,h=Math.abs(a)<Math.abs(o)?a:o;Math.abs(h)<Math.abs(r)?r=0:h=0;var d=e.getGeometry(i.cell);d!=null&&(d=d.clone(),d.offset!=null?(d.offset.x+=h,d.offset.y+=r):d.offset=new mxPoint(h,r),e.setGeometry(i.cell,d))}}}class mxFastOrganicLayout extends mxGraphLayout{constructor(t){super(t);u(this,"useInputOrigin",!0);u(this,"resetEdges",!0);u(this,"disableEdgeStyle",!0);u(this,"forceConstant",50);u(this,"forceConstantSquared",0);u(this,"minDistanceLimit",2);u(this,"maxDistanceLimit",500);u(this,"minDistanceLimitSquared",4);u(this,"initialTemp",200);u(this,"temperature",0);u(this,"maxIterations",0);u(this,"iteration",0);u(this,"vertexArray");u(this,"dispX");u(this,"dispY");u(this,"cellLocation");u(this,"radius");u(this,"radiusSquared");u(this,"isMoveable");u(this,"neighbours");u(this,"indices");u(this,"allowedToRun",!0)}isVertexIgnored(t){return super.isVertexIgnored(t)||this.graph.getConnections(t).length==0}execute(t){var e=this.graph.getModel();this.vertexArray=[];for(var s=this.graph.getChildVertices(t),n=0;n<s.length;n++)this.isVertexIgnored(s[n])||this.vertexArray.push(s[n]);var l=this.useInputOrigin?this.graph.getBoundingBoxFromGeometry(this.vertexArray):null,r=this.vertexArray.length;this.indices=[],this.dispX=[],this.dispY=[],this.cellLocation=[],this.isMoveable=[],this.neighbours=[],this.radius=[],this.radiusSquared=[],this.forceConstant<.001&&(this.forceConstant=.001),this.forceConstantSquared=this.forceConstant*this.forceConstant;for(var n=0;n<this.vertexArray.length;n++){var a=this.vertexArray[n];this.cellLocation[n]=[];var o=mxObjectIdentity.get(a);this.indices[o]=n;var h=this.getVertexBounds(a),d=h.width,g=h.height,m=h.x,f=h.y;this.cellLocation[n][0]=m+d/2,this.cellLocation[n][1]=f+g/2,this.radius[n]=Math.min(d,g),this.radiusSquared[n]=this.radius[n]*this.radius[n]}e.beginUpdate();try{for(var n=0;n<r;n++){this.dispX[n]=0,this.dispY[n]=0,this.isMoveable[n]=this.isVertexMovable(this.vertexArray[n]);var c=this.graph.getConnections(this.vertexArray[n],t),s=this.graph.getOpposites(c,this.vertexArray[n]);this.neighbours[n]=[];for(var x=0;x<s.length;x++){this.resetEdges&&this.graph.resetEdge(c[x]),this.disableEdgeStyle&&this.setEdgeStyleEnabled(c[x],!1);var o=mxObjectIdentity.get(s[x]),p=this.indices[o];p!=null?this.neighbours[n][x]=p:this.neighbours[n][x]=n}}for(this.temperature=this.initialTemp,this.maxIterations==0&&(this.maxIterations=20*Math.sqrt(r)),this.iteration=0;this.iteration<this.maxIterations;this.iteration++){if(!this.allowedToRun)return;this.calcRepulsion(),this.calcAttraction(),this.calcPositions(),this.reduceTemperature()}for(var C=null,E=null,n=0;n<this.vertexArray.length;n++){var a=this.vertexArray[n];if(this.isVertexMovable(a)){var h=this.getVertexBounds(a);if(h!=null){this.cellLocation[n][0]-=h.width/2,this.cellLocation[n][1]-=h.height/2;var m=this.graph.snap(Math.round(this.cellLocation[n][0])),f=this.graph.snap(Math.round(this.cellLocation[n][1]));this.setVertexLocation(a,m,f),C==null?C=m:C=Math.min(C,m),E==null?E=f:E=Math.min(E,f)}}}var T=-(C||0)+1,S=-(E||0)+1;l!=null&&(T+=l.x,S+=l.y),this.graph.moveCells(this.vertexArray,T,S)}finally{e.endUpdate()}}calcPositions(){for(var t=0;t<this.vertexArray.length;t++)if(this.isMoveable[t]){var e=Math.sqrt(this.dispX[t]*this.dispX[t]+this.dispY[t]*this.dispY[t]);e<.001&&(e=.001);var s=this.dispX[t]/e*Math.min(e,this.temperature),n=this.dispY[t]/e*Math.min(e,this.temperature);this.dispX[t]=0,this.dispY[t]=0,this.cellLocation[t][0]+=s,this.cellLocation[t][1]+=n}}calcAttraction(){for(var t=0;t<this.vertexArray.length;t++)for(var e=0;e<this.neighbours[t].length;e++){var s=this.neighbours[t][e];if(t!=s&&this.isMoveable[t]&&this.isMoveable[s]){var n=this.cellLocation[t][0]-this.cellLocation[s][0],l=this.cellLocation[t][1]-this.cellLocation[s][1],r=n*n+l*l-this.radiusSquared[t]-this.radiusSquared[s];r<this.minDistanceLimitSquared&&(r=this.minDistanceLimitSquared);var a=Math.sqrt(r),o=r/this.forceConstant,h=n/a*o,d=l/a*o;this.dispX[t]-=h,this.dispY[t]-=d,this.dispX[s]+=h,this.dispY[s]+=d}}}calcRepulsion(){for(var t=this.vertexArray.length,e=0;e<t;e++)for(var s=e;s<t;s++){if(!this.allowedToRun)return;if(s!=e&&this.isMoveable[e]&&this.isMoveable[s]){var n=this.cellLocation[e][0]-this.cellLocation[s][0],l=this.cellLocation[e][1]-this.cellLocation[s][1];n==0&&(n=.01+Math.random()),l==0&&(l=.01+Math.random());var r=Math.sqrt(n*n+l*l),a=r-this.radius[e]-this.radius[s];if(a>this.maxDistanceLimit)continue;a<this.minDistanceLimit&&(a=this.minDistanceLimit);var o=this.forceConstantSquared/a,h=n/r*o,d=l/r*o;this.dispX[e]+=h,this.dispY[e]+=d,this.dispX[s]-=h,this.dispY[s]-=d}}}reduceTemperature(){this.temperature=this.initialTemp*(1-this.iteration/this.maxIterations)}}class mxParallelEdgeLayout extends mxGraphLayout{constructor(t){super(t);u(this,"spacing",20)}execute(t){var e=this.findParallels(t);this.graph.model.beginUpdate();try{for(var s in e){var n=e[s];n.length>1&&this.layout(n)}}finally{this.graph.model.endUpdate()}}findParallels(t){for(var e=this.graph.getModel(),s=[],n=e.getChildCount(t),l=0;l<n;l++){var r=e.getChildAt(t,l);if(!this.isEdgeIgnored(r)){var a=this.getEdgeId(r);a!=null&&(s[a]==null&&(s[a]=[]),s[a].push(r))}}return s}getEdgeId(t){var e=this.graph.getView(),s=e.getVisibleTerminal(t,!0),n=e.getVisibleTerminal(t,!1);return s!=null&&n!=null?(s=mxObjectIdentity.get(s),n=mxObjectIdentity.get(n),s>n?n+"-"+s:s+"-"+n):null}layout(t){var e=t[0],s=this.graph.getView(),n=this.graph.getModel(),l=n.getGeometry(s.getVisibleTerminal(e,!0)),r=n.getGeometry(s.getVisibleTerminal(e,!1));if(l==r)for(var a=l.x+l.width+this.spacing,o=l.y+l.height/2,h=0;h<t.length;h++)this.route(t[h],a,o),a+=this.spacing;else if(l!=null&&r!=null){var d=l.x+l.width/2,g=l.y+l.height/2,m=r.x+r.width/2,f=r.y+r.height/2,c=m-d,x=f-g,p=Math.sqrt(c*c+x*x);if(p>0){var a=d+c/2,o=g+x/2,C=x*this.spacing/p,E=c*this.spacing/p;a+=C*(t.length-1)/2,o-=E*(t.length-1)/2;for(var h=0;h<t.length;h++)this.route(t[h],a,o),a-=C,o+=E}}}route(t,e,s){this.graph.isCellMovable(t)&&this.setEdgePoints(t,[new mxPoint(e,s)])}}class mxPartitionLayout extends mxGraphLayout{constructor(t,e,s,n){super(t);u(this,"resizeVertices",!0);this.horizontal=e??!0,this.spacing=s||0,this.border=n||0}isHorizontal(){return this.horizontal}moveCell(t,e,s){var n=this.graph.getModel(),l=n.getParent(t);if(t!=null&&l!=null){var r=0,a=0,o=n.getChildCount(l);for(r=0;r<o;r++){var h=n.getChildAt(l,r),d=this.getVertexBounds(h);if(d!=null){var g=d.x+d.width/2;if(a<e&&g>e)break;a=g}}var m=l.getIndex(t);m=Math.max(0,r-(r>m?1:0)),n.add(l,t,m)}}execute(t){var e=this.isHorizontal(),s=this.graph.getModel(),n=s.getGeometry(t);if(this.graph.container!=null&&(n==null&&s.isLayer(t)||t==this.graph.getView().currentRoot)){var l=this.graph.container.offsetWidth-1,r=this.graph.container.offsetHeight-1;n=new mxRectangle(0,0,l,r)}if(n!=null){for(var a=[],o=s.getChildCount(t),h=0;h<o;h++){var d=s.getChildAt(t,h);!this.isVertexIgnored(d)&&this.isVertexMovable(d)&&a.push(d)}var g=a.length;if(g>0){var m=this.border,f=this.border,c=e?n.height:n.width;c-=2*this.border;var x=this.graph.isSwimlane(t)?this.graph.getStartSize(t):new mxRectangle;c-=e?x.height:x.width,m=m+x.width,f=f+x.height;var p=this.border+(g-1)*this.spacing,C=e?(n.width-m-p)/g:(n.height-f-p)/g;if(C>0){s.beginUpdate();try{for(var h=0;h<g;h++){var d=a[h],E=s.getGeometry(d);E!=null&&(E=E.clone(),E.x=m,E.y=f,e?(this.resizeVertices&&(E.width=C,E.height=c),m+=C+this.spacing):(this.resizeVertices&&(E.height=C,E.width=c),f+=C+this.spacing),s.setGeometry(d,E))}}finally{s.endUpdate()}}}}}}class mxRadialTreeLayout extends mxCompactTreeLayout{constructor(t){super(t,!1);u(this,"angleOffset",.5);u(this,"rootx",0);u(this,"rooty",0);u(this,"levelDistance",120);u(this,"nodeDistance",10);u(this,"autoRadius",!1);u(this,"sortEdges",!1);u(this,"rowMinX",[]);u(this,"rowMaxX",[]);u(this,"rowMinCenX",[]);u(this,"rowMaxCenX",[]);u(this,"rowRadi",[]);u(this,"row",[])}isVertexIgnored(t){return super.isVertexIgnored(t)||this.graph.getConnections(t).length==0}execute(t,e){this.parent=t,this.useBoundingBox=!1,this.edgeRouting=!1,super.execute(t,e);var s=null,n=this.getVertexBounds(this.root);this.centerX=n.x+n.width/2,this.centerY=n.y+n.height/2;for(var l in this.visited){var r=this.getVertexBounds(this.visited[l]);s=s??r.clone(),s.add(r)}this.calcRowDims([this.node],0);for(var a=0,o=0,h=0;h<this.row.length;h++){var d=(this.centerX-this.rowMinX[h]-this.nodeDistance)/this.rowRadi[h],g=(this.rowMaxX[h]-this.centerX-this.nodeDistance)/this.rowRadi[h];a=Math.max(a,d),o=Math.max(o,g)}for(var h=0;h<this.row.length;h++)for(var m=this.centerX-this.nodeDistance-a*this.rowRadi[h],f=this.centerX+this.nodeDistance+o*this.rowRadi[h],c=f-m,x=0;x<this.row[h].length;x++){var p=this.row[h],C=p[x],r=this.getVertexBounds(C.cell),E=(r.x+r.width/2-m)/c,T=2*Math.PI*E;C.theta=T}for(var h=this.row.length-2;h>=0;h--)for(var p=this.row[h],x=0;x<p.length;x++){for(var C=p[x],S=C.child,y=0,b=0;S!=null;)b+=S.theta,y++,S=S.next;if(y>0){var w=b/y;if(w>C.theta&&x<p.length-1){var I=p[x+1].theta;C.theta=Math.min(w,I-Math.PI/10)}else if(w<C.theta&&x>0){var O=p[x-1].theta;C.theta=Math.max(w,O+Math.PI/10)}}}for(var h=0;h<this.row.length;h++)for(var x=0;x<this.row[h].length;x++){var p=this.row[h],C=p[x],r=this.getVertexBounds(C.cell);this.setVertexLocation(C.cell,this.centerX-r.width/2+this.rowRadi[h]*Math.cos(C.theta),this.centerY-r.height/2+this.rowRadi[h]*Math.sin(C.theta))}}calcRowDims(t,e){if(!(t==null||t.length==0)){this.rowMinX[e]=this.centerX,this.rowMaxX[e]=this.centerX,this.rowMinCenX[e]=this.centerX,this.rowMaxCenX[e]=this.centerX,this.row[e]=[];for(var s=!1,n=0;n<t.length;n++)for(var l=t[n]!=null?t[n].child:null;l!=null;){var r=l.cell,a=this.getVertexBounds(r);this.rowMinX[e]=Math.min(a.x,this.rowMinX[e]),this.rowMaxX[e]=Math.max(a.x+a.width,this.rowMaxX[e]),this.rowMinCenX[e]=Math.min(a.x+a.width/2,this.rowMinCenX[e]),this.rowMaxCenX[e]=Math.max(a.x+a.width/2,this.rowMaxCenX[e]),this.rowRadi[e]=a.y-this.getVertexBounds(this.root).y,l.child!=null&&(s=!0),this.row[e].push(l),l=l.next}s&&this.calcRowDims(this.row[e],e+1)}}}class mxHierarchicalEdgeStyle{}u(mxHierarchicalEdgeStyle,"ORTHOGONAL",1),u(mxHierarchicalEdgeStyle,"POLYLINE",2),u(mxHierarchicalEdgeStyle,"STRAIGHT",3),u(mxHierarchicalEdgeStyle,"CURVE",4);class mxHierarchicalLayoutStage{constructor(){}execute(i){}}class mxCoordinateAssignment extends mxHierarchicalLayoutStage{constructor(t,e,s,n,l,r){super();u(this,"maxIterations",8);u(this,"prefHozEdgeSep",5);u(this,"prefVertEdgeOff",2);u(this,"minEdgeJetty",12);u(this,"channelBuffer",4);u(this,"jettyPositions",null);u(this,"limitX",null);u(this,"currentXDelta",null);u(this,"widestRank",null);u(this,"rankTopY",null);u(this,"rankBottomY",null);u(this,"widestRankValue",null);u(this,"rankWidths",null);u(this,"rankY",null);u(this,"fineTuning",!0);u(this,"nextLayerConnectedCache",null);u(this,"previousLayerConnectedCache",null);u(this,"groupPadding",10);this.layout=t,this.intraCellSpacing=e,this.interRankCellSpacing=s,this.orientation=n,this.initialX=l,this.parallelEdgeSpacing=r}printStatus(){var t=this.layout.getModel();mxLog.show(),mxLog.writeln("======Coord assignment debug=======");for(var e=0;e<t.ranks.length;e++){mxLog.write("Rank ",e," : ");for(var s=t.ranks[e],n=0;n<s.length;n++){var l=s[n];mxLog.write(l.getGeneralPurposeVariable(e),"  ")}mxLog.writeln()}mxLog.writeln("====================================")}execute(t){this.jettyPositions=Object();var e=this.layout.getModel();this.currentXDelta=0,this.initialCoords(this.layout.getGraph(),e),this.fineTuning&&this.minNode(e);var s=1e8;if(this.fineTuning)for(var n=0;n<this.maxIterations;n++){if(n!=0&&(this.medianPos(n,e),this.minNode(e)),this.currentXDelta<s){for(var l=0;l<e.ranks.length;l++)for(var r=e.ranks[l],a=0;a<r.length;a++){var o=r[a];o.setX(l,o.getGeneralPurposeVariable(l))}s=this.currentXDelta}else for(var l=0;l<e.ranks.length;l++)for(var r=e.ranks[l],a=0;a<r.length;a++){var o=r[a];o.setGeneralPurposeVariable(l,o.getX(l))}this.minPath(this.layout.getGraph(),e),this.currentXDelta=0}this.setCellLocations(this.layout.getGraph(),e)}minNode(t){for(var e=[],s=new mxDictionary,n=[],l=0;l<=t.maxRank;l++){n[l]=t.ranks[l];for(var r=0;r<n[l].length;r++){var a=n[l][r],o=new WeightedCellSorter(a,l);o.rankIndex=r,o.visited=!0,e.push(o),s.put(a,o)}}for(var h=e.length*10,d=0,g=1;e.length>0&&d<=h;){var m=e.shift(),f=m.cell,c=m.weightedValue,x=parseInt(m.rankIndex),p=f.getNextLayerConnectedCells(c),C=f.getPreviousLayerConnectedCells(c),E=p.length,T=C.length,S=this.medianXValue(p,c+1),y=this.medianXValue(C,c-1),b=E+T,w=f.getGeneralPurposeVariable(c),I=w;b>0&&(I=(S*E+y*T)/b);var O=!1;if(I<w-g)if(x==0)f.setGeneralPurposeVariable(c,I),O=!0;else{var P=n[c][x-1],M=P.getGeneralPurposeVariable(c);M=M+P.width/2+this.intraCellSpacing+f.width/2,M<I?(f.setGeneralPurposeVariable(c,I),O=!0):M<f.getGeneralPurposeVariable(c)-g&&(f.setGeneralPurposeVariable(c,M),O=!0)}else if(I>w+g){var H=n[c].length;if(x==H-1)f.setGeneralPurposeVariable(c,I),O=!0;else{var R=n[c][x+1],D=R.getGeneralPurposeVariable(c);D=D-R.width/2-this.intraCellSpacing-f.width/2,D>I?(f.setGeneralPurposeVariable(c,I),O=!0):D>f.getGeneralPurposeVariable(c)+g&&(f.setGeneralPurposeVariable(c,D),O=!0)}}if(O){for(var l=0;l<p.length;l++){var A=p[l],G=s.get(A);G!=null&&G.visited==!1&&(G.visited=!0,e.push(G))}for(var l=0;l<C.length;l++){var A=C[l],G=s.get(A);G!=null&&G.visited==!1&&(G.visited=!0,e.push(G))}}m.visited=!1,d++}}medianPos(t,e){var s=t%2==0;if(s)for(var n=e.maxRank;n>0;n--)this.rankMedianPosition(n-1,e,n);else for(var n=0;n<e.maxRank-1;n++)this.rankMedianPosition(n+1,e,n)}rankMedianPosition(t,e,s){for(var n=e.ranks[t],l=[],r=new Object,a=0;a<n.length;a++){var o=n[a];l[a]=new WeightedCellSorter,l[a].cell=o,l[a].rankIndex=a,r[o.id]=l[a];var h=null;s<t?h=o.getPreviousLayerConnectedCells(t):h=o.getNextLayerConnectedCells(t),l[a].weightedValue=this.calculatedWeightedValue(o,h)}l.sort(WeightedCellSorter.compare);for(var a=0;a<l.length;a++){var d=0,g=l[a].cell,h=null,m=0;s<t?h=g.getPreviousLayerConnectedCells(t).slice():h=g.getNextLayerConnectedCells(t).slice(),h!=null&&(d=h.length,d>0?m=this.medianXValue(h,s):m=g.getGeneralPurposeVariable(t));for(var f=0,c=-1e8,x=l[a].rankIndex-1;x>=0;){var p=r[n[x].id];if(p!=null){var C=p.cell;p.visited?(c=C.getGeneralPurposeVariable(t)+C.width/2+this.intraCellSpacing+f+g.width/2,x=-1):(f+=C.width+this.intraCellSpacing,x--)}}for(var E=0,T=1e8,x=l[a].rankIndex+1;x<l.length;){var p=r[n[x].id];if(p!=null){var S=p.cell;p.visited?(T=S.getGeneralPurposeVariable(t)-S.width/2-this.intraCellSpacing-E-g.width/2,x=l.length):(E+=S.width+this.intraCellSpacing,x++)}}m>=c&&m<=T?g.setGeneralPurposeVariable(t,m):m<c?(g.setGeneralPurposeVariable(t,c),this.currentXDelta+=c-m):m>T&&(g.setGeneralPurposeVariable(t,T),this.currentXDelta+=m-T),l[a].visited=!0}}calculatedWeightedValue(t,e){for(var s=0,n=0;n<e.length;n++){var l=e[n];t.isVertex()&&l.isVertex()?s++:t.isEdge()&&l.isEdge()?s+=8:s+=2}return s}medianXValue(t,e){if(t.length==0)return 0;for(var s=[],n=0;n<t.length;n++)s[n]=t[n].getGeneralPurposeVariable(e);if(s.sort(function(o,h){return o-h}),t.length%2==1)return s[Math.floor(t.length/2)];var l=t.length/2,r=s[l-1],a=s[l];return(r+a)/2}initialCoords(t,e){this.calculateWidestRank(t,e);for(var s=this.widestRank;s>=0;s--)s<e.maxRank&&this.rankCoordinates(s,t,e);for(var s=this.widestRank+1;s<=e.maxRank;s++)s>0&&this.rankCoordinates(s,t,e)}rankCoordinates(t,e,s){for(var n=s.ranks[t],l=0,r=this.initialX+(this.widestRankValue-this.rankWidths[t])/2,a=!1,o=0;o<n.length;o++){var h=n[o];if(h.isVertex()){var d=this.layout.getVertexBounds(h.cell);d!=null?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(h.width=d.width,h.height=d.height):(h.width=d.height,h.height=d.width):a=!0,l=Math.max(l,h.height)}else if(h.isEdge()){var g=1;h.edges!=null?g=h.edges.length:mxLog.warn("edge.edges is null"),h.width=(g-1)*this.parallelEdgeSpacing}r+=h.width/2,h.setX(t,r),h.setGeneralPurposeVariable(t,r),r+=h.width/2,r+=this.intraCellSpacing}a==!0&&mxLog.warn("At least one cell has no bounds")}calculateWidestRank(t,e){var s=-this.interRankCellSpacing,n=0;this.rankWidths=[],this.rankY=[];for(var l=e.maxRank;l>=0;l--){for(var r=0,a=e.ranks[l],o=this.initialX,h=!1,d=0;d<a.length;d++){var g=a[d];if(g.isVertex()){var m=this.layout.getVertexBounds(g.cell);m!=null?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(g.width=m.width,g.height=m.height):(g.width=m.height,g.height=m.width):h=!0,r=Math.max(r,g.height)}else if(g.isEdge()){var f=1;g.edges!=null?f=g.edges.length:mxLog.warn("edge.edges is null"),g.width=(f-1)*this.parallelEdgeSpacing}o+=g.width/2,g.setX(l,o),g.setGeneralPurposeVariable(l,o),o+=g.width/2,o+=this.intraCellSpacing,o>this.widestRankValue&&(this.widestRankValue=o,this.widestRank=l),this.rankWidths[l]=o}h==!0&&mxLog.warn("At least one cell has no bounds"),this.rankY[l]=s;var c=r/2+n/2+this.interRankCellSpacing;n=r,this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_WEST?s+=c:s-=c;for(var d=0;d<a.length;d++){var x=a[d];x.setY(l,s)}}}minPath(t,e){for(var s=e.edgeMapper.getValues(),n=0;n<s.length;n++){var l=s[n];if(!(l.maxRank-l.minRank-1<1)){for(var r=l.getGeneralPurposeVariable(l.minRank+1),a=!0,o=0,h=l.minRank+2;h<l.maxRank;h++){var d=l.getGeneralPurposeVariable(h);r!=d?(a=!1,r=d):o++}if(!a){for(var g=0,m=0,f=[],c=[],x=l.getGeneralPurposeVariable(l.minRank+1),h=l.minRank+1;h<l.maxRank-1;h++){var p=l.getX(h+1);x==p||this.repositionValid(e,l,h+1,x)?(f[h-l.minRank-1]=x,g++):(f[h-l.minRank-1]=p,x=p)}x=l.getX(h);for(var h=l.maxRank-1;h>l.minRank+1;h--){var p=l.getX(h-1);x==p||this.repositionValid(e,l,h-1,x)?(c[h-l.minRank-2]=x,m++):(c[h-l.minRank-2]=l.getX(h-1),x=p)}if(m>o||g>o){if(m>=g)for(var h=l.maxRank-2;h>l.minRank;h--)l.setX(h,c[h-l.minRank-1]);else if(g>m)for(var h=l.minRank+2;h<l.maxRank;h++)l.setX(h,f[h-l.minRank-2])}}}}}repositionValid(t,e,s,n){for(var l=t.ranks[s],r=-1,a=0;a<l.length;a++)if(e==l[a]){r=a;break}if(r<0)return!1;var o=e.getGeneralPurposeVariable(s);if(n<o){if(r==0)return!0;var h=l[r-1],d=h.getGeneralPurposeVariable(s);return d=d+h.width/2+this.intraCellSpacing+e.width/2,d<=n}else if(n>o){if(r==l.length-1)return!0;var g=l[r+1],m=g.getGeneralPurposeVariable(s);return m=m-g.width/2-this.intraCellSpacing-e.width/2,m>=n}return!0}setCellLocations(t,e){this.rankTopY=[],this.rankBottomY=[];for(var s=0;s<e.ranks.length;s++)this.rankTopY[s]=Number.MAX_VALUE,this.rankBottomY[s]=-Number.MAX_VALUE;for(var n=e.vertexMapper.getValues(),s=0;s<n.length;s++)this.setVertexLocation(n[s]);(this.layout.edgeStyle==mxHierarchicalEdgeStyle.ORTHOGONAL||this.layout.edgeStyle==mxHierarchicalEdgeStyle.POLYLINE||this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE)&&this.localEdgeProcessing(e);for(var l=e.edgeMapper.getValues(),s=0;s<l.length;s++)this.setEdgePosition(l[s])}localEdgeProcessing(t){for(var e=0;e<t.ranks.length;e++)for(var s=t.ranks[e],n=0;n<s.length;n++){var l=s[n];if(l.isVertex())for(var r=l.getPreviousLayerConnectedCells(e),a=e-1,o=0;o<2;o++){if(a>-1&&a<t.ranks.length&&r!=null&&r.length>0){for(var h=[],d=0;d<r.length;d++){var g=new WeightedCellSorter(r[d],r[d].getX(a));h.push(g)}h.sort(WeightedCellSorter.compare);for(var m=l.x[0]-l.width/2,f=m+l.width,c=0,x=[],d=0;d<h.length;d++){var p=h[d].cell,C;if(p.isVertex()){o==0?C=l.connectsAsSource:C=l.connectsAsTarget;for(var E=0;E<C.length;E++)(C[E].source==p||C[E].target==p)&&(c+=C[E].edges.length,x.push(C[E]))}else c+=p.edges.length,x.push(p)}var T=(c+1)*this.prefHozEdgeSep;l.width>T+2*this.prefHozEdgeSep&&(m+=this.prefHozEdgeSep,f-=this.prefHozEdgeSep);for(var S=f-m,y=S/c,b=m+y/2,w=this.minEdgeJetty-this.prefVertEdgeOff,d=0;d<x.length;d++){var I=x[d].edges.length,O=this.jettyPositions[x[d].ids[0]];O==null&&(O=[],this.jettyPositions[x[d].ids[0]]=O),d<c/2?w+=this.prefVertEdgeOff:d>c/2&&(w-=this.prefVertEdgeOff);for(var P=0;P<I;P++)O[P*4+o*2]=b,b+=y,O[P*4+o*2+1]=w}}r=l.getNextLayerConnectedCells(e),a=e+1}}}setEdgePosition(t){var e=0;if(t.temp[0]!=101207){var s=t.maxRank,n=t.minRank;s==n&&(s=t.source.maxRank,n=t.target.minRank);for(var l=0,r=this.jettyPositions[t.ids[0]],a=t.isReversed?t.target.cell:t.source.cell,o=this.layout.graph,h=this.orientation==mxConstants.DIRECTION_EAST||this.orientation==mxConstants.DIRECTION_SOUTH,d=0;d<t.edges.length;d++){var g=t.edges[d],m=this.layout.getVisibleTerminal(g,!0),f=[],c=t.isReversed;if(m!=a&&(c=!c),r!=null){var x=c?2:0,p=c?h?this.rankBottomY[n]:this.rankTopY[n]:h?this.rankTopY[s]:this.rankBottomY[s],C=r[l*4+1+x];c!=h&&(C=-C),p+=C;var E=r[l*4+x],T=o.model.getTerminal(g,!0);if(this.layout.isPort(T)&&o.model.getParent(T)==m){var S=o.view.getState(T);S!=null?E=S.x:E=m.geometry.x+t.source.width*T.geometry.x}this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(f.push(new mxPoint(E,p)),this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&f.push(new mxPoint(E,p+C))):(f.push(new mxPoint(p,E)),this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&f.push(new mxPoint(p+C,E)))}var y=t.x.length-1,b=-1,w=-1,I=t.maxRank-1;c&&(y=0,b=t.x.length,w=1,I=t.minRank+1);for(var O=y;t.maxRank!=t.minRank&&O!=b;O+=w){var P=t.x[O]+e,M=(this.rankTopY[I]+this.rankBottomY[I+1])/2,H=(this.rankTopY[I-1]+this.rankBottomY[I])/2;if(c){var R=M;M=H,H=R}this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(f.push(new mxPoint(P,M)),f.push(new mxPoint(P,H))):(f.push(new mxPoint(M,P)),f.push(new mxPoint(H,P))),this.limitX=Math.max(this.limitX,P),I+=w}if(r!=null){var x=c?2:0,D=c?h?this.rankTopY[s]:this.rankBottomY[s]:h?this.rankBottomY[n]:this.rankTopY[n],C=r[l*4+3-x];c!=h&&(C=-C);var p=D-C,E=r[l*4+2-x],A=o.model.getTerminal(g,!1),G=this.layout.getVisibleTerminal(g,!1);if(this.layout.isPort(A)&&o.model.getParent(A)==G){var S=o.view.getState(A);S!=null?E=S.x:E=G.geometry.x+t.target.width*A.geometry.x}this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&f.push(new mxPoint(E,p-C)),f.push(new mxPoint(E,p))):(this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&f.push(new mxPoint(p-C,E)),f.push(new mxPoint(p,E)))}t.isReversed&&this.processReversedEdge(t,g),this.layout.setEdgePoints(g,f),e==0?e=this.parallelEdgeSpacing:e>0?e=-e:e=-e+this.parallelEdgeSpacing,l++}t.temp[0]=101207}}setVertexLocation(t){var e=t.cell,s=t.x[0]-t.width/2,n=t.y[0]-t.height/2;this.rankTopY[t.minRank]=Math.min(this.rankTopY[t.minRank],n),this.rankBottomY[t.minRank]=Math.max(this.rankBottomY[t.minRank],n+t.height),this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?this.layout.setVertexLocation(e,s,n):this.layout.setVertexLocation(e,n,s),this.limitX=Math.max(this.limitX,s+t.width)}processReversedEdge(t,e){}}class MedianCellSorter{constructor(){u(this,"medianValue",0);u(this,"cell",!1)}static compare(i,t){return i!=null&&t!=null?t.medianValue>i.medianValue?-1:t.medianValue<i.medianValue?1:0:0}}class mxMedianHybridCrossingReduction extends mxHierarchicalLayoutStage{constructor(t){super();u(this,"maxIterations",24);u(this,"nestedBestRanks",null);u(this,"currentBestCrossings",0);u(this,"iterationsWithoutImprovement",0);u(this,"maxNoImprovementIterations",2);this.layout=t}execute(t){var e=this.layout.getModel();this.nestedBestRanks=[];for(var s=0;s<e.ranks.length;s++)this.nestedBestRanks[s]=e.ranks[s].slice();for(var n=0,l=this.calculateCrossings(e),s=0;s<this.maxIterations&&n<this.maxNoImprovementIterations;s++){this.weightedMedian(s,e),this.transpose(s,e);var r=this.calculateCrossings(e);if(r<l){l=r,n=0;for(var a=0;a<this.nestedBestRanks.length;a++)for(var o=e.ranks[a],h=0;h<o.length;h++){var d=o[h];this.nestedBestRanks[a][d.getGeneralPurposeVariable(a)]=d}}else{n++;for(var a=0;a<this.nestedBestRanks.length;a++)for(var o=e.ranks[a],h=0;h<o.length;h++){var d=o[h];d.setGeneralPurposeVariable(a,h)}}if(l==0)break}for(var g=[],m=[],s=0;s<e.maxRank+1;s++)m[s]=[],g[s]=m[s];for(var s=0;s<this.nestedBestRanks.length;s++)for(var a=0;a<this.nestedBestRanks[s].length;a++)m[s].push(this.nestedBestRanks[s][a]);e.ranks=g}calculateCrossings(t){for(var e=t.ranks.length,s=0,n=1;n<e;n++)s+=this.calculateRankCrossing(n,t);return s}calculateRankCrossing(t,e){for(var s=0,n=e.ranks[t],l=e.ranks[t-1],r=[],a=0;a<n.length;a++){for(var o=n[a],h=o.getGeneralPurposeVariable(t),d=o.getPreviousLayerConnectedCells(t),g=[],m=0;m<d.length;m++){var f=d[m],c=f.getGeneralPurposeVariable(t-1);g.push(c)}g.sort(function(y,b){return y-b}),r[h]=g}for(var x=[],a=0;a<r.length;a++)x=x.concat(r[a]);for(var p=1;p<l.length;)p<<=1;var C=2*p-1;p-=1;for(var E=[],a=0;a<C;++a)E[a]=0;for(var a=0;a<x.length;a++){var T=x[a],S=T+p;for(++E[S];S>0;)S%2&&(s+=E[S+1]),S=S-1>>1,++E[S]}return s}transpose(t,e){for(var s=!0,n=0,l=10;s&&n++<l;){var r=t%2==1&&n%2==1;s=!1;for(var a=0;a<e.ranks.length;a++){for(var o=e.ranks[a],h=[],d=0;d<o.length;d++){var g=o[d],m=g.getGeneralPurposeVariable(a);m<0&&(m=d),h[m]=g}for(var f=null,c=null,x=null,p=null,C=null,E=null,T=null,S=null,y=null,b=null,d=0;d<o.length-1;d++){if(d==0){y=h[d],f=y.getNextLayerConnectedCells(a),c=y.getPreviousLayerConnectedCells(a),C=[],E=[];for(var w=0;w<f.length;w++)C[w]=f[w].getGeneralPurposeVariable(a+1);for(var w=0;w<c.length;w++)E[w]=c[w].getGeneralPurposeVariable(a-1)}else f=x,c=p,C=T,E=S,y=b;b=h[d+1],x=b.getNextLayerConnectedCells(a),p=b.getPreviousLayerConnectedCells(a),T=[],S=[];for(var w=0;w<x.length;w++)T[w]=x[w].getGeneralPurposeVariable(a+1);for(var w=0;w<p.length;w++)S[w]=p[w].getGeneralPurposeVariable(a-1);for(var I=0,O=0,w=0;w<C.length;w++)for(var P=0;P<T.length;P++)C[w]>T[P]&&I++,C[w]<T[P]&&O++;for(var w=0;w<E.length;w++)for(var P=0;P<S.length;P++)E[w]>S[P]&&I++,E[w]<S[P]&&O++;if(O<I||O==I&&r){var M=y.getGeneralPurposeVariable(a);y.setGeneralPurposeVariable(a,b.getGeneralPurposeVariable(a)),b.setGeneralPurposeVariable(a,M),x=f,p=c,T=C,S=E,b=y,r||(s=!0)}}}}}weightedMedian(t,e){var s=t%2==0;if(s)for(var n=e.maxRank-1;n>=0;n--)this.medianRank(n,s);else for(var n=1;n<e.maxRank;n++)this.medianRank(n,s)}medianRank(t,e){for(var s=this.nestedBestRanks[t].length,n=[],l=[],r=0;r<s;r++){var a=this.nestedBestRanks[t][r],o=new MedianCellSorter;o.cell=a;var h;e?h=a.getNextLayerConnectedCells(t):h=a.getPreviousLayerConnectedCells(t);var d;e?d=t+1:d=t-1,h!=null&&h.length!=0?(o.medianValue=this.medianValue(h,d),n.push(o)):l[a.getGeneralPurposeVariable(t)]=!0}n.sort(MedianCellSorter.compare);for(var r=0;r<s;r++)if(l[r]==null){var a=n.shift().cell;a.setGeneralPurposeVariable(t,r)}}medianValue(t,e){for(var s=[],n=0,l=0;l<t.length;l++){var r=t[l];s[n++]=r.getGeneralPurposeVariable(e)}if(s.sort(function(d,g){return d-g}),n%2==1)return s[Math.floor(n/2)];if(n==2)return(s[0]+s[1])/2;var a=n/2,o=s[a-1]-s[0],h=s[n-1]-s[a];return(s[a-1]*h+s[a]*o)/(o+h)}}class mxMinimumCycleRemover extends mxHierarchicalLayoutStage{constructor(i){super(),this.layout=i}execute(i){for(var t=this.layout.getModel(),e=new Object,s=t.vertexMapper.getValues(),n=new Object,l=0;l<s.length;l++)n[s[l].id]=s[l];var r=null;if(t.roots!=null){var a=t.roots;r=[];for(var l=0;l<a.length;l++)r[l]=t.vertexMapper.get(a[l])}t.visit(function(h,d,g,m,f){d.isAncestor(h)&&(g.invert(),mxUtils.remove(g,h.connectsAsSource),h.connectsAsTarget.push(g),mxUtils.remove(g,d.connectsAsTarget),d.connectsAsSource.push(g)),e[d.id]=d,delete n[d.id]},r,!0,null);var o=mxUtils.clone(e,null,!0);t.visit(function(h,d,g,m,f){d.isAncestor(h)&&(g.invert(),mxUtils.remove(g,h.connectsAsSource),d.connectsAsSource.push(g),h.connectsAsTarget.push(g),mxUtils.remove(g,d.connectsAsTarget)),e[d.id]=d,delete n[d.id]},n,!0,o)}}class mxGraphAbstractHierarchyCell{constructor(){u(this,"maxRank",-1);u(this,"minRank",-1);u(this,"width",0);u(this,"height",0);u(this,"nextLayerConnectedCells",null);u(this,"previousLayerConnectedCells",null);this.x=[],this.y=[],this.temp=[]}getNextLayerConnectedCells(i){return null}getPreviousLayerConnectedCells(i){return null}isEdge(){return!1}isVertex(){return!1}getGeneralPurposeVariable(i){return null}setGeneralPurposeVariable(i,t){return null}setX(i,t){this.isVertex()?this.x[0]=t:this.isEdge()&&(this.x[i-this.minRank-1]=t)}getX(i){return this.isVertex()?this.x[0]:this.isEdge()?this.x[i-this.minRank-1]:0}setY(i,t){this.isVertex()?this.y[0]=t:this.isEdge()&&(this.y[i-this.minRank-1]=t)}}class mxGraphHierarchyEdge extends mxGraphAbstractHierarchyCell{constructor(t){super(t);u(this,"source",null);u(this,"target",null);u(this,"isReversed",!1);this.edges=t,this.ids=[];for(var e=0;e<t.length;e++)this.ids.push(mxObjectIdentity.get(t[e]))}invert(t){var e=this.source;this.source=this.target,this.target=e,this.isReversed=!this.isReversed}getNextLayerConnectedCells(t){if(this.nextLayerConnectedCells==null){this.nextLayerConnectedCells=[];for(var e=0;e<this.temp.length;e++)this.nextLayerConnectedCells[e]=[],e==this.temp.length-1?this.nextLayerConnectedCells[e].push(this.source):this.nextLayerConnectedCells[e].push(this)}return this.nextLayerConnectedCells[t-this.minRank-1]}getPreviousLayerConnectedCells(t){if(this.previousLayerConnectedCells==null){this.previousLayerConnectedCells=[];for(var e=0;e<this.temp.length;e++)this.previousLayerConnectedCells[e]=[],e==0?this.previousLayerConnectedCells[e].push(this.target):this.previousLayerConnectedCells[e].push(this)}return this.previousLayerConnectedCells[t-this.minRank-1]}isEdge(){return!0}getGeneralPurposeVariable(t){return this.temp[t-this.minRank-1]}setGeneralPurposeVariable(t,e){this.temp[t-this.minRank-1]=e}getCoreCell(){return this.edges!=null&&this.edges.length>0?this.edges[0]:null}}class mxGraphHierarchyNode extends mxGraphAbstractHierarchyCell{constructor(t){super(t);u(this,"hashCode",!1);this.cell=t,this.id=mxObjectIdentity.get(t),this.connectsAsTarget=[],this.connectsAsSource=[]}getRankValue(t){return this.maxRank}getNextLayerConnectedCells(t){if(this.nextLayerConnectedCells==null){this.nextLayerConnectedCells=[],this.nextLayerConnectedCells[0]=[];for(var e=0;e<this.connectsAsTarget.length;e++){var s=this.connectsAsTarget[e];s.maxRank==-1||s.maxRank==t+1?this.nextLayerConnectedCells[0].push(s.source):this.nextLayerConnectedCells[0].push(s)}}return this.nextLayerConnectedCells[0]}getPreviousLayerConnectedCells(t){if(this.previousLayerConnectedCells==null){this.previousLayerConnectedCells=[],this.previousLayerConnectedCells[0]=[];for(var e=0;e<this.connectsAsSource.length;e++){var s=this.connectsAsSource[e];s.minRank==-1||s.minRank==t-1?this.previousLayerConnectedCells[0].push(s.target):this.previousLayerConnectedCells[0].push(s)}}return this.previousLayerConnectedCells[0]}isVertex(){return!0}getGeneralPurposeVariable(t){return this.temp[0]}setGeneralPurposeVariable(t,e){this.temp[0]=e}isAncestor(t){if(t!=null&&this.hashCode!=null&&t.hashCode!=null&&this.hashCode.length<t.hashCode.length){if(this.hashCode==t.hashCode)return!0;if(this.hashCode==null||this.hashCode==null)return!1;for(var e=0;e<this.hashCode.length;e++)if(this.hashCode[e]!=t.hashCode[e])return!1;return!0}return!1}getCoreCell(){return this.cell}}class mxGraphHierarchyModel{constructor(i,t,e,s,n){u(this,"ranks",null);u(this,"dfsCount",0);u(this,"SOURCESCANSTARTRANK",1e8);i.getGraph(),this.tightenToSource=n,this.roots=e,this.parent=s,this.vertexMapper=new mxDictionary,this.edgeMapper=new mxDictionary,this.maxRank=0;var l=[];t==null&&(t=this.graph.getChildVertices(s)),this.maxRank=this.SOURCESCANSTARTRANK,this.createInternalCells(i,t,l);for(var r=0;r<t.length;r++){for(var a=l[r].connectsAsSource,o=0;o<a.length;o++){var h=a[o],d=h.edges;if(d!=null&&d.length>0){var g=d[0],m=i.getVisibleTerminal(g,!1),f=this.vertexMapper.get(m);l[r]==f&&(m=i.getVisibleTerminal(g,!0),f=this.vertexMapper.get(m)),f!=null&&l[r]!=f&&(h.target=f,f.connectsAsTarget.length==0&&(f.connectsAsTarget=[]),mxUtils.indexOf(f.connectsAsTarget,h)<0&&f.connectsAsTarget.push(h))}}l[r].temp[0]=1}}createInternalCells(i,t,e){for(var s=i.getGraph(),n=0;n<t.length;n++){e[n]=new mxGraphHierarchyNode(t[n]),this.vertexMapper.put(t[n],e[n]);var l=i.getEdges(t[n]);e[n].connectsAsSource=[];for(var r=0;r<l.length;r++){var a=i.getVisibleTerminal(l[r],!1);if(a!=t[n]&&i.graph.model.isVertex(a)&&!i.isVertexIgnored(a)){var o=i.getEdgesBetween(t[n],a,!1),h=i.getEdgesBetween(t[n],a,!0);if(o!=null&&o.length>0&&this.edgeMapper.get(o[0])==null&&h.length*2>=o.length){for(var d=new mxGraphHierarchyEdge(o),g=0;g<o.length;g++){var m=o[g];this.edgeMapper.put(m,d),s.resetEdge(m),i.disableEdgeStyle&&(i.setEdgeStyleEnabled(m,!1),i.setOrthogonalEdge(m,!0))}d.source=e[n],mxUtils.indexOf(e[n].connectsAsSource,d)<0&&e[n].connectsAsSource.push(d)}}}e[n].temp[0]=0}}initialRank(){var i=[];if(this.roots!=null)for(var t=0;t<this.roots.length;t++){var e=this.vertexMapper.get(this.roots[t]);e!=null&&i.push(e)}for(var s=this.vertexMapper.getValues(),t=0;t<s.length;t++)s[t].temp[0]=-1;for(var n=i.slice();i.length>0;){var e=i[0],l,r;l=e.connectsAsTarget,r=e.connectsAsSource;for(var a=!0,o=this.SOURCESCANSTARTRANK,t=0;t<l.length;t++){var h=l[t];if(h.temp[0]==5270620){var d=h.source;o=Math.min(o,d.temp[0]-1)}else{a=!1;break}}if(a){if(e.temp[0]=o,this.maxRank=Math.min(this.maxRank,o),r!=null)for(var t=0;t<r.length;t++){var h=r[t];h.temp[0]=5270620;var d=h.target;d.temp[0]==-1&&(i.push(d),d.temp[0]=-2)}i.shift()}else{var g=i.shift();if(i.push(e),g==e&&i.length==1)break}}for(var t=0;t<s.length;t++)s[t].temp[0]-=this.maxRank;for(var t=0;t<n.length;t++)for(var e=n[t],m=0,l=e.connectsAsSource,f=0;f<l.length;f++){var h=l[f],d=h.target;e.temp[0]=Math.max(m,d.temp[0]+1),m=e.temp[0]}this.maxRank=this.SOURCESCANSTARTRANK-this.maxRank}fixRanks(){var i=[];this.ranks=[];for(var t=0;t<this.maxRank+1;t++)i[t]=[],this.ranks[t]=i[t];var e=null;if(this.roots!=null){var s=this.roots;e=[];for(var t=0;t<s.length;t++){var n=s[t],l=this.vertexMapper.get(n);e[t]=l}}this.visit(function(r,a,o,h,d){if(d==0&&a.maxRank<0&&a.minRank<0&&(i[a.temp[0]].push(a),a.maxRank=a.temp[0],a.minRank=a.temp[0],a.temp[0]=i[a.maxRank].length-1),r!=null&&o!=null){var g=r.maxRank-a.maxRank;if(g>1){o.maxRank=r.maxRank,o.minRank=a.maxRank,o.temp=[],o.x=[],o.y=[];for(var m=o.minRank+1;m<o.maxRank;m++)i[m].push(o),o.setGeneralPurposeVariable(m,i[m].length-1)}}},e,!1,null)}visit(i,t,e,s){if(t!=null){for(var n=0;n<t.length;n++){var l=t[n];l!=null&&(s==null&&(s=new Object),e?(l.hashCode=[],l.hashCode[0]=this.dfsCount,l.hashCode[1]=n,this.extendedDfs(null,l,null,i,s,l.hashCode,n,0)):this.dfs(null,l,null,i,s,0))}this.dfsCount++}}dfs(i,t,e,s,n,l){if(t!=null){var r=t.id;if(n[r]==null){n[r]=t,s(i,t,e,l,0);for(var a=t.connectsAsSource.slice(),o=0;o<a.length;o++){var h=a[o],d=h.target;this.dfs(t,d,h,s,n,l+1)}}else s(i,t,e,l,1)}}extendedDfs(i,t,e,s,n,l,r,a){if(t!=null){if(i!=null&&(t.hashCode==null||t.hashCode[0]!=i.hashCode[0])){var o=i.hashCode.length+1;t.hashCode=i.hashCode.slice(),t.hashCode[o-1]=r}var h=t.id;if(n[h]==null){n[h]=t,s(i,t,e,a,0);for(var d=t.connectsAsSource.slice(),g=0;g<d.length;g++){var m=d[g],f=m.target;this.extendedDfs(t,f,m,s,n,t.hashCode,g,a+1)}}else s(i,t,e,a,1)}}}class mxHierarchicalLayout extends mxGraphLayout{constructor(t,e,s){super(t);u(this,"roots",null);u(this,"resizeParent",!1);u(this,"maintainParentLocation",!1);u(this,"moveParent",!1);u(this,"parentBorder",0);u(this,"intraCellSpacing",30);u(this,"interRankCellSpacing",100);u(this,"interHierarchySpacing",60);u(this,"parallelEdgeSpacing",10);u(this,"fineTuning",!0);u(this,"tightenToSource",!0);u(this,"disableEdgeStyle",!0);u(this,"traverseAncestors",!0);u(this,"model",null);u(this,"edgesCache",null);u(this,"edgeSourceTermCache",null);u(this,"edgesTargetTermCache",null);u(this,"edgeStyle",mxHierarchicalEdgeStyle.POLYLINE);this.orientation=e??mxConstants.DIRECTION_NORTH,this.deterministic=s??!0}getModel(){return this.model}execute(t,e){this.parent=t;var s=this.graph.model;if(this.edgesCache=new mxDictionary,this.edgeSourceTermCache=new mxDictionary,this.edgesTargetTermCache=new mxDictionary,e!=null&&!(e instanceof Array)&&(e=[e]),!(e==null&&t==null)){if(this.parentX=null,this.parentY=null,t!=this.root&&s.isVertex(t)!=null&&this.maintainParentLocation){var n=this.graph.getCellGeometry(t);n!=null&&(this.parentX=n.x,this.parentY=n.y)}if(e!=null){for(var l=[],r=0;r<e.length;r++){var a=t!=null?s.isAncestor(t,e[r]):!0;a&&s.isVertex(e[r])&&l.push(e[r])}this.roots=l}s.beginUpdate();try{if(this.run(t),this.resizeParent&&!this.graph.isCellCollapsed(t)&&this.graph.updateGroupBounds([t],this.parentBorder,this.moveParent),this.parentX!=null&&this.parentY!=null){var n=this.graph.getCellGeometry(t);n!=null&&(n=n.clone(),n.x=this.parentX,n.y=this.parentY,s.setGeometry(t,n))}}finally{s.endUpdate()}}}findRoots(t,e){var s=[];if(t!=null&&e!=null){var n=this.graph.model,l=null,r=-1e5;for(var a in e){var o=e[a];if(n.isVertex(o)&&this.graph.isCellVisible(o)){for(var h=this.getEdges(o),d=0,g=0,m=0;m<h.length;m++){var f=this.getVisibleTerminal(h[m],!0);f==o?d++:g++}g==0&&d>0&&s.push(o);var c=d-g;c>r&&(r=c,l=o)}}s.length==0&&l!=null&&s.push(l)}return s}getEdges(t){var e=this.edgesCache.get(t);if(e!=null)return e;for(var s=this.graph.model,n=[],l=this.graph.isCellCollapsed(t),r=s.getChildCount(t),a=0;a<r;a++){var o=s.getChildAt(t,a);(this.isPort(o)||l||!this.graph.isCellVisible(o))&&(n=n.concat(s.getEdges(o,!0,!0)))}n=n.concat(s.getEdges(t,!0,!0));for(var h=[],a=0;a<n.length;a++){var d=this.getVisibleTerminal(n[a],!0),g=this.getVisibleTerminal(n[a],!1);(d==g||d!=g&&(g==t&&(this.parent==null||this.isAncestor(this.parent,d,this.traverseAncestors))||d==t&&(this.parent==null||this.isAncestor(this.parent,g,this.traverseAncestors))))&&h.push(n[a])}return this.edgesCache.put(t,h),h}getVisibleTerminal(t,e){var s=this.edgesTargetTermCache;e&&(s=this.edgeSourceTermCache);var n=s.get(t);if(n!=null)return n;var l=this.graph.view.getState(t),r=l!=null?l.getVisibleTerminal(e):this.graph.view.getVisibleTerminal(t,e);return r==null&&(r=l!=null?l.getVisibleTerminal(e):this.graph.view.getVisibleTerminal(t,e)),r!=null&&(this.isPort(r)&&(r=this.graph.model.getParent(r)),s.put(t,r)),r}run(t){var e=[],s=[];if(this.roots==null&&t!=null){var n=Object();this.filterDescendants(t,n),this.roots=[];var l=!0;for(var r in n)if(n[r]!=null){l=!1;break}for(;!l;){for(var a=this.findRoots(t,n),o=0;o<a.length;o++){var h=Object();e.push(h),this.traverse(a[o],!0,null,s,h,e,n)}for(var o=0;o<a.length;o++)this.roots.push(a[o]);l=!0;for(var r in n)if(n[r]!=null){l=!1;break}}}else for(var o=0;o<this.roots.length;o++){var h=Object();e.push(h),this.traverse(this.roots[o],!0,null,s,h,e,null)}for(var d=0,o=0;o<e.length;o++){var h=e[o],g=[];for(var r in h)g.push(h[r]);this.model=new mxGraphHierarchyModel(this,g,this.roots,t,this.tightenToSource),this.cycleStage(t),this.layeringStage(),this.crossingStage(t),d=this.placementStage(d,t)}}filterDescendants(t,e){var s=this.graph.model;if(s.isVertex(t)&&t!=this.parent&&this.graph.isCellVisible(t)&&(e[mxObjectIdentity.get(t)]=t),this.traverseAncestors||t==this.parent&&this.graph.isCellVisible(t))for(var n=s.getChildCount(t),l=0;l<n;l++){var r=s.getChildAt(t,l);this.isPort(r)||this.filterDescendants(r,e)}}isPort(t){return t!=null&&t.geometry!=null?t.geometry.relative:!1}getEdgesBetween(t,e,s){s=s??!1;for(var n=this.getEdges(t),l=[],r=0;r<n.length;r++){var a=this.getVisibleTerminal(n[r],!0),o=this.getVisibleTerminal(n[r],!1);(a==t&&o==e||!s&&a==e&&o==t)&&l.push(n[r])}return l}traverse(t,e,s,n,l,r,a){if(t!=null&&n!=null){var o=mxObjectIdentity.get(t);if(n[o]==null&&(a==null||a[o]!=null)){l[o]==null&&(l[o]=t),n[o]==null&&(n[o]=t),a!==null&&delete a[o];for(var h=this.getEdges(t),d=[],g=0;g<h.length;g++)d[g]=this.getVisibleTerminal(h[g],!0)==t;for(var g=0;g<h.length;g++)if(!e||d[g]){for(var m=this.getVisibleTerminal(h[g],!d[g]),f=1,c=0;c<h.length;c++)if(c!=g){var x=d[c],p=this.getVisibleTerminal(h[c],!x);p==m&&(x?f++:f--)}f>=0&&(l=this.traverse(m,e,h[g],n,l,r,a))}}else if(l[o]==null)for(var g=0;g<r.length;g++){var C=r[g];if(C[o]!=null){for(var E in C)l[E]=C[E];return r.splice(g,1),l}}}return l}cycleStage(t){var e=new mxMinimumCycleRemover(this);e.execute(t)}layeringStage(){this.model.initialRank(),this.model.fixRanks()}crossingStage(t){var e=new mxMedianHybridCrossingReduction(this);e.execute(t)}placementStage(t,e){var s=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,t,this.parallelEdgeSpacing);return s.fineTuning=this.fineTuning,s.execute(e),s.limitX+this.interHierarchySpacing}}class mxSwimlaneOrdering extends mxHierarchicalLayoutStage{constructor(i){super(),this.layout=i}execute(i){var t=this.layout.getModel(),e=new Object,s=mxUtils.clone(t.vertexMapper,null,!0),n=null;if(t.roots!=null){var l=t.roots;n=[];for(var r=0;r<l.length;r++)n[r]=t.vertexMapper.get(l[r])}t.visit(function(a,o,h,d,g){var m=a!=null&&a.swimlaneIndex==o.swimlaneIndex&&o.isAncestor(a),f=a!=null&&h!=null&&a.swimlaneIndex<o.swimlaneIndex&&h.source==o;m?(h.invert(),mxUtils.remove(h,a.connectsAsSource),o.connectsAsSource.push(h),a.connectsAsTarget.push(h),mxUtils.remove(h,o.connectsAsTarget)):f&&(h.invert(),mxUtils.remove(h,a.connectsAsTarget),o.connectsAsTarget.push(h),a.connectsAsSource.push(h),mxUtils.remove(h,o.connectsAsSource));var c=mxCellPath.create(o.cell);e[c]=o,delete s[c]},n,!0,null)}}class mxSwimlaneModel{constructor(i,t,e,s,n){u(this,"ranks",null);u(this,"dfsCount",0);u(this,"SOURCESCANSTARTRANK",1e8);u(this,"ranksPerGroup",null);i.getGraph(),this.tightenToSource=n,this.roots=e,this.parent=s,this.vertexMapper=new mxDictionary,this.edgeMapper=new mxDictionary,this.maxRank=0;var l=[];t==null&&(t=this.graph.getChildVertices(s)),this.maxRank=this.SOURCESCANSTARTRANK,this.createInternalCells(i,t,l);for(var r=0;r<t.length;r++){for(var a=l[r].connectsAsSource,o=0;o<a.length;o++){var h=a[o],d=h.edges;if(d!=null&&d.length>0){var g=d[0],m=i.getVisibleTerminal(g,!1),f=this.vertexMapper.get(m);l[r]==f&&(m=i.getVisibleTerminal(g,!0),f=this.vertexMapper.get(m)),f!=null&&l[r]!=f&&(h.target=f,f.connectsAsTarget.length==0&&(f.connectsAsTarget=[]),mxUtils.indexOf(f.connectsAsTarget,h)<0&&f.connectsAsTarget.push(h))}}l[r].temp[0]=1}}createInternalCells(i,t,e){for(var s=i.getGraph(),n=i.swimlanes,l=0;l<t.length;l++){e[l]=new mxGraphHierarchyNode(t[l]),this.vertexMapper.put(t[l],e[l]),e[l].swimlaneIndex=-1;for(var r=0;r<n.length;r++)if(s.model.getParent(t[l])==n[r]){e[l].swimlaneIndex=r;break}var a=i.getEdges(t[l]);e[l].connectsAsSource=[];for(var o=0;o<a.length;o++){var h=i.getVisibleTerminal(a[o],!1);if(h!=t[l]&&i.graph.model.isVertex(h)&&!i.isVertexIgnored(h)){var d=i.getEdgesBetween(t[l],h,!1),g=i.getEdgesBetween(t[l],h,!0);if(d!=null&&d.length>0&&this.edgeMapper.get(d[0])==null&&g.length*2>=d.length){for(var m=new mxGraphHierarchyEdge(d),f=0;f<d.length;f++){var c=d[f];this.edgeMapper.put(c,m),s.resetEdge(c),i.disableEdgeStyle&&(i.setEdgeStyleEnabled(c,!1),i.setOrthogonalEdge(c,!0))}m.source=e[l],mxUtils.indexOf(e[l].connectsAsSource,m)<0&&e[l].connectsAsSource.push(m)}}}e[l].temp[0]=0}}initialRank(){this.ranksPerGroup=[];var i=[],t=new Object;if(this.roots!=null)for(var e=0;e<this.roots.length;e++){var s=this.vertexMapper.get(this.roots[e]);this.maxChainDfs(null,s,null,t,0),s!=null&&i.push(s)}for(var n=[],l=[],e=this.ranksPerGroup.length-1;e>=0;e--)e==this.ranksPerGroup.length-1?n[e]=0:n[e]=l[e+1]+1,l[e]=n[e]+this.ranksPerGroup[e];this.maxRank=l[0];for(var r=this.vertexMapper.getValues(),e=0;e<r.length;e++)r[e].temp[0]=-1;for(;i.length>0;){var s=i[0],a,o;a=s.connectsAsTarget,o=s.connectsAsSource;for(var h=!0,d=l[0],e=0;e<a.length;e++){var g=a[e];if(g.temp[0]==5270620){var m=g.source;d=Math.min(d,m.temp[0]-1)}else{h=!1;break}}if(h){if(d>l[s.swimlaneIndex]&&(d=l[s.swimlaneIndex]),s.temp[0]=d,o!=null)for(var e=0;e<o.length;e++){var g=o[e];g.temp[0]=5270620;var m=g.target;m.temp[0]==-1&&(i.push(m),m.temp[0]=-2)}i.shift()}else{var f=i.shift();if(i.push(s),f==s&&i.length==1)break}}}maxChainDfs(i,t,e,s,n){if(t!=null){var l=mxCellPath.create(t.cell);if(s[l]==null){s[l]=t;var r=t.swimlaneIndex;(this.ranksPerGroup[r]==null||this.ranksPerGroup[r]<n)&&(this.ranksPerGroup[r]=n);for(var a=t.connectsAsSource.slice(),o=0;o<a.length;o++){var h=a[o],d=h.target;t.swimlaneIndex<d.swimlaneIndex?this.maxChainDfs(t,d,h,mxUtils.clone(s,null,!0),0):t.swimlaneIndex==d.swimlaneIndex&&this.maxChainDfs(t,d,h,mxUtils.clone(s,null,!0),n+1)}}}}fixRanks(){var i=[];this.ranks=[];for(var t=0;t<this.maxRank+1;t++)i[t]=[],this.ranks[t]=i[t];var e=null;if(this.roots!=null){var s=this.roots;e=[];for(var t=0;t<s.length;t++){var n=s[t],l=this.vertexMapper.get(n);e[t]=l}}this.visit(function(r,a,o,h,d){if(d==0&&a.maxRank<0&&a.minRank<0&&(i[a.temp[0]].push(a),a.maxRank=a.temp[0],a.minRank=a.temp[0],a.temp[0]=i[a.maxRank].length-1),r!=null&&o!=null){var g=r.maxRank-a.maxRank;if(g>1){o.maxRank=r.maxRank,o.minRank=a.maxRank,o.temp=[],o.x=[],o.y=[];for(var m=o.minRank+1;m<o.maxRank;m++)i[m].push(o),o.setGeneralPurposeVariable(m,i[m].length-1)}}},e,!1,null)}visit(i,t,e,s){if(t!=null){for(var n=0;n<t.length;n++){var l=t[n];l!=null&&(s==null&&(s=new Object),e?(l.hashCode=[],l.hashCode[0]=this.dfsCount,l.hashCode[1]=n,this.extendedDfs(null,l,null,i,s,l.hashCode,n,0)):this.dfs(null,l,null,i,s,0))}this.dfsCount++}}dfs(i,t,e,s,n,l){if(t!=null){var r=t.id;if(n[r]==null){n[r]=t,s(i,t,e,l,0);for(var a=t.connectsAsSource.slice(),o=0;o<a.length;o++){var h=a[o],d=h.target;this.dfs(t,d,h,s,n,l+1)}}else s(i,t,e,l,1)}}extendedDfs(i,t,e,s,n,l,r,a){if(t!=null){if(i!=null&&(t.hashCode==null||t.hashCode[0]!=i.hashCode[0])){var o=i.hashCode.length+1;t.hashCode=i.hashCode.slice(),t.hashCode[o-1]=r}var h=t.id;if(n[h]==null){n[h]=t,s(i,t,e,a,0);for(var d=t.connectsAsSource.slice(),g=t.connectsAsTarget.slice(),m=0;m<d.length;m++){var f=d[m],c=f.target;t.swimlaneIndex<=c.swimlaneIndex&&this.extendedDfs(t,c,f,s,n,t.hashCode,m,a+1)}for(var m=0;m<g.length;m++){var f=g[m],c=f.source;t.swimlaneIndex<c.swimlaneIndex&&this.extendedDfs(t,c,f,s,n,t.hashCode,m,a+1)}}else s(i,t,e,a,1)}}}class mxSwimlaneLayout extends mxGraphLayout{constructor(t,e,s){super(t);u(this,"roots",null);u(this,"swimlanes",null);u(this,"dummyVertexWidth",50);u(this,"resizeParent",!1);u(this,"maintainParentLocation",!1);u(this,"moveParent",!1);u(this,"parentBorder",30);u(this,"intraCellSpacing",30);u(this,"interRankCellSpacing",100);u(this,"interHierarchySpacing",60);u(this,"parallelEdgeSpacing",10);u(this,"fineTuning",!0);u(this,"tightenToSource",!0);u(this,"disableEdgeStyle",!0);u(this,"traverseAncestors",!0);u(this,"model",null);u(this,"edgesCache",null);u(this,"edgeSourceTermCache",null);u(this,"edgesTargetTermCache",null);u(this,"edgeStyle",mxHierarchicalEdgeStyle.POLYLINE);this.orientation=e??mxConstants.DIRECTION_NORTH,this.deterministic=s??!0}getModel(){return this.model}execute(t,e){this.parent=t;var s=this.graph.model;if(this.edgesCache=new mxDictionary,this.edgeSourceTermCache=new mxDictionary,this.edgesTargetTermCache=new mxDictionary,!(e==null||e.length<1)){if(t==null&&(t=s.getParent(e[0])),this.parentX=null,this.parentY=null,t!=this.root&&s.isVertex(t)!=null&&this.maintainParentLocation){var n=this.graph.getCellGeometry(t);n!=null&&(this.parentX=n.x,this.parentY=n.y)}this.swimlanes=e;for(var l=[],r=0;r<e.length;r++){var a=this.graph.getChildCells(e[r]);if(a==null||a.length==0){var o=this.graph.insertVertex(e[r],null,null,0,0,this.dummyVertexWidth,0);l.push(o)}}s.beginUpdate();try{if(this.run(t),this.resizeParent&&!this.graph.isCellCollapsed(t)&&this.graph.updateGroupBounds([t],this.parentBorder,this.moveParent),this.parentX!=null&&this.parentY!=null){var n=this.graph.getCellGeometry(t);n!=null&&(n=n.clone(),n.x=this.parentX,n.y=this.parentY,s.setGeometry(t,n))}this.graph.removeCells(l)}finally{s.endUpdate()}}}updateGroupBounds(){var t=[],e=this.model;for(var s in e.edgeMapper)for(var n=e.edgeMapper[s],l=0;l<n.edges.length;l++)t.push(n.edges[l]);for(var r=this.graph.getBoundingBoxFromGeometry(t,!0),a=[],l=0;l<this.swimlanes.length;l++){var o=this.swimlanes[l],h=this.graph.getCellGeometry(o);if(h!=null){var d=this.graph.getChildCells(o),g=this.graph.isSwimlane(o)?this.graph.getStartSize(o):new mxRectangle,m=this.graph.getBoundingBoxFromGeometry(d);a[l]=m;var f=m.y+h.y-g.height-this.parentBorder,c=m.y+h.y+m.height;if(r==null)r=new mxRectangle(0,f,0,c-f);else{r.y=Math.min(r.y,f);var x=Math.max(r.y+r.height,c);r.height=x-r.y}}}for(var l=0;l<this.swimlanes.length;l++){var o=this.swimlanes[l],h=this.graph.getCellGeometry(o);if(h!=null){var d=this.graph.getChildCells(o),g=this.graph.isSwimlane(o)?this.graph.getStartSize(o):new mxRectangle,p=h.clone(),C=l==0?this.parentBorder:this.interRankCellSpacing/2,E=g.width+C,T=a[l].x-E,S=r.y-this.parentBorder;p.x+=T,p.y=S,p.width=a[l].width+E+this.interRankCellSpacing/2,p.height=r.height+g.height+2*this.parentBorder,this.graph.model.setGeometry(o,p),this.graph.moveCells(d,-T,h.y-S)}}}findRoots(t,e){var s=[];if(t!=null&&e!=null){var n=this.graph.model,l=null,r=-1e5;for(var a in e){var o=e[a];if(o!=null&&n.isVertex(o)&&this.graph.isCellVisible(o)&&n.isAncestor(t,o)){for(var h=this.getEdges(o),d=0,g=0,m=0;m<h.length;m++){var f=this.getVisibleTerminal(h[m],!0);if(f==o){var c=this.getVisibleTerminal(h[m],!1);n.isAncestor(t,c)&&d++}else n.isAncestor(t,f)&&g++}g==0&&d>0&&s.push(o);var x=d-g;x>r&&(r=x,l=o)}}s.length==0&&l!=null&&s.push(l)}return s}getEdges(t){var e=this.edgesCache.get(t);if(e!=null)return e;for(var s=this.graph.model,n=[],l=this.graph.isCellCollapsed(t),r=s.getChildCount(t),a=0;a<r;a++){var o=s.getChildAt(t,a);(this.isPort(o)||l||!this.graph.isCellVisible(o))&&(n=n.concat(s.getEdges(o,!0,!0)))}n=n.concat(s.getEdges(t,!0,!0));for(var h=[],a=0;a<n.length;a++){var d=this.getVisibleTerminal(n[a],!0),g=this.getVisibleTerminal(n[a],!1);(d==g||d!=g&&(g==t&&(this.parent==null||this.graph.isValidAncestor(d,this.parent,this.traverseAncestors))||d==t&&(this.parent==null||this.graph.isValidAncestor(g,this.parent,this.traverseAncestors))))&&h.push(n[a])}return this.edgesCache.put(t,h),h}getVisibleTerminal(t,e){var s=this.edgesTargetTermCache;e&&(s=this.edgeSourceTermCache);var n=s.get(t);if(n!=null)return n;var l=this.graph.view.getState(t),r=l!=null?l.getVisibleTerminal(e):this.graph.view.getVisibleTerminal(t,e);return r==null&&(r=l!=null?l.getVisibleTerminal(e):this.graph.view.getVisibleTerminal(t,e)),r!=null&&(this.isPort(r)&&(r=this.graph.model.getParent(r)),s.put(t,r)),r}run(t){var e=[],s=Object();if(this.swimlanes!=null&&this.swimlanes.length>0&&t!=null){for(var n=Object(),l=0;l<this.swimlanes.length;l++)this.filterDescendants(this.swimlanes[l],n);this.roots=[];var r=!0;for(var a in n)if(n[a]!=null){r=!1;break}for(var o=0;!r&&o<this.swimlanes.length;){var h=this.findRoots(this.swimlanes[o],n);if(h.length==0){o++;continue}for(var l=0;l<h.length;l++){var d=Object();e.push(d),this.traverse(h[l],!0,null,s,d,e,n,o)}for(var l=0;l<h.length;l++)this.roots.push(h[l]);r=!0;for(var a in n)if(n[a]!=null){r=!1;break}}}else for(var l=0;l<this.roots.length;l++){var d=Object();e.push(d),this.traverse(this.roots[l],!0,null,s,d,e,null)}var g=[];for(var a in s)g.push(s[a]);this.model=new mxSwimlaneModel(this,g,this.roots,t,this.tightenToSource),this.cycleStage(t),this.layeringStage(),this.crossingStage(t),this.placementStage(0,t)}filterDescendants(t,e){var s=this.graph.model;if(s.isVertex(t)&&t!=this.parent&&s.getParent(t)!=this.parent&&this.graph.isCellVisible(t)&&(e[mxObjectIdentity.get(t)]=t),this.traverseAncestors||t==this.parent&&this.graph.isCellVisible(t))for(var n=s.getChildCount(t),l=0;l<n;l++){var r=s.getChildAt(t,l);this.isPort(r)||this.filterDescendants(r,e)}}isPort(t){return!!t.geometry.relative}getEdgesBetween(t,e,s){s=s??!1;for(var n=this.getEdges(t),l=[],r=0;r<n.length;r++){var a=this.getVisibleTerminal(n[r],!0),o=this.getVisibleTerminal(n[r],!1);(a==t&&o==e||!s&&a==e&&o==t)&&l.push(n[r])}return l}traverse(t,e,s,n,l,r,a,o){if(t!=null&&n!=null){var h=mxObjectIdentity.get(t);if(n[h]==null&&(a==null||a[h]!=null)){l[h]==null&&(l[h]=t),n[h]==null&&(n[h]=t),a!==null&&delete a[h];for(var d=this.getEdges(t),g=this.graph.model,m=0;m<d.length;m++){var f=this.getVisibleTerminal(d[m],!0),c=f==t;c&&(f=this.getVisibleTerminal(d[m],!1));var x=0;for(x=0;x<this.swimlanes.length&&!g.isAncestor(this.swimlanes[x],f);x++);x>=this.swimlanes.length||(x>o||(!e||c)&&x==o)&&(l=this.traverse(f,e,d[m],n,l,r,a,x))}}else if(l[h]==null)for(var m=0;m<r.length;m++){var p=r[m];if(p[h]!=null){for(var C in p)l[C]=p[C];return r.splice(m,1),l}}}return l}cycleStage(t){var e=new mxSwimlaneOrdering(this);e.execute(t)}layeringStage(){this.model.initialRank(),this.model.fixRanks()}crossingStage(t){var e=new mxMedianHybridCrossingReduction(this);e.execute(t)}placementStage(t,e){var s=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,t,this.parallelEdgeSpacing);return s.fineTuning=this.fineTuning,s.execute(e),s.limitX+this.interHierarchySpacing}}const pt=class pt{constructor(i){u(this,"constraints",null);u(this,"aspect",null);u(this,"w0",null);u(this,"h0",null);u(this,"bgNode",null);u(this,"fgNode",null);u(this,"strokewidth",null);this.desc=i,this.parseDescription(),this.parseConstraints()}parseDescription(){this.fgNode=this.desc.getElementsByTagName("foreground")[0],this.bgNode=this.desc.getElementsByTagName("background")[0],this.w0=Number(this.desc.getAttribute("w")||100),this.h0=Number(this.desc.getAttribute("h")||100);var i=this.desc.getAttribute("aspect");this.aspect=i??"variable";var t=this.desc.getAttribute("strokewidth");this.strokewidth=t??"1"}parseConstraints(){var i=this.desc.getElementsByTagName("connections")[0];if(i!=null){var t=mxUtils.getChildNodes(i);if(t!=null&&t.length>0){this.constraints=[];for(var e=0;e<t.length;e++)this.constraints.push(this.parseConstraint(t[e]))}}}parseConstraint(i){var t=Number(i.getAttribute("x")),e=Number(i.getAttribute("y")),s=i.getAttribute("perimeter")=="1",n=i.getAttribute("name");return new mxConnectionConstraint(new mxPoint(t,e),s,n)}evaluateTextAttribute(i,t,e){var s=this.evaluateAttribute(i,t,e),n=i.getAttribute("localized");return(pt.defaultLocalized&&n==null||n=="1")&&(s=mxResources.get(s)),s}evaluateAttribute(i,t,e){var s=i.getAttribute(t);if(s==null){var n=mxUtils.getTextContent(i);if(n!=null&&pt.allowEval){var l=mxUtils.eval(n);typeof l=="function"&&(s=l(e))}}return s}drawShape(i,t,e,s,n,l){var r=i.states.slice(),a=mxUtils.getValue(t.style,mxConstants.STYLE_DIRECTION,null),o=this.computeAspect(t.style,e,s,n,l,a),h=Math.min(o.width,o.height),d=this.strokewidth=="inherit"?Number(mxUtils.getNumber(t.style,mxConstants.STYLE_STROKEWIDTH,1)):Number(this.strokewidth)*h;i.setStrokeWidth(d),t.style!=null&&mxUtils.getValue(t.style,mxConstants.STYLE_POINTER_EVENTS,"0")=="1"&&(i.setStrokeColor(mxConstants.NONE),i.rect(e,s,n,l),i.stroke(),i.setStrokeColor(t.stroke)),this.drawChildren(i,t,e,s,n,l,this.bgNode,o,!1,!0),this.drawChildren(i,t,e,s,n,l,this.fgNode,o,!0,!t.outline||t.style==null||mxUtils.getValue(t.style,mxConstants.STYLE_BACKGROUND_OUTLINE,0)==0),i.states.length!=r.length&&(i.states=r)}drawChildren(i,t,e,s,n,l,r,a,o,h){if(r!=null&&n>0&&l>0)for(var d=r.firstChild;d!=null;)d.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(i,t,d,a,o,h),d=d.nextSibling}computeAspect(i,t,e,s,n,l){var r=t,a=e,o=s/this.w0,h=n/this.h0,d=l==mxConstants.DIRECTION_NORTH||l==mxConstants.DIRECTION_SOUTH;if(d){h=s/this.h0,o=n/this.w0;var g=(s-n)/2;r+=g,a-=g}return this.aspect=="fixed"&&(h=Math.min(o,h),o=h,d?(r+=(n-this.w0*o)/2,a+=(s-this.h0*h)/2):(r+=(s-this.w0*o)/2,a+=(n-this.h0*h)/2)),new mxRectangle(r,a,o,h)}drawNode(i,t,e,s,n,l){var r=e.nodeName,a=s.x,o=s.y,h=s.width,d=s.height,g=Math.min(h,d);if(r=="save")i.save();else if(r=="restore")i.restore();else if(l){if(r=="path"){i.begin();var m=!0;if(e.getAttribute("rounded")=="1"){m=!1;for(var f=Number(e.getAttribute("arcSize")),c=0,x=[],p=e.firstChild;p!=null;){if(p.nodeType==mxConstants.NODETYPE_ELEMENT){var C=p.nodeName;if(C=="move"||C=="line")(C=="move"||x.length==0)&&x.push([]),x[x.length-1].push(new mxPoint(a+Number(p.getAttribute("x"))*h,o+Number(p.getAttribute("y"))*d)),c++;else{m=!0;break}}p=p.nextSibling}if(!m&&c>0)for(var E=0;E<x.length;E++){var T=!1,S=x[E][0],y=x[E][x[E].length-1];S.x==y.x&&S.y==y.y&&(x[E].pop(),T=!0),this.addPoints(i,x[E],!0,f,T)}else m=!0}if(m)for(var p=e.firstChild;p!=null;)p.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(i,t,p,s,n,l),p=p.nextSibling}else if(r=="close")i.close();else if(r=="move")i.moveTo(a+Number(e.getAttribute("x"))*h,o+Number(e.getAttribute("y"))*d);else if(r=="line")i.lineTo(a+Number(e.getAttribute("x"))*h,o+Number(e.getAttribute("y"))*d);else if(r=="quad")i.quadTo(a+Number(e.getAttribute("x1"))*h,o+Number(e.getAttribute("y1"))*d,a+Number(e.getAttribute("x2"))*h,o+Number(e.getAttribute("y2"))*d);else if(r=="curve")i.curveTo(a+Number(e.getAttribute("x1"))*h,o+Number(e.getAttribute("y1"))*d,a+Number(e.getAttribute("x2"))*h,o+Number(e.getAttribute("y2"))*d,a+Number(e.getAttribute("x3"))*h,o+Number(e.getAttribute("y3"))*d);else if(r=="arc")i.arcTo(Number(e.getAttribute("rx"))*h,Number(e.getAttribute("ry"))*d,Number(e.getAttribute("x-axis-rotation")),Number(e.getAttribute("large-arc-flag")),Number(e.getAttribute("sweep-flag")),a+Number(e.getAttribute("x"))*h,o+Number(e.getAttribute("y"))*d);else if(r=="rect")i.rect(a+Number(e.getAttribute("x"))*h,o+Number(e.getAttribute("y"))*d,Number(e.getAttribute("w"))*h,Number(e.getAttribute("h"))*d);else if(r=="roundrect"){var b=Number(e.getAttribute("arcsize"));b==0&&(b=mxConstants.RECTANGLE_ROUNDING_FACTOR*100);var w=Number(e.getAttribute("w"))*h,I=Number(e.getAttribute("h"))*d,O=Number(b)/100,P=Math.min(w*O,I*O);i.roundrect(a+Number(e.getAttribute("x"))*h,o+Number(e.getAttribute("y"))*d,w,I,P,P)}else if(r=="ellipse")i.ellipse(a+Number(e.getAttribute("x"))*h,o+Number(e.getAttribute("y"))*d,Number(e.getAttribute("w"))*h,Number(e.getAttribute("h"))*d);else if(r=="image"){if(!t.outline){var M=this.evaluateAttribute(e,"src",t);i.image(a+Number(e.getAttribute("x"))*h,o+Number(e.getAttribute("y"))*d,Number(e.getAttribute("w"))*h,Number(e.getAttribute("h"))*d,M,!1,e.getAttribute("flipH")=="1",e.getAttribute("flipV")=="1")}}else if(r=="text"){if(!t.outline){var H=this.evaluateTextAttribute(e,"str",t),R=e.getAttribute("vertical")=="1"?-90:0;if(e.getAttribute("align-shape")=="0"){var D=t.rotation,A=mxUtils.getValue(t.style,mxConstants.STYLE_FLIPH,0)==1,G=mxUtils.getValue(t.style,mxConstants.STYLE_FLIPV,0)==1;A&&G?R-=D:A||G?R+=D:R-=D}R-=e.getAttribute("rotation"),i.text(a+Number(e.getAttribute("x"))*h,o+Number(e.getAttribute("y"))*d,0,0,H,e.getAttribute("align")||"left",e.getAttribute("valign")||"top",!1,"",null,!1,R)}}else if(r=="include-shape"){var B=mxStencilRegistry.getStencil(e.getAttribute("name"));if(B!=null){var tt=a+Number(e.getAttribute("x"))*h,q=o+Number(e.getAttribute("y"))*d,w=Number(e.getAttribute("w"))*h,I=Number(e.getAttribute("h"))*d;B.drawShape(i,t,tt,q,w,I)}}else if(r=="fillstroke")i.fillAndStroke();else if(r=="fill")i.fill();else if(r=="stroke")i.stroke();else if(r=="strokewidth"){var j=e.getAttribute("fixed")=="1"?1:g;i.setStrokeWidth(Number(e.getAttribute("width"))*j)}else if(r=="dashed")i.setDashed(e.getAttribute("dashed")=="1");else if(r=="dashpattern"){var V=e.getAttribute("pattern");if(V!=null){for(var X=V.split(" "),Z=[],E=0;E<X.length;E++)X[E].length>0&&Z.push(Number(X[E])*g);V=Z.join(" "),i.setDashPattern(V)}}else r=="strokecolor"?i.setStrokeColor(e.getAttribute("color")):r=="linecap"?i.setLineCap(e.getAttribute("cap")):r=="linejoin"?i.setLineJoin(e.getAttribute("join")):r=="miterlimit"?i.setMiterLimit(Number(e.getAttribute("limit"))):r=="fillcolor"?i.setFillColor(e.getAttribute("color")):r=="alpha"||r=="fillalpha"||r=="strokealpha"?i.setAlpha(e.getAttribute("alpha")):r=="fontcolor"?i.setFontColor(e.getAttribute("color")):r=="fontstyle"?i.setFontStyle(e.getAttribute("style")):r=="fontfamily"?i.setFontFamily(e.getAttribute("family")):r=="fontsize"&&i.setFontSize(Number(e.getAttribute("size"))*g);n&&(r=="fillstroke"||r=="fill"||r=="stroke")&&(n=!1,i.setShadow(!1))}}};u(pt,"defaultLocalized",!1),u(pt,"allowEval",!1);let mxStencil=pt;class mxAnimation extends mxEventSource{constructor(t){super();u(this,"thread",null);this.delay=t??20}isRunning(){return this.thread!=null}startAnimation(){this.thread==null&&(this.thread=window.setInterval(mxUtils.bind(this,this.updateAnimation),this.delay))}updateAnimation(){this.fireEvent(new mxEventObject(mxEvent.EXECUTE))}stopAnimation(){this.thread!=null&&(window.clearInterval(this.thread),this.thread=null,this.fireEvent(new mxEventObject(mxEvent.DONE)))}}class mxAutoSaveManager extends mxEventSource{constructor(t){super();u(this,"graph",null);u(this,"autoSaveDelay",10);u(this,"autoSaveThrottle",2);u(this,"autoSaveThreshold",5);u(this,"ignoredChanges",0);u(this,"lastSnapshot",0);u(this,"enabled",!0);this.changeHandler=(e,s)=>{this.isEnabled()&&this.graphModelChanged(s.getProperty("edit").changes)},this.setGraph(t)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}setGraph(t){this.graph!=null&&this.graph.getModel().removeListener(this.changeHandler),this.graph=t,this.graph!=null&&this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler)}save(){}graphModelChanged(t){var e=new Date().getTime(),s=(e-this.lastSnapshot)/1e3;s>this.autoSaveDelay||this.ignoredChanges>=this.autoSaveThreshold&&s>this.autoSaveThrottle?(this.save(),this.reset()):this.ignoredChanges++}reset(){this.lastSnapshot=new Date().getTime(),this.ignoredChanges=0}destroy(){this.setGraph(null)}}class mxImageBundle{constructor(i){this.images=[],this.alt=i??!1}putImage(i,t,e){this.images[i]={value:t,fallback:e}}getImage(i){var t=null;if(i!=null){var e=this.images[i];e!=null&&(t=this.alt?e.fallback:e.value)}return t}}class mxImageExport{constructor(){u(this,"includeOverlays",!1)}drawState(i,t){i!=null&&(this.visitStatesRecursive(i,t,()=>{this.drawCellState.apply(this,arguments)}),this.includeOverlays&&this.visitStatesRecursive(i,t,()=>{this.drawOverlays.apply(this,arguments)}))}visitStatesRecursive(i,t,e){if(i!=null){e(i,t);for(var s=i.view.graph,n=s.model.getChildCount(i.cell),l=0;l<n;l++){var r=s.view.getState(s.model.getChildAt(i.cell,l));this.visitStatesRecursive(r,t,e)}}}getLinkForCellState(i,t){return null}drawCellState(i,t){var e=this.getLinkForCellState(i,t);e!=null&&t.setLink(e),this.drawShape(i,t),this.drawText(i,t),e!=null&&t.setLink(null)}drawShape(i,t){i.shape instanceof mxShape&&i.shape.checkBounds()&&(t.save(),i.shape.paint(t),t.restore())}drawText(i,t){i.text!=null&&i.text.checkBounds()&&(t.save(),i.text.paint(t),t.restore())}drawOverlays(i,t){i.overlays!=null&&i.overlays.visit(function(e,s){s instanceof mxShape&&s.paint(t)})}}class mxCellStatePreview{constructor(i){u(this,"count",0);this.deltas=new mxDictionary,this.graph=i}isEmpty(){return this.count==0}moveState(i,t,e,s,n){s=s??!0,n=n??!0;var l=this.deltas.get(i.cell);return l==null?(l={point:new mxPoint(t,e),state:i},this.deltas.put(i.cell,l),this.count++):s?(l.point.x+=t,l.point.y+=e):(l.point.x=t,l.point.y=e),n&&this.addEdges(i),l.point}show(i){this.deltas.visit((t,e)=>{this.translateState(e.state,e.point.x,e.point.y)}),this.deltas.visit((t,e)=>{this.revalidateState(e.state,e.point.x,e.point.y,i)})}translateState(i,t,e){if(i!=null){var s=this.graph.getModel();if(s.isVertex(i.cell)){i.view.updateCellState(i);var n=s.getGeometry(i.cell);(t!=0||e!=0)&&n!=null&&(!n.relative||this.deltas.get(i.cell)!=null)&&(i.x+=t,i.y+=e)}for(var l=s.getChildCount(i.cell),r=0;r<l;r++)this.translateState(i.view.getState(s.getChildAt(i.cell,r)),t,e)}}revalidateState(i,t,e,s){if(i!=null){var n=this.graph.getModel();n.isEdge(i.cell)&&i.view.updateCellState(i);var l=this.graph.getCellGeometry(i.cell),r=i.view.getState(n.getParent(i.cell));(t!=0||e!=0)&&l!=null&&l.relative&&n.isVertex(i.cell)&&(r==null||n.isVertex(r.cell)||this.deltas.get(i.cell)!=null)&&(i.x+=t,i.y+=e),this.graph.cellRenderer.redraw(i),s!=null&&s(i);for(var a=n.getChildCount(i.cell),o=0;o<a;o++)this.revalidateState(this.graph.view.getState(n.getChildAt(i.cell,o)),t,e,s)}}addEdges(i){for(var t=this.graph.getModel(),e=t.getEdgeCount(i.cell),s=0;s<e;s++){var n=i.view.getState(t.getEdgeAt(i.cell,s));n!=null&&this.moveState(n,0,0)}}}class mxMorphing extends mxAnimation{constructor(t,e,s,n){super(n);u(this,"step",0);u(this,"cells",null);this.graph=t,this.steps=e??6,this.ease=s??1.5}updateAnimation(){super.updateAnimation();var t=new mxCellStatePreview(this.graph);if(this.cells!=null)for(var e=0;e<this.cells.length;e++)this.animateCell(this.cells[e],t,!1);else this.animateCell(this.graph.getModel().getRoot(),t,!0);this.show(t),(t.isEmpty()||this.step++>=this.steps)&&this.stopAnimation()}show(t){t.show()}animateCell(t,e,s){var n=this.graph.getView().getState(t),l=null;if(n!=null&&(l=this.getDelta(n),this.graph.getModel().isVertex(t)&&(l.x!=0||l.y!=0))){var r=this.graph.view.getTranslate(),a=this.graph.view.getScale();l.x+=r.x*a,l.y+=r.y*a,e.moveState(n,-l.x/this.ease,-l.y/this.ease)}if(s&&!this.stopRecursion(n,l))for(var o=this.graph.getModel().getChildCount(t),h=0;h<o;h++)this.animateCell(this.graph.getModel().getChildAt(t,h),e,s)}stopRecursion(t,e){return e!=null&&(e.x!=0||e.y!=0)}getDelta(t){var e=this.getOriginForCell(t.cell),s=this.graph.getView().getTranslate(),n=this.graph.getView().getScale(),l=t.x/n-s.x,r=t.y/n-s.y;return new mxPoint((e.x-l)*n,(e.y-r)*n)}getOriginForCell(t){var e=null;if(t!=null){var s=this.graph.getModel().getParent(t),n=this.graph.getCellGeometry(t);if(e=this.getOriginForCell(s),n!=null)if(n.relative){var l=this.graph.getCellGeometry(s);l!=null&&(e.x+=n.x*l.width,e.y+=n.y*l.height)}else e.x+=n.x,e.y+=n.y}if(e==null){var r=this.graph.view.getTranslate();e=new mxPoint(-r.x,-r.y)}return e}}class mxXmlCanvas2D extends mxAbstractCanvas2D{constructor(t){super();u(this,"textEnabled",!0);u(this,"compressed",!0);this.root=t,this.writeDefaults()}writeDefaults(){var t;t=this.createElement("fontfamily"),t.setAttribute("family",mxConstants.DEFAULT_FONTFAMILY),this.root.appendChild(t),t=this.createElement("fontsize"),t.setAttribute("size",mxConstants.DEFAULT_FONTSIZE),this.root.appendChild(t),t=this.createElement("shadowcolor"),t.setAttribute("color",mxConstants.SHADOWCOLOR),this.root.appendChild(t),t=this.createElement("shadowalpha"),t.setAttribute("alpha",mxConstants.SHADOW_OPACITY),this.root.appendChild(t),t=this.createElement("shadowoffset"),t.setAttribute("dx",mxConstants.SHADOW_OFFSET_X),t.setAttribute("dy",mxConstants.SHADOW_OFFSET_Y),this.root.appendChild(t)}format(t){return parseFloat(parseFloat(t).toFixed(2))}createElement(t){return this.root.ownerDocument.createElement(t)}save(){this.compressed&&super.save(),this.root.appendChild(this.createElement("save"))}restore(){this.compressed&&super.restore(),this.root.appendChild(this.createElement("restore"))}scale(t){var e=this.createElement("scale");e.setAttribute("scale",t),this.root.appendChild(e)}translate(t,e){var s=this.createElement("translate");s.setAttribute("dx",this.format(t)),s.setAttribute("dy",this.format(e)),this.root.appendChild(s)}rotate(t,e,s,n,l){var r=this.createElement("rotate");(t!=0||e||s)&&(r.setAttribute("theta",this.format(t)),r.setAttribute("flipH",e?"1":"0"),r.setAttribute("flipV",s?"1":"0"),r.setAttribute("cx",this.format(n)),r.setAttribute("cy",this.format(l)),this.root.appendChild(r))}setAlpha(t){if(this.compressed){if(this.state.alpha==t)return;super.setAlpha(t)}var e=this.createElement("alpha");e.setAttribute("alpha",this.format(t)),this.root.appendChild(e)}setFillAlpha(t){if(this.compressed){if(this.state.fillAlpha==t)return;super.setFillAlpha(t)}var e=this.createElement("fillalpha");e.setAttribute("alpha",this.format(t)),this.root.appendChild(e)}setStrokeAlpha(t){if(this.compressed){if(this.state.strokeAlpha==t)return;super.setStrokeAlpha(t)}var e=this.createElement("strokealpha");e.setAttribute("alpha",this.format(t)),this.root.appendChild(e)}setFillColor(t){if(t==mxConstants.NONE&&(t=null),this.compressed){if(this.state.fillColor==t)return;super.setFillColor(t)}var e=this.createElement("fillcolor");e.setAttribute("color",t??mxConstants.NONE),this.root.appendChild(e)}setGradient(t,e,s,n,l,r,a,o,h){if(t!=null&&e!=null){super.setGradient(t,e,s,n,l,r,a,o,h);var d=this.createElement("gradient");d.setAttribute("c1",t),d.setAttribute("c2",e),d.setAttribute("x",this.format(s)),d.setAttribute("y",this.format(n)),d.setAttribute("w",this.format(l)),d.setAttribute("h",this.format(r)),a!=null&&d.setAttribute("direction",a),o!=null&&d.setAttribute("alpha1",o),h!=null&&d.setAttribute("alpha2",h),this.root.appendChild(d)}}setStrokeColor(t){if(t==mxConstants.NONE&&(t=null),this.compressed){if(this.state.strokeColor==t)return;super.setStrokeColor(t)}var e=this.createElement("strokecolor");e.setAttribute("color",t??mxConstants.NONE),this.root.appendChild(e)}setStrokeWidth(t){if(this.compressed){if(this.state.strokeWidth==t)return;super.setStrokeWidth(t)}var e=this.createElement("strokewidth");e.setAttribute("width",this.format(t)),this.root.appendChild(e)}setDashed(t,e){if(this.compressed){if(this.state.dashed==t)return;super.setDashed(t,e)}var s=this.createElement("dashed");s.setAttribute("dashed",t?"1":"0"),e!=null&&s.setAttribute("fixDash",e?"1":"0"),this.root.appendChild(s)}setDashPattern(t){if(this.compressed){if(this.state.dashPattern==t)return;super.setDashPattern(t)}var e=this.createElement("dashpattern");e.setAttribute("pattern",t),this.root.appendChild(e)}setLineCap(t){if(this.compressed){if(this.state.lineCap==t)return;super.setLineCap(t)}var e=this.createElement("linecap");e.setAttribute("cap",t),this.root.appendChild(e)}setLineJoin(t){if(this.compressed){if(this.state.lineJoin==t)return;super.setLineJoin(t)}var e=this.createElement("linejoin");e.setAttribute("join",t),this.root.appendChild(e)}setMiterLimit(t){if(this.compressed){if(this.state.miterLimit==t)return;super.setMiterLimit(t)}var e=this.createElement("miterlimit");e.setAttribute("limit",t),this.root.appendChild(e)}setFontColor(t){if(this.textEnabled){if(t==mxConstants.NONE&&(t=null),this.compressed){if(this.state.fontColor==t)return;super.setFontColor(t)}var e=this.createElement("fontcolor");e.setAttribute("color",t??mxConstants.NONE),this.root.appendChild(e)}}setFontBackgroundColor(t){if(this.textEnabled){if(t==mxConstants.NONE&&(t=null),this.compressed){if(this.state.fontBackgroundColor==t)return;super.setFontBackgroundColor(t)}var e=this.createElement("fontbackgroundcolor");e.setAttribute("color",t??mxConstants.NONE),this.root.appendChild(e)}}setFontBorderColor(t){if(this.textEnabled){if(t==mxConstants.NONE&&(t=null),this.compressed){if(this.state.fontBorderColor==t)return;super.setFontBorderColor(t)}var e=this.createElement("fontbordercolor");e.setAttribute("color",t??mxConstants.NONE),this.root.appendChild(e)}}setFontSize(t){if(this.textEnabled){if(this.compressed){if(this.state.fontSize==t)return;super.setFontSize(t)}var e=this.createElement("fontsize");e.setAttribute("size",t),this.root.appendChild(e)}}setFontFamily(t){if(this.textEnabled){if(this.compressed){if(this.state.fontFamily==t)return;super.setFontFamily(t)}var e=this.createElement("fontfamily");e.setAttribute("family",t),this.root.appendChild(e)}}setFontStyle(t){if(this.textEnabled){if(t==null&&(t=0),this.compressed){if(this.state.fontStyle==t)return;super.setFontStyle(t)}var e=this.createElement("fontstyle");e.setAttribute("style",t),this.root.appendChild(e)}}setShadow(t){if(this.compressed){if(this.state.shadow==t)return;super.setShadow(t)}var e=this.createElement("shadow");e.setAttribute("enabled",t?"1":"0"),this.root.appendChild(e)}setShadowColor(t){if(this.compressed){if(t==mxConstants.NONE&&(t=null),this.state.shadowColor==t)return;super.setShadowColor(t)}var e=this.createElement("shadowcolor");e.setAttribute("color",t??mxConstants.NONE),this.root.appendChild(e)}setShadowAlpha(t){if(this.compressed){if(this.state.shadowAlpha==t)return;super.setShadowAlpha(t)}var e=this.createElement("shadowalpha");e.setAttribute("alpha",t),this.root.appendChild(e)}setShadowOffset(t,e){if(this.compressed){if(this.state.shadowDx==t&&this.state.shadowDy==e)return;super.setShadowOffset(t,e)}var s=this.createElement("shadowoffset");s.setAttribute("dx",t),s.setAttribute("dy",e),this.root.appendChild(s)}rect(t,e,s,n){var l=this.createElement("rect");l.setAttribute("x",this.format(t)),l.setAttribute("y",this.format(e)),l.setAttribute("w",this.format(s)),l.setAttribute("h",this.format(n)),this.root.appendChild(l)}roundrect(t,e,s,n,l,r){var a=this.createElement("roundrect");a.setAttribute("x",this.format(t)),a.setAttribute("y",this.format(e)),a.setAttribute("w",this.format(s)),a.setAttribute("h",this.format(n)),a.setAttribute("dx",this.format(l)),a.setAttribute("dy",this.format(r)),this.root.appendChild(a)}ellipse(t,e,s,n){var l=this.createElement("ellipse");l.setAttribute("x",this.format(t)),l.setAttribute("y",this.format(e)),l.setAttribute("w",this.format(s)),l.setAttribute("h",this.format(n)),this.root.appendChild(l)}image(t,e,s,n,l,r,a,o){l=this.converter.convert(l);var h=this.createElement("image");h.setAttribute("x",this.format(t)),h.setAttribute("y",this.format(e)),h.setAttribute("w",this.format(s)),h.setAttribute("h",this.format(n)),h.setAttribute("src",l),h.setAttribute("aspect",r?"1":"0"),h.setAttribute("flipH",a?"1":"0"),h.setAttribute("flipV",o?"1":"0"),this.root.appendChild(h)}begin(){this.root.appendChild(this.createElement("begin")),this.lastX=0,this.lastY=0}moveTo(t,e){var s=this.createElement("move");s.setAttribute("x",this.format(t)),s.setAttribute("y",this.format(e)),this.root.appendChild(s),this.lastX=t,this.lastY=e}lineTo(t,e){var s=this.createElement("line");s.setAttribute("x",this.format(t)),s.setAttribute("y",this.format(e)),this.root.appendChild(s),this.lastX=t,this.lastY=e}quadTo(t,e,s,n){var l=this.createElement("quad");l.setAttribute("x1",this.format(t)),l.setAttribute("y1",this.format(e)),l.setAttribute("x2",this.format(s)),l.setAttribute("y2",this.format(n)),this.root.appendChild(l),this.lastX=s,this.lastY=n}curveTo(t,e,s,n,l,r){var a=this.createElement("curve");a.setAttribute("x1",this.format(t)),a.setAttribute("y1",this.format(e)),a.setAttribute("x2",this.format(s)),a.setAttribute("y2",this.format(n)),a.setAttribute("x3",this.format(l)),a.setAttribute("y3",this.format(r)),this.root.appendChild(a),this.lastX=l,this.lastY=r}close(){this.root.appendChild(this.createElement("close"))}text(t,e,s,n,l,r,a,o,h,d,g,m,f){if(this.textEnabled&&l!=null){mxUtils.isNode(l)&&(l=mxUtils.getOuterHtml(l));var c=this.createElement("text");c.setAttribute("x",this.format(t)),c.setAttribute("y",this.format(e)),c.setAttribute("w",this.format(s)),c.setAttribute("h",this.format(n)),c.setAttribute("str",l),r!=null&&c.setAttribute("align",r),a!=null&&c.setAttribute("valign",a),c.setAttribute("wrap",o?"1":"0"),h==null&&(h=""),c.setAttribute("format",h),d!=null&&c.setAttribute("overflow",d),g!=null&&c.setAttribute("clip",g?"1":"0"),m!=null&&c.setAttribute("rotation",m),f!=null&&c.setAttribute("dir",f),this.root.appendChild(c)}}stroke(){this.root.appendChild(this.createElement("stroke"))}fill(){this.root.appendChild(this.createElement("fill"))}fillAndStroke(){this.root.appendChild(this.createElement("fillstroke"))}}class mxMultiplicity{constructor(i,t,e,s,n,l,r,a,o,h){this.source=i,this.type=t,this.attr=e,this.value=s,this.min=n??0,this.max=l??"n",this.validNeighbors=r,this.countError=mxResources.get(a)||a,this.typeError=mxResources.get(o)||o,this.validNeighborsAllowed=h??!0}check(i,t,e,s,n,l){var r="";if((this.source&&this.checkTerminal(i,e,t)||!this.source&&this.checkTerminal(i,s,t))&&(this.countError!=null&&(this.source&&(this.max==0||n>=this.max)||!this.source&&(this.max==0||l>=this.max))&&(r+=this.countError+`
`),this.validNeighbors!=null&&this.typeError!=null&&this.validNeighbors.length>0)){var a=this.checkNeighbors(i,t,e,s);a||(r+=this.typeError+`
`)}return r.length>0?r:null}checkNeighbors(i,t,e,s){for(var n=i.model.getValue(e),l=i.model.getValue(s),r=!this.validNeighborsAllowed,a=this.validNeighbors,o=0;o<a.length;o++)if(this.source&&this.checkType(i,l,a[o])){r=this.validNeighborsAllowed;break}else if(!this.source&&this.checkType(i,n,a[o])){r=this.validNeighborsAllowed;break}return r}checkTerminal(i,t,e){var s=i.model.getValue(t);return this.checkType(i,s,this.type,this.attr,this.value)}checkType(i,t,e,s,n){return t!=null?isNaN(t.nodeType)?t==e:mxUtils.isNode(t,e,s,n):!1}}bootstrap(),exports.MedianCellSorter=MedianCellSorter,exports.WeightedCellSorter=WeightedCellSorter,exports.mxAbstractCanvas2D=mxAbstractCanvas2D,exports.mxActor=mxActor,exports.mxAnimation=mxAnimation,exports.mxArrow=mxArrow,exports.mxArrowConnector=mxArrowConnector,exports.mxAutoSaveManager=mxAutoSaveManager,exports.mxCell=mxCell,exports.mxCellAttributeChange=mxCellAttributeChange,exports.mxCellCodec=mxCellCodec,exports.mxCellEditor=mxCellEditor,exports.mxCellHighlight=mxCellHighlight,exports.mxCellMarker=mxCellMarker,exports.mxCellOverlay=mxCellOverlay,exports.mxCellPath=mxCellPath,exports.mxCellRenderer=mxCellRenderer,exports.mxCellState=mxCellState,exports.mxCellStatePreview=mxCellStatePreview,exports.mxCellTracker=mxCellTracker,exports.mxChildChange=mxChildChange,exports.mxChildChangeCodec=mxChildChangeCodec,exports.mxCircleLayout=mxCircleLayout,exports.mxClient=mxClient,exports.mxClipboard=mxClipboard,exports.mxCloud=mxCloud,exports.mxCodec=mxCodec,exports.mxCodecRegistry=mxCodecRegistry,exports.mxCollapseChange=mxCollapseChange,exports.mxCompactTreeLayout=mxCompactTreeLayout,exports.mxCompositeLayout=mxCompositeLayout,exports.mxConnectionConstraint=mxConnectionConstraint,exports.mxConnectionHandler=mxConnectionHandler,exports.mxConnector=mxConnector,exports.mxConstants=mxConstants,exports.mxConstraintHandler=mxConstraintHandler,exports.mxCoordinateAssignment=mxCoordinateAssignment,exports.mxCurrentRootChange=mxCurrentRootChange,exports.mxCylinder=mxCylinder,exports.mxDefaultKeyHandler=mxDefaultKeyHandler,exports.mxDefaultKeyHandlerCodec=mxDefaultKeyHandlerCodec,exports.mxDefaultPopupMenu=mxDefaultPopupMenu,exports.mxDefaultPopupMenuCodec=mxDefaultPopupMenuCodec,exports.mxDefaultToolbar=mxDefaultToolbar,exports.mxDefaultToolbarCodec=mxDefaultToolbarCodec,exports.mxDictionary=mxDictionary,exports.mxDivResizer=mxDivResizer,exports.mxDoubleEllipse=mxDoubleEllipse,exports.mxDragSource=mxDragSource,exports.mxEdgeHandler=mxEdgeHandler,exports.mxEdgeLabelLayout=mxEdgeLabelLayout,exports.mxEdgeSegmentHandler=mxEdgeSegmentHandler,exports.mxEdgeStyle=mxEdgeStyle,exports.mxEditor=mxEditor,exports.mxEditorCodec=mxEditorCodec,exports.mxEffects=mxEffects,exports.mxElbowEdgeHandler=mxElbowEdgeHandler,exports.mxEllipse=mxEllipse,exports.mxEvent=mxEvent,exports.mxEventObject=mxEventObject,exports.mxEventSource=mxEventSource,exports.mxFastOrganicLayout=mxFastOrganicLayout,exports.mxForm=mxForm,exports.mxGenericChangeCodec=mxGenericChangeCodec,exports.mxGeometry=mxGeometry,exports.mxGeometryChange=mxGeometryChange,exports.mxGraph=mxGraph,exports.mxGraphAbstractHierarchyCell=mxGraphAbstractHierarchyCell,exports.mxGraphCodec=mxGraphCodec,exports.mxGraphHandler=mxGraphHandler,exports.mxGraphHierarchyEdge=mxGraphHierarchyEdge,exports.mxGraphHierarchyModel=mxGraphHierarchyModel,exports.mxGraphHierarchyNode=mxGraphHierarchyNode,exports.mxGraphLayout=mxGraphLayout,exports.mxGraphModel=mxGraphModel,exports.mxGraphSelectionModel=mxGraphSelectionModel,exports.mxGraphView=mxGraphView,exports.mxGraphViewCodec=mxGraphViewCodec,exports.mxGuide=mxGuide,exports.mxHandle=mxHandle,exports.mxHexagon=mxHexagon,exports.mxHierarchicalEdgeStyle=mxHierarchicalEdgeStyle,exports.mxHierarchicalLayout=mxHierarchicalLayout,exports.mxHierarchicalLayoutStage=mxHierarchicalLayoutStage,exports.mxImage=mxImage,exports.mxImageBundle=mxImageBundle,exports.mxImageExport=mxImageExport,exports.mxImageShape=mxImageShape,exports.mxKeyHandler=mxKeyHandler,exports.mxLabel=mxLabel,exports.mxLayoutManager=mxLayoutManager,exports.mxLine=mxLine,exports.mxLog=mxLog,exports.mxMarker=mxMarker,exports.mxMedianHybridCrossingReduction=mxMedianHybridCrossingReduction,exports.mxMinimumCycleRemover=mxMinimumCycleRemover,exports.mxModelCodec=mxModelCodec,exports.mxMorphing=mxMorphing,exports.mxMouseEvent=mxMouseEvent,exports.mxMultiplicity=mxMultiplicity,exports.mxObjectCodec=mxObjectCodec,exports.mxObjectIdentity=mxObjectIdentity,exports.mxOutline=mxOutline,exports.mxPanningHandler=mxPanningHandler,exports.mxPanningManager=mxPanningManager,exports.mxParallelEdgeLayout=mxParallelEdgeLayout,exports.mxPartitionLayout=mxPartitionLayout,exports.mxPerimeter=mxPerimeter,exports.mxPoint=mxPoint,exports.mxPolyline=mxPolyline,exports.mxPopupMenu=mxPopupMenu,exports.mxPopupMenuHandler=mxPopupMenuHandler,exports.mxPrintPreview=mxPrintPreview,exports.mxRadialTreeLayout=mxRadialTreeLayout,exports.mxRectangle=mxRectangle,exports.mxRectangleShape=mxRectangleShape,exports.mxResources=mxResources,exports.mxRhombus=mxRhombus,exports.mxRootChange=mxRootChange,exports.mxRootChangeCodec=mxRootChangeCodec,exports.mxRubberband=mxRubberband,exports.mxSelectionCellsHandler=mxSelectionCellsHandler,exports.mxSelectionChange=mxSelectionChange,exports.mxShape=mxShape,exports.mxStackLayout=mxStackLayout,exports.mxStencil=mxStencil,exports.mxStencilRegistry=mxStencilRegistry,exports.mxStyleChange=mxStyleChange,exports.mxStyleRegistry=mxStyleRegistry,exports.mxStylesheet=mxStylesheet,exports.mxStylesheetCodec=mxStylesheetCodec,exports.mxSvgCanvas2D=mxSvgCanvas2D,exports.mxSwimlane=mxSwimlane,exports.mxSwimlaneLayout=mxSwimlaneLayout,exports.mxSwimlaneManager=mxSwimlaneManager,exports.mxSwimlaneModel=mxSwimlaneModel,exports.mxSwimlaneOrdering=mxSwimlaneOrdering,exports.mxTemporaryCellStates=mxTemporaryCellStates,exports.mxTerminalChange=mxTerminalChange,exports.mxTerminalChangeCodec=mxTerminalChangeCodec,exports.mxText=mxText,exports.mxToolbar=mxToolbar,exports.mxTooltipHandler=mxTooltipHandler,exports.mxTriangle=mxTriangle,exports.mxUndoManager=mxUndoManager,exports.mxUndoableEdit=mxUndoableEdit,exports.mxUrlConverter=mxUrlConverter,exports.mxUtils=mxUtils,exports.mxValueChange=mxValueChange,exports.mxVertexHandler=mxVertexHandler,exports.mxVisibleChange=mxVisibleChange,exports.mxVmlCanvas2D=mxVmlCanvas2D,exports.mxWindow=mxWindow,exports.mxXmlCanvas2D=mxXmlCanvas2D,exports.mxXmlRequest=mxXmlRequest,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})});
